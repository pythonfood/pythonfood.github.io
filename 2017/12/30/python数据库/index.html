<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>python数据库 | PythonFood</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
    <meta name="keywords" content="python food,Python Food," />
  
  <meta name="description" content="人生苦短，我用python。">
<meta name="keywords" content="python">
<meta property="og:type" content="article">
<meta property="og:title" content="python数据库">
<meta property="og:url" content="http://pythonfood.github.io/2017/12/30/python数据库/index.html">
<meta property="og:site_name" content="PythonFood">
<meta property="og:description" content="人生苦短，我用python。">
<meta property="og:updated_time" content="2018-12-04T13:31:24.780Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="python数据库">
<meta name="twitter:description" content="人生苦短，我用python。">
  
  
    <link rel="icon" href="/favicon.ico">
  
  <link href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css">
  <script src="/js/pace.min.js"></script>
  

  
  

</head>

<body>
  <div id="container">
      <header id="header">
    <div id="banner"></div>
    <div id="header-outer">
        <div id="header-menu" class="header-menu-pos animated">
            <div class="header-menu-container">
                <a href="/" class="left">
                    <span class="site-title">Python Food</span>
                </a>
                <nav id="header-menu-nav" class="right">
                    
                    <a  href="/">
                        <i class="fa fa-home"></i>
                        <span>Home</span>
                    </a>
                    
                    <a  href="/archives">
                        <i class="fa fa-archive"></i>
                        <span>Archives</span>
                    </a>
                    
                    <a  href="/about">
                        <i class="fa fa-user"></i>
                        <span>About</span>
                    </a>
                    
                </nav>
                <a class="mobile-header-menu-button">
                    <i class="fa fa-bars"></i>
                </a>
            </div>
        </div>
        <div id="header-row">
            <div id="logo">
                <a href="/">
                    <img src="/images/logo.png" alt="logo">
                </a>
            </div>
            <div class="header-info">
                <div id="header-title">
                    
                    <h2>
                        Python Food
                    </h2>
                    
                </div>
                <div id="header-description">
                    
                    <h3>
                        A snake that grows up slowly
                    </h3>
                    
                </div>
            </div>
            <nav class="header-nav">
                <div class="social">
                    
                        <a title="Home" target="_blank" href="//pythonfood.github.io">
                            <i class="fa fa-home fa-2x"></i></a>
                    
                        <a title="Github" target="_blank" href="//github.com/pythonfood">
                            <i class="fa fa-github fa-2x"></i></a>
                    
                </div>
            </nav>
        </div>
    </div>
</header>
      <div class="outer">
        <section id="main" class="body-wrap"><article id="post-python数据库" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 class="post-title" itemprop="name">
      python数据库
    </h1>
    <div class="post-title-bar">
      <ul>
          
              <li>
                  <i class="fa fa-book"></i>
                  
                      <a href="/categories/python/">python</a>
                  
              </li>
          
        <li>
          <i class="fa fa-calendar"></i>  2017-12-30
        </li>
        <li>
          <i class="fa fa-eye"></i>
          <span id="busuanzi_value_page_pv"></span>
        </li>
      </ul>
    </div>
  

          
      </header>
    
    <div class="article-entry post-content" itemprop="articleBody">
      
            
            <p>人生苦短，我用python。<br><a id="more"></a></p>
<h2 id="一、pymysql模块"><a href="#一、pymysql模块" class="headerlink" title="一、pymysql模块"></a>一、pymysql模块</h2><p>PyMySQL是在Python3.x版本中用于连接MySQL服务器的一个库。</p>
<h3 id="1、pymysql安装"><a href="#1、pymysql安装" class="headerlink" title="1、pymysql安装"></a>1、pymysql安装</h3><p>(1)pip命令安装</p>
<blockquote>
<p><code>pip install PyMySQL</code></p>
</blockquote>
<p>(2)git命令下载安装</p>
<blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git clone https://github.com/PyMySQL/PyMySQL</span><br><span class="line">$ cd PyMySQL/</span><br><span class="line">$ python3 setup.py install</span><br></pre></td></tr></table></figure>
</blockquote>
<p>(3)curl命令制定版本号</p>
<blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ curl -L https://github.com/PyMySQL/PyMySQL/tarball/pymysql-X.X | tar xz</span><br><span class="line">$ cd PyMySQL* # 安装完可以删除PyMySQL*目录</span><br><span class="line">$ python3 setup.py install</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="2、数据库连接"><a href="#2、数据库连接" class="headerlink" title="2、数据库连接"></a>2、数据库连接</h3><p>使用数据库之前确保创建了数据库testdb，用户名”root”，密码”123456”。</p>
<blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">import pymysql</span><br><span class="line"></span><br><span class="line">#1.使用connect()方法连接数据库</span><br><span class="line">db = pymysql.connect(host=&apos;localhost&apos;,port=3306,user=&apos;root&apos;,password=&apos;123456&apos;,database=&apos;testdb&apos;,charset=&apos;utf8&apos;)</span><br><span class="line"></span><br><span class="line">#2.使用cursor()方法创建游标对象</span><br><span class="line">cursor = db.cursor()</span><br><span class="line"></span><br><span class="line">#3.使用execute()方法执行SQL语句</span><br><span class="line">cursor.execute(&apos;SELECT VERSION()&apos;)</span><br><span class="line"></span><br><span class="line">#4.使用fetchone()方法获取表单数据</span><br><span class="line">data = cursor.fetchone()</span><br><span class="line"></span><br><span class="line">print(&quot;Database version : s%&quot; % data)</span><br><span class="line"></span><br><span class="line">#5.使用close()方法关闭数据库连接</span><br><span class="line">db.close()</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="3、创建数据库表"><a href="#3、创建数据库表" class="headerlink" title="3、创建数据库表"></a>3、创建数据库表</h3><p><code>execute()</code>方法执行sql语句为数据库创建表。</p>
<blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">import pymysql</span><br><span class="line"></span><br><span class="line">#1.使用connect()方法连接数据库</span><br><span class="line">db = pymysql.connect(host=&apos;localhost&apos;,port=3306,user=&apos;root&apos;,password=&apos;123456&apos;,database=&apos;testdb&apos;,charset=&apos;utf8&apos;)</span><br><span class="line"></span><br><span class="line">#2.使用cursor()方法创建游标对象</span><br><span class="line">cursor = db.cursor()</span><br><span class="line"></span><br><span class="line">#3.如果user表已经存在，先删除</span><br><span class="line">cursor.execute(&quot;DROP TABLE IF EXISTS user&quot;)</span><br><span class="line"></span><br><span class="line">#4.使用预处理语句创建user表</span><br><span class="line">sql = &quot;&quot;&quot;CREATE TABLE user(</span><br><span class="line">		 NAME CHAR(20) NOT NULL,</span><br><span class="line">		 AGE INT,</span><br><span class="line">		 SEX CHAR(1),</span><br><span class="line">		 INCOME FLOAT)&quot;&quot;&quot;</span><br><span class="line">cursor.execute(sql)</span><br><span class="line"></span><br><span class="line">#5.使用close()方法关闭数据库连接</span><br><span class="line">db.close()</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="4、数据库插入操作"><a href="#4、数据库插入操作" class="headerlink" title="4、数据库插入操作"></a>4、数据库插入操作</h3><blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">import pymysql</span><br><span class="line"></span><br><span class="line">#1.使用connect()方法连接数据库</span><br><span class="line">db = pymsql.connect(host=&apos;localhost&apos;,port=3306,user=&apos;root&apos;,password=&apos;123456&apos;,database=&apos;testdb&apos;,charset=&apos;utf8&apos;)</span><br><span class="line"></span><br><span class="line">#2.使用cursor()方法创建游标对象</span><br><span class="line">cursor = db.cursor()</span><br><span class="line"></span><br><span class="line">#3.sql插入语句</span><br><span class="line">sql = &quot;&quot;&quot;INSERT INTO user(NAME,AGE,SEX,INCOME)</span><br><span class="line">		 VALUES(&apos;Jac&apos;,&apos;20&apos;,&apos;M&apos;,2000)&quot;&quot;&quot;</span><br><span class="line">		 </span><br><span class="line">#4.执行sql插入操作</span><br><span class="line">try:</span><br><span class="line">	cursor.execute(sql)</span><br><span class="line">	db.commit() #注意：提交到数据库执行</span><br><span class="line">except:</span><br><span class="line">	db.rollback() #注意：如果发生错误则回滚</span><br><span class="line"></span><br><span class="line">#5.使用close()方法关闭数据库连接	</span><br><span class="line">db.close()</span><br></pre></td></tr></table></figure>
</blockquote>
<p>ps:可以使用变量向SQL语句中传递参数</p>
<blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">user_id = &quot;test1&quot;</span><br><span class="line">password = &quot;123456&quot;</span><br><span class="line"></span><br><span class="line">con.execute(&apos;insert into Login values(&quot;%s&quot;, &quot;%s&quot;)&apos; % \</span><br><span class="line">             (user_id, password))</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="5、数据库删除操作"><a href="#5、数据库删除操作" class="headerlink" title="5、数据库删除操作"></a>5、数据库删除操作</h3><blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">import pymysql</span><br><span class="line"></span><br><span class="line">#1.使用connect()方法连接数据库</span><br><span class="line">db = pymsql.connect(host=&apos;localhost&apos;,port=3306,user=&apos;root&apos;,password=&apos;123456&apos;,database=&apos;testdb&apos;,charset=&apos;utf8&apos;)</span><br><span class="line"></span><br><span class="line">#2.使用cursor()方法创建游标对象</span><br><span class="line">cursor = db.cursor()</span><br><span class="line"></span><br><span class="line">#3.sql删除语句</span><br><span class="line">sql = &quot;DELETE FROM user WHERE AGE &gt; &apos;%d&apos;&quot; % (20)</span><br><span class="line"></span><br><span class="line">#4.执行sql删除操作</span><br><span class="line">try:</span><br><span class="line">	cursor.execute(sql)</span><br><span class="line">	db.commit() #注意：提交到数据库执行</span><br><span class="line">except:</span><br><span class="line">	db.rollback() #注意：如果发生错误则回滚</span><br><span class="line"></span><br><span class="line">#5.使用close()方法关闭数据库连接	</span><br><span class="line">db.close()</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="6、数据库更新操作"><a href="#6、数据库更新操作" class="headerlink" title="6、数据库更新操作"></a>6、数据库更新操作</h3><blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">import pymysql</span><br><span class="line"></span><br><span class="line">#1.使用connect()方法连接数据库</span><br><span class="line">db = pymysql.connect(host=&apos;localhost&apos;,port=3306,user=&apos;root&apos;,password=&apos;123456&apos;,database=&apos;testdb&apos;,charset=&apos;utf8&apos;)</span><br><span class="line"></span><br><span class="line">#2.使用cursor()方法创建游标对象</span><br><span class="line">cursor = db.cursor()</span><br><span class="line"></span><br><span class="line">#3.sql删除语句</span><br><span class="line">sql = &quot;UPDATE user SET AGE = AGE + 1 WHERE SEX = &apos;%c&apos;&quot; % (&apos;W&apos;)</span><br><span class="line"></span><br><span class="line">#4.执行sql删除操作</span><br><span class="line">try:</span><br><span class="line">	cursor.execute(sql)</span><br><span class="line">	db.commit() #注意：提交到数据库执行</span><br><span class="line">except:</span><br><span class="line">	db.rollback() #注意：如果发生错误则回滚</span><br><span class="line">	</span><br><span class="line">#5.使用close()方法关闭数据库连接	</span><br><span class="line">db.close()</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="7、数据库查询操作"><a href="#7、数据库查询操作" class="headerlink" title="7、数据库查询操作"></a>7、数据库查询操作</h3><p>使用fetchone()方法获取单条数据, 使用fetchall()方法获取多条数据。</p>
<ul>
<li><code>fetchone()</code>: 该方法获取下一个查询结果集。结果集是一个对象。</li>
<li><code>fetchall()</code>: 接收全部的返回结果行。</li>
<li><code>rowcount</code>: 这是一个只读属性，并返回执行execute()方法后影响的行数。</li>
</ul>
<blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">import pymysql</span><br><span class="line"></span><br><span class="line">#1.使用connect()方法连接数据库</span><br><span class="line">db = pymysql.connect(host=&apos;localhost&apos;,port=3306,user=&apos;root&apos;,password=&apos;123456&apos;,database=&apos;testdb&apos;,charset=&apos;utf8&apos;)</span><br><span class="line"></span><br><span class="line">#2.使用cursor()方法创建游标对象</span><br><span class="line">cursor = db.cursor()</span><br><span class="line"></span><br><span class="line">#3.sql查询语句</span><br><span class="line">sql = &quot;SELECT * FROM user \</span><br><span class="line">	   WHERE INCOME &gt; &apos;%d&apos;&quot; % (1000)</span><br><span class="line"></span><br><span class="line">#4.执行sql查询操作	   </span><br><span class="line">try:</span><br><span class="line">	cursor.execute(sql)</span><br><span class="line">	results = cursor.fetchall() #查询所有记录列表</span><br><span class="line">	for row in results:</span><br><span class="line">		name = row[0]</span><br><span class="line">		age = row[1]</span><br><span class="line">		sex = row[2]</span><br><span class="line">		income = row[3]</span><br><span class="line">		print(&quot;name=%s,age=%s,sex=%s,income=%d&quot; % \</span><br><span class="line">		(name, age, sex, income)) #打印结果</span><br><span class="line">except:</span><br><span class="line">	print(&apos;Error: unable to fetch data&apos;)</span><br><span class="line">	</span><br><span class="line">#5.使用close()方法关闭数据库连接	</span><br><span class="line">db.close()</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="8、执行事务"><a href="#8、执行事务" class="headerlink" title="8、执行事务"></a>8、执行事务</h3><p>事务机制可以确保数据一致性。</p>
<p>事务具有4个属性：原子性、一致性、隔离性、持久性。这四个属性通常称为ACID特性。</p>
<ul>
<li>原子性（atomicity）：一个事务是一个不可分割的工作单位，事务中包括的诸操作要么都做，要么都不做。</li>
<li>一致性（consistency）：事务必须是使数据库从一个一致性状态变到另一个一致性状态。一致性与原子性是密切相关的。</li>
<li>隔离性（isolation）：一个事务的执行不能被其他事务干扰。即一个事务内部的操作及使用的数据对并发的其他事务是隔离的，并发执行的各个事务之间不能互相干扰。</li>
<li>持久性（durability）：持续性也称永久性（permanence），指一个事务一旦提交，它对数据库中数据的改变就应该是永久性的。接下来的其他操作或故障不应该对其有任何影响。 </li>
</ul>
<p>Python DB API 2.0的事务提供了两个方法<code>commit()</code>或<code>rollback()</code>。</p>
<blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sql = &quot;DELETE FROM user WHERE INCOME &gt; &apos;%d&apos;&quot; % (1000)</span><br><span class="line">try:</span><br><span class="line">   cursor.execute(sql) # 执行SQL语句</span><br><span class="line">   db.commit()# commit() # 方法游标的所有更新操作</span><br><span class="line">except:</span><br><span class="line">   db.rollback() # rollback() # 方法回滚当前游标的所有操作</span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="9、错误处理"><a href="#9、错误处理" class="headerlink" title="9、错误处理"></a>9、错误处理</h3><table>
<thead>
<tr>
<th style="text-align:left">异常</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">Warning</td>
<td style="text-align:left">当有严重警告时触发，例如插入数据是被截断等等。必须是 StandardError 的子类。</td>
</tr>
<tr>
<td style="text-align:left">Error</td>
<td style="text-align:left">警告以外所有其他错误类。必须是 StandardError 的子类。</td>
</tr>
<tr>
<td style="text-align:left">InterfaceError</td>
<td style="text-align:left">当有数据库接口模块本身的错误（而不是数据库的错误）发生时触发。 必须是Error的子类。</td>
</tr>
<tr>
<td style="text-align:left">DatabaseError</td>
<td style="text-align:left">和数据库有关的错误发生时触发。 必须是Error的子类。</td>
</tr>
<tr>
<td style="text-align:left">DataError</td>
<td style="text-align:left">当有数据处理时的错误发生时触发，例如：除零错误，数据超范围等等。 必须是DatabaseError的子类。</td>
</tr>
<tr>
<td style="text-align:left">OperationalError</td>
<td style="text-align:left">指非用户控制的，而是操作数据库时发生的错误。例如：连接意外断开、 数据库名未找到、事务处理失败、内存分配错误等等操作数据库是发生的错误。 必须是DatabaseError的子类。</td>
</tr>
<tr>
<td style="text-align:left">IntegrityError</td>
<td style="text-align:left">完整性相关的错误，例如外键检查失败等。必须是DatabaseError子类。</td>
</tr>
<tr>
<td style="text-align:left">InternalError</td>
<td style="text-align:left">数据库的内部错误，例如游标（cursor）失效了、事务同步失败等等。 必须是DatabaseError子类。</td>
</tr>
<tr>
<td style="text-align:left">ProgrammingError</td>
<td style="text-align:left">程序错误，例如数据表（table）没找到或已存在、SQL语句语法错误、 参数数量错误等等。必须是DatabaseError的子类。</td>
</tr>
<tr>
<td style="text-align:left">NotSupportedError</td>
<td style="text-align:left">不支持错误，指使用了数据库不支持的函数或API等。例如在连接对象上 使用.rollback()函数，然而数据库并不支持事务或者事务已关闭。 必须是DatabaseError的子类。</td>
</tr>
</tbody>
</table>
<h3 id="10、数据库封装"><a href="#10、数据库封装" class="headerlink" title="10、数据库封装"></a>10、数据库封装</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mysql数据库</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MySql</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, host, port, db, user, passwd, charset=<span class="string">'utf8'</span>)</span>:</span> <span class="comment"># 初始化数据库配置</span></span><br><span class="line">        self.host = host</span><br><span class="line">        self.port = port</span><br><span class="line">        self.db = db</span><br><span class="line">        self.user = user</span><br><span class="line">        self.passwd = passwd</span><br><span class="line">        self.charset = charset</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">connect</span><span class="params">(self)</span>:</span>  <span class="comment"># 连接数据库方法</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            self.conn = pymysql.connect(host=self.host, port=self.port, db=self.db, user=self.user, passwd=self.passwd, charset=self.charset)</span><br><span class="line">            self.cursor = self.conn.cursor()</span><br><span class="line">        <span class="keyword">except</span> ConnectionError <span class="keyword">as</span> ce:</span><br><span class="line">            print(ce.message)</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">close</span><span class="params">(self)</span>:</span>  <span class="comment"># 关闭数据库方法</span></span><br><span class="line">        self.cursor.close()</span><br><span class="line">        self.conn.close()</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">select_one</span><span class="params">(self, sql, params=<span class="params">()</span>)</span>:</span>  <span class="comment"># 查找第一条数据方法</span></span><br><span class="line">        result = <span class="keyword">None</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            self.connect()</span><br><span class="line">            self.cursor.execute(sql, params)</span><br><span class="line">            result = self.cursor.fetchone()  <span class="comment"># 返回第一条查询结果</span></span><br><span class="line">            <span class="keyword">return</span> result</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            print(e.message)</span><br><span class="line">        <span class="keyword">finally</span>:</span><br><span class="line">            self.close()</span><br><span class="line">            </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">select_all</span><span class="params">(self, sql, params=<span class="params">()</span>)</span>:</span>  <span class="comment"># 查找多条数据方法</span></span><br><span class="line">        results = ()</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            self.connect()</span><br><span class="line">            self.cursor.execute(sql, params)</span><br><span class="line">            results = self.cursor.fetchall()  <span class="comment"># 返回所有查询结果</span></span><br><span class="line">            <span class="keyword">return</span> results</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            print(e.message)</span><br><span class="line">        <span class="keyword">finally</span>:</span><br><span class="line">            self.close()</span><br><span class="line">            </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">insert</span><span class="params">(self, sql, params=<span class="params">()</span>)</span>:</span>  <span class="comment"># 插入数据方法</span></span><br><span class="line">        <span class="keyword">return</span> self.__edit(sql, params)</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">delete</span><span class="params">(self, sql, params=<span class="params">()</span>)</span>:</span>  <span class="comment"># 删除数据方法</span></span><br><span class="line">        <span class="keyword">return</span> self.__edit(sql, params)</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">update</span><span class="params">(self, sql, params=<span class="params">()</span>)</span>:</span>  <span class="comment"># 更新数据方法</span></span><br><span class="line">        <span class="keyword">return</span> self.__edit(sql, params)</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__edit</span><span class="params">(self, sql, params=<span class="params">()</span>)</span>:</span>  <span class="comment"># 类内部实际执行sql的方法，仅供内部方法调用</span></span><br><span class="line">        execute_count = <span class="number">0</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            self.connect()</span><br><span class="line">            execute_count = self.cursor.execute(sql, params)  <span class="comment"># 执行sql</span></span><br><span class="line">            self.conn.commit()  <span class="comment"># 执行事务</span></span><br><span class="line">            <span class="keyword">return</span> execute_count</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            self.conn.rollback()  <span class="comment"># 事务执行失败则回滚</span></span><br><span class="line">            print(e.message)</span><br><span class="line">        <span class="keyword">finally</span>:</span><br><span class="line">            self.close()</span><br><span class="line"></span><br><span class="line">			</span><br><span class="line"><span class="comment"># 声明mysql对象        </span></span><br><span class="line">mysql = MySql(host=<span class="string">'localhost'</span>, port=<span class="number">3306</span>, db=<span class="string">'test'</span>, user=<span class="string">'root'</span>, passwd=<span class="string">'123456'</span>, charset=<span class="string">'utf8'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 查找第一条数据和多条数据</span></span><br><span class="line">select_sql = <span class="string">"""SELECT * FROM tb10 where sex=%s"""</span></span><br><span class="line">select_params = [<span class="number">1</span>]</span><br><span class="line">line = mysql.select_one(select_sql,select_params)</span><br><span class="line">print(line)  </span><br><span class="line">lines = mysql.select_all(sql, params)</span><br><span class="line">print(lines)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 插入数据</span></span><br><span class="line">insert_sql = <span class="string">"""INSERT INTO tb10(name,sex) VALUES(%s,%s)"""</span></span><br><span class="line">insert_params = [<span class="string">'Han'</span>, <span class="number">1</span>]</span><br><span class="line">execute_count = mysql.insert(insert_sql, insert_params)</span><br><span class="line"><span class="keyword">if</span> execute_count==<span class="number">1</span>:</span><br><span class="line">    print(<span class="string">'execute ok'</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">'execute error'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除数据</span></span><br><span class="line">delete_sql = <span class="string">"""DELETE FROM tb10 WHERE name=%s"""</span></span><br><span class="line">delete_params = [<span class="string">'Han'</span>]</span><br><span class="line">execute_count = mysql.delete(delete_sql, delete_params)</span><br><span class="line"><span class="keyword">if</span> execute_count==<span class="number">1</span>:</span><br><span class="line">    print(<span class="string">'execute ok'</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">'execute error'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 更新数据</span></span><br><span class="line">update_sql = <span class="string">"""UPDATE tb10 SET sex=%s WHERE name=%s"""</span></span><br><span class="line">update_params = [<span class="number">0</span>, <span class="string">'Han'</span>]</span><br><span class="line">execute_count = mysql.update(update_sql, update_params)</span><br><span class="line"><span class="keyword">if</span> execute_count==<span class="number">1</span>:</span><br><span class="line">    print(<span class="string">'execute ok'</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">'execute error'</span>)</span><br></pre></td></tr></table></figure>
<h2 id="二、sqlite3模块"><a href="#二、sqlite3模块" class="headerlink" title="二、sqlite3模块"></a>二、sqlite3模块</h2><p>SQLite是C写的一种嵌入式数据库，它的数据库就是一个文件，体积很小，经常被集成到各种应用程序中。<br>Python内置SQLite3，使用SQLite不需要安装任何东西，直接使用。</p>
<p>创建数据库的连接，如果数据库不存在，连接对象会自动创建数据库文件；如果数据库存在，则连接对象直接打开该数据库文件。<br>连接对象可以是硬盘上面的数据库文件，也可以是建立在内存中的：</p>
<ul>
<li>创建在硬盘上面： <code>conn = sqlite3.connect(&#39;c:\\test\\test.db&#39;)</code></li>
<li>创建在内存上面： <code>conn = sqlite3.connect(&#39;&quot;memory:&#39;)</code></li>
</ul>
<p>其中conn对象是数据库链接对象，具有以下操作：</p>
<ul>
<li><code>cursor()</code> : 创建一个游标</li>
<li><code>commit()</code> : 事务提交</li>
<li><code>rollback()</code> : 事务回滚</li>
<li><code>close()</code> : 关闭数据库链接</li>
</ul>
<p>创建了一个游标对象 ：<code>cu = conn.cursor()</code>，具有以下具体操作：</p>
<ul>
<li><code>execute()</code> : 执行一条sql语句</li>
<li><code>executemany()</code> : 执行多条sql语句</li>
<li><code>close()</code> : 游标关闭</li>
<li><code>fetchone()</code> : 从结果中取出一条记录</li>
<li><code>fetchmany()</code> : 从结果中取出多条记录</li>
<li><code>fetchall()</code> : 从结果中取出所有记录</li>
<li><code>scroll()</code> : 游标滚动</li>
</ul>
<blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">import sqlite3</span><br><span class="line">  </span><br><span class="line">#创建数据库  </span><br><span class="line">conn = sqlite3.connect(&apos;test.db&apos;) </span><br><span class="line">#创建游标 </span><br><span class="line">cur = conn.cursor()  </span><br><span class="line"></span><br><span class="line">#创建数据表</span><br><span class="line">cur.execute(&apos;create table t(id int,v varchar(20));&apos;);   </span><br><span class="line">#数据库操作</span><br><span class="line">cur.execute(&quot;insert into t values(%d,&apos;%s&apos;)&quot; % (1,&apos;xxx&apos;))  </span><br><span class="line">cur.execute(&quot;insert into t values(%d,&apos;%s&apos;)&quot; % (2,&apos;yyy&apos;))    </span><br><span class="line">cur.execute(&quot;update t set v = &apos;%s&apos; where id = %d&quot; % (&apos;zzz&apos;,2))   </span><br><span class="line">cur.execute(&quot;select * from t;&quot;) </span><br><span class="line">#打印结果  </span><br><span class="line">results = cur.fetchall()   </span><br><span class="line">for row in results:  </span><br><span class="line">    print(row)  </span><br><span class="line">#事务提交</span><br><span class="line">conn.commit() </span><br><span class="line"> </span><br><span class="line">#关闭游标 </span><br><span class="line">cur.close() </span><br><span class="line">#关闭数据库连接 </span><br><span class="line">conn.close()</span><br></pre></td></tr></table></figure>
</blockquote>
<h2 id="三、pymongo模块"><a href="#三、pymongo模块" class="headerlink" title="三、pymongo模块"></a>三、pymongo模块</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># mongodb数据库</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> pymongo</span><br><span class="line"></span><br><span class="line">client=pymongo.MongoClient(host=<span class="string">'localhost'</span>,port=<span class="number">27017</span>)  <span class="comment"># 连接、创建客户端，方法1</span></span><br><span class="line">client=pymongo.MongoClient(<span class="string">'mongodb://localhost:27017/'</span>)  <span class="comment"># 连接、创建客户端，方法2</span></span><br><span class="line"></span><br><span class="line">db = client.newtestdb  <span class="comment"># 指定数据库，方法1</span></span><br><span class="line">db = client[<span class="string">'newtestdb'</span>] <span class="comment"># 指定数据库，方法2</span></span><br><span class="line"></span><br><span class="line">collection = db.table  <span class="comment"># 指定集合，方法1</span></span><br><span class="line">collection = db[<span class="string">'table'</span>]  <span class="comment"># 指定集合，方法2</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加文档</span></span><br><span class="line">s1 = &#123;<span class="string">'name'</span>:<span class="string">'job'</span>,<span class="string">'age'</span>:<span class="number">20</span>&#125;</span><br><span class="line"><span class="comment">#collection.insert(s1)  # insert()方法弃用了</span></span><br><span class="line">s1_id = collection.insert_one(s1).inserted_id  <span class="comment"># 添加单个文档,并获得id</span></span><br><span class="line">print(s1_id)</span><br><span class="line">s2 = (&#123;<span class="string">'name'</span>:<span class="string">'pob'</span>,<span class="string">'age'</span>:<span class="number">19</span>&#125;,&#123;<span class="string">'name'</span>:<span class="string">'tob'</span>,<span class="string">'age'</span>:<span class="number">21</span>&#125;)</span><br><span class="line">s2_ids = collection.insert_many(s2).inserted_ids  <span class="comment"># 添加多个文档,并获得id列表</span></span><br><span class="line">print(s2_ids)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查找文档</span></span><br><span class="line">doc = collection.find_one()  <span class="comment"># 查找一个文档</span></span><br><span class="line">print(doc)</span><br><span class="line">docs = collection.find()  <span class="comment"># 查找多个文档，方法1</span></span><br><span class="line"><span class="keyword">for</span> d <span class="keyword">in</span> docs:</span><br><span class="line">    print(d)</span><br><span class="line">docs = collection.find()  <span class="comment"># 查找多个文档，方法2</span></span><br><span class="line">docs.next()</span><br><span class="line">docs.next()</span><br><span class="line">docs.next()</span><br><span class="line">docs_count = docs.count() <span class="comment"># 获取文档个数</span></span><br><span class="line">print(docs_count)</span><br><span class="line">results = collection.find(&#123;<span class="string">'name'</span>:<span class="string">'tob'</span>&#125;)  <span class="comment"># 设置字段，来过滤数据</span></span><br><span class="line"><span class="keyword">for</span> r <span class="keyword">in</span> results:</span><br><span class="line">    print(r)</span><br><span class="line">results = collection.find(&#123;<span class="string">'age'</span>:&#123;<span class="string">'$gt'</span>:<span class="number">20</span>&#125;&#125;) <span class="comment"># 比较大小查询使用修饰符：$lt小于、$gt大于、$lte小于等于、$gte大于等于、$ne不等于、$in在范围内、$nin不在范围内</span></span><br><span class="line"><span class="keyword">for</span> r <span class="keyword">in</span> results:</span><br><span class="line">    print(r)</span><br><span class="line">results = collection.find(&#123;<span class="string">'name'</span>:&#123;<span class="string">'$regex'</span>:<span class="string">'^p.*?b'</span>&#125;&#125;)  <span class="comment"># $regex正则表达式查询，其他符号：$exists属性是否存在、$type类型判断、$mod数字余数、$text文本查询、$shere条件查询</span></span><br><span class="line"><span class="keyword">for</span> r <span class="keyword">in</span> results:</span><br><span class="line">    print(r)</span><br><span class="line">results = collection.find().sort(<span class="string">'name'</span>,<span class="number">1</span>)  <span class="comment"># 查询结果排序，1 为升序，-1 为降序，默认为升序</span></span><br><span class="line"><span class="keyword">for</span> r <span class="keyword">in</span> results:</span><br><span class="line">    print(r)</span><br><span class="line">results = collection.find().limit(<span class="number">3</span>)  <span class="comment"># 指定查询条数</span></span><br><span class="line"><span class="keyword">for</span> r <span class="keyword">in</span> results:</span><br><span class="line">    print(r)</span><br><span class="line">results = collection.find().skip(<span class="number">2</span>)  <span class="comment"># 偏移查询，只取第3个及以后的数据</span></span><br><span class="line"><span class="keyword">for</span> r <span class="keyword">in</span> results:</span><br><span class="line">    print(r)</span><br><span class="line">results = collection.find().distinct(<span class="string">'name'</span>)  <span class="comment"># 去重查询，可以设定条件</span></span><br><span class="line"><span class="keyword">for</span> r <span class="keyword">in</span> results:</span><br><span class="line">    print(r)</span><br><span class="line">results = collection.find(&#123;&#125;,&#123;<span class="string">'_id'</span>:<span class="number">0</span>,<span class="string">'name'</span>:<span class="number">1</span>&#125;)  <span class="comment"># 投影，只显示必要字段，值为1表示显示，值为0不显示(其他字段不设置即可，不过_id不显示必须设置0)</span></span><br><span class="line"><span class="keyword">for</span> r <span class="keyword">in</span> results:</span><br><span class="line">    print(r)</span><br><span class="line"></span><br><span class="line">	</span><br><span class="line"><span class="comment"># 修改文档</span></span><br><span class="line"><span class="comment">#result=collection.update(&#123;'name':'job'&#125;,&#123;'age':21&#125;)  # update()方法不安全，已弃用，它会将除了_id和要更新的数据外的其他字段会被删除</span></span><br><span class="line"><span class="comment">#result=collection.update(&#123;'name':'job'&#125;,&#123;'$set':&#123;'age':21&#125;&#125;)  # 使用$set会比较安全,不过还是使用update_one()和update_many()</span></span><br><span class="line">result = collection.update_one(&#123;<span class="string">'name'</span>:<span class="string">'job'</span>&#125;,&#123;<span class="string">'$set'</span>:&#123;<span class="string">'age'</span>:<span class="number">21</span>&#125;&#125;)  <span class="comment"># 只能修匹配到的第一条记录</span></span><br><span class="line">print(result)</span><br><span class="line">results = collection.update_many(&#123;<span class="string">'name'</span>:<span class="string">'job'</span>&#125;,&#123;<span class="string">'$set'</span>:&#123;<span class="string">'age'</span>:<span class="number">21</span>&#125;&#125;)  <span class="comment"># 修改所有匹配到的记录</span></span><br><span class="line">print(results.matched_count, results.modified_count) <span class="comment"># 打印匹配的数据条数和影响的数据条数</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除文档</span></span><br><span class="line"><span class="comment">#result = collection.remove(&#123;'name':'bob'&#125;) # remove()方法弃用了</span></span><br><span class="line">result = collection.delete_one(&#123;<span class="string">'age'</span>:&#123;<span class="string">'$gt'</span>:<span class="number">21</span>&#125;&#125;)  <span class="comment"># 删除一个文档，第一个参数为查询对象，指定要删除哪些数据</span></span><br><span class="line">print(result)</span><br><span class="line">results = collection.delete_many(&#123;<span class="string">'age'</span>:&#123;<span class="string">'$gt'</span>:<span class="number">20</span>&#125;&#125;)  <span class="comment"># 删除多个文档</span></span><br><span class="line">print(results.deleted_count)  <span class="comment"># 打印删除文档的个数</span></span><br><span class="line">results = collection.delete_many(&#123;&#125;)  <span class="comment"># 删除所有文档</span></span><br><span class="line">print(results.deleted_count)</span><br></pre></td></tr></table></figure>
<h2 id="四、redis模块"><a href="#四、redis模块" class="headerlink" title="四、redis模块"></a>四、redis模块</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># redis数据库</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> redis</span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建redis链接对象</span></span><br><span class="line">r = redis.StrictRedis(host=<span class="string">'localhost'</span>, port=<span class="number">6379</span>, decode_responses=<span class="keyword">True</span>)  <span class="comment"># 方法1，StrictRedis用于实现大部分官方的命令，并使用官方的语法和命令，decode_responses控制显示字符串  </span></span><br><span class="line">r = redis.Redis(host=<span class="string">'127.0.0.1'</span>, port=<span class="number">6379</span>, decode_responses=<span class="keyword">True</span>)  <span class="comment">#  方法2，Redis是StrictRedis的子类，用于向后兼容旧版本的redis-py</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 交互方式</span></span><br><span class="line">r.set(<span class="string">'name'</span>,<span class="string">'value'</span>)  <span class="comment"># 方式1，直接用redis对象调用方法</span></span><br><span class="line">print(r.get(<span class="string">'name'</span>))</span><br><span class="line"></span><br><span class="line">pipe = r.pipeline(transaction=<span class="keyword">True</span>)  <span class="comment"># 方式2，定义pipeline管道，缓冲多条命令，然后一次执行，transaction=True打开同时请求多个指令的功能</span></span><br><span class="line">pipe.set(<span class="string">'name'</span>, <span class="string">'value'</span>)</span><br><span class="line">pipe.get(<span class="string">'name'</span>)</span><br><span class="line">pipe.execute()  <span class="comment"># 一次性执行多条命令，减少服务器-客户端之间TCP数据库包，从而提高效率</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 操作键</span></span><br><span class="line">r.delete(<span class="string">'name'</span>,<span class="string">'name1'</span>)  <span class="comment"># 删除redis中的键值</span></span><br><span class="line">r.exists(<span class="string">'name'</span>)  <span class="comment"># 检测键是否存在</span></span><br><span class="line">r.keys(pattern=<span class="string">'n*'</span>)  <span class="comment"># 根据模型获取redis的键名，参数支持正则表达式</span></span><br><span class="line">r.expire(<span class="string">'name'</span>,<span class="number">60</span>)  <span class="comment"># 对redis的某个键设置有效时间，单位秒</span></span><br><span class="line">r.rename(<span class="string">'name'</span>, <span class="string">'name1'</span>)  <span class="comment"># 对redis的键重命名</span></span><br><span class="line">r.move(<span class="string">'name'</span>,<span class="string">'db1'</span>)  <span class="comment"># 将redis的某个键值移动到指定的db下</span></span><br><span class="line">r.randomkey()  <span class="comment"># 随机获取一个redis的键值</span></span><br><span class="line">r.ttl(<span class="string">'name'</span>)  <span class="comment"># 查看键的有效时间，单位秒</span></span><br><span class="line">r.type(<span class="string">'name'</span>)  <span class="comment"># 获取键对应值的类型</span></span><br><span class="line">r.scan(cursor=<span class="number">0</span>,match=<span class="keyword">None</span>,count=<span class="keyword">None</span>)  <span class="comment"># 同字符串操作，用于增量迭代获取key</span></span><br><span class="line">r.scan_iter(match=<span class="keyword">None</span>,count=<span class="keyword">None</span>)  <span class="comment"># 同字符串操作，用于增量迭代获取key</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 值类型string(字符串)</span></span><br><span class="line">r.set(<span class="string">'name'</span>, <span class="string">'value'</span>, ex=<span class="number">60</span>, nx=<span class="keyword">True</span>) <span class="comment"># 设置键、值，ex=有效时间单位秒、px=有效时间单位毫秒、nx=True只有name不存在时当前set操作才执行、xx=True只有name存在时当前set操作才执行</span></span><br><span class="line">r.setnx(<span class="string">'name'</span>, <span class="string">'value'</span>)  <span class="comment"># 设置值，只有在name不存在是才执行操作</span></span><br><span class="line">r.setex(<span class="string">'name'</span>, <span class="string">'value'</span>, <span class="number">60</span>)  <span class="comment"># 设置值,过期时间单位为秒</span></span><br><span class="line">r.psetex(<span class="string">'name'</span>, <span class="number">60000</span>, <span class="string">'value'</span>)  <span class="comment"># 设置值，过期时间单位为毫秒，注意参数顺序和setex()是不同的</span></span><br><span class="line">r.mset(&#123;<span class="string">'name'</span>:<span class="string">'value'</span>,<span class="string">'name1'</span>:<span class="string">'value1'</span>&#125;)  <span class="comment"># 批量设置多个值</span></span><br><span class="line">r.get(<span class="string">'name'</span>)  <span class="comment"># 获取值</span></span><br><span class="line">r.mget(<span class="string">'name'</span>,<span class="string">'name1'</span>)  <span class="comment"># 批量获取值</span></span><br><span class="line">r.getset(<span class="string">'name'</span>,<span class="string">'value1'</span>)  <span class="comment"># 设置新值并获取原来的值</span></span><br><span class="line">r.getrange(<span class="string">'name'</span>,<span class="number">0</span>,<span class="number">3</span>)  <span class="comment"># 获取子序列（根据字节获取，非字符）, 如： "内蒙古" ，0-3表示 "内"</span></span><br><span class="line">r.setrange(<span class="string">'name'</span>,<span class="number">3</span>,<span class="string">'value1'</span>) <span class="comment"># 修改值内容，从指定字符串索引开始向后替换（新值太长时，则向后添加），字符串的索引，字节（一个汉字三个字节）</span></span><br><span class="line">r.getbit(<span class="string">'name'</span>, <span class="string">'7'</span>)  <span class="comment"># 获取name对应的值的二进制表示中的某位的值，只能是0或1</span></span><br><span class="line">r.setbit(<span class="string">'name'</span>, <span class="string">'7'</span>, <span class="string">'1'</span>)  <span class="comment"># 对name对应值的二进制表示的位进行操作,如：将第7位设置为1</span></span><br><span class="line">r.strlen(<span class="string">'name'</span>)  <span class="comment"># 返回name对应值的字节长度，utf-8一个汉字3个字节</span></span><br><span class="line">r.set(<span class="string">'name'</span>, <span class="number">1</span>)</span><br><span class="line">r.incr(<span class="string">'name'</span>, amount=<span class="number">3</span>)  <span class="comment"># 当name存在时,name对应的值自增amount(整型)，当name不存在时，则创建name=amount</span></span><br><span class="line">r.incrbyfloat(<span class="string">'name'</span>, amount=<span class="number">3.0</span>)  <span class="comment"># 当name存在时,name对应的值自增amount(浮点型)，当name不存在时，则创建name=amount</span></span><br><span class="line">r.decr(<span class="string">'name'</span>, amount=<span class="number">3</span>)  <span class="comment"># 当name存在时,name对应的值自减amount(整型)，当name不存在时，则创建name=amount。注意不存在decrbyfloat()</span></span><br><span class="line">r.append(<span class="string">'name'</span>,<span class="string">'value'</span>)  <span class="comment"># 在name对应的值后面追加内容</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 值类型hash(键值对)</span></span><br><span class="line">r.hset(<span class="string">'name'</span>, <span class="string">'key'</span>, <span class="string">'value'</span>)  <span class="comment"># name对应的hash中设置一个键值对（不存在，则创建；否则，修改）</span></span><br><span class="line">r.hmset(<span class="string">'name'</span>, &#123;<span class="string">'key'</span>:<span class="string">'value'</span>,<span class="string">'key1'</span>:<span class="string">'value1'</span>&#125;)  <span class="comment"># 在name对应的hash中批量设置键值对</span></span><br><span class="line">r.hget(<span class="string">'name'</span>, <span class="string">'key'</span>)  <span class="comment"># 在name对应的hash中获取根据key获取value</span></span><br><span class="line">r.hmget(<span class="string">'name'</span>, [<span class="string">'key'</span>, <span class="string">'key1'</span>])  <span class="comment"># 在name对应的hash中获取多个key的值</span></span><br><span class="line">r.hgetall(<span class="string">'name'</span>)  <span class="comment"># 获取name对应hash的所有键值</span></span><br><span class="line">r.hlen(<span class="string">'name'</span>)  <span class="comment"># 获取name对应的hash中键值对的个数</span></span><br><span class="line">r.hkeys(<span class="string">'name'</span>)  <span class="comment"># 获取name对应的hash中所有的key的值</span></span><br><span class="line">r.hvals(<span class="string">'name'</span>)  <span class="comment"># 获取name对应的hash中所有的value的值</span></span><br><span class="line">r.hexists(<span class="string">'name'</span>, <span class="string">'key'</span>)  <span class="comment"># 检查name对应的hash是否存在key</span></span><br><span class="line">r.hdel(<span class="string">'name'</span>, [<span class="string">'key'</span>,<span class="string">'key1'</span>])  <span class="comment"># 将name对应的hash中指定key的键值对删除</span></span><br><span class="line">r.hincrby(<span class="string">'name'</span>, <span class="string">'key'</span>, amount=<span class="number">3</span>)  <span class="comment"># 自增name对应的hash中的指定key的值，不存在则创建key=amount(整型)</span></span><br><span class="line">r.hincrbyfloat(<span class="string">'name'</span>, <span class="string">'key'</span>, amount=<span class="number">3.0</span>)  <span class="comment"># 自增name对应的hash中的指定key的值，不存在则创建key=amount(浮点型)</span></span><br><span class="line">r.hscan(<span class="string">'name'</span>, cursor=<span class="number">0</span>, match=<span class="string">'key'</span>, count=<span class="number">4</span>)  <span class="comment"># 增量迭代获取hash中数据，cursor游标，match匹配key默认所有，count获取的个数。</span></span><br><span class="line">r.hscan_iter(<span class="string">'name'</span>, cursor=<span class="number">0</span>, match=<span class="string">'key'</span>, count=<span class="number">4</span>)  <span class="comment"># 利用yield封装hscan创建生成器，实现分批获取数据</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 值类型list(列表)</span></span><br><span class="line">r.lpush(<span class="string">'name'</span>, <span class="number">11</span>,<span class="number">22</span>,<span class="number">33</span>)  <span class="comment"># 从左向右添加list元素，每个新的元素都添加到列表的最左边，如：当前最左边是33</span></span><br><span class="line">r.rpush(<span class="string">'name'</span>, <span class="number">11</span>,<span class="number">22</span>,<span class="number">33</span>)  <span class="comment"># 从右向左添加list元素，每个新的元素都添加到列表的最右边，如：当前最右边是33</span></span><br><span class="line">r.lpushx(<span class="string">'name'</span>, <span class="number">44</span>)  <span class="comment"># 在列表中添加元素，只有在name存在时才添加，值添加到列表的最左边</span></span><br><span class="line">r.rpushx(<span class="string">'name'</span>, <span class="number">44</span>)  <span class="comment"># 在列表中添加元素，只有在name存在时才添加，值添加到列表的最右边</span></span><br><span class="line">r.llen(<span class="string">'name'</span>)  <span class="comment"># name对应的list元素的个数</span></span><br><span class="line">r.linsert(<span class="string">'name'</span>, <span class="string">'before'</span>, <span class="number">22</span>, <span class="number">55</span>)  <span class="comment"># 在name对应的列表的某一个值前(before)或后(after)插入一个新值,如：当前在22前插入55</span></span><br><span class="line">r.lset(<span class="string">'name'</span>, <span class="number">0</span>, <span class="number">66</span>)  <span class="comment"># 对name对应的list中的某一个索引位置重新赋值，如：当前在第0位重新赋值为66</span></span><br><span class="line">r.lrem(<span class="string">'name'</span>, <span class="number">44</span>, num=<span class="number">0</span>)  <span class="comment"># 在name对应的list中删除指定的值, num=0表示删除指定值本身，num=负数表示从指定值向前删除，num=正数表示从指定值向后删除</span></span><br><span class="line">r.lpop(<span class="string">'name'</span>)  <span class="comment"># 在name对应的列表的左侧获取第一个元素，并在列表中移除，返回值则是该元素</span></span><br><span class="line">r.rpop(<span class="string">'name'</span>)  <span class="comment"># 在name对应的列表的右侧获取第一个元素，并在列表中移除，返回值则是该元素</span></span><br><span class="line">r.lindex(<span class="string">'name'</span>, <span class="number">3</span>)  <span class="comment"># 在name对应的列表中根据索引获取列表元素</span></span><br><span class="line">r.lrange(<span class="string">'name'</span>, <span class="number">3</span>, <span class="number">11</span>)  <span class="comment"># 在name对应的列表分片获取数据</span></span><br><span class="line">r.ltrim(<span class="string">'name'</span>, <span class="number">3</span>, <span class="number">11</span>)  <span class="comment"># 在name对应的列表中移除没有在start-end索引之间的值</span></span><br><span class="line">r.rpoplpush(<span class="string">'name_r'</span>, <span class="string">'name_l'</span>)  <span class="comment"># 从一个列表取出最右边的元素，同时将其添加至另一个列表的最左边</span></span><br><span class="line">r.blpop([<span class="string">'name'</span>, <span class="string">'name_l'</span>], timeout=<span class="number">0</span>) <span class="comment"># 将多个列表排列，按照从左到右去pop对应列表的元素，timeout，超时时间，当元素所有列表的元素获取完之后，阻塞等待列表内有数据的时间（秒）, 0 表示永远阻塞</span></span><br><span class="line">r.brpoplpush(<span class="string">'name_r'</span>, <span class="string">'name_l'</span>, timeout=<span class="number">0</span>)  <span class="comment"># 从一个列表的右侧移除一个元素并将其添加到另一个列表的左侧，timeout，当src对应的列表中没有数据时，阻塞等待其有数据的超时时间（秒），0 表示永远阻塞</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 值类型set(无序集合)</span></span><br><span class="line">r.sadd(<span class="string">'name'</span>, <span class="number">11</span>,<span class="number">22</span>,<span class="number">33</span>) <span class="comment"># name对应的集合中添加元素</span></span><br><span class="line"><span class="comment"># r.sadd('name1', 33,44,55) # name对应的集合中添加元素</span></span><br><span class="line">r.scard(<span class="string">'name'</span>)  <span class="comment"># 获取name对应的集合中元素个数</span></span><br><span class="line">r.sdiff(<span class="string">'name'</span>,<span class="string">'name1'</span>)  <span class="comment"># 获取在第一个name对应的集合中且不在其他name对应的集合的元素集合，如：当前获取的在name中而不在name1中的集合</span></span><br><span class="line">r.sdiffstore(<span class="string">'name2'</span>, <span class="string">'name'</span>, <span class="string">'name1'</span>)  <span class="comment"># 在第二个集合中且不在第二个集合以后其他集合中的元素，添加到第一个新集合中，如：当前获取在name中而不在name1中的集合元素添加到name2</span></span><br><span class="line">r.sinter(<span class="string">'name'</span>, <span class="string">'name1'</span>)  <span class="comment"># 获取多个集合的并集</span></span><br><span class="line">r.sinterstore(<span class="string">'name2'</span>, <span class="string">'name'</span>, <span class="string">'name1'</span>)  <span class="comment"># 获取多个集合的并集，添加到第一个新集合中，如：当前获取name和name1的并集添加到name2中</span></span><br><span class="line">r.sismember(<span class="string">'name'</span>, <span class="number">33</span>)  <span class="comment"># 检查value是否是name对应的集合的成员</span></span><br><span class="line">r.smembers(<span class="string">'name'</span>)  <span class="comment"># 获取name对应的集合的所有成员</span></span><br><span class="line">r.smove(<span class="string">'name'</span>, <span class="string">'name1'</span>, <span class="number">22</span>)  <span class="comment"># 将某个成员从一个集合中移动到另外一个集合,如：将22从name中移动到name1中</span></span><br><span class="line">r.spop(<span class="string">'name'</span>)  <span class="comment"># 从集合的右侧（尾部）移除一个成员，并将其返回</span></span><br><span class="line">r.srandmember(<span class="string">'name'</span>, <span class="number">2</span>)  <span class="comment"># 从name对应的集合中随机获取 numbers 个元素</span></span><br><span class="line">r.srem(<span class="string">'name'</span>, <span class="number">11</span>,<span class="number">33</span>)  <span class="comment"># 在name对应的集合中删除某些值</span></span><br><span class="line">r.sunion(<span class="string">'name2'</span>, <span class="string">'name1'</span>)  <span class="comment"># 获取多个集合的合集</span></span><br><span class="line">r.sunionstore(<span class="string">'name2'</span>, <span class="string">'name'</span>, <span class="string">'name1'</span>)  <span class="comment"># 获取多个集合的合集，添加到第一个新集合中，如：当前获取name和name1的合集添加到name2中</span></span><br><span class="line">r.sscan(<span class="string">'name'</span>, cursor=<span class="number">0</span>, match=<span class="keyword">None</span>, count=<span class="keyword">None</span>)  <span class="comment"># 同字符串的操作，用于增量迭代分批获取元素，避免内存消耗太大</span></span><br><span class="line">r.sscan_iter(<span class="string">'name'</span>, match=<span class="keyword">None</span>, count=<span class="keyword">None</span>)  <span class="comment"># 同字符串的操作，用于增量迭代分批获取元素，避免内存消耗太大</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 值类型zset(有序集合)</span></span><br><span class="line"><span class="comment"># 有序集合，在集合的基础上，所以对于有序集合，每一个元素有两个值，即：值和分数，分数score专门用来做排序。</span></span><br><span class="line">r.zadd(<span class="string">'name'</span>, <span class="string">'value1'</span>,<span class="number">1</span>, <span class="string">'value2'</span>,<span class="number">2</span>) <span class="comment"># 在name对应的有序集合中添加元素value=score。也可以写成r.zadd('name', value1=1, value2=2)</span></span><br><span class="line">r.zcard(<span class="string">'name'</span>)  <span class="comment"># 获取name对应的有序集合元素的数量</span></span><br><span class="line">r.zcount(<span class="string">'name'</span>, min=<span class="number">1</span>, max=<span class="number">60</span>)  <span class="comment"># 获取name对应的有序集合中分数在 [min,max] 之间的个数</span></span><br><span class="line">r.zincrby(<span class="string">'name'</span>, <span class="string">'value1'</span>, amount=<span class="number">3</span>)  <span class="comment"># 自增name对应的有序集合的 amount 对应的分数</span></span><br><span class="line">r.zrange( <span class="string">'name'</span>, start=<span class="number">0</span>, end=<span class="number">4</span>, desc=<span class="keyword">False</span>, withscores=<span class="keyword">False</span>, score_cast_func=float) <span class="comment"># 按照索引范围获取name对应的有序集合的元素</span></span><br><span class="line">r.zrank(<span class="string">'name'</span>, <span class="string">'value'</span>)  <span class="comment"># 获取某个值在 name对应的有序集合中的排行（从 0 开始）</span></span><br><span class="line">r.zrangebylex(<span class="string">'name3'</span>, min=<span class="string">'-'</span>, max=<span class="string">'[ca'</span>, start=<span class="keyword">None</span>, num=<span class="keyword">None</span>)  <span class="comment">#?当有序集合的所有成员都具有相同的分值时，有序集合的元素会根据成员的值来进行排序。BUT没搞懂，老报错</span></span><br><span class="line">r.zrem(<span class="string">'name'</span>, [<span class="string">'value1'</span>,<span class="string">'value2'</span>])  <span class="comment"># 删除name对应的有序集合中值是values的成员</span></span><br><span class="line">r.zremrangebyrank(<span class="string">'name'</span>, min=<span class="number">1</span>, max=<span class="number">4</span>)  <span class="comment"># 根据排行范围删除</span></span><br><span class="line">r.zremrangebyscore(<span class="string">'name'</span>, min=<span class="number">1</span>, max=<span class="number">60</span>)  <span class="comment"># 根据分数范围删除</span></span><br><span class="line">r.zremrangebylex (<span class="string">'name'</span>, min, max) <span class="comment">#?根据值返回删除</span></span><br><span class="line">r.zscore(<span class="string">'name'</span>,<span class="string">'value'</span>)  <span class="comment"># 获取name对应有序集合中 value 对应的分数</span></span><br><span class="line">r.zinterstore(<span class="string">'name2'</span>,(<span class="string">'name'</span>,<span class="string">'name1'</span>), aggregate=<span class="keyword">None</span>)  <span class="comment"># 获取两个有序集合的交集并放入dest集合，如果遇到相同值不同分数，则按照aggregate进行操作，aggregate的值为: SUM  MIN  MAX</span></span><br><span class="line">r.zunionstore(<span class="string">'name2'</span>,(<span class="string">'name'</span>,<span class="string">'name1'</span>),aggregate=<span class="string">'min'</span>) <span class="comment"># 获取两个有序集合的合集并放入dest集合，如果遇到相同值不同分数，则按照aggregate进行操作，aggregate的值为: SUM  MIN  MAX</span></span><br><span class="line">r.zscan(<span class="string">'name'</span>, cursor=<span class="number">0</span>, match=<span class="keyword">None</span>, count=<span class="keyword">None</span>, score_cast_func=float)  <span class="comment"># 同字符串相似，相较于字符串新增score_cast_func，用来对分数进行操作</span></span><br><span class="line">r.zscan_iter(<span class="string">'name'</span>, match=<span class="keyword">None</span>, count=<span class="keyword">None</span>,score_cast_func=float)  <span class="comment"># 同字符串相似，相较于字符串新增score_cast_func，用来对分数进行操作</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 连接池</span></span><br><span class="line">pool = redis.ConnectionPool(host=<span class="string">'127.0.0.1'</span>,port=<span class="number">6379</span>,decode_responses=<span class="keyword">True</span>)  <span class="comment"># 创建连接池</span></span><br><span class="line">r1 = redis.Redis(connection_pool=pool)  <span class="comment"># 创建第一个链接对象</span></span><br><span class="line">r1.sadd(<span class="string">'set1'</span>, <span class="string">'mysql'</span>,<span class="string">'redis'</span>,<span class="string">'mongodb'</span>)</span><br><span class="line">print(r1.smembers(<span class="string">'set1'</span>))</span><br><span class="line">r2 = redis.StrictRedis(connection_pool=pool)  <span class="comment"># 创建第二个链接对象</span></span><br><span class="line">r2.lpush(<span class="string">'l1'</span>, <span class="string">'mysql'</span>,<span class="string">'redis'</span>,<span class="string">'mongodb'</span>)</span><br><span class="line">print(r2.lrange(<span class="string">'l1'</span>,<span class="number">0</span>,<span class="number">-1</span>))</span><br></pre></td></tr></table></figure>
<h1 id="持续更新…"><a href="#持续更新…" class="headerlink" title="持续更新…"></a>持续更新…</h1>
            <div class="post-copyright">
    <div class="content">
        <p>最后更新： 2018年12月04日 21:31</p>
        <p>原始链接： <a class="post-url" href="/2017/12/30/python数据库/" title="python数据库">http://pythonfood.github.io/2017/12/30/python数据库/</a></p>
        <footer>
            <a href="http://pythonfood.github.io">
                <img src="/images/logo.png" alt="Python Food">
                Python Food
            </a>
        </footer>
    </div>
</div>

      
        
            
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;">赏</a>
</div>

<div id="reward" class="post-modal reward-lay">
    <a class="close" href="javascript:;" id="reward-close">×</a>
    <span class="reward-title">
        <i class="icon icon-quote-left"></i>
        多少都行~
        <i class="icon icon-quote-right"></i>
    </span>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/images/wechat_code.jpg" alt="打赏二维码">
        </div>
        <div class="reward-select">
            
            <label class="reward-select-item checked" data-id="wechat" data-wechat="/images/wechat_code.jpg">
                <img class="reward-select-item-wechat" src="/images/wechat.png" alt="微信">
            </label>
            
            
            <label class="reward-select-item" data-id="alipay" data-alipay="/images/alipay_code.jpg">
                <img class="reward-select-item-alipay" src="/images/alipay.png" alt="支付宝">
            </label>
            
        </div>
    </div>
</div>


        
    </div>
    <footer class="article-footer">
        
        
<div class="post-share">
    <a href="javascript:;" id="share-sub" class="post-share-fab">
        <i class="fa fa-share-alt"></i>
    </a>
    <div class="post-share-list" id="share-list">
        <ul class="share-icons">
          <li>
            <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://pythonfood.github.io/2017/12/30/python数据库/&title=《python数据库》 — PythonFood&pic=/images/banner.jpg" data-title="微博">
              <i class="fa fa-weibo"></i>
            </a>
          </li>
          <li>
            <a class="weixin share-sns" id="wxFab" href="javascript:;" data-title="微信">
              <i class="fa fa-weixin"></i>
            </a>
          </li>
          <li>
            <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://pythonfood.github.io/2017/12/30/python数据库/&title=《python数据库》 — PythonFood&source=人生苦短，我用python。" data-title="QQ">
              <i class="fa fa-qq"></i>
            </a>
          </li>
          <li>
            <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://pythonfood.github.io/2017/12/30/python数据库/" data-title="Facebook">
              <i class="fa fa-facebook"></i>
            </a>
          </li>
          <li>
            <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《python数据库》 — PythonFood&url=http://pythonfood.github.io/2017/12/30/python数据库/&via=http://pythonfood.github.io" data-title="Twitter">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
          <li>
            <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://pythonfood.github.io/2017/12/30/python数据库/" data-title="Google+">
              <i class="fa fa-google-plus"></i>
            </a>
          </li>
        </ul>
     </div>
</div>
<div class="post-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;" id="wxShare-close">×</a>
    <p>扫一扫，分享到微信</p>
    <img src="//api.qrserver.com/v1/create-qr-code/?data=http://pythonfood.github.io/2017/12/30/python数据库/" alt="微信分享二维码">
</div>

<div class="mask"></div>

        
        <ul class="article-footer-menu">
            
            
  <li class="article-footer-tags">
    <i class="fa fa-tags"></i>
      
    <a href="/tags/python/" class="color2">python</a>
      
  </li>

        </ul>
        
    </footer>
  </div>
</article>


    <aside class="post-toc-pos post-toc-top" id="post-toc">
        <nav class="post-toc-wrap">
            <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#一、pymysql模块"><span class="post-toc-text">一、pymysql模块</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1、pymysql安装"><span class="post-toc-text">1、pymysql安装</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2、数据库连接"><span class="post-toc-text">2、数据库连接</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#3、创建数据库表"><span class="post-toc-text">3、创建数据库表</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#4、数据库插入操作"><span class="post-toc-text">4、数据库插入操作</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#5、数据库删除操作"><span class="post-toc-text">5、数据库删除操作</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#6、数据库更新操作"><span class="post-toc-text">6、数据库更新操作</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#7、数据库查询操作"><span class="post-toc-text">7、数据库查询操作</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#8、执行事务"><span class="post-toc-text">8、执行事务</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#9、错误处理"><span class="post-toc-text">9、错误处理</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#10、数据库封装"><span class="post-toc-text">10、数据库封装</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#二、sqlite3模块"><span class="post-toc-text">二、sqlite3模块</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#三、pymongo模块"><span class="post-toc-text">三、pymongo模块</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#四、redis模块"><span class="post-toc-text">四、redis模块</span></a></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#持续更新…"><span class="post-toc-text">持续更新…</span></a>
        </nav>
    </aside>
    

<nav id="article-nav">
  
    <a href="/2017/12/30/python网络请求/" id="article-nav-newer" class="article-nav-link-wrap">

      <span class="article-nav-title">
        <i class="fa fa-hand-o-left" aria-hidden="true"></i>
        
          python网络请求
        
      </span>
    </a>
  
  
    <a href="/2017/12/30/python发送邮件/" id="article-nav-older" class="article-nav-link-wrap">
      <span class="article-nav-title">python发送邮件</span>
      <i class="fa fa-hand-o-right" aria-hidden="true"></i>
    </a>
  
</nav>



    
        <div id="SOHUCS" sid="python数据库" ></div>
<script type="text/javascript">
    (function(){
        var appid = 'cytnRgqDg';
        var conf = '61714297a608dcad6779ec4ea0059b2a';
        var width = window.innerWidth || document.documentElement.clientWidth;
        if (width < 960) {
            window.document.write('<script id="changyan_mobile_js" charset="utf-8" type="text/javascript" src="https://changyan.sohu.com/upload/mobile/wap-js/changyan_mobile.js?client_id=' + appid + '&conf=' + conf + '"><\/script>'); } else { var loadJs=function(d,a){var c=document.getElementsByTagName("head")[0]||document.head||document.documentElement;var b=document.createElement("script");b.setAttribute("type","text/javascript");b.setAttribute("charset","UTF-8");b.setAttribute("src",d);if(typeof a==="function"){if(window.attachEvent){b.onreadystatechange=function(){var e=b.readyState;if(e==="loaded"||e==="complete"){b.onreadystatechange=null;a()}}}else{b.onload=a}}c.appendChild(b)};loadJs("https://changyan.sohu.com/upload/changyan.js",function(){window.changyan.api.config({appid:appid,conf:conf})}); } })(); </script>
    
</section>
        
      </div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info" class="inner">
      
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


      <p>
        Powered by  <a href="http://hexo.io/" target="_blank">Hexo</a>
        Theme <a href="//github.com/wongminho/hexo-theme-miho" target="_blank">MiHo</a>
      &copy; 2019 Python Food<br>
      </p>
    </div>
  </div>
</footer>
    <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<script src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
<script>
  var mihoConfig = {
      root: "http://pythonfood.github.io",
      animate: true,
      isHome: false,
      share: true,
      reward: 1
  }
</script>
<div class="sidebar">
    <div id="sidebar-search" title="Search">
        <i class="fa fa-search"></i>
    </div>
    <div id="sidebar-category" title="Categories">
        <i class="fa fa-book"></i>
    </div>
    <div id="sidebar-tag" title="Tags">
        <i class="fa fa-tags"></i>
    </div>
    <div id="sidebar-top">
        <span class="sidebar-top-icon"><i class="fa fa-angle-up"></i></span>
    </div>
</div>
<div class="sidebar-menu-box" id="sidebar-menu-box">
    <div class="sidebar-menu-box-container">
        <div id="sidebar-menu-box-categories">
            <a class="category-link" href="/categories/app测试/">app测试</a><a class="category-link" href="/categories/django/">django</a><a class="category-link" href="/categories/github/">github</a><a class="category-link" href="/categories/hexo/">hexo</a><a class="category-link" href="/categories/linux/">linux</a><a class="category-link" href="/categories/markdown/">markdown</a><a class="category-link" href="/categories/mongodb/">mongodb</a><a class="category-link" href="/categories/mysql/">mysql</a><a class="category-link" href="/categories/python/">python</a><a class="category-link" href="/categories/redis/">redis</a><a class="category-link" href="/categories/web测试/">web测试</a><a class="category-link" href="/categories/持续集成/">持续集成</a><a class="category-link" href="/categories/接口测试/">接口测试</a><a class="category-link" href="/categories/数据结构与算法/">数据结构与算法</a><a class="category-link" href="/categories/服务器/">服务器</a><a class="category-link" href="/categories/测试框架/">测试框架</a><a class="category-link" href="/categories/测试用例/">测试用例</a><a class="category-link" href="/categories/爬虫/">爬虫</a><a class="category-link" href="/categories/网络/">网络</a>
        </div>
        <div id="sidebar-menu-box-tags">
            <a href="/tags/adb/" style="font-size: 10px;">adb</a> <a href="/tags/appium/" style="font-size: 13.33px;">appium</a> <a href="/tags/app测试/" style="font-size: 10px;">app测试</a> <a href="/tags/django/" style="font-size: 10px;">django</a> <a href="/tags/fiddler/" style="font-size: 10px;">fiddler</a> <a href="/tags/github/" style="font-size: 10px;">github</a> <a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/jenkins/" style="font-size: 10px;">jenkins</a> <a href="/tags/jmeter/" style="font-size: 10px;">jmeter</a> <a href="/tags/linux/" style="font-size: 10px;">linux</a> <a href="/tags/markdown/" style="font-size: 10px;">markdown</a> <a href="/tags/mongodb/" style="font-size: 10px;">mongodb</a> <a href="/tags/monkey/" style="font-size: 10px;">monkey</a> <a href="/tags/mysql/" style="font-size: 10px;">mysql</a> <a href="/tags/postman/" style="font-size: 10px;">postman</a> <a href="/tags/python/" style="font-size: 20px;">python</a> <a href="/tags/redis/" style="font-size: 10px;">redis</a> <a href="/tags/selenium/" style="font-size: 11.67px;">selenium</a> <a href="/tags/unittest/" style="font-size: 10px;">unittest</a> <a href="/tags/web测试/" style="font-size: 10px;">web测试</a> <a href="/tags/安卓性能/" style="font-size: 15px;">安卓性能</a> <a href="/tags/接口测试/" style="font-size: 10px;">接口测试</a> <a href="/tags/接口脚本/" style="font-size: 10px;">接口脚本</a> <a href="/tags/测试用例/" style="font-size: 16.67px;">测试用例</a> <a href="/tags/爬虫/" style="font-size: 18.33px;">爬虫</a>
        </div>
    </div>
    <a href="javascript:;" class="sidebar-menu-box-close">&times;</a>
</div>
<div class="mobile-header-menu-nav" id="mobile-header-menu-nav">
    <div class="mobile-header-menu-container">
        <span class="title">Menus</span>
        <ul class="mobile-header-menu-navbar">
            
            <li>
                <a  href="/">
                    <i class="fa fa-home"></i><span>Home</span>
                </a>
            </li>
            
            <li>
                <a  href="/archives">
                    <i class="fa fa-archive"></i><span>Archives</span>
                </a>
            </li>
            
            <li>
                <a  href="/about">
                    <i class="fa fa-user"></i><span>About</span>
                </a>
            </li>
            
        </ul>
    </div>
    <div class="mobile-header-tag-container">
        <span class="title">Tags</span>
        <div id="mobile-header-container-tags">
            <a href="/tags/adb/" style="font-size: 10px;">adb</a> <a href="/tags/appium/" style="font-size: 13.33px;">appium</a> <a href="/tags/app测试/" style="font-size: 10px;">app测试</a> <a href="/tags/django/" style="font-size: 10px;">django</a> <a href="/tags/fiddler/" style="font-size: 10px;">fiddler</a> <a href="/tags/github/" style="font-size: 10px;">github</a> <a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/jenkins/" style="font-size: 10px;">jenkins</a> <a href="/tags/jmeter/" style="font-size: 10px;">jmeter</a> <a href="/tags/linux/" style="font-size: 10px;">linux</a> <a href="/tags/markdown/" style="font-size: 10px;">markdown</a> <a href="/tags/mongodb/" style="font-size: 10px;">mongodb</a> <a href="/tags/monkey/" style="font-size: 10px;">monkey</a> <a href="/tags/mysql/" style="font-size: 10px;">mysql</a> <a href="/tags/postman/" style="font-size: 10px;">postman</a> <a href="/tags/python/" style="font-size: 20px;">python</a> <a href="/tags/redis/" style="font-size: 10px;">redis</a> <a href="/tags/selenium/" style="font-size: 11.67px;">selenium</a> <a href="/tags/unittest/" style="font-size: 10px;">unittest</a> <a href="/tags/web测试/" style="font-size: 10px;">web测试</a> <a href="/tags/安卓性能/" style="font-size: 15px;">安卓性能</a> <a href="/tags/接口测试/" style="font-size: 10px;">接口测试</a> <a href="/tags/接口脚本/" style="font-size: 10px;">接口脚本</a> <a href="/tags/测试用例/" style="font-size: 16.67px;">测试用例</a> <a href="/tags/爬虫/" style="font-size: 18.33px;">爬虫</a>
        </div>
    </div>
</div>
<div class="search-wrap">
    <span class="search-close">&times;</span>
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
            <i class="icon icon-lg icon-chevron-left"></i>
        </a>
        <input class="search-field" placeholder="Search..." id="keywords">
        <a id="search-submit" href="javascript:;">
            <i class="fa fa-search"></i>
        </a>
    <div class="search-container" id="search-container">
        <ul class="search-result" id="search-result">
        </ul>
    </div>
</div>

<div id="search-tpl">
    <li class="search-result-item">
        <a href="{url}" class="search-item-li">
            <span class="search-item-li-title" title="{title}">{title}</span>
        </a>
    </li>
</div>
<script src="/js/search.js"></script>
<script src="/js/main.js"></script>


  <script src="//cdn.bootcss.com/particles.js/2.0.0/particles.min.js"></script>
  <div id="particles"></div>
  <script src="/js/particles.js"></script>







  <link rel="stylesheet" href="//cdn.bootcss.com/animate.css/3.5.0/animate.min.css">
  <script src="//cdn.bootcss.com/scrollReveal.js/3.0.5/scrollreveal.js"></script>
  <script src="/js/animate.js"></script>

  </div>
</body>
</html>