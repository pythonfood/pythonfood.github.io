<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>PythonFood</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="http://pythonfood.github.io/"/>
  <updated>2018-08-14T09:52:56.689Z</updated>
  <id>http://pythonfood.github.io/</id>
  
  <author>
    <name>Python Food</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>爬虫-selenium库</title>
    <link href="http://pythonfood.github.io/2018/07/02/%E7%88%AC%E8%99%AB-selenium%E5%BA%93/"/>
    <id>http://pythonfood.github.io/2018/07/02/爬虫-selenium库/</id>
    <published>2018-07-02T07:00:00.000Z</published>
    <updated>2018-08-14T09:52:56.689Z</updated>
    
    <content type="html"><![CDATA[<p>崔庆才老师爬虫的学习笔记。<br><a id="more"></a></p><h2 id="一、Selenium库详解"><a href="#一、Selenium库详解" class="headerlink" title="一、Selenium库详解"></a>一、Selenium库详解</h2><h3 id="1、什么是Selenium"><a href="#1、什么是Selenium" class="headerlink" title="1、什么是Selenium"></a>1、什么是Selenium</h3><p>Selenium是一个自动化测试工具，利用它可以驱动浏览器执行特定的动作，如点击、下拉等操作，同时还可以获取浏览器当前呈现的页面的源代码，做到可见即可爬。对于一些JavaScript动态渲染的页面来说，此种抓取方式非常有效。</p><h3 id="2、安装"><a href="#2、安装" class="headerlink" title="2、安装"></a>2、安装</h3><p><code>pip install selenium</code></p><h3 id="3、基本使用"><a href="#3、基本使用" class="headerlink" title="3、基本使用"></a>3、基本使用</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.by <span class="keyword">import</span> By</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.keys <span class="keyword">import</span> Keys</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support <span class="keyword">import</span> expected_conditions <span class="keyword">as</span> EC</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support.wait <span class="keyword">import</span> WebDriverWait</span><br><span class="line"></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    browser.get(<span class="string">'https://www.baidu.com'</span>)</span><br><span class="line">    input = browser.find_element_by_id(<span class="string">'kw'</span>)</span><br><span class="line">    input.send_keys(<span class="string">'python'</span>)</span><br><span class="line">    input.send_keys(Keys.ENTER)</span><br><span class="line">    wait = WebDriverWait(browser,<span class="number">10</span>)</span><br><span class="line">    wait.until(EC.presence_of_element_located((By.ID,<span class="string">'content_left'</span>)))</span><br><span class="line">    print(browser.current_url)</span><br><span class="line">    print(browser.get_cookies())</span><br><span class="line">    print(browser.page_source)</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    browser.close()</span><br></pre></td></tr></table></figure><h3 id="4、声明浏览器对象"><a href="#4、声明浏览器对象" class="headerlink" title="4、声明浏览器对象"></a>4、声明浏览器对象</h3><p>Selenium支持非常多的浏览器，如Chrome、Firefox、Edge等，还有Android、BlackBerry等手机端的浏览器。另外，也支持无界面浏览器PhantomJS。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"> </span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line">browser = webdriver.Firefox()</span><br><span class="line">browser = webdriver.Edge()</span><br><span class="line">browser = webdriver.PhantomJS()</span><br><span class="line">browser = webdriver.Safari()</span><br></pre></td></tr></table></figure><h3 id="5、访问页面"><a href="#5、访问页面" class="headerlink" title="5、访问页面"></a>5、访问页面</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line">browser.get(<span class="string">'https://www.taobao.com'</span>)</span><br><span class="line">print(browser.page_source)</span><br><span class="line">browser.close()</span><br></pre></td></tr></table></figure><h3 id="6、查找节点"><a href="#6、查找节点" class="headerlink" title="6、查找节点"></a>6、查找节点</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#单个节点</span></span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.by <span class="keyword">import</span> By</span><br><span class="line"></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line">browser.get(<span class="string">'https://www.taobao.com'</span>)</span><br><span class="line">input1 = browser.find_element_by_id(<span class="string">'q'</span>)</span><br><span class="line">input2 = browser.find_element_by_css_selector(<span class="string">'#q'</span>)</span><br><span class="line">input3 = browser.find_element_by_xpath(<span class="string">'//*[@id="q"]'</span>)</span><br><span class="line">print(input1,input2,input3)</span><br><span class="line"></span><br><span class="line"><span class="comment">#Selenium还提供了查找元素通用方法find_element()，它需要传入两个参数：查找方式By和值。</span></span><br><span class="line"><span class="comment">#这种查找方式的功能和上面列举的查找函数完全一致，不过参数更加灵活。</span></span><br><span class="line">input1_same = browser.find_element(By.ID,<span class="string">'q'</span>) <span class="comment">#等价于find_element_by_id('q')</span></span><br><span class="line">print(input1_same)</span><br><span class="line"></span><br><span class="line">browser.close()</span><br></pre></td></tr></table></figure><p>所有获取单个节点的方法：</p><ul><li>find_element_by_id</li><li>find_element_by_name</li><li>find_element_by_xpath</li><li>find_element_by_link_text</li><li>find_element_by_partial_link_text</li><li>find_element_by_tag_name</li><li>find_element_by_class_name</li><li>find_element_by_css_selector</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#多个节点</span></span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line">browser.get(<span class="string">'https://www.taobao.com'</span>)</span><br><span class="line">lis = browser.find_elements_by_css_selector(<span class="string">'.service-bd li'</span>)</span><br><span class="line">print(lis)</span><br><span class="line"></span><br><span class="line"><span class="comment">#也可以直接用find_elements()方法来选择</span></span><br><span class="line">lis_same = browser.find_elements(By.CSS_SELECTOR,<span class="string">'.service-bd li'</span>) <span class="comment">#等价于find_elements_by_css_selector('.service-bd li')</span></span><br><span class="line">print(lis_same)</span><br><span class="line"></span><br><span class="line">browser.close()</span><br></pre></td></tr></table></figure><p>所有获取多个节点的方法：</p><ul><li>find_elements_by_id</li><li>find_elements_by_name</li><li>find_elements_by_xpath</li><li>find_elements_by_link_text</li><li>find_elements_by_partial_link_text</li><li>find_elements_by_tag_name</li><li>find_elements_by_class_name</li><li>find_elements_by_css_selector</li></ul><h3 id="7、元素交互"><a href="#7、元素交互" class="headerlink" title="7、元素交互"></a>7、元素交互</h3><p>官方文档：<a href="http://selenium-python.readthedocs.io/api.html#module-selenium.webdriver.remote.webelement" target="_blank" rel="noopener">http://selenium-python.readthedocs.io/api.html#module-selenium.webdriver.remote.webelement</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line">browser.get(<span class="string">'https://www.taobao.com'</span>)</span><br><span class="line">input = browser.find_element_by_id(<span class="string">'q'</span>)</span><br><span class="line">input.send_keys(<span class="string">'iphone'</span>)</span><br><span class="line">time.sleep(<span class="number">1</span>)</span><br><span class="line">input.clear()</span><br><span class="line">input.send_keys(<span class="string">'ipad'</span>)</span><br><span class="line">button = browser.find_element_by_class_name(<span class="string">'btn-search'</span>)</span><br><span class="line">button.click()</span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line">browser.close()</span><br></pre></td></tr></table></figure><h3 id="8、交互动作-动作链"><a href="#8、交互动作-动作链" class="headerlink" title="8、交互动作(动作链)"></a>8、交互动作(动作链)</h3><p>还有一些操作，它们没有特定的执行对象，比如鼠标拖曳、键盘按键等，这些动作用另一种方式来执行，那就是动作链。</p><p>将动作附加到动作链中串行执行。</p><p>官方文档：<a href="http://selenium-python.readthedocs.io/api.html#module-selenium.webdriver.common.action_chains" target="_blank" rel="noopener">http://selenium-python.readthedocs.io/api.html#module-selenium.webdriver.common.action_chains</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver <span class="keyword">import</span> ActionChains</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line">browser.get(<span class="string">'http://www.runoob.com/try/try.php?filename=jqueryui-api-droppable'</span>)</span><br><span class="line">time.sleep(<span class="number">5</span>)</span><br><span class="line">browser.switch_to.frame(<span class="string">'iframeResult'</span>)</span><br><span class="line">source = browser.find_element_by_css_selector(<span class="string">'#draggable'</span>)</span><br><span class="line">target = browser.find_element_by_css_selector(<span class="string">'#droppable'</span>)</span><br><span class="line">actions = ActionChains(browser) <span class="comment">#声明动作链对象</span></span><br><span class="line">actions.drag_and_drop(source,target) <span class="comment">#定义拖放动作</span></span><br><span class="line">actions.perform() <span class="comment">#执行动作链</span></span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line">browser.close()</span><br></pre></td></tr></table></figure><h3 id="9、执行JavaScript"><a href="#9、执行JavaScript" class="headerlink" title="9、执行JavaScript"></a>9、执行JavaScript</h3><p>对于某些操作，Selenium API并没有提供。比如，下拉进度条，它可以直接模拟运行JavaScript，此时使用execute_script()方法即可实现。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line">browser.get(<span class="string">'https://www.zhihu.com/explore'</span>)</span><br><span class="line">browser.execute_script(<span class="string">'window.scrollTo(0,document.body.scrollHeight)'</span>)</span><br><span class="line">browser.execute_script(<span class="string">'alert("To Bottom")'</span>)</span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line">browser.close()</span><br></pre></td></tr></table></figure><h3 id="10、获取元素信息"><a href="#10、获取元素信息" class="headerlink" title="10、获取元素信息"></a>10、获取元素信息</h3><p>Selenium已经提供了选择节点的方法，返回的是WebElement类型，那么它也有相关的方法和属性来直接提取节点信息，如属性、文本等。这样的话，我们就可以不用通过解析源代码来提取信息了，非常方便。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#获取属性</span></span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line">browser.get(<span class="string">'https://www.zhihu.com/explore'</span>)</span><br><span class="line">logo = browser.find_element_by_id(<span class="string">'zh-top-link-logo'</span>)</span><br><span class="line">print(logo)</span><br><span class="line">print(logo.get_attribute(<span class="string">'class'</span>)) <span class="comment">#获取class属性</span></span><br><span class="line"></span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line">browser.close()</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#获取文本值</span></span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line">browser.get(<span class="string">'https://www.zhihu.com/explore'</span>)</span><br><span class="line">input = browser.find_element_by_class_name(<span class="string">'zu-top-add-question'</span>)</span><br><span class="line">print(input)</span><br><span class="line">print(input.text) <span class="comment">#获取文本值</span></span><br><span class="line"></span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line">browser.close()</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#获取id、位置、标签名和大小</span></span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line">browser.get(<span class="string">'https://www.zhihu.com/explore'</span>)</span><br><span class="line">input = browser.find_element_by_class_name(<span class="string">'zu-top-add-question'</span>)</span><br><span class="line">print(input)</span><br><span class="line">print(input.id) <span class="comment">#获取节点id</span></span><br><span class="line">print(input.location) <span class="comment">#获取该节点在页面中的相对位置</span></span><br><span class="line">print(input.tag_name) <span class="comment">#获取标签名称</span></span><br><span class="line">print(input.size) <span class="comment">#获取节点的大小，也就是宽高</span></span><br><span class="line"></span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line">browser.close()</span><br></pre></td></tr></table></figure><h3 id="11、切换Frame"><a href="#11、切换Frame" class="headerlink" title="11、切换Frame"></a>11、切换Frame</h3><p>网页中有一种节点叫作iframe，也就是子Frame，相当于页面的子页面，它的结构和外部网页的结构完全一致。Selenium打开页面后，它默认是在父级Frame里面操作，而此时如果页面中还有子Frame，它是不能获取到子Frame里面的节点的。这时就需要使用switch_to.frame()方法来切换Frame。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.common.exceptions <span class="keyword">import</span> NoSuchElementException</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line">browser.get(<span class="string">'http://www.runoob.com/try/try.php?filename=jqueryui-api-droppable'</span>)</span><br><span class="line">browser.switch_to.frame(<span class="string">'iframeResult'</span>) <span class="comment">#切换到子frame</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    logo = browser.find_element_by_class_name(<span class="string">'logo'</span>)</span><br><span class="line"><span class="keyword">except</span> NoSuchElementException:</span><br><span class="line">    print(<span class="string">'NO LOGO'</span>)</span><br><span class="line">browser.switch_to.parent_frame() <span class="comment">#切换回父frame</span></span><br><span class="line">logo = browser.find_element_by_class_name(<span class="string">'logo'</span>)</span><br><span class="line">print(logo)</span><br><span class="line">print(logo.text)</span><br><span class="line"></span><br><span class="line">time.sleep(<span class="number">3</span>)</span><br><span class="line">browser.close()</span><br></pre></td></tr></table></figure><h3 id="12、延时等待"><a href="#12、延时等待" class="headerlink" title="12、延时等待"></a>12、延时等待</h3><p>这里等待的方式有两种：一种是隐式等待，一种是显式等待。</p><p>隐式等待，如果Selenium没有在DOM中找到节点，将继续等待，超出设定时间后，则抛出找不到节点的异常。隐式等待的效果其实并没有那么好，因为我们只规定了一个固定时间，而页面的加载时间会受到网络条件的影响。</p><p>显式等待，它指定要查找的节点，然后指定一个最长等待时间。如果在规定时间内加载出来了这个节点，就返回查找的节点；如果到了规定时间依然没有加载出该节点，则抛出超时异常。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#隐式等待</span></span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line">browser.implicitly_wait(<span class="number">10</span>) <span class="comment">#隐式等待10秒</span></span><br><span class="line">browser.get(<span class="string">'https://www.zhihu.com/explore'</span>)</span><br><span class="line">input = browser.find_element_by_class_name(<span class="string">'zu-top-add-question'</span>)</span><br><span class="line">print(input)</span><br><span class="line"></span><br><span class="line">browser.close()</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#显示等待</span></span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.by <span class="keyword">import</span> By</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support.ui <span class="keyword">import</span> WebDriverWait</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support <span class="keyword">import</span> expected_conditions <span class="keyword">as</span> EC</span><br><span class="line"></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line">browser.get(<span class="string">'https://www.taobao.com/'</span>)</span><br><span class="line">wait = WebDriverWait(browser,<span class="number">10</span>) <span class="comment">#声明WebDriverWait对象，指定最长等待时间</span></span><br><span class="line">input = wait.until(EC.presence_of_element_located((By.ID,<span class="string">'q'</span>))) <span class="comment">#调用它的until()方法，传入要等待条件</span></span><br><span class="line">button = wait.until(EC.element_to_be_clickable((By.CSS_SELECTOR,<span class="string">'.btn-search'</span>)))</span><br><span class="line">print(input,button)</span><br><span class="line">browser.close()</span><br></pre></td></tr></table></figure><p>等待条件及其含义：</p><ul><li><code>title_is</code>：标题是某内容</li><li><code>title_contains</code>：标题包含某内容</li><li><code>presence_of_element_located</code>：节点加载出来，传入定位元组，如(By.ID, ‘p’)</li><li><code>visibility_of_element_located</code>：节点可见，传入定位元组</li><li><code>visibility_of</code>：可见，传入节点对象</li><li><code>presence_of_all_elements_located</code>：所有节点加载出来</li><li><code>text_to_be_present_in_element</code>：某个节点文本包含某文字</li><li><code>text_to_be_present_in_element_value</code>：某个节点值包含某文字</li><li><code>frame_to_be_available_and_switch_to_it</code>：加载并切换</li><li><code>invisibility_of_element_located</code>：节点不可见</li><li><code>element_to_be_clickable</code>：节点可点击</li><li><code>staleness_of</code>：判断一个节点是否仍在DOM，可判断页面是否已经刷新</li><li><code>element_to_be_selected</code>：节点可选择，传节点对象</li><li><code>element_located_to_be_selected</code>：节点可选择，传入定位元组</li><li><code>element_selection_state_to_be</code>：传入节点对象以及状态，相等返回True，否则返回False</li><li><code>element_located_selection_state_to_be</code>：传入定位元组以及状态，相等返回True，否则返回False</li><li><code>alert_is_present</code>：是否出现警告</li></ul><p>等待条件的参数及用法参考官方文档：<a href="http://selenium-python.readthedocs.io/api.html#module-selenium.webdriver.support.expected_conditions" target="_blank" rel="noopener">http://selenium-python.readthedocs.io/api.html#module-selenium.webdriver.support.expected_conditions</a></p><h3 id="13、前进后退"><a href="#13、前进后退" class="headerlink" title="13、前进后退"></a>13、前进后退</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line">browser.get(<span class="string">'https://www.baidu.com/'</span>)</span><br><span class="line">browser.get(<span class="string">'https://www.taobao.com/'</span>)</span><br><span class="line">browser.get(<span class="string">'https://www.python.org/'</span>)</span><br><span class="line"></span><br><span class="line">browser.back() <span class="comment">#后退</span></span><br><span class="line">time.sleep(<span class="number">2</span>)</span><br><span class="line">browser.forward() <span class="comment">#前进</span></span><br><span class="line">time.sleep(<span class="number">2</span>)</span><br><span class="line">browser.close()</span><br></pre></td></tr></table></figure><h3 id="14、Cookies"><a href="#14、Cookies" class="headerlink" title="14、Cookies"></a>14、Cookies</h3><p>Selenium可以方便地对Cookies进行操作，例如获取、添加、删除Cookies等</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"> </span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line">browser.get(<span class="string">'https://www.zhihu.com/explore'</span>)</span><br><span class="line">print(browser.get_cookies()) <span class="comment">#获取cookies</span></span><br><span class="line">browser.add_cookie(&#123;<span class="string">'name'</span>: <span class="string">'name'</span>, <span class="string">'domain'</span>: <span class="string">'www.zhihu.com'</span>, <span class="string">'value'</span>: <span class="string">'germey'</span>&#125;) <span class="comment">#添加cookie</span></span><br><span class="line">print(browser.get_cookies())</span><br><span class="line">browser.delete_all_cookies() <span class="comment">#删除全部cookies</span></span><br><span class="line">print(browser.get_cookies())</span><br><span class="line">browser.close()</span><br></pre></td></tr></table></figure><h3 id="15、选项卡管理"><a href="#15、选项卡管理" class="headerlink" title="15、选项卡管理"></a>15、选项卡管理</h3><p>在访问网页的时候，会开启一个个选项卡。Selenium也可以对选项卡进行操作。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">import</span> time </span><br><span class="line"></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line">browser.get(<span class="string">'https://www.baidu.com'</span>)</span><br><span class="line">browser.execute_script(<span class="string">'window.open()'</span>) <span class="comment">#借助javascript开启新的选项卡</span></span><br><span class="line">print(browser.window_handles) <span class="comment">#window_handles获取当前所有选项卡句柄</span></span><br><span class="line">browser.switch_to_window(browser.window_handles[<span class="number">1</span>]) <span class="comment">#切换到第二个选项卡</span></span><br><span class="line">browser.get(<span class="string">'https://www.taobao.com'</span>)</span><br><span class="line">time.sleep(<span class="number">2</span>)</span><br><span class="line">browser.switch_to_window(browser.window_handles[<span class="number">0</span>]) <span class="comment">#切换回第一个选项卡</span></span><br><span class="line">browser.get(<span class="string">'https://python.org'</span>)</span><br><span class="line">time.sleep(<span class="number">2</span>)</span><br><span class="line">browser.close()</span><br></pre></td></tr></table></figure><h3 id="16、异常处理"><a href="#16、异常处理" class="headerlink" title="16、异常处理"></a>16、异常处理</h3><p>官方文档：<a href="http://selenium-python.readthedocs.io/api.html#module-selenium.common.exceptions" target="_blank" rel="noopener">http://selenium-python.readthedocs.io/api.html#module-selenium.common.exceptions</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"> </span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line">browser.get(<span class="string">'https://www.baidu.com'</span>)</span><br><span class="line">browser.find_element_by_id(<span class="string">'hello'</span>) <span class="comment">#选择一个并不存在的节点，此时就会遇到异常。</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.common.exceptions <span class="keyword">import</span> TimeoutException,NoSuchElementException</span><br><span class="line"></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    browser.get(<span class="string">'https://www.baidu.com'</span>)</span><br><span class="line"><span class="keyword">except</span> TimeoutException:</span><br><span class="line">    print(<span class="string">'Time Out'</span>)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    browser.find_element_by_id(<span class="string">'hello'</span>)</span><br><span class="line"><span class="keyword">except</span> NoSuchElementException:</span><br><span class="line">    print(<span class="string">'No Element'</span>)</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    browser.close()</span><br></pre></td></tr></table></figure><h1 id="持续更新…"><a href="#持续更新…" class="headerlink" title="持续更新…"></a><em>持续更新…</em></h1>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;崔庆才老师爬虫的学习笔记。&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="爬虫" scheme="http://pythonfood.github.io/categories/%E7%88%AC%E8%99%AB/"/>
    
    
      <category term="爬虫" scheme="http://pythonfood.github.io/tags/%E7%88%AC%E8%99%AB/"/>
    
  </entry>
  
  <entry>
    <title>爬虫-pyquery库</title>
    <link href="http://pythonfood.github.io/2018/07/02/%E7%88%AC%E8%99%AB-pyquery%E5%BA%93/"/>
    <id>http://pythonfood.github.io/2018/07/02/爬虫-pyquery库/</id>
    <published>2018-07-02T06:00:00.000Z</published>
    <updated>2018-08-14T09:47:15.801Z</updated>
    
    <content type="html"><![CDATA[<p>崔庆才老师爬虫的学习笔记。<br><a id="more"></a></p><h2 id="一、PyQuery库详解"><a href="#一、PyQuery库详解" class="headerlink" title="一、PyQuery库详解"></a>一、PyQuery库详解</h2><h3 id="1、什么是PyQuery库"><a href="#1、什么是PyQuery库" class="headerlink" title="1、什么是PyQuery库"></a>1、什么是PyQuery库</h3><p>强大而灵活的网页解析库。如果你觉得正则写起来太麻烦，如果你觉得BeautifulSoup语法太难记，如果你熟悉jQuery的语法，那么PyQuery就是你的绝佳选择！！！</p><p><a href="http://pyquery.readthedocs.io" target="_blank" rel="noopener">http://pyquery.readthedocs.io</a></p><h3 id="2、安装"><a href="#2、安装" class="headerlink" title="2、安装"></a>2、安装</h3><p><code>pip install pyquery</code></p><h3 id="3、初始化"><a href="#3、初始化" class="headerlink" title="3、初始化"></a>3、初始化</h3><p>初始化pyquery的时候，也需要传入HTML文本来初始化一个PyQuery对象。它的初始化方式有多种，比如直接传入字符串，传入URL，传入文件名，等等。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#三种初始化方式</span></span><br><span class="line"><span class="keyword">from</span> pyquery <span class="keyword">import</span> PyQuery <span class="keyword">as</span> pq</span><br><span class="line"></span><br><span class="line"><span class="comment">#1.字符串初始化</span></span><br><span class="line">html = <span class="string">''' </span></span><br><span class="line"><span class="string">&lt;div&gt; </span></span><br><span class="line"><span class="string">    &lt;ul&gt; </span></span><br><span class="line"><span class="string">        &lt;li class="item-0"&gt;first item&lt;/li&gt; </span></span><br><span class="line"><span class="string">        &lt;li class="item-1"&gt;&lt;a href="link2.html"&gt;second item&lt;/a&gt;&lt;&gt;/li </span></span><br><span class="line"><span class="string">        &lt;li class="item-0 active"&gt;&lt;a href="link3.html"&gt;&lt;span class="boid"&gt;third item&lt;/span&gt;&lt;/a&gt;&lt;/li&gt; </span></span><br><span class="line"><span class="string">        &lt;li class="item-1 active"&gt;&lt;a href="link4.html"&gt;fourth item&lt;/a&gt;&lt;/li&gt; </span></span><br><span class="line"><span class="string">        &lt;li class="item-0"&gt;&lt;a href="link5.html"&gt;fifth item&lt;/a&gt;&lt;/li&gt; </span></span><br><span class="line"><span class="string">    &lt;/ul&gt; </span></span><br><span class="line"><span class="string">&lt;/div&gt; </span></span><br><span class="line"><span class="string">'''</span> </span><br><span class="line">doc1 = pq(html)</span><br><span class="line">print(doc1(<span class="string">'li'</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">#2.URL初始化 </span></span><br><span class="line">doc2 = pq(url=<span class="string">'http://www.baidu.com'</span>)</span><br><span class="line">print(doc2(<span class="string">'head'</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">#3.文件初始化</span></span><br><span class="line">doc3 = pq(filename=<span class="string">'demo.html'</span>)</span><br><span class="line">print(doc3(<span class="string">'li'</span>))</span><br></pre></td></tr></table></figure><h3 id="4、CSS选择器"><a href="#4、CSS选择器" class="headerlink" title="4、CSS选择器"></a>4、CSS选择器</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyquery <span class="keyword">import</span> PyQuery <span class="keyword">as</span> pq</span><br><span class="line"></span><br><span class="line">html = <span class="string">''' </span></span><br><span class="line"><span class="string">&lt;div id="container"&gt; </span></span><br><span class="line"><span class="string">    &lt;ul class="list"&gt; </span></span><br><span class="line"><span class="string">        &lt;li class="item-0"&gt;first item&lt;/li&gt; </span></span><br><span class="line"><span class="string">        &lt;li class="item-1"&gt;&lt;a href="link2.html"&gt;second item&lt;/a&gt;&lt;&gt;/li </span></span><br><span class="line"><span class="string">        &lt;li class="item-0 active"&gt;&lt;a href="link3.html"&gt;&lt;span class="boid"&gt;third item&lt;/span&gt;&lt;/a&gt;&lt;/li&gt; </span></span><br><span class="line"><span class="string">        &lt;li class="item-1 active"&gt;&lt;a href="link4.html"&gt;fourth item&lt;/a&gt;&lt;/li&gt; </span></span><br><span class="line"><span class="string">        &lt;li class="item-0"&gt;&lt;a href="link5.html"&gt;fifth item&lt;/a&gt;&lt;/li&gt; </span></span><br><span class="line"><span class="string">    &lt;/ul&gt; </span></span><br><span class="line"><span class="string">&lt;/div&gt; </span></span><br><span class="line"><span class="string">'''</span>  </span><br><span class="line">doc = pq(html)</span><br><span class="line">print(doc(<span class="string">'#container .list li'</span>)) <span class="comment">#空格代表嵌套关系,依次传入了id、class、标签</span></span><br><span class="line">print(type(doc(<span class="string">'#container .list li'</span>)))</span><br></pre></td></tr></table></figure><h3 id="5、查找元素"><a href="#5、查找元素" class="headerlink" title="5、查找元素"></a>5、查找元素</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#子元素</span></span><br><span class="line"><span class="keyword">from</span> pyquery <span class="keyword">import</span> PyQuery <span class="keyword">as</span> pq</span><br><span class="line"></span><br><span class="line">html = <span class="string">'''</span></span><br><span class="line"><span class="string">&lt;div id="container"&gt; </span></span><br><span class="line"><span class="string">    &lt;ul class="list"&gt; </span></span><br><span class="line"><span class="string">        &lt;li class="item-0"&gt;first item&lt;/li&gt; </span></span><br><span class="line"><span class="string">        &lt;li class="item-1"&gt;&lt;a href="link2.html"&gt;second item&lt;/a&gt;&lt;&gt;/li </span></span><br><span class="line"><span class="string">        &lt;li class="item-0 active"&gt;&lt;a href="link3.html"&gt;&lt;span class="boid"&gt;third item&lt;/span&gt;&lt;/a&gt;&lt;/li&gt; </span></span><br><span class="line"><span class="string">        &lt;li class="item-1 active"&gt;&lt;a href="link4.html"&gt;fourth item&lt;/a&gt;&lt;/li&gt; </span></span><br><span class="line"><span class="string">        &lt;li class="item-0"&gt;&lt;a href="link5.html"&gt;fifth item&lt;/a&gt;&lt;/li&gt; </span></span><br><span class="line"><span class="string">    &lt;/ul&gt; </span></span><br><span class="line"><span class="string">&lt;/div&gt; </span></span><br><span class="line"><span class="string">'''</span>  </span><br><span class="line">doc = pq(html)</span><br><span class="line"><span class="comment"># 查找子孙节点需要用到find()方法，此时传入的参数是CSS选择器</span></span><br><span class="line">items = doc.find(<span class="string">'.list'</span>)</span><br><span class="line">print(items)</span><br><span class="line">print(type(items))</span><br><span class="line">lis = doc.find(<span class="string">'li'</span>)</span><br><span class="line">print(lis)</span><br><span class="line">print(type(lis))</span><br><span class="line"></span><br><span class="line">child1 = items.children() <span class="comment">#children()方法查找子节点</span></span><br><span class="line">print(child1)</span><br><span class="line">print(type(child1))</span><br><span class="line"></span><br><span class="line">child2 = items.children(<span class="string">'.active'</span>) <span class="comment">#筛选子节点中符合条件的节点</span></span><br><span class="line">print(child2)</span><br><span class="line">print(type(child2))</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#父元素</span></span><br><span class="line"><span class="keyword">from</span> pyquery <span class="keyword">import</span> PyQuery <span class="keyword">as</span> pq</span><br><span class="line"></span><br><span class="line">html = <span class="string">'''</span></span><br><span class="line"><span class="string">&lt;div class="wrap"&gt;</span></span><br><span class="line"><span class="string">    &lt;div id="container"&gt;</span></span><br><span class="line"><span class="string">        &lt;ul class="list"&gt;</span></span><br><span class="line"><span class="string">             &lt;li class="item-0"&gt;first item&lt;/li&gt;</span></span><br><span class="line"><span class="string">             &lt;li class="item-1"&gt;&lt;a href="link2.html"&gt;second item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">             &lt;li class="item-0 active"&gt;&lt;a href="link3.html"&gt;&lt;span class="bold"&gt;third item&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">             &lt;li class="item-1 active"&gt;&lt;a href="link4.html"&gt;fourth item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">             &lt;li class="item-0"&gt;&lt;a href="link5.html"&gt;fifth item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">         &lt;/ul&gt;</span></span><br><span class="line"><span class="string">     &lt;/div&gt;</span></span><br><span class="line"><span class="string"> &lt;/div&gt;</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line">doc = pq(html)</span><br><span class="line">items = doc(<span class="string">'.list'</span>) <span class="comment">#首先用.list选取class为list的节点</span></span><br><span class="line"></span><br><span class="line">container = items.parent() <span class="comment">#parent()得到父节点</span></span><br><span class="line">print(container)</span><br><span class="line">print(type(container))</span><br><span class="line"></span><br><span class="line">parents = items.parents() <span class="comment">#parents()得到祖先节点</span></span><br><span class="line">print(parents)</span><br><span class="line">print(type(parents))</span><br><span class="line">parent = items.parents(<span class="string">'.wrap'</span>) <span class="comment">#筛选祖先节点中符合条件的节点</span></span><br><span class="line">print(parent)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#兄弟元素</span></span><br><span class="line"><span class="keyword">from</span> pyquery <span class="keyword">import</span> PyQuery <span class="keyword">as</span> pq</span><br><span class="line"></span><br><span class="line">html = <span class="string">'''</span></span><br><span class="line"><span class="string">&lt;div class="wrap"&gt;</span></span><br><span class="line"><span class="string">    &lt;div id="container"&gt;</span></span><br><span class="line"><span class="string">        &lt;ul class="list"&gt;</span></span><br><span class="line"><span class="string">             &lt;li class="item-0"&gt;first item&lt;/li&gt;</span></span><br><span class="line"><span class="string">             &lt;li class="item-1"&gt;&lt;a href="link2.html"&gt;second item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">             &lt;li class="item-0 active"&gt;&lt;a href="link3.html"&gt;&lt;span class="bold"&gt;third item&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">             &lt;li class="item-1 active"&gt;&lt;a href="link4.html"&gt;fourth item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">             &lt;li class="item-0"&gt;&lt;a href="link5.html"&gt;fifth item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">         &lt;/ul&gt;</span></span><br><span class="line"><span class="string">     &lt;/div&gt;</span></span><br><span class="line"><span class="string"> &lt;/div&gt;</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line">doc = pq(html)</span><br><span class="line">li = doc(<span class="string">'.list .item-0.active'</span>) <span class="comment">#注意：.item-0和.active之间没有空格，表示这两个class并存的节点</span></span><br><span class="line"></span><br><span class="line">print(li.siblings()) <span class="comment">#siblings()获取兄弟节点</span></span><br><span class="line"></span><br><span class="line">print(li.siblings(<span class="string">'.active'</span>)) <span class="comment">#筛选兄弟节点中符合条件的节点</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#遍历</span></span><br><span class="line"><span class="keyword">from</span> pyquery <span class="keyword">import</span> PyQuery <span class="keyword">as</span> pq</span><br><span class="line"></span><br><span class="line">html = <span class="string">'''</span></span><br><span class="line"><span class="string">&lt;div class="wrap"&gt;</span></span><br><span class="line"><span class="string">    &lt;div id="container"&gt;</span></span><br><span class="line"><span class="string">        &lt;ul class="list"&gt;</span></span><br><span class="line"><span class="string">             &lt;li class="item-0"&gt;first item&lt;/li&gt;</span></span><br><span class="line"><span class="string">             &lt;li class="item-1"&gt;&lt;a href="link2.html"&gt;second item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">             &lt;li class="item-0 active"&gt;&lt;a href="link3.html"&gt;&lt;span class="bold"&gt;third item&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">             &lt;li class="item-1 active"&gt;&lt;a href="link4.html"&gt;fourth item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">             &lt;li class="item-0"&gt;&lt;a href="link5.html"&gt;fifth item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">         &lt;/ul&gt;</span></span><br><span class="line"><span class="string">     &lt;/div&gt;</span></span><br><span class="line"><span class="string"> &lt;/div&gt;</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"></span><br><span class="line">doc = pq(html)</span><br><span class="line">li = doc(<span class="string">'.item-0.active'</span>)</span><br><span class="line">print(li) <span class="comment">#单个节点可以直接打印输出</span></span><br><span class="line">print(str(li)) <span class="comment">#也可以直接转成字符串</span></span><br><span class="line"></span><br><span class="line">lis = doc(<span class="string">'li'</span>).items() <span class="comment">#多个节点的结果，需要items()遍历来获取</span></span><br><span class="line">print(type(lis))</span><br><span class="line"><span class="keyword">for</span> l <span class="keyword">in</span> lis:</span><br><span class="line">    print(li,type(li))</span><br></pre></td></tr></table></figure><h3 id="6、获取信息"><a href="#6、获取信息" class="headerlink" title="6、获取信息"></a>6、获取信息</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#获取属性</span></span><br><span class="line"><span class="keyword">from</span> pyquery <span class="keyword">import</span> PyQuery <span class="keyword">as</span> pq</span><br><span class="line"></span><br><span class="line">html = <span class="string">'''</span></span><br><span class="line"><span class="string">&lt;div class="wrap"&gt; </span></span><br><span class="line"><span class="string">    &lt;div id="container"&gt; </span></span><br><span class="line"><span class="string">        &lt;ul class="list"&gt; </span></span><br><span class="line"><span class="string">            &lt;li class="item-0"&gt;first item&lt;/li&gt; </span></span><br><span class="line"><span class="string">            &lt;li class="item-1"&gt;&lt;a href="link2.html"&gt;second item&lt;/a&gt;&lt;/li&gt; </span></span><br><span class="line"><span class="string">            &lt;li class="item-0 active"&gt;&lt;a href="link3.html"&gt;&lt;span class="boid"&gt;third item&lt;/span&gt;&lt;/a&gt;&lt;/li&gt; </span></span><br><span class="line"><span class="string">            &lt;li class="item-1 active"&gt;&lt;a href="link4.html"&gt;fourth item&lt;/a&gt;&lt;/li&gt; </span></span><br><span class="line"><span class="string">            &lt;li class="item-0"&gt;&lt;a href="link5.html"&gt;fifth item&lt;/a&gt;&lt;/li&gt; </span></span><br><span class="line"><span class="string">        &lt;/ul&gt; </span></span><br><span class="line"><span class="string">    &lt;/div&gt; </span></span><br><span class="line"><span class="string">&lt;/div&gt; </span></span><br><span class="line"><span class="string">'''</span>  </span><br><span class="line"></span><br><span class="line">doc = pq(html)</span><br><span class="line">a = doc(<span class="string">'.item-0.active a'</span>)</span><br><span class="line"></span><br><span class="line">print(a,type(a))</span><br><span class="line">print(a.attr(<span class="string">'href'</span>)) <span class="comment">#调用attr()方法获取属性值</span></span><br><span class="line">print(a.attr.href) <span class="comment">#调用attr属性来获取属性值，这两种方式都可以</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#获取文本</span></span><br><span class="line"><span class="keyword">from</span> pyquery <span class="keyword">import</span> PyQuery <span class="keyword">as</span> pq</span><br><span class="line"></span><br><span class="line">html = <span class="string">'''</span></span><br><span class="line"><span class="string">&lt;div class="wrap"&gt; </span></span><br><span class="line"><span class="string">    &lt;div id="container"&gt; </span></span><br><span class="line"><span class="string">        &lt;ul class="list"&gt;  </span></span><br><span class="line"><span class="string">            &lt;li class="item-1"&gt;&lt;a href="link2.html"&gt;second item&lt;/a&gt;&lt;/li&gt; </span></span><br><span class="line"><span class="string">            &lt;li class="item-0 active"&gt;&lt;a href="link3.html"&gt;&lt;span class="boid"&gt;third item&lt;/span&gt;&lt;/a&gt;&lt;/li&gt; </span></span><br><span class="line"><span class="string">            &lt;li class="item-1 active"&gt;&lt;a href="link4.html"&gt;fourth item&lt;/a&gt;&lt;/li&gt; </span></span><br><span class="line"><span class="string">            &lt;li class="item-0"&gt;&lt;a href="link5.html"&gt;fifth item&lt;/a&gt;&lt;/li&gt; </span></span><br><span class="line"><span class="string">        &lt;/ul&gt; </span></span><br><span class="line"><span class="string">    &lt;/div&gt; </span></span><br><span class="line"><span class="string">&lt;/div&gt; </span></span><br><span class="line"><span class="string">'''</span>  </span><br><span class="line"></span><br><span class="line">doc = pq(html)</span><br><span class="line"></span><br><span class="line">a = doc(<span class="string">'.item-0.active a'</span>)</span><br><span class="line">print(a,type(a))</span><br><span class="line">print(a.text()) <span class="comment">#text()获取节点内部的纯文本</span></span><br><span class="line"></span><br><span class="line">li = doc(<span class="string">'.item-0.active'</span>)</span><br><span class="line">print(li)</span><br><span class="line">print(li.html()) <span class="comment">#html()获取节点内部的HTML文本</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#注意，如果选中的结果是多个节点</span></span><br><span class="line">lis = doc(<span class="string">'li'</span>)</span><br><span class="line">print(lis.html()) <span class="comment">#html()方法返回的是第一个li节点的内部HTML文本</span></span><br><span class="line">print(lis.text()) <span class="comment">#text()则返回所有的li节点内部的纯文本，中间用空格分割开</span></span><br><span class="line">print(type(lis.text())) <span class="comment">#text()返回结果是一个字符串</span></span><br></pre></td></tr></table></figure><h3 id="7、DOM操作"><a href="#7、DOM操作" class="headerlink" title="7、DOM操作"></a>7、DOM操作</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyquery <span class="keyword">import</span> PyQuery <span class="keyword">as</span> pq</span><br><span class="line"></span><br><span class="line">html = <span class="string">'''</span></span><br><span class="line"><span class="string">&lt;div class="wrap"&gt; </span></span><br><span class="line"><span class="string">    &lt;div id="container"&gt; </span></span><br><span class="line"><span class="string">        &lt;ul class="list"&gt; </span></span><br><span class="line"><span class="string">            &lt;li class="item-0"&gt;first item&lt;/li&gt; </span></span><br><span class="line"><span class="string">            &lt;li class="item-1"&gt;&lt;a href="link2.html"&gt;second item&lt;/a&gt;&lt;/li&gt; </span></span><br><span class="line"><span class="string">            &lt;li class="item-0 active"&gt;&lt;a href="link3.html"&gt;&lt;span class="boid"&gt;third item&lt;/span&gt;&lt;/a&gt;&lt;/li&gt; </span></span><br><span class="line"><span class="string">            &lt;li class="item-1 active"&gt;&lt;a href="link4.html"&gt;fourth item&lt;/a&gt;&lt;/li&gt; </span></span><br><span class="line"><span class="string">            &lt;li class="item-0"&gt;&lt;a href="link5.html"&gt;fifth item&lt;/a&gt;&lt;/li&gt; </span></span><br><span class="line"><span class="string">        &lt;/ul&gt; </span></span><br><span class="line"><span class="string">    &lt;/div&gt; </span></span><br><span class="line"><span class="string">&lt;/div&gt; </span></span><br><span class="line"><span class="string">'''</span>  </span><br><span class="line">doc = pq(html)</span><br><span class="line"></span><br><span class="line">li = doc(<span class="string">'.item-0.active'</span>)</span><br><span class="line">print(li)</span><br><span class="line">li.removeClass(<span class="string">'active'</span>) <span class="comment">#removeClass()移除class属性</span></span><br><span class="line">print(li)</span><br><span class="line">li.addClass(<span class="string">'active'</span>) <span class="comment">#addClass()增加class属性</span></span><br><span class="line">print(li)</span><br><span class="line"></span><br><span class="line">li.attr(<span class="string">'name'</span>,<span class="string">'link'</span>) <span class="comment">#attr(属性名，属性值)来修改属性，如果只传入第一个参数的属性名，则是获取这个属性值</span></span><br><span class="line">print(li)</span><br><span class="line"></span><br><span class="line">li.text(<span class="string">'changed item'</span>) <span class="comment">#text(纯文本)来修改节点内纯文本，如果不传参数则是获取节点内纯文本</span></span><br><span class="line">print(li)</span><br><span class="line"></span><br><span class="line">li.html(<span class="string">'&lt;span&gt;changed item&lt;/span&gt;'</span>) <span class="comment">#html(html文本)来修改节点内html文本，如果不传参数则是获取节点内html文本</span></span><br><span class="line">print(li)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># remove()移除</span></span><br><span class="line"><span class="keyword">from</span> pyquery <span class="keyword">import</span> PyQuery <span class="keyword">as</span> pq</span><br><span class="line"></span><br><span class="line">html = <span class="string">'''</span></span><br><span class="line"><span class="string">&lt;div class="wrap"&gt;</span></span><br><span class="line"><span class="string">    Hello, World</span></span><br><span class="line"><span class="string">    &lt;p&gt;This is a paragraph.&lt;/p&gt;</span></span><br><span class="line"><span class="string"> &lt;/div&gt;</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">doc = pq(html)</span><br><span class="line"></span><br><span class="line">wrap = doc(<span class="string">'.wrap'</span>)</span><br><span class="line">print(wrap.text()) <span class="comment">#获取的所有文本。现在想提取'Hello, World'这个字符串，而不要p节点内部的字符串，需要怎样操作呢？</span></span><br><span class="line"></span><br><span class="line">wrap.find(<span class="string">'p'</span>).remove() <span class="comment">#remove()方法移除节点</span></span><br><span class="line">print(wrap.text()) <span class="comment">#此时wrap内部就只剩下'Hello, World'这句话了</span></span><br></pre></td></tr></table></figure><p>还有很多节点操作的方法：append()、empty()和prepend()等，和jQuery的用法完全一致。官方文档：<a href="http://pyquery.readthedocs.io/en/latest/api.html。" target="_blank" rel="noopener">http://pyquery.readthedocs.io/en/latest/api.html。</a></p><h3 id="8、伪类选择器"><a href="#8、伪类选择器" class="headerlink" title="8、伪类选择器"></a>8、伪类选择器</h3><p>CSS选择器之所以强大，还有一个很重要的原因，那就是它支持多种多样的伪类选择器，例如选择第一个节点、最后一个节点、奇偶数节点、包含某一文本的节点等。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyquery <span class="keyword">import</span> PyQuery <span class="keyword">as</span> pq</span><br><span class="line">html = <span class="string">'''</span></span><br><span class="line"><span class="string">&lt;div class="wrap"&gt;</span></span><br><span class="line"><span class="string">    &lt;div id="container"&gt;</span></span><br><span class="line"><span class="string">        &lt;ul class="list"&gt;</span></span><br><span class="line"><span class="string">             &lt;li class="item-0"&gt;first item&lt;/li&gt;</span></span><br><span class="line"><span class="string">             &lt;li class="item-1"&gt;&lt;a href="link2.html"&gt;second item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">             &lt;li class="item-0 active"&gt;&lt;a href="link3.html"&gt;&lt;span class="bold"&gt;third item&lt;/span&gt;&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">             &lt;li class="item-1 active"&gt;&lt;a href="link4.html"&gt;fourth item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">             &lt;li class="item-0"&gt;&lt;a href="link5.html"&gt;fifth item&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">         &lt;/ul&gt;</span></span><br><span class="line"><span class="string">     &lt;/div&gt;</span></span><br><span class="line"><span class="string"> &lt;/div&gt;</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">doc = pq(html)</span><br><span class="line"></span><br><span class="line">li = doc(<span class="string">'li:first-child'</span>) <span class="comment">#第一个</span></span><br><span class="line">print(li)</span><br><span class="line">li1 = doc(<span class="string">'li:last-child'</span>) <span class="comment">#最后一个</span></span><br><span class="line">print(li1)</span><br><span class="line">li2 = doc(<span class="string">'li:nth-child(2)'</span>) <span class="comment">#指定缩写顺序，第二个</span></span><br><span class="line">print(li2)</span><br><span class="line">li3 = doc(<span class="string">'li:gt(2)'</span>) <span class="comment">#大于2的</span></span><br><span class="line">print(li3)</span><br><span class="line">li4 = doc(<span class="string">'li:nth-child(2n)'</span>) <span class="comment">#偶数</span></span><br><span class="line">print(li4)</span><br><span class="line">li5 = doc(<span class="string">'li:contains(second)'</span>) <span class="comment">#包含second</span></span><br><span class="line">print(li5)</span><br></pre></td></tr></table></figure><p>关于CSS选择器的更多用法，可以参考<a href="http://www.w3school.com.cn/css/index.asp" target="_blank" rel="noopener">http://www.w3school.com.cn/css/index.asp</a></p><h1 id="持续更新…"><a href="#持续更新…" class="headerlink" title="持续更新…"></a><em>持续更新…</em></h1>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;崔庆才老师爬虫的学习笔记。&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="爬虫" scheme="http://pythonfood.github.io/categories/%E7%88%AC%E8%99%AB/"/>
    
    
      <category term="爬虫" scheme="http://pythonfood.github.io/tags/%E7%88%AC%E8%99%AB/"/>
    
  </entry>
  
  <entry>
    <title>爬虫-beautifulsoup库</title>
    <link href="http://pythonfood.github.io/2018/07/02/%E7%88%AC%E8%99%AB-beautifulsoup%E5%BA%93/"/>
    <id>http://pythonfood.github.io/2018/07/02/爬虫-beautifulsoup库/</id>
    <published>2018-07-02T05:00:00.000Z</published>
    <updated>2018-08-14T09:43:09.814Z</updated>
    
    <content type="html"><![CDATA[<p>崔庆才老师爬虫的学习笔记。<br><a id="more"></a></p><h2 id="一、BeautifulSoup库详解"><a href="#一、BeautifulSoup库详解" class="headerlink" title="一、BeautifulSoup库详解"></a>一、BeautifulSoup库详解</h2><h3 id="1、什么是BeautifulSoup"><a href="#1、什么是BeautifulSoup" class="headerlink" title="1、什么是BeautifulSoup"></a>1、什么是BeautifulSoup</h3><p>Beautiful Soup就是Python的一个HTML或XML的解析库，可以用它来方便地从网页中提取数据。利用它不用编写正则表达式即可方便实现网页信息的提取。</p><h3 id="2、安装"><a href="#2、安装" class="headerlink" title="2、安装"></a>2、安装</h3><p><code>pip install beautifulsoup4</code></p><h3 id="3、解析器"><a href="#3、解析器" class="headerlink" title="3、解析器"></a>3、解析器</h3><table><thead><tr><th style="text-align:left">解析器</th><th style="text-align:left">使用方法</th><th style="text-align:left">优势</th><th style="text-align:left">劣势</th></tr></thead><tbody><tr><td style="text-align:left">Python标准库</td><td style="text-align:left">BeautifulSoup(markup, “html.parser”)</td><td style="text-align:left">Python的内置标准库、执行速度适中、文档容错能力强</td><td style="text-align:left">Python 2.7.3及Python 3.2.2之前的版本文档容错能力差</td></tr><tr><td style="text-align:left">lxml HTML解析器</td><td style="text-align:left">BeautifulSoup(markup, “lxml”)</td><td style="text-align:left">速度快、文档容错能力强</td><td style="text-align:left">需要安装C语言库</td></tr><tr><td style="text-align:left">lxml XML解析器</td><td style="text-align:left">BeautifulSoup(markup, “xml”)</td><td style="text-align:left">速度快、唯一支持XML的解析器</td><td style="text-align:left">需要安装C语言库</td></tr><tr><td style="text-align:left">html5lib</td><td style="text-align:left">BeautifulSoup(markup, “html5lib”)</td><td style="text-align:left">最好的容错性、以浏览器的方式解析文档、生成HTML5格式的文档</td><td style="text-align:left">速度慢、不依赖外部扩展</td></tr></tbody></table><h3 id="4、基本用法"><a href="#4、基本用法" class="headerlink" title="4、基本用法"></a>4、基本用法</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line">html = <span class="string">''''' </span></span><br><span class="line"><span class="string">&lt;html&gt;&lt;head&gt;&lt;title&gt;The Domouse's story&lt;/title&gt;&lt;/head&gt; </span></span><br><span class="line"><span class="string">&lt;body&gt; </span></span><br><span class="line"><span class="string">&lt;p class="title"name="dromouse"&gt;&lt;b&gt;The Dormouse's story&lt;/b&gt;&lt;/p&gt; </span></span><br><span class="line"><span class="string">&lt;p class="story"&gt;Once upon a time there were little sisters;and their names were </span></span><br><span class="line"><span class="string">&lt;a href="http://example.com/elsie"class="sister"id="link1"&gt;&lt;!--Elsie--&gt;&lt;/a&gt; </span></span><br><span class="line"><span class="string">&lt;a hred="http://example.com/lacle"class="sister"id="link2"&gt;Lacle&lt;/a&gt;and </span></span><br><span class="line"><span class="string">&lt;a hred="http://example.com/tilie"class="sister"id="link3"&gt;Tillie&lt;/a&gt; </span></span><br><span class="line"><span class="string">and they lived at bottom of a well.&lt;/p&gt; </span></span><br><span class="line"><span class="string">&lt;p class="story"&gt;...&lt;/p&gt; </span></span><br><span class="line"><span class="string">'''</span>  </span><br><span class="line"></span><br><span class="line">soup = BeautifulSoup(html,<span class="string">'lxml'</span>)</span><br><span class="line">print(soup.title.string) <span class="comment">#打印标题</span></span><br><span class="line">print(soup.prettify()) <span class="comment">#格式化代码</span></span><br></pre></td></tr></table></figure><h3 id="5、标签选择器"><a href="#5、标签选择器" class="headerlink" title="5、标签选择器"></a>5、标签选择器</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 选择元素</span></span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line">html = <span class="string">'''  </span></span><br><span class="line"><span class="string">&lt;html&gt;&lt;head&gt;&lt;title&gt;The Domouse's story&lt;/title&gt;&lt;/head&gt;  </span></span><br><span class="line"><span class="string">&lt;body&gt;  </span></span><br><span class="line"><span class="string">&lt;p class="title"name="dromouse"&gt;&lt;b&gt;The Dormouse's story&lt;/b&gt;&lt;/p&gt;  </span></span><br><span class="line"><span class="string">&lt;p class="story"&gt;Once upon a time there were little sisters;and their names were  </span></span><br><span class="line"><span class="string">&lt;a href="http://example.com/elsie"class="sister"id="link1"&gt;&lt;!--Elsie--&gt;&lt;/a&gt;  </span></span><br><span class="line"><span class="string">&lt;a hred="http://example.com/lacle"class="sister"id="link2"&gt;Lacle&lt;/a&gt;and  </span></span><br><span class="line"><span class="string">&lt;a hred="http://example.com/tilie"class="sister"id="link3"&gt;Tillie&lt;/a&gt;  </span></span><br><span class="line"><span class="string">and they lived at bottom of a well.&lt;/p&gt;  </span></span><br><span class="line"><span class="string">&lt;p class="story"&gt;...&lt;/p&gt;  </span></span><br><span class="line"><span class="string">'''</span>  </span><br><span class="line"></span><br><span class="line">soup = BeautifulSoup(html,<span class="string">'lxml'</span>)</span><br><span class="line">print(soup.title)</span><br><span class="line">print(type(soup.title))</span><br><span class="line">print(soup.head)</span><br><span class="line">print(soup.p) <span class="comment">#只能返回第一个标签</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#获取名称</span></span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line">html = <span class="string">'''  </span></span><br><span class="line"><span class="string">&lt;html&gt;&lt;head&gt;&lt;title&gt;The Domouse's story&lt;/title&gt;&lt;/head&gt;  </span></span><br><span class="line"><span class="string">&lt;body&gt;  </span></span><br><span class="line"><span class="string">&lt;p class="title"name="dromouse"&gt;&lt;b&gt;The Dormouse's story&lt;/b&gt;&lt;/p&gt;  </span></span><br><span class="line"><span class="string">&lt;p class="story"&gt;Once upon a time there were little sisters;and their names were  </span></span><br><span class="line"><span class="string">&lt;a href="http://example.com/elsie"class="sister"id="link1"&gt;&lt;!--Elsie--&gt;&lt;/a&gt;  </span></span><br><span class="line"><span class="string">&lt;a hred="http://example.com/lacle"class="sister"id="link2"&gt;Lacle&lt;/a&gt;and  </span></span><br><span class="line"><span class="string">&lt;a hred="http://example.com/tilie"class="sister"id="link3"&gt;Tillie&lt;/a&gt;  </span></span><br><span class="line"><span class="string">and they lived at bottom of a well.&lt;/p&gt;  </span></span><br><span class="line"><span class="string">&lt;p class="story"&gt;...&lt;/p&gt;  </span></span><br><span class="line"><span class="string">'''</span>  </span><br><span class="line">soup = BeautifulSoup(html,<span class="string">'lxml'</span>)</span><br><span class="line">print(soup.title.name) <span class="comment">#打印标签名称</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#获取属性</span></span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line">html = <span class="string">'''  </span></span><br><span class="line"><span class="string">&lt;html&gt;&lt;head&gt;&lt;title&gt;The Domouse's story&lt;/title&gt;&lt;/head&gt;  </span></span><br><span class="line"><span class="string">&lt;body&gt;  </span></span><br><span class="line"><span class="string">&lt;p class="title"name="dromouse"&gt;&lt;b&gt;The Dormouse's story&lt;/b&gt;&lt;/p&gt;  </span></span><br><span class="line"><span class="string">&lt;p class="story"&gt;Once upon a time there were little sisters;and their names were  </span></span><br><span class="line"><span class="string">&lt;a href="http://example.com/elsie"class="sister"id="link1"&gt;&lt;!--Elsie--&gt;&lt;/a&gt;  </span></span><br><span class="line"><span class="string">&lt;a hred="http://example.com/lacle"class="sister"id="link2"&gt;Lacle&lt;/a&gt;and  </span></span><br><span class="line"><span class="string">&lt;a hred="http://example.com/tilie"class="sister"id="link3"&gt;Tillie&lt;/a&gt;  </span></span><br><span class="line"><span class="string">and they lived at bottom of a well.&lt;/p&gt;  </span></span><br><span class="line"><span class="string">&lt;p class="story"&gt;...&lt;/p&gt;  </span></span><br><span class="line"><span class="string">'''</span>  </span><br><span class="line">soup = BeautifulSoup(html,<span class="string">'lxml'</span>)</span><br><span class="line">print(soup.p.attrs[<span class="string">'name'</span>])</span><br><span class="line">print(soup.p[<span class="string">'name'</span>]) <span class="comment">#两种方式都可以获取标签属性</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#获取内容</span></span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line">html = <span class="string">'''  </span></span><br><span class="line"><span class="string">&lt;html&gt;&lt;head&gt;&lt;title&gt;The Domouse's story&lt;/title&gt;&lt;/head&gt;  </span></span><br><span class="line"><span class="string">&lt;body&gt;  </span></span><br><span class="line"><span class="string">&lt;p class="title"name="dromouse"&gt;&lt;b&gt;The Dormouse's story&lt;/b&gt;&lt;/p&gt;  </span></span><br><span class="line"><span class="string">&lt;p class="story"&gt;Once upon a time there were little sisters;and their names were  </span></span><br><span class="line"><span class="string">&lt;a href="http://example.com/elsie"class="sister"id="link1"&gt;&lt;!--Elsie--&gt;&lt;/a&gt;  </span></span><br><span class="line"><span class="string">&lt;a hred="http://example.com/lacle"class="sister"id="link2"&gt;Lacle&lt;/a&gt;and  </span></span><br><span class="line"><span class="string">&lt;a hred="http://example.com/tilie"class="sister"id="link3"&gt;Tillie&lt;/a&gt;  </span></span><br><span class="line"><span class="string">and they lived at bottom of a well.&lt;/p&gt;  </span></span><br><span class="line"><span class="string">&lt;p class="story"&gt;...&lt;/p&gt;  </span></span><br><span class="line"><span class="string">'''</span> </span><br><span class="line">soup = BeautifulSoup(html,<span class="string">'lxml'</span>)</span><br><span class="line">print(soup.p.string)</span><br></pre></td></tr></table></figure><h3 id="6、嵌套选择"><a href="#6、嵌套选择" class="headerlink" title="6、嵌套选择"></a>6、嵌套选择</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line">html = <span class="string">'''  </span></span><br><span class="line"><span class="string">&lt;html&gt;&lt;head&gt;&lt;title&gt;The Domouse's story&lt;/title&gt;&lt;/head&gt;  </span></span><br><span class="line"><span class="string">&lt;body&gt;  </span></span><br><span class="line"><span class="string">&lt;p class="title"name="dromouse"&gt;&lt;b&gt;The Dormouse's story&lt;/b&gt;&lt;/p&gt;  </span></span><br><span class="line"><span class="string">&lt;p class="story"&gt;Once upon a time there were little sisters;and their names were  </span></span><br><span class="line"><span class="string">&lt;a href="http://example.com/elsie"class="sister"id="link1"&gt;&lt;!--Elsie--&gt;&lt;/a&gt;  </span></span><br><span class="line"><span class="string">&lt;a hred="http://example.com/lacle"class="sister"id="link2"&gt;Lacle&lt;/a&gt;and  </span></span><br><span class="line"><span class="string">&lt;a hred="http://example.com/tilie"class="sister"id="link3"&gt;Tillie&lt;/a&gt;  </span></span><br><span class="line"><span class="string">and they lived at bottom of a well.&lt;/p&gt;  </span></span><br><span class="line"><span class="string">&lt;p class="story"&gt;...&lt;/p&gt;  </span></span><br><span class="line"><span class="string">'''</span> </span><br><span class="line">soup = BeautifulSoup(html,<span class="string">'lxml'</span>)</span><br><span class="line">print(soup.head.title.string)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#子节点和子孙节点</span></span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line">html = <span class="string">'''</span></span><br><span class="line"><span class="string">&lt;html&gt; </span></span><br><span class="line"><span class="string">    &lt;head&gt; </span></span><br><span class="line"><span class="string">        &lt;title&gt;The Domouse's story&lt;/title&gt; </span></span><br><span class="line"><span class="string">    &lt;/head&gt; </span></span><br><span class="line"><span class="string">    &lt;body&gt; </span></span><br><span class="line"><span class="string">    &lt;p class="story"&gt; </span></span><br><span class="line"><span class="string">        Once upon a time there were little sisters;and their names were </span></span><br><span class="line"><span class="string">        &lt;a href="http://example.com/elsie" class="sister"id="link1"&gt; </span></span><br><span class="line"><span class="string">        &lt;span&gt;Elsle&lt;/span&gt; </span></span><br><span class="line"><span class="string">        &lt;/a&gt; </span></span><br><span class="line"><span class="string">        &lt;a hred="http://example.com/lacle"class="sister" id="link2"&gt;Lacle&lt;/a&gt; </span></span><br><span class="line"><span class="string">        and </span></span><br><span class="line"><span class="string">        &lt;a hred="http://example.com/tilie"class="sister" id="link3"&gt;Tillie&lt;/a&gt; </span></span><br><span class="line"><span class="string">        and they lived at bottom of a well. </span></span><br><span class="line"><span class="string">        &lt;/p&gt; </span></span><br><span class="line"><span class="string">        &lt;p class="story"&gt;...&lt;/p&gt; </span></span><br><span class="line"><span class="string">'''</span>  </span><br><span class="line">soup = BeautifulSoup(html,<span class="string">'lxml'</span>)</span><br><span class="line">print(soup.p.contents) <span class="comment">#子节点以列表形式返回</span></span><br><span class="line"></span><br><span class="line">print(soup.p.children) <span class="comment">#不同之处：children实际上是一个迭代器，需要用循环的方式才能将内容取出</span></span><br><span class="line"><span class="keyword">for</span> i,child <span class="keyword">in</span> enumerate(soup.p.children):</span><br><span class="line">    print(i,child)</span><br><span class="line"></span><br><span class="line">print(soup.p.descendants) <span class="comment">#获取所有的子孙节点，也是一个迭代器</span></span><br><span class="line"><span class="keyword">for</span> l,child1 <span class="keyword">in</span> enumerate(soup.p.descendants):</span><br><span class="line">    print(l,child1)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#父节点和祖先节点</span></span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line">html = <span class="string">'''</span></span><br><span class="line"><span class="string">&lt;html&gt; </span></span><br><span class="line"><span class="string">    &lt;head&gt; </span></span><br><span class="line"><span class="string">        &lt;title&gt;The Domouse's story&lt;/title&gt; </span></span><br><span class="line"><span class="string">    &lt;/head&gt; </span></span><br><span class="line"><span class="string">    &lt;body&gt; </span></span><br><span class="line"><span class="string">    &lt;p class="story"&gt; </span></span><br><span class="line"><span class="string">        Once upon a time there were little sisters;and their names were </span></span><br><span class="line"><span class="string">        &lt;a href="http://example.com/elsie" class="sister"id="link1"&gt; </span></span><br><span class="line"><span class="string">        &lt;span&gt;Elsle&lt;/span&gt; </span></span><br><span class="line"><span class="string">        &lt;/a&gt; </span></span><br><span class="line"><span class="string">        &lt;a hred="http://example.com/lacle"class="sister" id="link2"&gt;Lacle&lt;/a&gt; </span></span><br><span class="line"><span class="string">        and </span></span><br><span class="line"><span class="string">        &lt;a hred="http://example.com/tilie"class="sister" id="link3"&gt;Tillie&lt;/a&gt; </span></span><br><span class="line"><span class="string">        and they lived at bottom of a well. </span></span><br><span class="line"><span class="string">        &lt;/p&gt; </span></span><br><span class="line"><span class="string">        &lt;p class="story"&gt;...&lt;/p&gt; </span></span><br><span class="line"><span class="string">'''</span>  </span><br><span class="line"></span><br><span class="line">soup = BeautifulSoup(html,<span class="string">'lxml'</span>)</span><br><span class="line">print(soup.a.parent) <span class="comment">#返回父标签的整个内容</span></span><br><span class="line"></span><br><span class="line">print(list(enumerate(soup.a.parents))) <span class="comment">#所有祖先节点（包括父标签）</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#兄弟节点</span></span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"></span><br><span class="line">html = <span class="string">'''</span></span><br><span class="line"><span class="string">&lt;html&gt; </span></span><br><span class="line"><span class="string">    &lt;head&gt; </span></span><br><span class="line"><span class="string">        &lt;title&gt;The Domouse's story&lt;/title&gt; </span></span><br><span class="line"><span class="string">    &lt;/head&gt; </span></span><br><span class="line"><span class="string">    &lt;body&gt; </span></span><br><span class="line"><span class="string">    &lt;p class="story"&gt; </span></span><br><span class="line"><span class="string">        Once upon a time there were little sisters;and their names were </span></span><br><span class="line"><span class="string">        &lt;a href="http://example.com/elsie" class="sister"id="link1"&gt; </span></span><br><span class="line"><span class="string">        &lt;span&gt;Elsle&lt;/span&gt; </span></span><br><span class="line"><span class="string">        &lt;/a&gt; </span></span><br><span class="line"><span class="string">        &lt;a hred="http://example.com/lacle"class="sister" id="link2"&gt;Lacle&lt;/a&gt; </span></span><br><span class="line"><span class="string">        and </span></span><br><span class="line"><span class="string">        &lt;a hred="http://example.com/tilie"class="sister" id="link3"&gt;Tillie&lt;/a&gt; </span></span><br><span class="line"><span class="string">        and they lived at bottom of a well. </span></span><br><span class="line"><span class="string">        &lt;/p&gt; </span></span><br><span class="line"><span class="string">        &lt;p class="story"&gt;...&lt;/p&gt; </span></span><br><span class="line"><span class="string">'''</span>  </span><br><span class="line"></span><br><span class="line">soup = BeautifulSoup(html,<span class="string">'lxml'</span>)</span><br><span class="line"></span><br><span class="line">print(list(enumerate(soup.a.next_siblings))) <span class="comment">#后面的兄弟节点 </span></span><br><span class="line">print(list(enumerate(soup.a.previous_siblings))) <span class="comment">#前面的兄弟节点</span></span><br></pre></td></tr></table></figure><h3 id="7、标准选择器"><a href="#7、标准选择器" class="headerlink" title="7、标准选择器"></a>7、标准选择器</h3><p><code>find_all(name,attrs,recursive,text,**kargs)</code> </p><p>可根据签名、属性、内容查找文档  </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#name</span></span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup  </span><br><span class="line">  </span><br><span class="line">html = <span class="string">'''</span></span><br><span class="line"><span class="string">&lt;div class="panel"&gt; </span></span><br><span class="line"><span class="string">    &lt;div class="panel-heading"name="elements"&gt; </span></span><br><span class="line"><span class="string">        &lt;h4&gt;Hello&lt;/h4&gt; </span></span><br><span class="line"><span class="string">    &lt;/div&gt; </span></span><br><span class="line"><span class="string">    &lt;div class="panel-body"&gt; </span></span><br><span class="line"><span class="string">        &lt;ul class="list"Id="list-1"&gt; </span></span><br><span class="line"><span class="string">            &lt;li class="element"&gt;Foo&lt;/li&gt; </span></span><br><span class="line"><span class="string">            &lt;li class="element"&gt;Bar&lt;/li&gt; </span></span><br><span class="line"><span class="string">            &lt;li class="element"&gt;Jay&lt;/li&gt; </span></span><br><span class="line"><span class="string">        &lt;/ul&gt; </span></span><br><span class="line"><span class="string">        &lt;ul class="list list-small"Id="list-2"&gt; </span></span><br><span class="line"><span class="string">            &lt;li class="element"&gt;Foo&lt;/li&gt; </span></span><br><span class="line"><span class="string">            &lt;li class="element"&gt;Bar&lt;/li&gt; </span></span><br><span class="line"><span class="string">        &lt;/ul&gt; </span></span><br><span class="line"><span class="string">    &lt;/div&gt; </span></span><br><span class="line"><span class="string">&lt;div&gt; </span></span><br><span class="line"><span class="string">'''</span>  </span><br><span class="line">soup = BeautifulSoup(html,<span class="string">'lxml'</span>)</span><br><span class="line">print(soup.find_all(<span class="string">'ul'</span>)) <span class="comment">#返回列表类型</span></span><br><span class="line">print(soup.find_all(<span class="string">'ul'</span>)[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ul <span class="keyword">in</span> soup.find_all(<span class="string">'ul'</span>):</span><br><span class="line">    print(ul.find_all(<span class="string">'li'</span>))</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#attrs</span></span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup  </span><br><span class="line">  </span><br><span class="line">html=<span class="string">'''</span></span><br><span class="line"><span class="string">&lt;div class="panel"&gt;</span></span><br><span class="line"><span class="string">    &lt;div class="panel-heading"&gt;</span></span><br><span class="line"><span class="string">        &lt;h4&gt;Hello&lt;/h4&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;div class="panel-body"&gt;</span></span><br><span class="line"><span class="string">        &lt;ul class="list" id="list-1" name="elements"&gt;</span></span><br><span class="line"><span class="string">            &lt;li class="element"&gt;Foo&lt;/li&gt;</span></span><br><span class="line"><span class="string">            &lt;li class="element"&gt;Bar&lt;/li&gt;</span></span><br><span class="line"><span class="string">            &lt;li class="element"&gt;Jay&lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;/ul&gt;</span></span><br><span class="line"><span class="string">        &lt;ul class="list list-small" id="list-2"&gt;</span></span><br><span class="line"><span class="string">            &lt;li class="element"&gt;Foo&lt;/li&gt;</span></span><br><span class="line"><span class="string">            &lt;li class="element"&gt;Bar&lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;/ul&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">&lt;/div&gt;</span></span><br><span class="line"><span class="string">'''</span>  </span><br><span class="line">soup = BeautifulSoup(html,<span class="string">'lxml'</span>)</span><br><span class="line">print(soup.find_all(attrs=&#123;<span class="string">"id"</span>:<span class="string">"list-1"</span>&#125;))</span><br><span class="line">print(soup.find_all(attrs=&#123;<span class="string">"name"</span>:<span class="string">"elements"</span>&#125;))</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#常用属性</span></span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup  </span><br><span class="line">  </span><br><span class="line">html=<span class="string">'''</span></span><br><span class="line"><span class="string">&lt;div class="panel"&gt;</span></span><br><span class="line"><span class="string">    &lt;div class="panel-heading"&gt;</span></span><br><span class="line"><span class="string">        &lt;h4&gt;Hello&lt;/h4&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;div class="panel-body"&gt;</span></span><br><span class="line"><span class="string">        &lt;ul class="list" id="list-1" name="elements"&gt;</span></span><br><span class="line"><span class="string">            &lt;li class="element"&gt;Foo&lt;/li&gt;</span></span><br><span class="line"><span class="string">            &lt;li class="element"&gt;Bar&lt;/li&gt;</span></span><br><span class="line"><span class="string">            &lt;li class="element"&gt;Jay&lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;/ul&gt;</span></span><br><span class="line"><span class="string">        &lt;ul class="list list-small" id="list-2"&gt;</span></span><br><span class="line"><span class="string">            &lt;li class="element"&gt;Foo&lt;/li&gt;</span></span><br><span class="line"><span class="string">            &lt;li class="element"&gt;Bar&lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;/ul&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">&lt;/div&gt;</span></span><br><span class="line"><span class="string">'''</span>  </span><br><span class="line">soup = BeautifulSoup(html,<span class="string">'lxml'</span>)</span><br><span class="line">print(soup.find_all(id=<span class="string">'list-1'</span>))</span><br><span class="line">print(soup.find_all(class_=<span class="string">'element'</span>)) <span class="comment">#注意：由于class在Python里是一个关键字，所以后面需要加一个下划线</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#text</span></span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup  </span><br><span class="line">  </span><br><span class="line">html=<span class="string">'''</span></span><br><span class="line"><span class="string">&lt;div class="panel"&gt;</span></span><br><span class="line"><span class="string">    &lt;div class="panel-heading"&gt;</span></span><br><span class="line"><span class="string">        &lt;h4&gt;Hello&lt;/h4&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">    &lt;div class="panel-body"&gt;</span></span><br><span class="line"><span class="string">        &lt;ul class="list" id="list-1" name="elements"&gt;</span></span><br><span class="line"><span class="string">            &lt;li class="element"&gt;Foo&lt;/li&gt;</span></span><br><span class="line"><span class="string">            &lt;li class="element"&gt;Bar&lt;/li&gt;</span></span><br><span class="line"><span class="string">            &lt;li class="element"&gt;Jay&lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;/ul&gt;</span></span><br><span class="line"><span class="string">        &lt;ul class="list list-small" id="list-2"&gt;</span></span><br><span class="line"><span class="string">            &lt;li class="element"&gt;Foo&lt;/li&gt;</span></span><br><span class="line"><span class="string">            &lt;li class="element"&gt;Bar&lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;/ul&gt;</span></span><br><span class="line"><span class="string">    &lt;/div&gt;</span></span><br><span class="line"><span class="string">&lt;/div&gt;</span></span><br><span class="line"><span class="string">'''</span>  </span><br><span class="line">soup = BeautifulSoup(html,<span class="string">'lxml'</span>)</span><br><span class="line">print(soup.find_all(text=<span class="string">'Foo'</span>))</span><br></pre></td></tr></table></figure><p><code>find(name，attrs，recursive，text，**kwargs)</code></p><p>find返回单个元素，find_all返回所有元素 </p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup  </span><br><span class="line"></span><br><span class="line">html = <span class="string">''''' </span></span><br><span class="line"><span class="string">&lt;div class="panel"&gt; </span></span><br><span class="line"><span class="string">    &lt;div class="panel-heading"&gt; </span></span><br><span class="line"><span class="string">        &lt;h4&gt;Hello&lt;/h4&gt; </span></span><br><span class="line"><span class="string">    &lt;/div&gt; </span></span><br><span class="line"><span class="string">    &lt;div class="panel-body"name="elelments"&gt; </span></span><br><span class="line"><span class="string">        &lt;ul class="list"Id="list-1"&gt; </span></span><br><span class="line"><span class="string">            &lt;li class="element"&gt;Foo&lt;/li&gt; </span></span><br><span class="line"><span class="string">            &lt;li class="element"&gt;Bar&lt;/li&gt; </span></span><br><span class="line"><span class="string">            &lt;li class="element"&gt;Jay&lt;/li&gt; </span></span><br><span class="line"><span class="string">        &lt;/ul&gt; </span></span><br><span class="line"><span class="string">        &lt;ul class="list list-small"Id="list-2"&gt; </span></span><br><span class="line"><span class="string">            &lt;li class="element"&gt;Foo&lt;/li&gt; </span></span><br><span class="line"><span class="string">            &lt;li class="element"&gt;Bar&lt;/li&gt; </span></span><br><span class="line"><span class="string">        &lt;/ul&gt; </span></span><br><span class="line"><span class="string">    &lt;/div&gt; </span></span><br><span class="line"><span class="string">&lt;div&gt; </span></span><br><span class="line"><span class="string">'''</span>  </span><br><span class="line">soup = BeautifulSoup(html,<span class="string">'lxml'</span>)</span><br><span class="line">print(soup.find(<span class="string">'ul'</span>))</span><br><span class="line">print(type(soup.find(<span class="string">'ul'</span>)))</span><br><span class="line">print(soup.find(<span class="string">'page'</span>))</span><br></pre></td></tr></table></figure><p>其他常用方法：</p><ul><li><code>find_parents()</code>：返回所有祖先节点和find_parent()返回直接父节点</li><li><code>find_next_siblings()</code>：返回所有兄弟节点和find_next_sibling()返回后面第一个兄弟节点</li><li><code>find_previous_siblings()</code>：返回前面的所有兄弟节点和find_previous_sibling()：返回前面第一个兄弟节点</li><li><code>find_all_next()</code>：返回节点后所有符合条件的节点和find_next()：返回第一个符合条件的节点</li><li><code>find_all_previous()</code>：返回节点前所有符合条件的节点和find_previous()：返回节点前第一个符合条件的节点</li></ul><h3 id="8、CSS选择器"><a href="#8、CSS选择器" class="headerlink" title="8、CSS选择器"></a>8、CSS选择器</h3><p>通过select()直接传入CSS选择器即可完成选择</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup </span><br><span class="line"></span><br><span class="line">html = <span class="string">'''</span></span><br><span class="line"><span class="string">&lt;div class="panel"&gt; </span></span><br><span class="line"><span class="string">    &lt;div class="panel-heading"&gt; </span></span><br><span class="line"><span class="string">        &lt;h4&gt;Hello&lt;/h4&gt; </span></span><br><span class="line"><span class="string">    &lt;/div&gt; </span></span><br><span class="line"><span class="string">    &lt;div class="panel-body"name="elelments"&gt; </span></span><br><span class="line"><span class="string">        &lt;ul class="list"Id="list-1"&gt; </span></span><br><span class="line"><span class="string">            &lt;li class="element"&gt;Foo&lt;/li&gt; </span></span><br><span class="line"><span class="string">            &lt;li class="element"&gt;Bar&lt;/li&gt; </span></span><br><span class="line"><span class="string">            &lt;li class="element"&gt;Jay&lt;/li&gt; </span></span><br><span class="line"><span class="string">        &lt;/ul&gt; </span></span><br><span class="line"><span class="string">        &lt;ul class="list list-small"Id="list-2"&gt; </span></span><br><span class="line"><span class="string">            &lt;li class="element"&gt;Foo&lt;/li&gt; </span></span><br><span class="line"><span class="string">            &lt;li class="element"&gt;Bar&lt;/li&gt; </span></span><br><span class="line"><span class="string">        &lt;/ul&gt; </span></span><br><span class="line"><span class="string">    &lt;/div&gt; </span></span><br><span class="line"><span class="string">&lt;div&gt; </span></span><br><span class="line"><span class="string">'''</span> </span><br><span class="line">soup = BeautifulSoup(html,<span class="string">'lxml'</span>) </span><br><span class="line">print(soup.select(<span class="string">'.panel .panel-heading'</span>)) <span class="comment">#传入css选择器</span></span><br><span class="line">print(soup.select(<span class="string">'ul li'</span>)) <span class="comment"># 传入标签</span></span><br><span class="line">print(soup.select(<span class="string">'#list-2 .element'</span>)) <span class="comment">#传入id</span></span><br><span class="line">print(type(soup.select(<span class="string">'ul'</span>)[<span class="number">0</span>]))</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#嵌套选择</span></span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup </span><br><span class="line"></span><br><span class="line">html = <span class="string">'''</span></span><br><span class="line"><span class="string">&lt;div class="panel"&gt; </span></span><br><span class="line"><span class="string">    &lt;div class="panel-heading"&gt; </span></span><br><span class="line"><span class="string">        &lt;h4&gt;Hello&lt;/h4&gt; </span></span><br><span class="line"><span class="string">    &lt;/div&gt; </span></span><br><span class="line"><span class="string">    &lt;div class="panel-body"name="elelments"&gt; </span></span><br><span class="line"><span class="string">        &lt;ul class="list"Id="list-1"&gt; </span></span><br><span class="line"><span class="string">            &lt;li class="element"&gt;Foo&lt;/li&gt; </span></span><br><span class="line"><span class="string">            &lt;li class="element"&gt;Bar&lt;/li&gt; </span></span><br><span class="line"><span class="string">            &lt;li class="element"&gt;Jay&lt;/li&gt; </span></span><br><span class="line"><span class="string">        &lt;/ul&gt; </span></span><br><span class="line"><span class="string">        &lt;ul class="list list-small"Id="list-2"&gt; </span></span><br><span class="line"><span class="string">            &lt;li class="element"&gt;Foo&lt;/li&gt; </span></span><br><span class="line"><span class="string">            &lt;li class="element"&gt;Bar&lt;/li&gt; </span></span><br><span class="line"><span class="string">        &lt;/ul&gt; </span></span><br><span class="line"><span class="string">    &lt;/div&gt; </span></span><br><span class="line"><span class="string">&lt;div&gt; </span></span><br><span class="line"><span class="string">'''</span> </span><br><span class="line">soup = BeautifulSoup(html,<span class="string">'lxml'</span>) </span><br><span class="line"><span class="keyword">for</span> ul <span class="keyword">in</span> soup.select(<span class="string">'ul'</span>):</span><br><span class="line">    print(ul.select(<span class="string">'li'</span>))</span><br><span class="line"><span class="comment">#可以直接传入选择器实现嵌套比这种方式更方便</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#获取属性</span></span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup </span><br><span class="line"></span><br><span class="line">html = <span class="string">'''</span></span><br><span class="line"><span class="string">&lt;div class="panel"&gt; </span></span><br><span class="line"><span class="string">    &lt;div class="panel-heading"&gt; </span></span><br><span class="line"><span class="string">        &lt;h4&gt;Hello&lt;/h4&gt; </span></span><br><span class="line"><span class="string">    &lt;/div&gt; </span></span><br><span class="line"><span class="string">    &lt;div class="panel-body"name="elelments"&gt; </span></span><br><span class="line"><span class="string">        &lt;ul class="list"Id="list-1"&gt; </span></span><br><span class="line"><span class="string">            &lt;li class="element"&gt;Foo&lt;/li&gt; </span></span><br><span class="line"><span class="string">            &lt;li class="element"&gt;Bar&lt;/li&gt; </span></span><br><span class="line"><span class="string">            &lt;li class="element"&gt;Jay&lt;/li&gt; </span></span><br><span class="line"><span class="string">        &lt;/ul&gt; </span></span><br><span class="line"><span class="string">        &lt;ul class="list list-small"Id="list-2"&gt; </span></span><br><span class="line"><span class="string">            &lt;li class="element"&gt;Foo&lt;/li&gt; </span></span><br><span class="line"><span class="string">            &lt;li class="element"&gt;Bar&lt;/li&gt; </span></span><br><span class="line"><span class="string">        &lt;/ul&gt; </span></span><br><span class="line"><span class="string">    &lt;/div&gt; </span></span><br><span class="line"><span class="string">&lt;div&gt; </span></span><br><span class="line"><span class="string">'''</span> </span><br><span class="line">soup = BeautifulSoup(html,<span class="string">'lxml'</span>) </span><br><span class="line"><span class="keyword">for</span> ul <span class="keyword">in</span> soup.select(<span class="string">'ul'</span>):</span><br><span class="line">    print(ul[<span class="string">'id'</span>]) <span class="comment">#直接传入中括号和属性名</span></span><br><span class="line">    print(ul.attrs[<span class="string">'id'</span>]) <span class="comment">#通过attrs属性获取属性值,两种方式都可以</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#获取内容</span></span><br><span class="line">html = <span class="string">''''' </span></span><br><span class="line"><span class="string">&lt;div class="panel"&gt; </span></span><br><span class="line"><span class="string">    &lt;div class="panel-heading"&gt; </span></span><br><span class="line"><span class="string">        &lt;h4&gt;Hello&lt;/h4&gt; </span></span><br><span class="line"><span class="string">    &lt;/div&gt; </span></span><br><span class="line"><span class="string">    &lt;div class="panel-body"name="elelments"&gt; </span></span><br><span class="line"><span class="string">        &lt;ul class="list"Id="list-1"&gt; </span></span><br><span class="line"><span class="string">            &lt;li class="element"&gt;Foo&lt;/li&gt; </span></span><br><span class="line"><span class="string">            &lt;li class="element"&gt;Bar&lt;/li&gt; </span></span><br><span class="line"><span class="string">            &lt;li class="element"&gt;Jay&lt;/li&gt; </span></span><br><span class="line"><span class="string">        &lt;/ul&gt; </span></span><br><span class="line"><span class="string">        &lt;ul class="list list-small"Id="list-2"&gt; </span></span><br><span class="line"><span class="string">            &lt;li class="element"&gt;Foo&lt;/li&gt; </span></span><br><span class="line"><span class="string">            &lt;li class="element"&gt;Bar&lt;/li&gt; </span></span><br><span class="line"><span class="string">        &lt;/ul&gt; </span></span><br><span class="line"><span class="string">    &lt;/div&gt; </span></span><br><span class="line"><span class="string">&lt;div&gt; </span></span><br><span class="line"><span class="string">'''</span>  </span><br><span class="line">soup = BeautifulSoup(html,<span class="string">'lxml'</span>) </span><br><span class="line"><span class="keyword">for</span> li <span class="keyword">in</span> soup.select(<span class="string">'li'</span>):</span><br><span class="line">    print(li.string) <span class="comment">#string属性获取文本</span></span><br><span class="line">    print(li.get_text()) <span class="comment">#get_text()方法获取文本，两种都行</span></span><br></pre></td></tr></table></figure><p>总结：</p><p>(1)推荐使用’lxml’解析库，必要时使用html.parser</p><p>(2)标签选择器筛选功能但速度快</p><p>(3)建议使用find()，find_all()查询匹配单个结果或者多个结果</p><p>(4)如果对CSS选择器熟悉建议选用select()</p><p>(5)记住常用的获取属性和文本值得方法</p><h1 id="持续更新…"><a href="#持续更新…" class="headerlink" title="持续更新…"></a><em>持续更新…</em></h1>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;崔庆才老师爬虫的学习笔记。&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="爬虫" scheme="http://pythonfood.github.io/categories/%E7%88%AC%E8%99%AB/"/>
    
    
      <category term="爬虫" scheme="http://pythonfood.github.io/tags/%E7%88%AC%E8%99%AB/"/>
    
  </entry>
  
  <entry>
    <title>爬虫-re库</title>
    <link href="http://pythonfood.github.io/2018/07/02/%E7%88%AC%E8%99%AB-re%E5%BA%93/"/>
    <id>http://pythonfood.github.io/2018/07/02/爬虫-re库/</id>
    <published>2018-07-02T04:00:00.000Z</published>
    <updated>2018-08-14T09:29:30.055Z</updated>
    
    <content type="html"><![CDATA[<p>崔庆才老师爬虫的学习笔记。<br><a id="more"></a></p><h2 id="一、Re库详解"><a href="#一、Re库详解" class="headerlink" title="一、Re库详解"></a>一、Re库详解</h2><h3 id="1、什么是正则表达式"><a href="#1、什么是正则表达式" class="headerlink" title="1、什么是正则表达式"></a>1、什么是正则表达式</h3><p>正则表达式对子符串操作的一种逻辑公式，就是事先定义好的一些特定字符、及这些特定字符的组合，组成一个‘规则字符串’，这个‘规则字符串’用来表达对字符串的一种过滤逻辑。</p><h3 id="2、样例展示"><a href="#2、样例展示" class="headerlink" title="2、样例展示"></a>2、样例展示</h3><p>开源中国提供的正则表达式测试工具：<a href="http://tool.oschina.net/regex/" target="_blank" rel="noopener">http://tool.oschina.net/regex/</a> 。输入待匹配的文本，然后选择常用的正则表达式，就可以得出相应的匹配结果了。</p><h3 id="3、常用的匹配规则"><a href="#3、常用的匹配规则" class="headerlink" title="3、常用的匹配规则"></a>3、常用的匹配规则</h3><table><thead><tr><th style="text-align:left">模式</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left">\w</td><td style="text-align:left">匹配字母、数字及下划线</td></tr><tr><td style="text-align:left">\W</td><td style="text-align:left">匹配不是字母、数字及下划线的字符</td></tr><tr><td style="text-align:left">\s</td><td style="text-align:left">匹配任意空白字符，等价于[\t\n\r\f]</td></tr><tr><td style="text-align:left">\S</td><td style="text-align:left">匹配任意非空字符</td></tr><tr><td style="text-align:left">\d</td><td style="text-align:left">匹配任意数字，等价于[0-9]</td></tr><tr><td style="text-align:left">\D</td><td style="text-align:left">匹配任意非数字的字符</td></tr><tr><td style="text-align:left">\A</td><td style="text-align:left">匹配字符串开头</td></tr><tr><td style="text-align:left">\Z</td><td style="text-align:left">匹配字符串结尾，如果存在换行，只匹配到换行前的结束字符串</td></tr><tr><td style="text-align:left">\z</td><td style="text-align:left">匹配字符串结尾，如果存在换行，同时还会匹配换行符</td></tr><tr><td style="text-align:left">\G</td><td style="text-align:left">匹配最后匹配完成的位置</td></tr><tr><td style="text-align:left">\n</td><td style="text-align:left">匹配一个换行符</td></tr><tr><td style="text-align:left">\t</td><td style="text-align:left">匹配一个制表符</td></tr><tr><td style="text-align:left">^</td><td style="text-align:left">匹配一行字符串的开头</td></tr><tr><td style="text-align:left">$</td><td style="text-align:left">匹配一行字符串的结尾</td></tr><tr><td style="text-align:left">.</td><td style="text-align:left">匹配任意字符，除了换行符，当re.DOTALL标记被指定时，则可以匹配包括换行符的任意字符</td></tr><tr><td style="text-align:left">[…]</td><td style="text-align:left">用来表示一组字符，单独列出，比如[amk]匹配a、m或k</td></tr><tr><td style="text-align:left">[^…]</td><td style="text-align:left">不在[]中的字符，比如[^abc]匹配除了a、b、c之外的字符</td></tr><tr><td style="text-align:left">*</td><td style="text-align:left">匹配0个或多个表达式</td></tr><tr><td style="text-align:left">+</td><td style="text-align:left">匹配1个或多个表达式</td></tr><tr><td style="text-align:left">?</td><td style="text-align:left">匹配0个或1个前面的正则表达式定义的片段，非贪婪方式</td></tr><tr><td style="text-align:left">{n}</td><td style="text-align:left">精确匹配n个前面的表达式</td></tr><tr><td style="text-align:left">{n, m}</td><td style="text-align:left">匹配n到m次由前面正则表达式定义的片段，贪婪方式</td></tr><tr><td style="text-align:left">a&#124;b</td><td style="text-align:left">匹配a或b</td></tr><tr><td style="text-align:left">( )</td><td style="text-align:left">匹配括号内的表达式，也表示一个组</td></tr></tbody></table><h3 id="4、常用的修饰符-匹配模式"><a href="#4、常用的修饰符-匹配模式" class="headerlink" title="4、常用的修饰符(匹配模式)"></a>4、常用的修饰符(匹配模式)</h3><table><thead><tr><th style="text-align:left">修饰符</th><th style="text-align:left">描述</th></tr></thead><tbody><tr><td style="text-align:left">re.I</td><td style="text-align:left">使匹配对大小写不敏感</td></tr><tr><td style="text-align:left">re.L</td><td style="text-align:left">做本地化识别（locale-aware）匹配</td></tr><tr><td style="text-align:left">re.M</td><td style="text-align:left">多行匹配，影响^和$</td></tr><tr><td style="text-align:left">re.S</td><td style="text-align:left">使.匹配包括换行在内的所有字符</td></tr><tr><td style="text-align:left">re.U</td><td style="text-align:left">根据Unicode字符集解析字符。这个标志影响\w、\W、 \b和\B</td></tr><tr><td style="text-align:left">re.X</td><td style="text-align:left">该标志通过给予你更灵活的格式以便你将正则表达式写得更易于理解</td></tr></tbody></table><h3 id="5、re-match"><a href="#5、re-match" class="headerlink" title="5、re.match"></a>5、re.match</h3><p>尝试从字符串的起始位置匹配一个模式，如果不是起始位置匹配成功的话，match()就返回None</p><p><code>re.match(pattern,string,flags=0)</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#常规匹配</span></span><br><span class="line"><span class="keyword">import</span> re </span><br><span class="line"></span><br><span class="line">content = <span class="string">'Hello 123 4567 World_This is a Regex Demo'</span>  </span><br><span class="line">print(len(content))</span><br><span class="line">result = re.match(<span class="string">'^Hello\s\d\d\d\s\d&#123;4&#125;.*Demo$'</span>,content)</span><br><span class="line">print(result)</span><br><span class="line">print(result.group())</span><br><span class="line">print(result.span())</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#泛匹配</span></span><br><span class="line"><span class="keyword">import</span> re </span><br><span class="line"></span><br><span class="line">content = <span class="string">'Hello 123 4567 World_This is a Regex Demo'</span>  </span><br><span class="line">print(len(content))</span><br><span class="line">result = re.match(<span class="string">'^Hello.*Demo$'</span>,content)</span><br><span class="line">print(result)</span><br><span class="line">print(result.group())</span><br><span class="line">print(result.span())</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#匹配目标</span></span><br><span class="line"><span class="keyword">import</span> re </span><br><span class="line"></span><br><span class="line">content = <span class="string">'Hello 1234567 World_This is a Regex Demo'</span></span><br><span class="line">print(len(content))</span><br><span class="line"><span class="comment">#可以使用()括号将想提取的子字符串括起来。()实际上标记了一个子表达式的开始和结束位置，被标记的每个子表达式会依次对应每一个分组，调用group()方法传入分组的索引即可获取提取的结果。</span></span><br><span class="line">result = re.match(<span class="string">'^Hello\s(\d+)\sWorld.*Demo$'</span>,content) </span><br><span class="line">print(result)</span><br><span class="line">print(result.group())</span><br><span class="line">print(result.group(<span class="number">1</span>)) <span class="comment"># 将第一括号括起来的内容打印出来，依次可推group(2)</span></span><br><span class="line">print(result.span())</span><br><span class="line">print(result.groups())</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#贪婪匹配</span></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">content = <span class="string">'Hello 1234567 World_This is a Regex Demo'</span></span><br><span class="line">print(len(content))</span><br><span class="line">result = re.match(<span class="string">'^Hel.*(\d+).*Demo$'</span>,content)</span><br><span class="line">print(result)</span><br><span class="line">print(result.group(<span class="number">1</span>))</span><br><span class="line"><span class="comment">#在贪婪匹配下，.*会匹配尽可能多的字符。正则表达式中.*后面\d+至少一个数字，但并没有指定具体多少个数字，因此，.*就尽可能匹配多的字符，这里就把123456匹配了，给\d+留下一个可满足条件的数字7。</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#非贪婪匹配</span></span><br><span class="line">content = <span class="string">'Hello 1234567 World_This is a Regex Demo'</span></span><br><span class="line">print(len(content))</span><br><span class="line">result = re.match(<span class="string">'Hel.*?(\d+).*Demo$'</span>,content) <span class="comment">#非贪婪匹配的写法是.*?</span></span><br><span class="line">print(result)</span><br><span class="line">print(result.group(<span class="number">1</span>))</span><br><span class="line"><span class="comment">#非贪婪匹配就是尽可能匹配少的字符。当.*?匹配到Hello后面的空白字符时，再往后的字符就是数字了，而\d+恰好可以匹配，那么这里.*?就不再进行匹配，交给\d+去匹配后面的数字。</span></span><br><span class="line"><span class="comment">#这里需要注意，如果匹配的结果在字符串结尾，.*?就有可能匹配不到任何内容了，因为它会匹配尽可能少的字符。需要用贪婪匹配.*</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#匹配模式(修饰符)</span></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">content = <span class="string">'''Hello 1234567 World_This  </span></span><br><span class="line"><span class="string">is a Regex Demo'''</span>  </span><br><span class="line">result = re.match(<span class="string">'He.*?(\d+).*?Demo$'</span>,content) <span class="comment">#.匹配的是除换行符之外的任意字符，当遇到换行符时，.*?就不能匹配了</span></span><br><span class="line">print(result)</span><br><span class="line">result1 = re.match(<span class="string">'He.*?(\d+).*?Demo$'</span>,content,re.S) <span class="comment"># 只需加一个修饰符re.S,使.匹配包括换行在内的所有字符</span></span><br><span class="line">print(result1)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#转义匹配</span></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">content = <span class="string">'prince is $5.00'</span></span><br><span class="line">result = re.match(<span class="string">'prince is $5.00'</span>,content)</span><br><span class="line">print(result)</span><br><span class="line">result1 = re.match(<span class="string">'prince is \$5\.00'</span>,content) <span class="comment">#遇到用于正则匹配模式的特殊字符时，在前面加反斜线转义一下</span></span><br><span class="line">print(result1)</span><br></pre></td></tr></table></figure><p>总结：尽量使用泛匹配，使用括号得到匹配目标，尽量使用非贪婪模式、有换行符就用re.S</p><h3 id="6、re-search"><a href="#6、re-search" class="headerlink" title="6、re.search"></a>6、re.search</h3><p>match()方法是从字符串的开头开始匹配的，一旦开头不匹配，那么整个匹配就失败了.</p><p>这里有另外一个方法search()会依次扫描字符串，直到找到第一个符合规则的字符串，然后返回匹配内容，如果搜索完了还没有找到，就返回None。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"> </span><br><span class="line">content = <span class="string">'Extra stings Hello 1234567 World_This is a Regex Demo Extra stings'</span></span><br><span class="line">result = re.match(<span class="string">'Hello.*?(\d+).*?Demo'</span>, content)</span><br><span class="line">print(result)</span><br><span class="line">result1 = re.search(<span class="string">'Hello.*?(\d+).*?Demo'</span>, content)</span><br><span class="line">print(result1)</span><br></pre></td></tr></table></figure><p>总结：为了匹配方便，能用search()就不用match()。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 匹配练习</span></span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">html = <span class="string">'''&lt;div id="songs-list"&gt;</span></span><br><span class="line"><span class="string">    &lt;h2 class="title"&gt;经典老歌&lt;/h2&gt;</span></span><br><span class="line"><span class="string">    &lt;p class="introduction"&gt;</span></span><br><span class="line"><span class="string">        经典老歌列表</span></span><br><span class="line"><span class="string">    &lt;/p&gt;</span></span><br><span class="line"><span class="string">    &lt;ul id="list" class="list-group"&gt;</span></span><br><span class="line"><span class="string">        &lt;li data-view="2"&gt;一路上有你&lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;li data-view="7"&gt;</span></span><br><span class="line"><span class="string">            &lt;a href="/2.mp3" singer="任贤齐"&gt;沧海一声笑&lt;/a&gt;</span></span><br><span class="line"><span class="string">        &lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;li data-view="4" class="active"&gt;</span></span><br><span class="line"><span class="string">            &lt;a href="/3.mp3" singer="齐秦"&gt;往事随风&lt;/a&gt;</span></span><br><span class="line"><span class="string">        &lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;li data-view="6"&gt;&lt;a href="/4.mp3" singer="beyond"&gt;光辉岁月&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;li data-view="5"&gt;&lt;a href="/5.mp3" singer="陈慧琳"&gt;记事本&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;li data-view="5"&gt;</span></span><br><span class="line"><span class="string">            &lt;a href="/6.mp3" singer="邓丽君"&gt;&lt;i class="fa fa-user"&gt;&lt;/i&gt;但愿人长久&lt;/a&gt;</span></span><br><span class="line"><span class="string">        &lt;/li&gt;</span></span><br><span class="line"><span class="string">    &lt;/ul&gt;</span></span><br><span class="line"><span class="string">&lt;/div&gt;'''</span></span><br><span class="line"></span><br><span class="line">result = re.search(<span class="string">'&lt;li.*?active.*?singer="(.*?)"&gt;(.*?)&lt;/a&gt;'</span>,html,re.S)</span><br><span class="line">print(result.groups())</span><br><span class="line">print(result.group(<span class="number">1</span>),result.group(<span class="number">2</span>))</span><br></pre></td></tr></table></figure><h3 id="7、re-findall"><a href="#7、re-findall" class="headerlink" title="7、re.findall"></a>7、re.findall</h3><p>搜索字符，以列表的形式返回全部匹配的字符串。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">html = <span class="string">'''&lt;div id="songs-list"&gt;</span></span><br><span class="line"><span class="string">    &lt;h2 class="title"&gt;经典老歌&lt;/h2&gt;</span></span><br><span class="line"><span class="string">    &lt;p class="introduction"&gt;</span></span><br><span class="line"><span class="string">        经典老歌列表</span></span><br><span class="line"><span class="string">    &lt;/p&gt;</span></span><br><span class="line"><span class="string">    &lt;ul id="list" class="list-group"&gt;</span></span><br><span class="line"><span class="string">        &lt;li data-view="2"&gt;一路上有你&lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;li data-view="7"&gt;</span></span><br><span class="line"><span class="string">            &lt;a href="/2.mp3" singer="任贤齐"&gt;沧海一声笑&lt;/a&gt;</span></span><br><span class="line"><span class="string">        &lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;li data-view="4" class="active"&gt;</span></span><br><span class="line"><span class="string">            &lt;a href="/3.mp3" singer="齐秦"&gt;往事随风&lt;/a&gt;</span></span><br><span class="line"><span class="string">        &lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;li data-view="6"&gt;&lt;a href="/4.mp3" singer="beyond"&gt;光辉岁月&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;li data-view="5"&gt;&lt;a href="/5.mp3" singer="陈慧琳"&gt;记事本&lt;/a&gt;&lt;/li&gt;</span></span><br><span class="line"><span class="string">        &lt;li data-view="5"&gt;</span></span><br><span class="line"><span class="string">            &lt;a href="/6.mp3" singer="邓丽君"&gt;但愿人长久&lt;/a&gt;</span></span><br><span class="line"><span class="string">        &lt;/li&gt;</span></span><br><span class="line"><span class="string">    &lt;/ul&gt;</span></span><br><span class="line"><span class="string">&lt;/div&gt;'''</span></span><br><span class="line"></span><br><span class="line">results = re.findall(<span class="string">'&lt;li.*?href="/(.*?)".*?singer="(.*?)"&gt;(.*?)&lt;/a&gt;'</span>,html,re.S)</span><br><span class="line">print(results)</span><br><span class="line">print(type(results))</span><br><span class="line"><span class="keyword">for</span> result <span class="keyword">in</span> results:</span><br><span class="line">    print(result[<span class="number">0</span>],result[<span class="number">1</span>],result[<span class="number">2</span>])</span><br><span class="line">    </span><br><span class="line">results1 = re.findall(<span class="string">'&lt;li.*?&gt;\s*?(&lt;/a.*?&gt;)?(\w+)(&lt;/a&gt;)?\s*?&lt;/li&gt;'</span>,html,re.S)</span><br><span class="line">print(results1)</span><br><span class="line"><span class="keyword">for</span> result1 <span class="keyword">in</span> results1:</span><br><span class="line">    print(result1[<span class="number">1</span>])</span><br></pre></td></tr></table></figure><h3 id="8、re-sub"><a href="#8、re-sub" class="headerlink" title="8、re.sub"></a>8、re.sub</h3><p>替换字符串中每一个匹配的字符串后返回替换后的字符串。</p><p><code>re.sub(正则表达式，要替换成的字符串，原字符串)</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re </span><br><span class="line"></span><br><span class="line">content = <span class="string">'Extra stings Hello 1234567 World_This is a Regex Demo Extra stings'</span></span><br><span class="line"></span><br><span class="line">result = re.sub(<span class="string">'\d+'</span>,<span class="string">''</span>,content) <span class="comment">#去掉数字</span></span><br><span class="line">print(result)</span><br><span class="line"></span><br><span class="line">result1 = re.sub(<span class="string">'\d+'</span>,<span class="string">'Replacement'</span>,content) <span class="comment">#数字替换为字符</span></span><br><span class="line">print(result1)</span><br><span class="line"></span><br><span class="line">result2 = re.sub(<span class="string">'(\d+)'</span>,<span class="string">r'\1 8910'</span>,content) <span class="comment">#如果要替换的字符串包含自己本身用\1表示，正则表达式需要用()</span></span><br><span class="line">print(result2)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re </span><br><span class="line"></span><br><span class="line">html = <span class="string">'''''&lt;div id="songs-list"&gt; </span></span><br><span class="line"><span class="string">&lt;h2 class="title"&gt;经典老歌&lt;/h2&gt; </span></span><br><span class="line"><span class="string">&lt;p class="introduction"&gt; </span></span><br><span class="line"><span class="string">    经典老歌列表 </span></span><br><span class="line"><span class="string">&lt;/p&gt; </span></span><br><span class="line"><span class="string">&lt;ul id="list"class="list-group"&gt; </span></span><br><span class="line"><span class="string">    &lt;li data-view="2"&gt;一路上有你&lt;/li&gt; </span></span><br><span class="line"><span class="string">    &lt;li data-view="7"&gt; </span></span><br><span class="line"><span class="string">        &lt;a href="/2.mp3"singer="任贤齐"&gt;沧海一声笑&lt;/a&gt; </span></span><br><span class="line"><span class="string">    &lt;/li&gt; </span></span><br><span class="line"><span class="string">    &lt;li data-view="4"class="active"&gt; </span></span><br><span class="line"><span class="string">        &lt;a href="/3.mp3"singer="齐秦"&gt;往事随风&lt;/a&gt; </span></span><br><span class="line"><span class="string">    &lt;/li&gt; </span></span><br><span class="line"><span class="string">    &lt;li data-view="6"&gt;&lt;a href="/4.mp3"singer="begoud"&gt;光辉岁月&lt;/a&gt;&lt;/li&gt; </span></span><br><span class="line"><span class="string">    &lt;li data-view="5"&gt;&lt;a href="/5.mp3"singer="陈慧琳"&gt;记事本&lt;/a&gt;&lt;/li&gt; </span></span><br><span class="line"><span class="string">    &lt;li data-view="5"&gt; </span></span><br><span class="line"><span class="string">        &lt;a href="/6.mp3"singer="邓丽君"&gt;但愿人长久&lt;/a&gt; </span></span><br><span class="line"><span class="string">    &lt;/li&gt; </span></span><br><span class="line"><span class="string">&lt;/ul&gt; </span></span><br><span class="line"><span class="string">&lt;/div&gt;'''</span>  </span><br><span class="line"></span><br><span class="line">html = re.sub(<span class="string">'&lt;a.*?&gt;|&lt;/a&gt;'</span>,<span class="string">''</span>,html) <span class="comment">#首先去掉a标签</span></span><br><span class="line">print(html)</span><br><span class="line">results = re.findall(<span class="string">'&lt;li.*?&gt;(.*?)&lt;/li&gt;'</span>,html,re.S) <span class="comment">#然后再查找所有歌名</span></span><br><span class="line">print(results)</span><br><span class="line"><span class="keyword">for</span> result <span class="keyword">in</span> results:</span><br><span class="line">    print(result.strip())</span><br></pre></td></tr></table></figure><h3 id="9、re-compile"><a href="#9、re-compile" class="headerlink" title="9、re.compile"></a>9、re.compile</h3><p>将正则字符串编译成正则表达式对象，以便在后面的匹配中复用。</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re </span><br><span class="line"></span><br><span class="line">content = <span class="string">'''Hello 1234545 World_This  </span></span><br><span class="line"><span class="string">is a Regex Demo'''</span>  </span><br><span class="line"></span><br><span class="line">pattern = re.compile(<span class="string">'Hello.*Demo'</span>,re.S) <span class="comment">#编译正则表达式对象</span></span><br><span class="line">result = re.match(pattern,content) <span class="comment">#正则对象复用</span></span><br><span class="line">print(result)</span><br><span class="line">result1 = re.match(<span class="string">'Hello.*Demo'</span>,content,re.S)</span><br><span class="line">print(result1)</span><br></pre></td></tr></table></figure><h3 id="10、实战练习"><a href="#10、实战练习" class="headerlink" title="10、实战练习"></a>10、实战练习</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> re </span><br><span class="line"></span><br><span class="line">content = requests.get(<span class="string">'https://book.douban.com/'</span>).text <span class="comment">#获取网页源代码</span></span><br><span class="line"><span class="comment">#print(content)</span></span><br><span class="line">pattern = re.compile(<span class="string">'&lt;li.*?"cover"&gt;.*?href="(.*?)" title="(.*?)".*?"more-meta".*?"author"&gt;(.*?)&lt;/span&gt;.*?"year"&gt;(.*?)&lt;/span&gt;.*?&lt;/li&gt;'</span>,re.S)</span><br><span class="line">results = re.findall(pattern,content)</span><br><span class="line">print(results)</span><br><span class="line"><span class="keyword">for</span> result <span class="keyword">in</span> results:</span><br><span class="line">    url,name,author,time = result</span><br><span class="line">    author = re.sub(<span class="string">'\s'</span>,<span class="string">''</span>,author)</span><br><span class="line">    time = re.sub(<span class="string">'\s'</span>,<span class="string">''</span>,time)</span><br><span class="line">    print(url,name,author,time)</span><br></pre></td></tr></table></figure><h1 id="持续更新…"><a href="#持续更新…" class="headerlink" title="持续更新…"></a><em>持续更新…</em></h1>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;崔庆才老师爬虫的学习笔记。&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="爬虫" scheme="http://pythonfood.github.io/categories/%E7%88%AC%E8%99%AB/"/>
    
    
      <category term="爬虫" scheme="http://pythonfood.github.io/tags/%E7%88%AC%E8%99%AB/"/>
    
  </entry>
  
  <entry>
    <title>爬虫-requests库</title>
    <link href="http://pythonfood.github.io/2018/07/02/%E7%88%AC%E8%99%AB-requests%E5%BA%93/"/>
    <id>http://pythonfood.github.io/2018/07/02/爬虫-requests库/</id>
    <published>2018-07-02T03:00:00.000Z</published>
    <updated>2018-08-14T09:14:32.334Z</updated>
    
    <content type="html"><![CDATA[<p>崔庆才老师爬虫的学习笔记。<br><a id="more"></a></p><h2 id="一、Requests库详解"><a href="#一、Requests库详解" class="headerlink" title="一、Requests库详解"></a>一、Requests库详解</h2><h3 id="1、什么是Requests库"><a href="#1、什么是Requests库" class="headerlink" title="1、什么是Requests库"></a>1、什么是Requests库</h3><p>Requests库是用Python编写的，基于urllib，采用Apache2 Licensed开源协议的HTTP库。</p><p>相比urllib库，Requests库更加方便，可以节约我们大量的工作，完全满足HTTP测试需求。</p><h3 id="2、安装"><a href="#2、安装" class="headerlink" title="2、安装"></a>2、安装</h3><p><code>pip install request</code></p><h3 id="3、Requests库用法详解"><a href="#3、Requests库用法详解" class="headerlink" title="3、Requests库用法详解"></a>3、Requests库用法详解</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">response = requests.get(<span class="string">'http://www.baidu.com'</span>)</span><br><span class="line">print(type(response))</span><br><span class="line">print(response.status_code)</span><br><span class="line">print(type(response.text))</span><br><span class="line">print(response.text)</span><br><span class="line">print(response.cookies)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 各种请求（HTTP测试网站：http://httpbin.org/）</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">requests.get(<span class="string">'http://httpbin.org/get'</span>)</span><br><span class="line">requests.post(<span class="string">'http://httpbin.org/post'</span>)</span><br><span class="line">requests.delete(<span class="string">'http://httpbin.org/delete'</span>)</span><br><span class="line">requests.put(<span class="string">'http://httpbin.org/put'</span>)</span><br><span class="line">requests.head(<span class="string">'http://httpbin.org/get'</span>)</span><br><span class="line">requests.options(<span class="string">'http://httpbin.org/get'</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 基本get请求</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">response = requests.get(<span class="string">'http://httpbin.org/get'</span>)</span><br><span class="line">print(response.text)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 带参数get请求</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">data=&#123;</span><br><span class="line">    <span class="string">'name'</span>:<span class="string">'asr'</span>,</span><br><span class="line">    <span class="string">'age'</span>:<span class="string">'12'</span></span><br><span class="line">&#125;</span><br><span class="line">response = requests.get(<span class="string">'http://httpbin.org/get'</span>,params=data)</span><br><span class="line">print(response.text)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 解析json</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line">response = requests.get(<span class="string">'http://httpbin.org/get'</span>)</span><br><span class="line">print(response.text)</span><br><span class="line">print(type(response.text))</span><br><span class="line">print(response.json())</span><br><span class="line">print(type(response.json()))</span><br><span class="line">print(json.loads(response.text))</span><br><span class="line">print(type(json.loads(response.text)))</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取二进制数据</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">response = requests.get(<span class="string">'https://github.com/favicon.ico'</span>)</span><br><span class="line">print(response.text)</span><br><span class="line">print(type(response.text))</span><br><span class="line">print(response.content) <span class="comment"># 获取二进制数据用response.content</span></span><br><span class="line">print(type(response.content))</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'favicon.ico'</span>,<span class="string">'wb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(response.content)</span><br><span class="line">    f.close()</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加headers</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">response = requests.get(<span class="string">'http://www.zhihu.com/explore'</span>)  <span class="comment">#不加headers不能访问</span></span><br><span class="line">print(response.text)</span><br><span class="line"></span><br><span class="line">headers = &#123;<span class="string">'User-Agent'</span>:<span class="string">'Mozilla/5.0 (Windows NT 10.0; rv:60.0) Gecko/20100101 Firefox/60.0'</span>&#125;</span><br><span class="line">response1 = requests.get(<span class="string">'http://www.zhihu.com/explore'</span>,headers=headers)</span><br><span class="line">print(response1.text)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 基本post请求</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">'name'</span>:<span class="string">'jk'</span>,</span><br><span class="line">    <span class="string">'age'</span>:<span class="number">18</span></span><br><span class="line">&#125;</span><br><span class="line">headers=&#123;</span><br><span class="line">    <span class="string">'User-Agent'</span>:<span class="string">'Mozilla/5.0 (Windows NT 10.0; rv:60.0) Gecko/20100101 Firefox/60.0'</span></span><br><span class="line">&#125;</span><br><span class="line">response = requests.post(<span class="string">'http://httpbin.org/post'</span>,data=data,headers=headers)</span><br><span class="line">print(response.json())</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># response属性</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">response = requests.get(<span class="string">'http://www.douban.com'</span>)</span><br><span class="line">print(type(response.status_code),response.status_code)</span><br><span class="line">print(type(response.headers),response.headers)</span><br><span class="line">print(type(response.cookies),response.cookies)</span><br><span class="line">print(type(response.url),response.url)</span><br><span class="line">print(type(response.history),response.history)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 状态码判断</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">response =requests.get(<span class="string">'http://www.jianshu.com'</span>)</span><br><span class="line">exit() <span class="keyword">if</span> <span class="keyword">not</span> response.status_code==requests.codes.forbidden <span class="keyword">else</span> print(<span class="string">'403 forbidden'</span>) <span class="comment">#状态码查询对象，可以从下表中查找</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 信息性状态码</span></span><br><span class="line"><span class="number">100</span>: (<span class="string">'continue'</span>,),</span><br><span class="line"><span class="number">101</span>: (<span class="string">'switching_protocols'</span>,),</span><br><span class="line"><span class="number">102</span>: (<span class="string">'processing'</span>,),</span><br><span class="line"><span class="number">103</span>: (<span class="string">'checkpoint'</span>,),</span><br><span class="line"><span class="number">122</span>: (<span class="string">'uri_too_long'</span>, <span class="string">'request_uri_too_long'</span>),</span><br><span class="line"></span><br><span class="line"><span class="comment"># 成功状态码</span></span><br><span class="line"><span class="number">200</span>: (<span class="string">'ok'</span>, <span class="string">'okay'</span>, <span class="string">'all_ok'</span>, <span class="string">'all_okay'</span>, <span class="string">'all_good'</span>, <span class="string">'\\o/'</span>, <span class="string">'✓'</span>),</span><br><span class="line"><span class="number">201</span>: (<span class="string">'created'</span>,),</span><br><span class="line"><span class="number">202</span>: (<span class="string">'accepted'</span>,),</span><br><span class="line"><span class="number">203</span>: (<span class="string">'non_authoritative_info'</span>, <span class="string">'non_authoritative_information'</span>),</span><br><span class="line"><span class="number">204</span>: (<span class="string">'no_content'</span>,),</span><br><span class="line"><span class="number">205</span>: (<span class="string">'reset_content'</span>, <span class="string">'reset'</span>),</span><br><span class="line"><span class="number">206</span>: (<span class="string">'partial_content'</span>, <span class="string">'partial'</span>),</span><br><span class="line"><span class="number">207</span>: (<span class="string">'multi_status'</span>, <span class="string">'multiple_status'</span>, <span class="string">'multi_stati'</span>, <span class="string">'multiple_stati'</span>),</span><br><span class="line"><span class="number">208</span>: (<span class="string">'already_reported'</span>,),</span><br><span class="line"><span class="number">226</span>: (<span class="string">'im_used'</span>,),</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重定向状态码</span></span><br><span class="line"><span class="number">300</span>: (<span class="string">'multiple_choices'</span>,),</span><br><span class="line"><span class="number">301</span>: (<span class="string">'moved_permanently'</span>, <span class="string">'moved'</span>, <span class="string">'\\o-'</span>),</span><br><span class="line"><span class="number">302</span>: (<span class="string">'found'</span>,),</span><br><span class="line"><span class="number">303</span>: (<span class="string">'see_other'</span>, <span class="string">'other'</span>),</span><br><span class="line"><span class="number">304</span>: (<span class="string">'not_modified'</span>,),</span><br><span class="line"><span class="number">305</span>: (<span class="string">'use_proxy'</span>,),</span><br><span class="line"><span class="number">306</span>: (<span class="string">'switch_proxy'</span>,),</span><br><span class="line"><span class="number">307</span>: (<span class="string">'temporary_redirect'</span>, <span class="string">'temporary_moved'</span>, <span class="string">'temporary'</span>),</span><br><span class="line"><span class="number">308</span>: (<span class="string">'permanent_redirect'</span>,</span><br><span class="line">      <span class="string">'resume_incomplete'</span>, <span class="string">'resume'</span>,), <span class="comment"># These 2 to be removed in 3.0</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 客户端错误状态码</span></span><br><span class="line"><span class="number">400</span>: (<span class="string">'bad_request'</span>, <span class="string">'bad'</span>),</span><br><span class="line"><span class="number">401</span>: (<span class="string">'unauthorized'</span>,),</span><br><span class="line"><span class="number">402</span>: (<span class="string">'payment_required'</span>, <span class="string">'payment'</span>),</span><br><span class="line"><span class="number">403</span>: (<span class="string">'forbidden'</span>,),</span><br><span class="line"><span class="number">404</span>: (<span class="string">'not_found'</span>, <span class="string">'-o-'</span>),</span><br><span class="line"><span class="number">405</span>: (<span class="string">'method_not_allowed'</span>, <span class="string">'not_allowed'</span>),</span><br><span class="line"><span class="number">406</span>: (<span class="string">'not_acceptable'</span>,),</span><br><span class="line"><span class="number">407</span>: (<span class="string">'proxy_authentication_required'</span>, <span class="string">'proxy_auth'</span>, <span class="string">'proxy_authentication'</span>),</span><br><span class="line"><span class="number">408</span>: (<span class="string">'request_timeout'</span>, <span class="string">'timeout'</span>),</span><br><span class="line"><span class="number">409</span>: (<span class="string">'conflict'</span>,),</span><br><span class="line"><span class="number">410</span>: (<span class="string">'gone'</span>,),</span><br><span class="line"><span class="number">411</span>: (<span class="string">'length_required'</span>,),</span><br><span class="line"><span class="number">412</span>: (<span class="string">'precondition_failed'</span>, <span class="string">'precondition'</span>),</span><br><span class="line"><span class="number">413</span>: (<span class="string">'request_entity_too_large'</span>,),</span><br><span class="line"><span class="number">414</span>: (<span class="string">'request_uri_too_large'</span>,),</span><br><span class="line"><span class="number">415</span>: (<span class="string">'unsupported_media_type'</span>, <span class="string">'unsupported_media'</span>, <span class="string">'media_type'</span>),</span><br><span class="line"><span class="number">416</span>: (<span class="string">'requested_range_not_satisfiable'</span>, <span class="string">'requested_range'</span>, <span class="string">'range_not_satisfiable'</span>),</span><br><span class="line"><span class="number">417</span>: (<span class="string">'expectation_failed'</span>,),</span><br><span class="line"><span class="number">418</span>: (<span class="string">'im_a_teapot'</span>, <span class="string">'teapot'</span>, <span class="string">'i_am_a_teapot'</span>),</span><br><span class="line"><span class="number">421</span>: (<span class="string">'misdirected_request'</span>,),</span><br><span class="line"><span class="number">422</span>: (<span class="string">'unprocessable_entity'</span>, <span class="string">'unprocessable'</span>),</span><br><span class="line"><span class="number">423</span>: (<span class="string">'locked'</span>,),</span><br><span class="line"><span class="number">424</span>: (<span class="string">'failed_dependency'</span>, <span class="string">'dependency'</span>),</span><br><span class="line"><span class="number">425</span>: (<span class="string">'unordered_collection'</span>, <span class="string">'unordered'</span>),</span><br><span class="line"><span class="number">426</span>: (<span class="string">'upgrade_required'</span>, <span class="string">'upgrade'</span>),</span><br><span class="line"><span class="number">428</span>: (<span class="string">'precondition_required'</span>, <span class="string">'precondition'</span>),</span><br><span class="line"><span class="number">429</span>: (<span class="string">'too_many_requests'</span>, <span class="string">'too_many'</span>),</span><br><span class="line"><span class="number">431</span>: (<span class="string">'header_fields_too_large'</span>, <span class="string">'fields_too_large'</span>),</span><br><span class="line"><span class="number">444</span>: (<span class="string">'no_response'</span>, <span class="string">'none'</span>),</span><br><span class="line"><span class="number">449</span>: (<span class="string">'retry_with'</span>, <span class="string">'retry'</span>),</span><br><span class="line"><span class="number">450</span>: (<span class="string">'blocked_by_windows_parental_controls'</span>, <span class="string">'parental_controls'</span>),</span><br><span class="line"><span class="number">451</span>: (<span class="string">'unavailable_for_legal_reasons'</span>, <span class="string">'legal_reasons'</span>),</span><br><span class="line"><span class="number">499</span>: (<span class="string">'client_closed_request'</span>,),</span><br><span class="line"></span><br><span class="line"><span class="comment"># 服务端错误状态码</span></span><br><span class="line"><span class="number">500</span>: (<span class="string">'internal_server_error'</span>, <span class="string">'server_error'</span>, <span class="string">'/o\\'</span>, <span class="string">'✗'</span>),</span><br><span class="line"><span class="number">501</span>: (<span class="string">'not_implemented'</span>,),</span><br><span class="line"><span class="number">502</span>: (<span class="string">'bad_gateway'</span>,),</span><br><span class="line"><span class="number">503</span>: (<span class="string">'service_unavailable'</span>, <span class="string">'unavailable'</span>),</span><br><span class="line"><span class="number">504</span>: (<span class="string">'gateway_timeout'</span>,),</span><br><span class="line"><span class="number">505</span>: (<span class="string">'http_version_not_supported'</span>, <span class="string">'http_version'</span>),</span><br><span class="line"><span class="number">506</span>: (<span class="string">'variant_also_negotiates'</span>,),</span><br><span class="line"><span class="number">507</span>: (<span class="string">'insufficient_storage'</span>,),</span><br><span class="line"><span class="number">509</span>: (<span class="string">'bandwidth_limit_exceeded'</span>, <span class="string">'bandwidth'</span>),</span><br><span class="line"><span class="number">510</span>: (<span class="string">'not_extended'</span>,),</span><br><span class="line"><span class="number">511</span>: (<span class="string">'network_authentication_required'</span>, <span class="string">'network_auth'</span>, <span class="string">'network_authentication'</span>)</span><br></pre></td></tr></table></figure><h3 id="4、Requests高级操作"><a href="#4、Requests高级操作" class="headerlink" title="4、Requests高级操作"></a>4、Requests高级操作</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 文件上传</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">files = &#123;</span><br><span class="line">    <span class="string">'files'</span>:open(<span class="string">'favicon.ico'</span>,<span class="string">'rb'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">response = requests.post(<span class="string">'http://httpbin.org/post'</span>,files=files)</span><br><span class="line">print(response.text)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获取cookies</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">response = requests.get(<span class="string">'http://www.baidu.com'</span>)</span><br><span class="line">print(response.cookies)</span><br><span class="line"><span class="keyword">for</span> k,v <span class="keyword">in</span> response.cookies.items():</span><br><span class="line">    print(k +<span class="string">'='</span>+ v)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 会话维持</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">requests.get(<span class="string">'http://httpbin.org/cookies/set/number/123456789'</span>) <span class="comment">#为网站的访问设置cookie </span></span><br><span class="line">response = requests.get(<span class="string">'http://httpbin.org/cookies'</span>)  <span class="comment">#与上面的行为时独立的，所以获取不到任何与cookie相关的信息</span></span><br><span class="line">print(response.text)</span><br><span class="line"></span><br><span class="line">s = requests.Session() <span class="comment">#声明Session对象，使用这个对象发起两次GET请求（相当于同一个浏览器发出来的请求）</span></span><br><span class="line">s.get(<span class="string">'http://httpbin.org/cookies/set/number/123456789'</span>)</span><br><span class="line">r = s.get(<span class="string">'http://httpbin.org/cookies'</span>)</span><br><span class="line">print(r.text)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 证书验证</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment">#直接请求https会报错SLLError</span></span><br><span class="line"><span class="comment">#response = requests.get('https://www.12306.cn')</span></span><br><span class="line"><span class="comment">#print(response.status_code)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#添加verify=False可以忽略证书验证，但是还是会报警告</span></span><br><span class="line"><span class="comment">#response = requests.get('https://www.12306.cn',verify=False)</span></span><br><span class="line"><span class="comment">#print(response.text)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1.引入requests.packages.urllib3设置忽略警告</span></span><br><span class="line"><span class="keyword">from</span> requests.packages <span class="keyword">import</span> urllib3</span><br><span class="line">urllib3.disable_warnings()</span><br><span class="line">response = requests.get(<span class="string">'https://www.12306.cn'</span>,verify=<span class="keyword">False</span>)</span><br><span class="line">print(response.status_code)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2.通过捕获警告到日志的方式忽略警告</span></span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line">logging.captureWarnings(<span class="keyword">True</span>)</span><br><span class="line">response = requests.get(<span class="string">'https://www.12306.cn'</span>,verify=<span class="keyword">False</span>)</span><br><span class="line">print(response.status_code)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3.指定一个本地证书用作客户端证书，这可以是单个文件（包含密钥和证书）或一个包含两个文件路径的元组</span></span><br><span class="line">response = requests.get(<span class="string">'https://www.12306.cn'</span>,cert=(<span class="string">'/path/server.crt'</span>, <span class="string">'/path/key'</span>))</span><br><span class="line">print(response.status_code)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 代理设置</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">proxies = &#123;</span><br><span class="line">  <span class="string">"http"</span>: <span class="string">"http://10.10.1.10:3128"</span>,</span><br><span class="line">  <span class="string">"https"</span>: <span class="string">"http://10.10.1.10:1080"</span>,</span><br><span class="line">&#125;</span><br><span class="line">requests.get(<span class="string">"https://www.taobao.com"</span>, proxies=proxies)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 若代理需要使用HTTP Basic Auth，可以使用类似http://user:password@host:port这样的语法来设置代理。</span></span><br><span class="line">proxies = &#123;</span><br><span class="line">    <span class="string">"http"</span>: <span class="string">"http://user:password@10.10.1.10:3128/"</span>,</span><br><span class="line">&#125;</span><br><span class="line">requests.get(<span class="string">"https://www.taobao.com"</span>, proxies=proxies)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 除了基本的HTTP代理外，requests还支持SOCKS协议的代理。pip3 install 'requests[socks]'</span></span><br><span class="line">proxies = &#123;</span><br><span class="line">    <span class="string">'http'</span>: <span class="string">'socks5://user:password@host:port'</span>,</span><br><span class="line">    <span class="string">'https'</span>: <span class="string">'socks5://user:password@host:port'</span></span><br><span class="line">&#125;</span><br><span class="line">requests.get(<span class="string">"https://www.taobao.com"</span>, proxies=proxies)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 超时设置 </span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">r = requests.get(<span class="string">'https://www.taobao.com'</span>,timeout=<span class="number">1</span>)</span><br><span class="line">print(r.status_code)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 分别指定连接（connect）和读取（read）两个阶段超时，可以传入一个元组</span></span><br><span class="line">r = requests.get(<span class="string">'https://www.taobao.com'</span>,timeout=(<span class="number">5.11</span>,<span class="number">30</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 想永久等待，可以直接将timeout设置为None,或直接不加参数</span></span><br><span class="line">r = requests.get(<span class="string">'https://www.taobao.com'</span>,timeout=<span class="keyword">None</span>)</span><br><span class="line">r = requests.get(<span class="string">'https://www.taobao.com'</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 身份认证</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">r = requests.get(<span class="string">'http://120.27.34.24.9001'</span>,auth=(<span class="string">'username'</span>, <span class="string">'password'</span>))</span><br><span class="line">print(r.status_code)</span><br><span class="line"></span><br><span class="line"><span class="comment">#上面代码是简写，实际调用的requests.auth.HTTPBasicAuth </span></span><br><span class="line"><span class="keyword">from</span> requests.auth <span class="keyword">import</span> HTTPBasicAuth</span><br><span class="line">r=requests.get(<span class="string">'http://120.27.34.24.9001'</span>,auth=HTTPBasicAuth(<span class="string">'username'</span>, <span class="string">'password'</span>))</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 异常处理</span></span><br><span class="line"><span class="comment"># http://docs.python-requests.org/en/master/api/#exceptions</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> requests.exceptions <span class="keyword">import</span> ReadTimeout,HTTPError,RequestException</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    r = requests.get(<span class="string">'https://www.taobao.com'</span>,timeout=<span class="number">0.1</span>)</span><br><span class="line"><span class="keyword">except</span> ReadTimeout:</span><br><span class="line">    print(<span class="string">'ReadTimeout'</span>)</span><br><span class="line"><span class="keyword">except</span> HTTPError:</span><br><span class="line">    print(<span class="string">'HTTPError'</span>)</span><br><span class="line"><span class="keyword">except</span> RequestException:</span><br><span class="line">    print(<span class="string">'RequestException'</span>)</span><br></pre></td></tr></table></figure><h1 id="持续更新…"><a href="#持续更新…" class="headerlink" title="持续更新…"></a><em>持续更新…</em></h1>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;崔庆才老师爬虫的学习笔记。&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="爬虫" scheme="http://pythonfood.github.io/categories/%E7%88%AC%E8%99%AB/"/>
    
    
      <category term="爬虫" scheme="http://pythonfood.github.io/tags/%E7%88%AC%E8%99%AB/"/>
    
  </entry>
  
  <entry>
    <title>爬虫-urllib库</title>
    <link href="http://pythonfood.github.io/2018/07/02/%E7%88%AC%E8%99%AB-urllib%E5%BA%93/"/>
    <id>http://pythonfood.github.io/2018/07/02/爬虫-urllib库/</id>
    <published>2018-07-02T02:00:00.000Z</published>
    <updated>2018-08-14T09:09:16.035Z</updated>
    
    <content type="html"><![CDATA[<p>崔庆才老师爬虫的学习笔记。<br><a id="more"></a></p><h2 id="一、Urllib库详解"><a href="#一、Urllib库详解" class="headerlink" title="一、Urllib库详解"></a>一、Urllib库详解</h2><h3 id="1、Urllib库"><a href="#1、Urllib库" class="headerlink" title="1、Urllib库"></a>1、Urllib库</h3><ul><li>urllib.request：请求模块</li><li>urllib.error：异常处理模块</li><li>urllib.parse：url解析模块（拆分、合并等）</li><li>urllib.robotparser：robot.txt解析模块</li></ul><p><code>urllib.request.urlopen(url,data = None,[timeout]*,cafile = None,capath = None,cadefault = False,context = None)</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># get请求</span></span><br><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line">response = urllib.request.urlopen(<span class="string">'http://www.baidu.com'</span>)</span><br><span class="line">print(response.read().decode(<span class="string">'utf-8'</span>))</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># post请求</span></span><br><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line"></span><br><span class="line">data = bytes(urllib.parse.urlencode(&#123;<span class="string">'word'</span>:<span class="string">'hello'</span>&#125;),encoding=<span class="string">'utf8'</span>)</span><br><span class="line">response = urllib.request.urlopen(<span class="string">'http://httpbin.org/post'</span>,data=data)</span><br><span class="line">print(response.read())</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># time超时</span></span><br><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"></span><br><span class="line">response = urllib.request.urlopen(<span class="string">'http://httpbin.org/get'</span>,timeout=<span class="number">1</span>)</span><br><span class="line">print(response.read())</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># error错误</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"><span class="keyword">import</span> urllib.error</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:  </span><br><span class="line">    response = urllib.request.urlopen(<span class="string">'http://httpbin.org/get'</span>,timeout = <span class="number">0.1</span>)</span><br><span class="line"><span class="keyword">except</span> urllib.error.URLError <span class="keyword">as</span> e:  </span><br><span class="line">    <span class="keyword">if</span> isinstance(e.reason,socket.timeout): </span><br><span class="line">        print(<span class="string">'TIME OUT'</span>)</span><br></pre></td></tr></table></figure><h3 id="2、响应"><a href="#2、响应" class="headerlink" title="2、响应"></a>2、响应</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 响应类型</span></span><br><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"></span><br><span class="line">response = urllib.request.urlopen(<span class="string">'https://www.python.org'</span>)</span><br><span class="line">print(type(response))</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 状态码、响应头</span></span><br><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"></span><br><span class="line">response = urllib.request.urlopen(<span class="string">'https://www.python.org'</span>)</span><br><span class="line"></span><br><span class="line">print(response.status)</span><br><span class="line">print(response.getheaders()) </span><br><span class="line"><span class="comment">#print(response.getheaders("Server"))</span></span><br></pre></td></tr></table></figure><h3 id="3、Request"><a href="#3、Request" class="headerlink" title="3、Request"></a>3、Request</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"></span><br><span class="line">request = urllib.request.Request(<span class="string">'https://www.python.org'</span>)</span><br><span class="line">response = urllib.request.urlopen(request)</span><br><span class="line">print(response.read().decode(<span class="string">'utf-8'</span>))</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Request添加header、data</span></span><br><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://httpbin.org/post'</span></span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">'User-Agent'</span>:<span class="string">'Mozilla/5.0 (Windows NT 6.1; WOW64)'</span>,</span><br><span class="line">    <span class="string">'Host'</span>:<span class="string">'httpbin.org'</span></span><br><span class="line">&#125;</span><br><span class="line">dict = &#123;<span class="string">'name'</span>:<span class="string">'Germey'</span> &#125;</span><br><span class="line">data = bytes(urllib.parse.urlencode(dict),encoding=<span class="string">"utf8"</span>)</span><br><span class="line"></span><br><span class="line">request = urllib.request.Request(url=url,headers=headers,data=data,method=<span class="string">'POST'</span>)</span><br><span class="line">response = urllib.request.urlopen(request)</span><br><span class="line">print(response.read().decode(<span class="string">'utf-8'</span>))</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 另外一种添加header方式</span></span><br><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://httpbin.org/post'</span></span><br><span class="line">dict = &#123;<span class="string">'name'</span>:<span class="string">'Germey'</span> &#125;</span><br><span class="line">data = bytes(urllib.parse.urlencode(dict),encoding=<span class="string">"utf8"</span>)</span><br><span class="line"></span><br><span class="line">request = urllib.request.Request(url=url,data=data,method=<span class="string">'POST'</span>)</span><br><span class="line">request.add_header( <span class="string">'User-Agent'</span>,<span class="string">'Mozilla/5.0 (Windows NT 6.1; WOW64)'</span>) <span class="comment"># 注意key,value之间用逗号隔开</span></span><br><span class="line">request.add_header(<span class="string">'Host'</span>,<span class="string">'httpbin.org'</span>)</span><br><span class="line">response = urllib.request.urlopen(request)</span><br><span class="line">print(response.read().decode(<span class="string">'utf-8'</span>))</span><br></pre></td></tr></table></figure><h3 id="4、Handler"><a href="#4、Handler" class="headerlink" title="4、Handler"></a>4、Handler</h3><p><a href="https://docs.python.org/3/library/urllib.request.html#module-urllib.request" target="_blank" rel="noopener">https://docs.python.org/3/library/urllib.request.html#module-urllib.request</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 代理</span></span><br><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"></span><br><span class="line">proxy_handler = urllib.request.ProxyHandler(</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="string">'http'</span>:<span class="string">'http://127.0.0.1:9743'</span>,  </span><br><span class="line">        <span class="string">'https'</span>:<span class="string">'https://127.0.0.1:9743'</span> </span><br><span class="line">    &#125;</span><br><span class="line">)</span><br><span class="line">opener = urllib.request.build_opener(proxy_handler)</span><br><span class="line">response = opener.open(<span class="string">'http://www.baidu.com'</span>)</span><br><span class="line">print(response.read().decode(<span class="string">'utf-8'</span>))</span><br></pre></td></tr></table></figure><h3 id="5、Cookie"><a href="#5、Cookie" class="headerlink" title="5、Cookie"></a>5、Cookie</h3><p>客户端保存，用来记录客户身份的文本文件、维持登录状态</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cookie获取</span></span><br><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"><span class="keyword">import</span> http.cookiejar</span><br><span class="line"></span><br><span class="line">cookie = http.cookiejar.CookieJar() <span class="comment"># 设置一个cookie栈  </span></span><br><span class="line">handler = urllib.request.HTTPCookieProcessor(cookie)</span><br><span class="line">opener = urllib.request.build_opener(handler)</span><br><span class="line">response = opener.open(<span class="string">'http://www.baidu.com'</span>)</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> cookie:</span><br><span class="line">    print(item.name+<span class="string">'='</span>+item.value)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 保存cookie为文本文件</span></span><br><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"><span class="keyword">import</span> http.cookiejar</span><br><span class="line"></span><br><span class="line">filename = <span class="string">'cookie.txt'</span></span><br><span class="line">cookie = http.cookiejar.MozillaCookieJar(filename)</span><br><span class="line">handler = urllib.request.HTTPCookieProcessor(cookie)</span><br><span class="line">opener = urllib.request.build_opener(handler)</span><br><span class="line">response = opener.open(<span class="string">'http://www.baidu.com'</span>)</span><br><span class="line">cookie.save(ignore_discard=<span class="keyword">True</span>,ignore_expires=<span class="keyword">True</span>) <span class="comment">#保存cookie</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 另外一种cookie保存格式</span></span><br><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"><span class="keyword">import</span> http.cookiejar</span><br><span class="line"></span><br><span class="line">filename = <span class="string">'cookie_LWP.txt'</span></span><br><span class="line">cookie = http.cookiejar.LWPCookieJar(filename)</span><br><span class="line">handler = urllib.request.HTTPCookieProcessor(cookie)</span><br><span class="line">opener = urllib.request.build_opener(handler)</span><br><span class="line">response = opener.open(<span class="string">'http://www.baidu.com'</span>)</span><br><span class="line">cookie.save(ignore_discard=<span class="keyword">True</span>,ignore_expires=<span class="keyword">True</span>) <span class="comment">#保存cookie</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 用什么方式保存cookie，就用什么方式读取</span></span><br><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"><span class="keyword">import</span> http.cookiejar</span><br><span class="line"></span><br><span class="line">cookie = http.cookiejar.LWPCookieJar()</span><br><span class="line">cookie.load(<span class="string">'cookie_LWP.txt'</span>,ignore_discard=<span class="keyword">True</span>,ignore_expires=<span class="keyword">True</span>)</span><br><span class="line">handler = urllib.request.HTTPCookieProcessor(cookie)</span><br><span class="line">opener = urllib.request.build_opener(handler)</span><br><span class="line">response = opener.open(<span class="string">'http://www.baidu.com'</span>)</span><br><span class="line">print(response.read().decode(<span class="string">'utf-8'</span>))</span><br></pre></td></tr></table></figure><h3 id="6、异常处理"><a href="#6、异常处理" class="headerlink" title="6、异常处理"></a>6、异常处理</h3><p><a href="https://docs.python.org/3/library/urllib.error.html#module-urllib.error" target="_blank" rel="noopener">https://docs.python.org/3/library/urllib.error.html#module-urllib.error</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> request</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> error</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    response = request.urlopen(<span class="string">'http://www.cuiqingcai.com/index.html'</span>)</span><br><span class="line"><span class="keyword">except</span> error.URLError <span class="keyword">as</span> e:</span><br><span class="line">    print(e.reason)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 可以捕捉的异常</span></span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> request</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> error</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    response = request.urlopen(<span class="string">'http://www.cuiqingcai.com/index.html'</span>)</span><br><span class="line"><span class="keyword">except</span> error.HTTPError <span class="keyword">as</span> e: <span class="comment"># 先捕捉子类异常</span></span><br><span class="line">    print(e.reason,e.code,e.headers,sep=<span class="string">'\n'</span>)</span><br><span class="line"><span class="keyword">except</span> error.URLError <span class="keyword">as</span> e: <span class="comment"># 再捕捉父类异常</span></span><br><span class="line">    print(e.reason)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">'Request Successfully'</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 验证异常是那种原因</span></span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> request</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> error</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    response = request.urlopen(<span class="string">'http://www.baidu.com'</span>,timeout=<span class="number">0.01</span>)</span><br><span class="line"><span class="keyword">except</span> error.URLError <span class="keyword">as</span> e:</span><br><span class="line">    print(type(e.reason))</span><br><span class="line">    <span class="keyword">if</span> isinstance(e.reason,socket.timeout):</span><br><span class="line">          print(<span class="string">'Time Out'</span>)</span><br></pre></td></tr></table></figure><h3 id="7、URL解析"><a href="#7、URL解析" class="headerlink" title="7、URL解析"></a>7、URL解析</h3><p><a href="https://docs.python.org/3/library/urllib.parse.html#module-urllib.parse" target="_blank" rel="noopener">https://docs.python.org/3/library/urllib.parse.html#module-urllib.parse</a></p><p>(1)urlparse</p><p>将url进行分割，分割成几个部分，再依次将其复制</p><p><code>parse.urlparse(urlstring,scheme=&#39;&#39;,allow_fragments = True)</code></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> urlparse</span><br><span class="line"></span><br><span class="line">result = urlparse(<span class="string">'https://www.baidu.com/s?wd=urllib&amp;ie=UTF-8'</span>)  <span class="comment"># 解析url为6个部分</span></span><br><span class="line">print(type(result))</span><br><span class="line">print(result)</span><br><span class="line"></span><br><span class="line">result1 = urlparse(<span class="string">'www.baidu.com/s?wd=urllib&amp;ie=UTF-8'</span>,scheme=<span class="string">'https'</span>)  <span class="comment"># 无协议类型，自行添加协议类型</span></span><br><span class="line">print(result1)</span><br><span class="line"></span><br><span class="line">result2 = urlparse(<span class="string">'http://www.baidu.com/s?wd=urllib&amp;ie=UTF-8'</span>,scheme=<span class="string">'https'</span>)  <span class="comment"># 有协议类型，添加协议类型还是会显示默认协议</span></span><br><span class="line">print(result2)</span><br><span class="line"></span><br><span class="line">result3 = urlparse(<span class="string">'http://www.baidu.com/s?wd=urllib&amp;ie=UTF-8#comment'</span>,allow_fragments=<span class="keyword">True</span>) <span class="comment"># allow_fragments为True</span></span><br><span class="line">print(result3)</span><br><span class="line"></span><br><span class="line">result4 = urlparse(<span class="string">'http://www.baidu.com/s?wd=urllib&amp;ie=UTF-8#comment'</span>,allow_fragments=<span class="keyword">False</span>) <span class="comment"># allow_fragments为False，会自行向前拼接</span></span><br><span class="line">print(result4)</span><br></pre></td></tr></table></figure><p>(2)urlunparse</p><p>urlparse的反函数</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> urlunparse</span><br><span class="line"></span><br><span class="line"><span class="comment">#data可以通过urlparse得出的参数往里面带，注意：即使是空符号也要写进去，不然会出错</span></span><br><span class="line">data = [<span class="string">'http'</span>, <span class="string">'www.baidu.com'</span>, <span class="string">'index.html'</span>, <span class="string">'user'</span>, <span class="string">'a=6'</span>, <span class="string">'comment'</span>] </span><br><span class="line">result = urlunparse(data)</span><br><span class="line">print(result)</span><br></pre></td></tr></table></figure><p>(3)urljoin</p><p>拼接url</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> urljoin</span><br><span class="line"></span><br><span class="line">result = urljoin(<span class="string">'http://www.baidu.com'</span>,<span class="string">'FQA.html'</span>) <span class="comment"># 正常拼接</span></span><br><span class="line">print(result)</span><br><span class="line"></span><br><span class="line">result1 = urljoin(<span class="string">'http://www.baidu.com'</span>,<span class="string">'http://www.taobao.com/FQA.html'</span>) <span class="comment"># 后面url会覆盖前面url共有的部分，多余部分自行拼接</span></span><br><span class="line">print(result1)</span><br><span class="line"></span><br><span class="line">result2 = urljoin(<span class="string">'http://www.baidu.com/about'</span>,<span class="string">'https://www.taobao.com/FQA.html'</span>) <span class="comment"># 后面url会覆盖前面url共有的部分，总之以后面为准</span></span><br><span class="line">print(result2)</span><br></pre></td></tr></table></figure><p>(4)urlencode</p><p>字典对象转化为get请求参数</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> urlencode</span><br><span class="line"></span><br><span class="line">params=&#123;</span><br><span class="line">    <span class="string">'name'</span>:<span class="string">'Arise'</span>,  </span><br><span class="line">    <span class="string">'age'</span>:<span class="string">'21'</span> </span><br><span class="line">&#125;</span><br><span class="line">base_url = <span class="string">'http://www.baidu.com?'</span></span><br><span class="line"></span><br><span class="line">url = base_url + urlencode(params)</span><br><span class="line">print(url)</span><br></pre></td></tr></table></figure><h3 id="8、robotparser"><a href="#8、robotparser" class="headerlink" title="8、robotparser"></a>8、robotparser</h3><p>用来解析robot.txt（只做了解）</p><p><a href="https://docs.python.org/3/library/urllib.robotparser.html#module-urllib.robotparser" target="_blank" rel="noopener">https://docs.python.org/3/library/urllib.robotparser.html#module-urllib.robotparser</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.robotparser  </span><br><span class="line"></span><br><span class="line">rp = urllib.robotparser.RobotFileParser()  </span><br><span class="line">rp.set_url(<span class="string">"http://www.musi-cal.com/robots.txt"</span>)  </span><br><span class="line">rp.read()  </span><br><span class="line">rrate = rp.request_rate(<span class="string">"*"</span>)  </span><br><span class="line">print(rrate.requests)</span><br><span class="line"><span class="comment">#3  </span></span><br><span class="line">rrate.seconds  </span><br><span class="line"><span class="comment">#20  </span></span><br><span class="line">rp.crawl_delay(<span class="string">"*"</span>)  </span><br><span class="line"><span class="comment">#6  </span></span><br><span class="line">rp.can_fetch(<span class="string">"*"</span>, <span class="string">"http://www.musi-cal.com/cgi-bin/search?city=San+Francisco"</span>)  </span><br><span class="line"><span class="comment">#False  </span></span><br><span class="line">rp.can_fetch(<span class="string">"*"</span>, <span class="string">"http://www.musi-cal.com/"</span>)  </span><br><span class="line"><span class="comment">#True</span></span><br></pre></td></tr></table></figure><h1 id="持续更新…"><a href="#持续更新…" class="headerlink" title="持续更新…"></a><em>持续更新…</em></h1>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;崔庆才老师爬虫的学习笔记。&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="爬虫" scheme="http://pythonfood.github.io/categories/%E7%88%AC%E8%99%AB/"/>
    
    
      <category term="爬虫" scheme="http://pythonfood.github.io/tags/%E7%88%AC%E8%99%AB/"/>
    
  </entry>
  
  <entry>
    <title>爬虫-基本原理</title>
    <link href="http://pythonfood.github.io/2018/07/02/%E7%88%AC%E8%99%AB-%E5%9F%BA%E6%9C%AC%E5%8E%9F%E7%90%86/"/>
    <id>http://pythonfood.github.io/2018/07/02/爬虫-基本原理/</id>
    <published>2018-07-02T01:00:00.000Z</published>
    <updated>2018-08-14T07:42:06.707Z</updated>
    
    <content type="html"><![CDATA[<p>崔庆才老师爬虫的学习笔记。<br><a id="more"></a></p><h2 id="一、爬虫基本原理"><a href="#一、爬虫基本原理" class="headerlink" title="一、爬虫基本原理"></a>一、爬虫基本原理</h2><p><strong>1、什么是爬虫</strong></p><p>请求网站并提取数据的自动化程序。</p><p><strong>2、爬虫基本流程</strong></p><blockquote><p>(1)发起请求：<br>通过HTTP库向目标站点发起请求，即发送一个Request，请求可以包含额外的headers等信息，等待服务器响应。<br>(2)获取响应内容：<br>如果服务器能正常响应，会得到一个Response，Response的内容是所获取的页面内容，类型可能有HTML、Json字符串、二进制数据（如图片视频）等类型。<br>(3)解析内容：<br>得到的内容可能是HTML，可以用正则表达式、网页解析库进行解析。可能是Json,可以直接转换为Json对象解析。可能是二进制数据，可以做保存或者进一步的处理。<br>(4)保存数据：<br>保存形式多样，可以保存为文本，可以保存至数据库，或者保存特定格式的文件。</p></blockquote><p><strong>3、Request与Response</strong></p><blockquote><p>(1)浏览器就发送消息给该网址所在的服务器，这个过程叫做HTTP Request。<br>(2)服务器收到浏览器发送的消息后，能够根据浏览器发送消息的内容，做响应处理，然后把消息回传给浏览器。这个过程叫做HTTP Response。<br>(3)浏览器收到服务器的Response信息后，会对信息进行相应处理，然后展示。</p></blockquote><p><strong>4、Request</strong></p><blockquote><p>(1)请求方式：<br>主要有GET、POST两种类型，另外还有HEAD、PUT、DELETE、OPTIONS等。<br>(2)请求URL：<br>URL全称统一资源定位符，如一个网页文档、一张图片、一个视频都可以用URL唯一来确定。<br>(3)请求头：<br>包含请求时的头部信息，如User-Agent、Host、Cookies等信息。<br>(4)请求体：<br>请求时额外携带的数据，如表单提交时的表单数据（eg：fromdata）。</p></blockquote><p><strong>5、Response</strong></p><blockquote><p>(1)响应状态：<br>有多重响应状态，如200代表成功、301是跳转、404为找不到网页、502服务器错误<br>(2)响应头：<br>如内容类型、内容长度、服务器信息、设置Cookie等等；<br>(3)响应体：<br>最主要的部分，包含了请求资源的内容，如网页HTML、图片二进制数据等；</p></blockquote><p><strong>6、能抓怎样的数据</strong></p><blockquote><p>(1)网页文本：<br>如HTML文档，JSON格式文本等。<br>(2)图片：<br>获取二进制文本文件，保存为图片格式。<br>(3)视频：<br>同样为二进制文件，保存为音频格式即可，抓取方法如图片抓取方法。<br>(4)其他：<br>只要是能请求到的，都能获取。</p></blockquote><p><strong>7、解析方式</strong></p><blockquote><p>(1)直接处理<br>(2)Json解析<br>(3)正则表达式<br>(4)BeautifulSoup<br>(5)PyQuery<br>(6)XPath</p></blockquote><p><strong>8、为啥抓到的和浏览器看到的不一样</strong></p><p>由于JavaScript渲染的问题，在network看到的代码（我们通过Python）与element中看到（JavaScript渲染的）不一样。</p><p><strong>9、怎么解决JavaScript渲染的问题</strong></p><blockquote><p>(1)分析Ajax请求：<br>返回Json格式数据。<br>(2)Selenium/WebDriver：<br>来模拟一个浏览器。<br>(3)Splash：<br><a href="https://github.com/scrapinghub/splash" target="_blank" rel="noopener">https://github.com/scrapinghub/splash</a><br>(4)PyV8、Ghost.py：</p></blockquote><p><strong>10、怎样保存数据</strong></p><blockquote><p>(1)文本：<br>纯文本、Json、Xml等。<br>(2)关系型数据库：<br>如MySQL、Oracle、SQL Server等具有结构化表结构形式存储。<br>(3)非关系型数据库：<br>MongoDB、Redis等Key-Value形式存储。<br>(4)二进制文件：<br>如图片、视频、音频等等直接保存成特定格式即可。</p></blockquote><h1 id="持续更新…"><a href="#持续更新…" class="headerlink" title="持续更新…"></a><em>持续更新…</em></h1>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;崔庆才老师爬虫的学习笔记。&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="爬虫" scheme="http://pythonfood.github.io/categories/%E7%88%AC%E8%99%AB/"/>
    
    
      <category term="爬虫" scheme="http://pythonfood.github.io/tags/%E7%88%AC%E8%99%AB/"/>
    
  </entry>
  
  <entry>
    <title>爬虫-phantomjs配置</title>
    <link href="http://pythonfood.github.io/2018/07/01/%E7%88%AC%E8%99%AB-phantomjs%E9%85%8D%E7%BD%AE/"/>
    <id>http://pythonfood.github.io/2018/07/01/爬虫-phantomjs配置/</id>
    <published>2018-07-01T04:00:00.000Z</published>
    <updated>2018-08-14T07:49:50.220Z</updated>
    
    <content type="html"><![CDATA[<p>崔庆才老师爬虫的学习笔记。<br><a id="more"></a></p><h2 id="一、PhantomJS下载"><a href="#一、PhantomJS下载" class="headerlink" title="一、PhantomJS下载"></a>一、PhantomJS下载</h2><p>国内镜像：<a href="http://npm.taobao.org/dist/phantomjs/" target="_blank" rel="noopener">http://npm.taobao.org/dist/phantomjs/</a></p><h2 id="二、PhantomJS安装"><a href="#二、PhantomJS安装" class="headerlink" title="二、PhantomJS安装"></a>二、PhantomJS安装</h2><p>(1)将zip包解压到自定义路径即可D:\Program Files\PhantomJS\phantomjs-2.1.1-windows<br>(2)配置环境变量D:\Program Files\PhantomJS\phantomjs-2.1.1-windows\bin</p><h2 id="三、验证环境"><a href="#三、验证环境" class="headerlink" title="三、验证环境"></a>三、验证环境</h2><p>cmd输入命令<code>python</code>进入交互环境<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">from selenium import webdriver</span><br><span class="line">driver = webdriver.PhantomJS()  # PhantomJS对应chromedriver必须是2.0以上</span><br><span class="line">driver.get(&apos;http://www.baidu.com&apos;)</span><br><span class="line">driver.page_source  # 由于PhantomJS没有界面，通过page_source打印网页信息</span><br></pre></td></tr></table></figure></p><h1 id="持续更新…"><a href="#持续更新…" class="headerlink" title="持续更新…"></a><em>持续更新…</em></h1>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;崔庆才老师爬虫的学习笔记。&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="爬虫" scheme="http://pythonfood.github.io/categories/%E7%88%AC%E8%99%AB/"/>
    
    
      <category term="爬虫" scheme="http://pythonfood.github.io/tags/%E7%88%AC%E8%99%AB/"/>
    
  </entry>
  
  <entry>
    <title>爬虫-redis配置</title>
    <link href="http://pythonfood.github.io/2018/07/01/%E7%88%AC%E8%99%AB-redis%E9%85%8D%E7%BD%AE/"/>
    <id>http://pythonfood.github.io/2018/07/01/爬虫-redis配置/</id>
    <published>2018-07-01T03:00:00.000Z</published>
    <updated>2018-08-14T07:49:22.672Z</updated>
    
    <content type="html"><![CDATA[<p>崔庆才老师爬虫的学习笔记。<br><a id="more"></a></p><h2 id="一、Redis下载"><a href="#一、Redis下载" class="headerlink" title="一、Redis下载"></a>一、Redis下载</h2><p>64位可以从github下载:<a href="https://github.com/MicrosoftArchive/redis/releases" target="_blank" rel="noopener">https://github.com/MicrosoftArchive/redis/releases</a><br>32位下载:<a href="https://pan.baidu.com/s/1mig98a0" target="_blank" rel="noopener">https://pan.baidu.com/s/1mig98a0</a> （只找到一个百度网盘的）</p><h2 id="二、Redis安装"><a href="#二、Redis安装" class="headerlink" title="二、Redis安装"></a>二、Redis安装</h2><p><strong>1、64位安装</strong></p><p>(1)运行msi安装软件，根据提示安装即可。<br>(2)服务运行端口是6379</p><p><strong>2、32位安装</strong></p><p>(1)将zip包解压到自定义安装路径即可 D:\Program Files\Redis<br>(2)双击redis-server.exe或cmd进入redis路径输入命令<code>D:\Program Files\Redis&gt;redis-server.exe Redis.conf</code>就可以启动服务。</p><h2 id="三、Redis-Desktop-Manager"><a href="#三、Redis-Desktop-Manager" class="headerlink" title="三、Redis Desktop Manager"></a>三、Redis Desktop Manager</h2><p>官网地址：<a href="https://redisdesktop.com/download" target="_blank" rel="noopener">https://redisdesktop.com/download</a><br>64位可以从github下载：<a href="https://github.com/uglide/RedisDesktopManager/releases" target="_blank" rel="noopener">https://github.com/uglide/RedisDesktopManager/releases</a><br>32位下载：<a href="https://pan.baidu.com/s/1kU8sY3P" target="_blank" rel="noopener">https://pan.baidu.com/s/1kU8sY3P</a> （只找到一个百度网盘的）</p><h1 id="持续更新…"><a href="#持续更新…" class="headerlink" title="持续更新…"></a><em>持续更新…</em></h1>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;崔庆才老师爬虫的学习笔记。&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="爬虫" scheme="http://pythonfood.github.io/categories/%E7%88%AC%E8%99%AB/"/>
    
    
      <category term="爬虫" scheme="http://pythonfood.github.io/tags/%E7%88%AC%E8%99%AB/"/>
    
  </entry>
  
  <entry>
    <title>爬虫-mongodb配置</title>
    <link href="http://pythonfood.github.io/2018/07/01/%E7%88%AC%E8%99%AB-mongodb%E9%85%8D%E7%BD%AE/"/>
    <id>http://pythonfood.github.io/2018/07/01/爬虫-mongodb配置/</id>
    <published>2018-07-01T02:00:00.000Z</published>
    <updated>2018-08-14T07:39:29.918Z</updated>
    
    <content type="html"><![CDATA[<p>崔庆才老师爬虫的学习笔记。<br><a id="more"></a></p><h2 id="一、mongodb下载："><a href="#一、mongodb下载：" class="headerlink" title="一、mongodb下载："></a>一、mongodb下载：</h2><p>官网地址：<a href="https://www.mongodb.com/" target="_blank" rel="noopener">https://www.mongodb.com/</a><br>64位下载地址：<a href="http://dl.mongodb.org/dl/win32/x86_64" target="_blank" rel="noopener">http://dl.mongodb.org/dl/win32/x86_64</a><br>32位下载地址：<a href="https://www.mongodb.org/dl/win32" target="_blank" rel="noopener">https://www.mongodb.org/dl/win32</a></p><h2 id="二、windows64位安装"><a href="#二、windows64位安装" class="headerlink" title="二、windows64位安装"></a>二、windows64位安装</h2><blockquote><p>(1)下载的将zip包解压到自定义路径 </p><ul><li>D:\Program Files\MongoDB\Server\3.2</li><li>或将msi安装软件安装到自定义路径 D:\Program Files\MongoDB\Server\3.2</li></ul><p>(2)在monggodb安装路径下新建data文件夹 </p><ul><li>D:\Program Files\MongoDB\Server\3.2\data</li></ul><p>(3)在data文件夹下新建db和log两个文件夹</p><ul><li>D:\Program Files\MongoDB\Server\3.2\data\db`</li><li>D:\Program Files\MongoDB\Server\3.2\data\log`</li></ul><p>(4)在log文件夹下新建日志文件MongoDB.log</p><ul><li>D:\Program Files\MongoDB\Server\3.2\data\log\MongoDB.log</li></ul><p>(5)管理员方式打开cmd，进入到mongodb安装路径的\bin目录下，输入命令安装<br><code>D:\Program Files\MongoDB\Server\3.2\bin&gt;mongod --dbpath &quot;D:\Program Files\MongoDB\Server\3.2\data\db&quot; --logpath &quot;D:\Program Files\MongoDB\Server\3.2\data\log\MongoDB.log&quot; --install --serviceName &quot;MongoDB&quot;</code></p><p>(6)安装完成后，手动启动MongoDB服务，浏览器打开<a href="http://localhost:27017/" target="_blank" rel="noopener">http://localhost:27017/</a></p><p>(7)cmd使用monggodb数据库，输入命令<code>mongo</code></p></blockquote><h2 id="三、windows32位安装"><a href="#三、windows32位安装" class="headerlink" title="三、windows32位安装"></a>三、windows32位安装</h2><blockquote><p>(1)32位安装过程和64位大致相同，但是安装后一般会碰到几个异常：</p><ul><li>安装服务报这个错误：32-bit servers don’t have journaling enabled by default. Please use –journal if you want durability.</li><li>32位的mongodb数据库存储引擎只能是：mmapv1</li></ul><p>(2)综上，32位的安装命令需要添加–journal选项和指定存储引擎mmapv1<br><code>D:\Program Files\MongoDB\Server\3.2\bin&gt;mongod --dbpath &quot;D:\Program Files\MongoDB\Server\3.2\data\db&quot; --logpath &quot;D:\Program Files\MongoDB\Server\3.2\data\log\MongoDB.log&quot; --install --serviceName &quot;MongoDB&quot; --journal --storageEngine=mmapv1</code></p><p>(3)cmd输入命令<code>net start MongoDB</code>启动服务。然后连接到mongodb数据库，输入命令<code>mongo</code></p><p>(4)如果启动mongodb服务时提示“发生服务特定错误100”：<br>在mongodb安装路径的data目录下两个文件mongod.lock和storage.bson，一般删除mongod.lock重启服务就好了。如果还提示“发生服务特定错误100”，就把storage.bson一起删掉再重启服务。</p></blockquote><h2 id="四、Robomongo可视化客户端"><a href="#四、Robomongo可视化客户端" class="headerlink" title="四、Robomongo可视化客户端"></a>四、Robomongo可视化客户端</h2><p>64位下载地址：<a href="https://robomongo.org/download" target="_blank" rel="noopener">https://robomongo.org/download</a><br>32位下载地址：<a href="http://pan.baidu.com/s/1c02GmHE" target="_blank" rel="noopener">http://pan.baidu.com/s/1c02GmHE</a> （只找到一个百度网盘的）</p><h1 id="持续更新…"><a href="#持续更新…" class="headerlink" title="持续更新…"></a><em>持续更新…</em></h1>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;崔庆才老师爬虫的学习笔记。&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="爬虫" scheme="http://pythonfood.github.io/categories/%E7%88%AC%E8%99%AB/"/>
    
    
      <category term="爬虫" scheme="http://pythonfood.github.io/tags/%E7%88%AC%E8%99%AB/"/>
    
  </entry>
  
  <entry>
    <title>爬虫-anaconda配置</title>
    <link href="http://pythonfood.github.io/2018/07/01/%E7%88%AC%E8%99%AB-anaconda%E9%85%8D%E7%BD%AE/"/>
    <id>http://pythonfood.github.io/2018/07/01/爬虫-anaconda配置/</id>
    <published>2018-07-01T01:00:00.000Z</published>
    <updated>2018-08-14T07:39:15.229Z</updated>
    
    <content type="html"><![CDATA[<p>崔庆才老师爬虫的学习笔记。<br><a id="more"></a></p><h2 id="一、anaconda安装"><a href="#一、anaconda安装" class="headerlink" title="一、anaconda安装"></a>一、anaconda安装</h2><p><strong>1、国内镜像站</strong></p><p><a href="https://mirrors.tuna.tsinghua.edu.cn/anaconda/archive/" target="_blank" rel="noopener">https://mirrors.tuna.tsinghua.edu.cn/anaconda/archive/</a></p><p><strong>2、配置环境变量</strong></p><p>D:\Program Files\Anaconda3<br>D:\Program Files\Anaconda3\Scripts<br>D:\Program Files\Anaconda3\Library\bin<br>D:\Program Files\Anaconda3\Library\usr\bin<br>D:\Program Files\Anaconda3\Library\mingw-w64\bin</p><h2 id="二、解决python多版本"><a href="#二、解决python多版本" class="headerlink" title="二、解决python多版本"></a>二、解决python多版本</h2><p><strong>1、修改python3</strong></p><p>python3安装路径下，复制python.exe为python3.exe。<br>python3安装路径的\Scripts目录下，复制pip.exe为pip3.exe。</p><p><strong>2、修改anaconda</strong></p><p>ananconda安装路径下，复制python.exe为python-conda.exe。<br>ananconda安装路径的\Scripts目录下，复制pip.exe为pip-conda.exe。<br>ananconda安装路径的\Scripts目录下，复制pip-script.py为pip-conda-script.py。</p><p><strong>3、验证多版本设置</strong><br>cmd输入命令<code>python3</code>，进入python3的交互界面。<br>cmd输入命令<code>pip3 list</code>，显示python3下安装的库。<br>cmd输入命令<code>python-conda</code>，进入anaconda下python的交互界面。<br>cmd输入命令<code>pip-conda list</code>，显示anaconda下安装的库。</p><p><strong>4、默认python设置</strong></p><p>python3和anaconda的环境变量，谁在前谁就是默认的python。<br>例如python3的环境变量在anaconda之前，则cmd输入<code>python</code>，进入python3的交互界面。</p><h2 id="三、jupyter编辑器"><a href="#三、jupyter编辑器" class="headerlink" title="三、jupyter编辑器"></a>三、jupyter编辑器</h2><p><strong>1、运行jupyter</strong></p><p>cmd输入命令<code>jupyter notebook</code>,会自动打开浏览器<a href="http://localhost:8888/tree" target="_blank" rel="noopener">http://localhost:8888/tree</a></p><p><strong>2、修改保存路径</strong></p><p>(1)cmd输入命令<code>jupyter notebook --generate-config</code>生成配置文件。<br>(2)根据提示找到文件路径C:\Users\tester.jupyter\jupyter_notebook_config.py<br>(3)打开配置文件，找到jupyter默认路径这行#c.NotebookApp.notebook_dir = ‘’<br>(4)去掉#号，修改默认路径为c.NotebookApp.notebook_dir = ‘D:\JupyterProjects’</p><h1 id="持续更新…"><a href="#持续更新…" class="headerlink" title="持续更新…"></a><em>持续更新…</em></h1>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;崔庆才老师爬虫的学习笔记。&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="爬虫" scheme="http://pythonfood.github.io/categories/%E7%88%AC%E8%99%AB/"/>
    
    
      <category term="爬虫" scheme="http://pythonfood.github.io/tags/%E7%88%AC%E8%99%AB/"/>
    
  </entry>
  
  <entry>
    <title>django-签到系统</title>
    <link href="http://pythonfood.github.io/2018/06/01/django-%E7%AD%BE%E5%88%B0%E7%B3%BB%E7%BB%9F/"/>
    <id>http://pythonfood.github.io/2018/06/01/django-签到系统/</id>
    <published>2018-06-01T01:00:00.000Z</published>
    <updated>2018-08-14T07:38:53.499Z</updated>
    
    <content type="html"><![CDATA[<p>虫师所写django签到系统的学习笔记。<br><a id="more"></a></p><h2 id="一、Hello-Django"><a href="#一、Hello-Django" class="headerlink" title="一、Hello Django"></a>一、Hello Django</h2><p><strong>1、查看django命令</strong></p><p>D:> <code>django-admin</code></p><p><strong>2、创建项目</strong></p><p>D:> <code>django-admin startproject guest</code></p><blockquote><ul><li>guest/<ul><li>guest/<ul><li>__init__.py：一个空的文件，用它标识一个目录为 Python 的标准包。</li><li>settings.py：Django 项目的配置文件，包括 Django 模块应用配置，数据库配置，模板配置等。</li><li>urls.py：Django 项目的 URL 声明。</li><li>wsgi.py：为 WSGI 兼容的 Web 服务器服务项目的切入点。</li></ul></li><li>manage.py：一个命令行工具，可以让你在使用 Django 项目时以不同的方式进行交互。</li></ul></li></ul></blockquote><p><strong>3、查看 manage 所提供的命令</strong></p><p>D:\guest&gt; <code>python manage.py</code></p><p><strong>4、创建应用</strong></p><p>D:\guest&gt; <code>python manage.py startapp sign</code></p><blockquote><ul><li>guest/<ul><li>sign/<ul><li>migrations/：用于记录 models 中数据的变更。</li><li>admin.py：映射 models 中的数据到 Django 自带的 admin 后台。</li><li>apps.py：在新的 Django 版本中新增，用于应用程序的配置。</li><li>models.py：创建应用程序数据表模型（对应数据库的相关操作）。</li><li>tests.py：创建 Django 测试。</li><li>views.py：控制向前端显示哪些数据。</li></ul></li></ul></li></ul></blockquote><p><strong>5、运行项目</strong></p><blockquote><p>D:\guest&gt; <code>python manage.py runserver</code></p><p>默认8000端口启动项目，也可以指定IP和端口：D:\guest&gt; <code>python manage.py runserver 127.0.0.1:8001</code></p></blockquote><p><strong>6、使用视图显示 Hello Django</strong></p><blockquote><p>(1)首先配置 guest/guest/settings.py ，将 sign 应用添加到项目中。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS = [</span><br><span class="line">...</span><br><span class="line"><span class="string">'sign'</span>,  <span class="comment"># 添加sign应用</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure></p><p>(2)再配置 guest/guest/urls.py ，添加 index/ 目录。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.conf.urls <span class="keyword">import</span> url, include  <span class="comment"># url控制需要导入</span></span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">path(<span class="string">'admin/'</span>, admin.site.urls),</span><br><span class="line">url(<span class="string">r'^index/$'</span>, views.index),   <span class="comment"># 添加 index/ 路径配置</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure></p><p>(3)接着编辑 guest/sign/views.py ，创建 index() 视图函数。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(request)</span>:</span></span><br><span class="line"><span class="keyword">return</span> HttpResponse(<span class="string">'Hello Django'</span>)</span><br></pre></td></tr></table></figure></p><p>(4)运行项目，访问127.0.0.1:8000，即可显示’Hello Django’。</p></blockquote><p><strong>7、使用模板显示 Hello Django</strong></p><blockquote><p>(1)在应用 guest/sign/ 目录下，创建 templates/index.html 。（注意需要创建templates目录）<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Django Page<span class="tag">&lt;/<span class="name">title</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello Django<span class="tag">&lt;/<span class="name">h1</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>(2)编辑 guest/sign/views.py，用 index() 视图函数返回 index.html。（注意html文件路径不需要写templates）<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(request)</span>:</span></span><br><span class="line"><span class="keyword">return</span> render(request, <span class="string">'index.html'</span>)  <span class="comment"># 这里抛弃 HttpResponse 类，转而使用 Django 的 render 函数</span></span><br></pre></td></tr></table></figure></p><p>(3)运行项目，访问127.0.0.1:8000，即可显示’Hello Django’。</p></blockquote><p><strong>8、MTV模式</strong></p><blockquote><p>(1)首先理解 Model-View-Controller（MVC）模式：数据存取逻辑、表现逻辑、业务逻辑。</p><p>(2)由于 Controller 由框架自行处理，而 Django 里更关注的是模型（Model）、模板(Template)和视图（Views）， Django 也被称为 MTV 框架 ：</p><ul><li>M（Model），即数据存取层。该层处理与数据相关的所有事务： 如何存取、如何验证有效。</li><li>T（Template），即表现层。该层处理与表现相关的决定： 如何在页面或其他类型文档中进行显示。</li><li>V（View），即业务逻辑层。该层包含存取模型及调取恰当模板的相关逻辑。 你可以把它看作模型与模板之间的桥梁。</li></ul></blockquote><h2 id="二、Views-视图"><a href="#二、Views-视图" class="headerlink" title="二、Views 视图"></a>二、Views 视图</h2><p><strong>1、写个简单的登录</strong></p><blockquote><p>(1)…/templates/index.html编写登录表单代码代码。表单方法使用 method=”post”，提交路径为  action=”/login_action/“。<br>(2)注意页面需要添加跨站请求伪造（ CSRF）令牌，在Html表单中使用Django模板标签：<code>{</code>% csrf_token %<code>}</code><br>(3)打开 …/guest/urls.py 文件添加 login_action/的路由。<br>(4)打开 …/sign/views.py 文件，创建 login_action 视图函数。<br>(5)在 …/templates/index.html 页面中添加 Django 模板：。<br>(6)刷新网页，填入账号密码，验证效果。</p></blockquote><p><strong>2、添加登录成功页</strong></p><blockquote><p>(1)首先创建 …/templates/event_manage.html 页面，编写html代码。<br>(2)修改 …/sign/views.py 中的 login_action 函数，登录成功后重定向到 /event_manage/ 路径。<br>(3)在 …/guest/urls.py 文件中添加路径 event_manage/的路由：views.event_manage。<br>(4)在 …/sign/views.py 中添加event_manage视图函数，返回event_manage.html。</p></blockquote><p><strong>3、Cookie 的使用</strong></p><blockquote><p>(1)修改…/sign/views.py 文件login_action函数设置cookie：<code>response.set_cookie(&#39;user&#39;, username)</code><br>(2)修改…/sign/views.py 文件 event_manage函数获取cookie： <code>request.COOKIES.get(&#39;user&#39;, &#39;&#39;, 3600)</code><br>(3)修改…/templates/event_manage.html 页面，添加<div>标签来显示用户登录的用户名。</div></p></blockquote><p><strong>4、Session 的使用</strong></p><blockquote><p>(1)修改…/sign/views.py文件，在 login_action 函数中将 session 信息记录到浏览器：<code>request.session[&#39;user&#39;]=username</code> 。<br>(2)修改…/sign/views.py文件，在 event_manage 函数中读取浏览器 session：<code>username=request.session.get(&#39;user&#39;,&#39;&#39;)</code> 。<br>(3)既然要服务器端记录用户的数据，需要创建 django_session 表，不过Django已经准备好了，我们需要生成他们，进行数据迁移：D:\guest&gt; <code>python3 manage.py migrate</code> </p></blockquote><p><strong>5、登录 Admin 后台</strong></p><blockquote><p>执行 manage.py 的“migrate”命令时，Django 同时也帮我们生成了 auth_user 表。同时，我们可以通过 URL 地址：<a href="http://127.0.0.1:8000/admin/" target="_blank" rel="noopener">http://127.0.0.1:8000/admin/</a> 来访问 Django 自带的 Admin 管理后台。在此之前,先来创建登录 Admin 后台的管理员账号：</p><ul><li>D:\guest&gt; <code>python3 manage.py createsuperuser</code></li><li>Username (leave blank to use ‘fnngj’): <code>admin</code> #输入用户名 </li><li>Email address: <code>admin@mail.com</code> #输入邮箱 </li><li>Password: <code>admin123456</code> #输入密码 </li><li>Password (again): <code>admin123456</code> #重复输入密码 </li></ul></blockquote><p><strong>6、引用 Django 认证登录</strong></p><blockquote><p>(1)打开…/sign/views.py 文件修改 login_action 函数，认证给出的用户名和密码：<code>user = auth.authenticate(username=username, password=password)</code><br>(2)通过 if 语句判断 authenticate()返回（即user）如果不为 None，说明用户认证通过。<br>(3)来调用 login()函数进行 登录：<code>auth.login(request, user)</code> </p></blockquote><p><strong>7、关上窗户</strong></p><blockquote><p>(1)直接访问：<a href="http://127.0.0.1:8000/event_manage/，" target="_blank" rel="noopener">http://127.0.0.1:8000/event_manage/，</a> 我们不需要通过登录也可以直接访问到登录成功的页面。我们要把这些“窗户”都关上，使用户只能通过登录来访问系统：</p><ul><li>如果想限制某个视图函数必须登录才能访问，只需要在这个函数的前面加上： <code>@login_required</code> 。</li></ul><p>(2)仔细看，会发布在访问被@login_required 装饰的视图时，默认会跳转的 URL 中会包含 “/accounts/login/”，为什么不让它直接跳转到登录页面呢？不但要告诉你窗户是关着的，还要帮你指引到门的位置：</p><ul><li>修改…/urls.py 文件，添加以下路径：url(r’^accounts/login/$’, views.index)。</li><li>当用户访问：<a href="http://127.0.0.1:8000/" target="_blank" rel="noopener">http://127.0.0.1:8000/</a> 、 <a href="http://127.0.0.1:8000/index/" target="_blank" rel="noopener">http://127.0.0.1:8000/index/</a> 、 <a href="http://127.0.0.1:8000/event_manage/" target="_blank" rel="noopener">http://127.0.0.1:8000/event_manage/</a> ，都会跳转到登录页面。</li></ul></blockquote><h2 id="三、Model-模型"><a href="#三、Model-模型" class="headerlink" title="三、Model 模型"></a>三、Model 模型</h2><p><strong>1、设计系统表</strong></p><blockquote><p>Django 提供完善的模型（model）层主要用来创建和存取数据，不需要我们直接对数据库操作。每个模型是一个 Python 类，继承 django.db.models.model 类。该模型的每个属性表示一个数据库表字段。</p><p>(1)打开…/sign/models.py 文件，完成表的创建。<br>(2)进行数据库迁移：</p><ul><li>D:\guest&gt; <code>python3 manage.py makemigrations sign</code> </li><li>D:\guest&gt; <code>python3 manage.py migrate</code></li></ul></blockquote><p><strong>2、admin 后台管理</strong></p><blockquote><p>创建的发布会和嘉宾表 同样可以通过 Admin 后台去管理：</p><ul><li>打开…/sign/admin.py 文件，通知 admin 管理工具为这些模块逐一提供界面：<code>admin.site.register()</code>。</li><li>打开…/sign/admin.py 文件，定义 list_display 要在列表中显示哪些字段，当然，这些字段名称必须是模型中的数据表类中定义的。</li><li>打开…/sign/admin.py 文件，search_fields 创建表字段的搜索器，设置搜索关键字匹配多个表字段。 list_filter 用于创建字段过滤器。</li></ul></blockquote><p><strong>3、基本数据访问</strong></p><ul><li><code>python manage.py shell</code>  # dos下进入django的shell模式</li><li><code>from sign.models import Event,Guest</code>  </li><li><code>table.objects.all()</code>  # 获得 table（Event、Gues 表）中的所有对象</li><li><code>quit()</code>  # 退出shell</li></ul><blockquote><p>(1)插入数据<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime  </span><br><span class="line">e1 = Event(id=<span class="number">2</span>,name=<span class="string">'红米 Pro 发布会'</span>,limit=<span class="number">2000</span>,status=<span class="keyword">True</span>,address=<span class="string">'北京水立方'</span>,start_time=datetime(<span class="number">2016</span>,<span class="number">8</span>,<span class="number">10</span>,<span class="number">14</span>,<span class="number">0</span>,<span class="number">0</span>))   </span><br><span class="line">e1.save()</span><br></pre></td></tr></table></figure></p><p>ps：修改 settings.py 文件保存后，需要执行 quit() 命令退出 shell 模式，并重新执行 Python3 manage.py shell 进入，刚才的设置才会生效。<br>也可以通过 table.objects.create()方法将两步合为一步：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Event.objects.create(id=<span class="number">3</span>,name=<span class="string">'红米 MAX发布会'</span>,limit=<span class="number">2000</span>,status=<span class="keyword">True</span>, address=<span class="string">'北京会展中心'</span>,start_time=datetime(<span class="number">2016</span>,<span class="number">9</span>,<span class="number">22</span>,<span class="number">14</span>,<span class="number">0</span>,<span class="number">0</span>)) &lt;Event: 红米MAX发布会&gt; </span><br><span class="line">Guest.objects.create(realname=<span class="string">'andy'</span>,phone=<span class="number">13611001101</span>,email= <span class="string">'andy@mail.com'</span>,sign=<span class="keyword">False</span>,event_id=<span class="number">3</span>)</span><br></pre></td></tr></table></figure></p><p>(2)查询数据<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">table.objects.get()  <span class="comment"># 从数据库表中取得一条匹配的结果，返回一个对象，如果记录不存在的话，那么它会报DoesNotExist类型错误：</span></span><br><span class="line">e1 = Event.objects.get(name=<span class="string">'红米MAX发布会'</span>) </span><br><span class="line">e1</span><br><span class="line">e1.address</span><br><span class="line"></span><br><span class="line">table.objects.filter()  <span class="comment"># 方法是从数据库的取得匹配的结果，返回一个对象列表，如果记录不存在的话，它会返回[]：</span></span><br><span class="line">e2 = Event.objects.filter(name__contains=<span class="string">'发布会'</span>) </span><br><span class="line">e2</span><br></pre></td></tr></table></figure></p><p>(3)删除数据<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#通过 delete()方法删除：</span></span><br><span class="line">g2 = Guest.objects.get(phone=<span class="string">'13611001101'</span>) </span><br><span class="line">g2.delete()</span><br></pre></td></tr></table></figure></p><p>(4)更新数据<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">g3=Guest.objects.get(phone=<span class="string">'13611001101'</span>) </span><br><span class="line">g3.realname=<span class="string">'andy2'</span> </span><br><span class="line">g3.save()</span><br></pre></td></tr></table></figure></p></blockquote><p><strong>4、配置 MySQL</strong></p><blockquote><p>(1)要在…/guest/settings.py 文件中修改数据库相关配置。<br>(2)安装pymysql库。<br>(3)创建数据库。<br>(4)切换了数据库后，之前 Sqlite3 数据库里的数据并不能复制到 MySQL 中，所以需要重新进行数据库同步，使数据模型重新在 MySQL 数据库中生成表：D:\guest&gt; <code>python manage.py migrate</code><br>(5)直接进行数据迁移会报错！这是因为Django 在连接 MySQL 数据库时默认使用的是 MySQLdb 驱动，然而我们没有安装该驱动，因为它并不支持 Python3，我们现在安装的是 PyMySQL 驱动，如何让当前的 Django 通过 PyMySQL 来连接 MySQL 数据库呢？方法很简单，在…/guest/__init__.py 目录下添加：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line">pymysql.install_as_MySQLdb()</span><br><span class="line"><span class="comment">#添加完后，再执行数据迁移命令。</span></span><br></pre></td></tr></table></figure></p><p>(6) 因为更换了数据库，所以，Admin 后台超级管理员账号（admin/admin123456）也需要重新创建：  </p><ul><li>D:\guest&gt; <code>python3 manage.py createsuperuser</code></li><li>Username (leave blank to use ‘fnngj’): <code>admin</code> #输入用户名 </li><li>Email address: <code>admin@mail.com</code> #输入邮箱 </li><li>Password: <code>admin123456</code> #输入密码 </li><li>Password (again): <code>admin123456</code> #重复输入密码 </li></ul></blockquote><h2 id="四、Template-模板"><a href="#四、Template-模板" class="headerlink" title="四、Template 模板"></a>四、Template 模板</h2><p><strong>1、Django-bootstrap3</strong></p><blockquote><p>(1)安装 <code>pip install django-bootstrap3</code><br>(2)在…/guest/settings.py 文件中添加 bootstrap3 应用。</p></blockquote><p><strong>2、发布会管理</strong></p><blockquote><p>(1)打开…/sign/views.py 文件，修改 event_manage()视图函数：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">event_list = Event.objects.all()  <span class="comment"># 从数据库查询所有发布会</span></span><br><span class="line"><span class="keyword">return</span> render(request,<span class="string">"event_manage.html"</span>,&#123;<span class="string">"user"</span>: username, <span class="string">"events"</span>:event_list&#125;)  <span class="comment"># 将发布会列表返回给前端</span></span><br></pre></td></tr></table></figure></p><p>(2)打开并编写…/templates/event_manage.html 页面：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- &lt;head&gt;中引入bootstrap：--&gt;</span></span><br><span class="line">&#123;% load bootstrap3 %&#125; </span><br><span class="line">&#123;% bootstrap_css %&#125;</span><br><span class="line">&#123;% bootstrap_javascript %&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- &lt;body&gt;中遍历显示出所有发布会列表：--&gt;</span></span><br><span class="line">&#123;% for event in events %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; event.id &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; event.name &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; event.status &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; event.address &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; event.start_time &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span> </span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure></p><p>(3)在…/templates/event_manage.html 页面上创建搜索表单。<br>(4)在…/guest/urls.py 文件中添加搜索路径的路由：<code>url(r&#39;^search_name/$&#39;, views.search_name)</code><br>(5)打开…/sign/views.py 文件，创建 search_name()视图函数。</p></blockquote><p><strong>3、嘉宾管理</strong></p><blockquote><p>(1)创建…/templates/guest_manage.html 页面：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;% for guest in guests %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; guest.id &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; guest.realname &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; guest.phone &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; guest.email &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; guest.sign &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; guest.event &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span> </span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure></p><p>(2)在…/guest/urls.py 文件中添加嘉宾路径的路由。<br>(3)打开…/sign/views.py 文件，创建 guest_manage()视图函数。</p></blockquote><p><strong>4、分页器 Paginator</strong></p><p>Django 已经为我们准备好了 Paginator 分页类。所以，只需要调用它即可完成列表的分页功能，进入 Django 的 shell 模式，练习 Paginator 类的基本使用:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">D:\guest&gt; python3 manage.py shell</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> django.core.paginator <span class="keyword">import</span> Paginator</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> sign.models <span class="keyword">import</span> Guest</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>guest_list = Guest.objects.all()  <span class="comment"># 查询 uest 表的所有数据</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p = Paginator(guest_list, <span class="number">2</span>)  <span class="comment"># 创建每页 2 条数据的分页器 </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p.count  <span class="comment"># 查看共多少条数据</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p.page_range  <span class="comment"># 查看共分多少页 </span></span><br><span class="line"></span><br><span class="line"><span class="comment">##########第一页#############</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>page1 = p.page(<span class="number">1</span>)  <span class="comment"># 获取第 1 页的数据</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>page1  <span class="comment"># 当前第几页  </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>page1.object_list  <span class="comment"># 当前页的对象 </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> p <span class="keyword">in</span> page1:  <span class="comment"># 循环打印第 1 页嘉宾的 realname </span></span><br><span class="line"><span class="meta">... </span>p.realname</span><br><span class="line"></span><br><span class="line"><span class="comment">##########第二页#############</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>page2 = p.page(<span class="number">2</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>page2.start_index()  <span class="comment"># 本页的第一条数据 </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>page2.end_index()  <span class="comment"># 本页的最后一条数据 </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>page2.has_previous()  <span class="comment"># 是否有上一页 </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>page2.has_next()  <span class="comment"># 是否有下一页</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>page2.previous_page_number()  <span class="comment"># 上一页是第几页</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>page2.next_page_number()  <span class="comment"># 下一页是第几页  </span></span><br><span class="line"></span><br><span class="line"><span class="comment">##########第三页#############</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>page3 = p.page(<span class="number">3</span>) </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>page3.has_other_pages()  <span class="comment"># 是否有其他页</span></span><br></pre></td></tr></table></figure></p><blockquote><p>(1)打开…/sign/views.py 文件，修改 guest_manage()视图函数。<br>(2)在…/templates/guest_manage.html 页面也需要添加分页器的代码。</p></blockquote><p><strong>5、签到功能</strong></p><blockquote><p>(1)在…/templates/event_manage.html 页面，增加签到列链接。<br>(2)在…/guest/urls.py 文件中添加路径路由。<br>(3)打开…/sign/views.py 文件，创建 sign_index()视图函数。<br>(4)创建…/templates/sign_index.html 签到页面。<br>(5)打开…/guest/urls.py 文件，添加签到路径的路由。<br>(6)打开…/sign/views.py 文件，创建 sign_index_action()视图函数。<br>(7)修改…/templates/sign_index.html 页面，增加 sign_index_action()视图函数返回的提示信息的位置：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">font</span> <span class="attr">color</span>=<span class="string">"red"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>&gt;</span>&#123;&#123; hint &#125;&#125; </span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>&gt;</span>&#123;&#123; guest.realname &#125;&#125; </span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>&gt;</span>&#123;&#123; guest.phone &#125;&#125; </span><br><span class="line"><span class="tag">&lt;/<span class="name">font</span>&gt;</span></span><br></pre></td></tr></table></figure></p></blockquote><p><strong>6、退出系统</strong></p><blockquote><p>(1)打开…/urls.py 文件，添加退出目录的路由。<br>(2)打开…/sign/views.py 文件，创建 logout()视图函数：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">auth.logout(request) <span class="comment">#退出登录 </span></span><br><span class="line">response = HttpResponseRedirect(<span class="string">'/index/'</span>) </span><br><span class="line"><span class="keyword">return</span> response</span><br></pre></td></tr></table></figure></p></blockquote><h2 id="五、开发-Web-接口"><a href="#五、开发-Web-接口" class="headerlink" title="五、开发 Web 接口"></a>五、开发 Web 接口</h2><p>首先，单独创建…/sign/views_if.py文件，该项目的接口方法都在这里。</p><p><strong>1、发布会添加接口</strong></p><blockquote><p>(1)首先，判断 eid、 name、limit、address、start_time 等字段均不能为空，否则 JsonResponse()返回相应的 状态码和提示。<br>(2)接下来，判断发布会 id 是否存在，以及发布会名称（name）是否存在；如果存在将返回相应的状态码和 提示信息。<br>(3)再接下来，判断发布会状态是否为空，如果为空，将状态设置为 1（True）。<br>(4)最后，将数据插入到 Event 表，在插入的过程中如果日期格式错误，将抛出 ValidationError 异常，接收 该异常并返回相应的状态和提示，否则，插入成功，返回状态码 200 和“addeventsuccess”的提示。</p></blockquote><p><strong>2、发布会查询接口</strong></p><blockquote><p>(1)通过GET请求接收发布会id和name参数。两个参数都是可选的。首先，判断当两个参数同时为空，接 口返回状态码 10021，参数错误。<br>(2)如果发布会 id 不为空，优先通过 id 查询，因为 id 的唯一性，所以，查询结果只会有一条，将查询结果 以 key:value 对的方式存放到定义的 event 字典中，并将数据字典作为整个返回字典中 data 对应的值返回。<br>(3)name 查询为模糊查询，查询数据可能会有多条，返回的数据稍显复杂；首先将查询的每一条数据放到一 个字典 event 中，再把每一个字典再放到数组 datas 中，最后再将整个数组做为返回字典中 data 对应的值返回。</p></blockquote><p><strong>3、嘉宾添加接口</strong></p><blockquote><p>(1)通过POST请求接收嘉宾参数：关联的发布会id、姓名、手机号和邮箱等参数。<br>(2)首先，判断 eid、realname、phone 等参数均不能为空。<br>(3)接下来，判断嘉宾关联的发布会 id 是否存在，以及关联的发布会状态是否为 True（即 1），如果不存在 或不为 True，将返回相应的状态码和提示信息。<br>(4)接下来判断发布会人数限制。<br>(5)再接下来的步骤是判断当前时间是否大于发布会时间，如果大于则说明发布已开始，或者早已经结束。那么该发布会就应该不能允许再添加嘉宾。<br>(6)最后，插入嘉宾数据，如果发布会的手机号重复则抛 IntegrityError 异常，接收该异常并返回相应的状态 码和提示信息。如果添加成功，则返回状态码 200 和“addguestsuccess”的提示。</p></blockquote><p><strong>4、嘉宾查询接口</strong></p><p>嘉宾查询接口与发布会查询接口相似，只是参数与查询条件判断有所不同，这里就不再一一说明。</p><p><strong>5、嘉宾签到接口</strong></p><blockquote><p>(1)签到接口通过POST请求接收发布会id和嘉宾手机号。签到接口的判断条件比较多。<br>(2)首先，判断两个参数均不能为空。<br>(3)接着，判断发布会 id 是否存在，以及发布会状态是否为 True，如果不存在或不为 True，将返回相应的状 态码和提示信息。<br>(4)再接着，判断当前时间是否大于发布会时间，如果大于发布会时间说明发布会已开始，不允许签到。<br>(5)然后，再判断嘉宾的手机号是否存在，以及嘉宾的手机号与发布会 id 是否为对应关系。否则返回相应的 错误码和提示信息。<br>(6)最后，判断该嘉宾的状态是否为已签到，如果已签到，返回相应的状态码和提示；如果未签到修改状态 为已签到，并返回状态码 200 和“signsuccess”的提示。</p></blockquote><p><strong>6、配置接口路径</strong></p><blockquote><p>(1)打开…/guest/urls.py文件，添加接口基本路径“/api/”：<code>url(r&#39;^api/&#39;, include(&#39;sign.urls&#39;, namespace=&quot;sign&quot;))</code><br>(2)创建…/sign/urls.py文件，配置具体接口的二级路径：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">app_name=<span class="string">'sign'</span>  <span class="comment"># django2.0里必须添加应用名称</span></span><br><span class="line">urlpatterns = [</span><br><span class="line"><span class="comment"># guest system interface: </span></span><br><span class="line"><span class="comment"># ex : /api/add_event/</span></span><br><span class="line">url(<span class="string">r'^add_event/'</span>, views_if.add_event, name=<span class="string">'add_event'</span>),</span><br><span class="line"><span class="comment"># ex : /api/add_guest/ </span></span><br><span class="line">url(<span class="string">r'^add_guest/'</span>, views_if.add_guest, name=<span class="string">'add_guest'</span>), </span><br><span class="line"><span class="comment"># ex : /api/get_event_list/ </span></span><br><span class="line">url(<span class="string">r'^get_event_list/'</span>, views_if.get_event_list, name=<span class="string">'get_event_list'</span>), </span><br><span class="line"><span class="comment"># ex : /api/get_guest_list/ </span></span><br><span class="line">url(<span class="string">r'^get_guest_list/'</span>, views_if.get_guest_list, name=<span class="string">'get_guest_list'</span>), </span><br><span class="line"><span class="comment"># ex : /api/user_sign/ </span></span><br><span class="line">url(<span class="string">r'^user_sign/'</span>, views_if.user_sign, name=<span class="string">'user_sign'</span>),</span><br><span class="line">]</span><br></pre></td></tr></table></figure></p></blockquote><p><strong>7、编写 Web 接口文档</strong></p><h2 id="六、接口的安全机制"><a href="#六、接口的安全机制" class="headerlink" title="六、接口的安全机制"></a>六、接口的安全机制</h2><p><strong>1、用户认证</strong></p><blockquote><p>(1)重新创建…/sign/views_if_sec.py 视图文件，添加用户认证函数。<br>(2)增加发布会查询接口函数，函数首先调用用户认证函数，进行用户认证。<br>(3)在…/sign/urls.py 文件中添加新的安全接口指向：<code>url(r&#39;^sec_get_event_list/&#39;, views_if_sec.get_event_list, name=&#39;get_event_list&#39;)</code></p></blockquote><p><strong>2、数字签名</strong></p><p>在使用 HTTP/SOAP 协议传输数据的时候，签名作为其中一个参数，可以起到关键作用：</p><p>1)鉴权：通过客户的密钥，服务端的密钥匹配：</p><ul><li>例如一个接口传参为：<a href="http://127.0.0.1:8000/api/?a=1&amp;b=2" target="_blank" rel="noopener">http://127.0.0.1:8000/api/?a=1&amp;b=2</a></li><li>假设签名的密钥为：@admin123</li><li>加上签名之后的接口参数为：<a href="http://127.0.0.1:8000/sign/?a=1&amp;b=2&amp;sign=@admin123" target="_blank" rel="noopener">http://127.0.0.1:8000/sign/?a=1&amp;b=2&amp;sign=@admin123</a></li><li>sign 参数明文传输是不安全的，一般会通过加密算法进行加密, “@admin123” 经过 MD5 加密得到：4b9db269c5f978e1264480b0a7619eea</li><li>单做为鉴权，带签名的接口为：<a href="http://127.0.0.1:8000/sign/?a=1&amp;b=2&amp;sign=4b9db269c5f978e1264480b0a7619eea" target="_blank" rel="noopener">http://127.0.0.1:8000/sign/?a=1&amp;b=2&amp;sign=4b9db269c5f978e1264480b0a7619eea</a></li><li>服务器接收到请求后，同样需要对“@admin123”进行 MD5 加密，比对与传来的 sign 加密串是否一致，从而来鉴别调用者是否有权限方位该接口。</li></ul><p>2)数据防篡改：参数是明文传输，将参数及密钥加密作为签名与服务器匹配：</p><ul><li>同样是这样一个带参数的接口：<a href="http://127.0.0.1:8000/api/?a=1&amp;b=2" target="_blank" rel="noopener">http://127.0.0.1:8000/api/?a=1&amp;b=2</a></li><li>假设签名的密钥为：@admin123</li><li>签名的明文为：a=1&amp;b=2&amp;api_key=@admin123</li><li>将签名的明文生成 MD5 加密串：786bfe32ae1d3764f208e03ca0bfaf13</li><li>带参数的接口串为：<a href="http://127.0.0.1:8000/sign/?a=1&amp;b=2&amp;sign=786bfe32ae1d3764f208e03ca0bfaf13" target="_blank" rel="noopener">http://127.0.0.1:8000/sign/?a=1&amp;b=2&amp;sign=786bfe32ae1d3764f208e03ca0bfaf13</a></li><li>因为整个接口的参数做了加密，所以，只要任意一个参数发改变，那签名的验证就会失败。从而起到了鉴权及数据完整性的保护。</li></ul><blockquote><p>(1)打开…/sign/views_if_sec.py 视图文件，添加用户签名函数。<br>(2)增加添加发布会接口函数，函数首先调用用户签名函数，进行签名验证。<br>(3)在…/sign/urls.py 文件中添加新的安全接口路由：<code>url(r&#39;sec_add_event/&#39;, views_if_sec.add_event, name=&#39;add_event&#39;)</code></p></blockquote><p><strong>3、接口加密</strong></p><p>PyCrypto 是一个免费的加密算法库，支持常见的 DES、AES 加密以及 MD5、SHA 各种 HASH 运算。<br>安装PyCryoto库： <code>pip install Crypto</code></p><blockquote><p>(1)客户端请求接口时，进行了AES加密，在服务端需要进行解密验证。代码详见虫师原文地址。<br>(2)打开…/sign/views_if_sec.py 视图文件，编写解密函数。<br>(3)在获取嘉宾例表的接口中调用 aes_encryption()函数进行 AES 加密字符串解密。<br>(4)在…/sign/urls.py 文件中添加新的安全接口指向：<code>url(r&#39;^sec_get_guest_list/&#39;, views_if_sec.get_guest_list, name=&#39;get_guest_list&#39;)</code></p></blockquote><h2 id="七、REST-API"><a href="#七、REST-API" class="headerlink" title="七、REST API"></a>七、REST API</h2><p>REST（即 RepresentationalStateTransfer 的缩写）中文翻译为“表现层状态转化”：</p><ul><li><p>资源（Resources），所谓”资源”，就是网络上的一个实体，或者说是网络上的一个具体信息。你可以用一个 URI（统一资源定位符）指向它，每种资源对应一个特定的 URI。要获取这个资源，访问它的 URI 就可以。</p></li><li><p>表现层（Representation），把”资源”具体呈现出来的形式。URI 只代表资源的实体，不代表它的形式。严格地说，有些网址最后的“.html”后缀名是不必要的，因为这个后缀名表示格式，属于“表现层”范畴，而 URI 应该只代表“资源”的位置。它的具体表现形式，应该在 HTTP 请求的头信息中用 Accept 和 Content-Type 字段指定，这两个字段才是对”表现层”的描述。</p></li><li><p>状态转化（StateTransfer），互联网通信协议 HTTP 协议，是一个无状态协议。这意味着，所有的状态都保存在服务器端。因此，如果客户端想要操作服务器，必须通过某种手段，让服务器端发生“状态转化”（StateTransfer）。而这种转化是建立在表现层之上的，所以就是”表现层状态转化”。客户端用到的手段，只能是 HTTP 协议。具体来说，就是 HTTP 协议里面，四个表示操作方式的动词： GET、POST、PUT、DELETE。它们分别对应四种基本操作：GET 用来获取资源，POST 用来新建资源（也可 以用于更新资源），PUT 用来更新资源，DELETE 用来删除资源。</p></li></ul><p>Django-REST-Framework是一个强大而灵活的工具用于构建 WebAPIs。通过该框架可以创建 REST 风格的 WebSeriver 应用。安装：<code>pip install djangorestframework</code></p><p><strong>1、创建简单的 API</strong></p><blockquote><p>(1)&gt; <code>django-admin startproject django_rest</code><br>(2)&gt; <code>cd django_rest</code><br>(3)\django_rest&gt; <code>python3 manage.py startapp api</code><br>(4)打开 settings.py 文件添加应用：’rest_framework’和’api’<br>(5)在 settings.py 文件末尾添加:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">REST_FRAMEWORK = &#123; </span><br><span class="line"><span class="string">'DEFAULT_PERMISSION_CLASSES'</span>: (<span class="string">'rest_framework.permissions.IsAdminUser'</span>,), </span><br><span class="line"><span class="string">'PAGE_SIZE'</span>: <span class="number">10</span> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>(6)执行数据库迁移 \django_rest&gt; <code>python3 manage.py migrate</code><br>(7)创建超级管理员账户\django_rest&gt; <code>python3 manage.py createsuperuser</code><br>(8)创建数据序列化，创建…/api/serializers.py 文件,代码见文件。<br>(9)创建视图，打开…/api/views.py 视图文件，代码见文件。<br>(10)打开…/django_rest/urls.py 文件，添加路径的路由，代码见文件。<br>(11)启动服务 …\django_rest&gt; <code>python3 manage.py runserver</code></p></blockquote><p><strong>2、 集成发布会系统 API</strong></p><blockquote><p>(1)接下来在 django_rest 项目的基础上增加发布会和嘉宾管理的接口。<br>(2)打开…/api/models.py 文件，创建模型。<br>(3)进行数据库迁移：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">\django_rest&gt; python3 manage.py makemigrations api</span><br><span class="line">\django_rest&gt; python3 manage.py migrate</span><br></pre></td></tr></table></figure></p><p>(4)打开…/api/serializers.py 文件，添加发布会数据序列化。<br>(5)打开…/api/views.py 视图文件，定义发布会视图类。<br>(6)打开…/django_rest/urls.py 文件，添加 URL 配置。<br>(7)启动项目，使用浏览器打开：<a href="http://127.0.0.1:8000/" target="_blank" rel="noopener">http://127.0.0.1:8000/</a></p></blockquote><h2 id="八、项目代码"><a href="#八、项目代码" class="headerlink" title="八、项目代码"></a>八、项目代码</h2><h3 id="1、guest项目"><a href="#1、guest项目" class="headerlink" title="1、guest项目"></a>1、guest项目</h3><blockquote><ul><li>guest/<ul><li>guest/<ul><li>__init__.py</li><li>settings.py</li><li>urls.py</li><li>wsgi.py</li></ul></li><li>sign/<ul><li>migrations/<ul><li>__init__.py</li><li>0001_initial.py</li></ul></li><li>templates/<ul><li>event_manage.html</li><li>guest_manage.html</li><li>index.html</li><li>sign_index.html</li></ul></li><li>__init__.py</li><li>admin.py</li><li>apps.py</li><li>models.py</li><li>tests.py</li><li>urls.py</li><li>views.py</li><li>views_if.py</li><li>views_if_sec.py</li></ul></li><li>db.sqlite3</li><li>manage.py</li></ul></li></ul></blockquote><p>guest/guest/__init__.py<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"></span><br><span class="line">pymysql.install_as_MySQLdb()  <span class="comment"># 让当前的 Django 通过 PyMySQL 来连接 MySQL 数据库</span></span><br></pre></td></tr></table></figure></p><p>guest/guest/settings.py<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">INSTALLED_APPS = [</span><br><span class="line">    <span class="string">'django.contrib.admin'</span>,</span><br><span class="line">    <span class="string">'django.contrib.auth'</span>,</span><br><span class="line">    <span class="string">'django.contrib.contenttypes'</span>,</span><br><span class="line">    <span class="string">'django.contrib.sessions'</span>,</span><br><span class="line">    <span class="string">'django.contrib.messages'</span>,</span><br><span class="line">    <span class="string">'django.contrib.staticfiles'</span>,</span><br><span class="line"><span class="string">'sign'</span>,  <span class="comment"># 添加sign应用</span></span><br><span class="line"><span class="string">'bootstrap3'</span>,  <span class="comment"># 添加</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="meta">... </span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置mysql数据库</span></span><br><span class="line">DATABASES = &#123;</span><br><span class="line">    <span class="string">'default'</span>: &#123;</span><br><span class="line">        <span class="string">'ENGINE'</span>: <span class="string">'django.db.backends.mysql'</span>, </span><br><span class="line"><span class="string">'HOST'</span>: <span class="string">'127.0.0.1'</span>, </span><br><span class="line"><span class="string">'PORT'</span>: <span class="string">'3306'</span>, </span><br><span class="line"><span class="string">'NAME'</span>: <span class="string">'guest'</span>, </span><br><span class="line"><span class="string">'USER'</span>: <span class="string">'root'</span>, </span><br><span class="line"><span class="string">'PASSWORD'</span>: <span class="string">'123456'</span>,</span><br><span class="line"><span class="string">'OPTIONS'</span>: &#123; </span><br><span class="line"><span class="string">'init_command'</span>: <span class="string">"SET sql_mode='STRICT_TRANS_TABLES'"</span>, </span><br><span class="line">&#125;,</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">... </span></span><br><span class="line">...</span><br></pre></td></tr></table></figure></p><p>guest/guest/urls.py<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"><span class="keyword">from</span> django.conf.urls <span class="keyword">import</span> url, include  <span class="comment"># url控制需要导入</span></span><br><span class="line"><span class="keyword">from</span> sign <span class="keyword">import</span> views  <span class="comment"># 导入 sign 应用 views 文件</span></span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">'admin/'</span>, admin.site.urls),</span><br><span class="line">url(<span class="string">r'^index/$'</span>, views.index),   <span class="comment"># 添加 index/路径配置</span></span><br><span class="line">url(<span class="string">r'^login_action/$'</span>, views.login_action),</span><br><span class="line">url(<span class="string">r'^event_manage/$'</span>, views.event_manage),</span><br><span class="line">url(<span class="string">r'^accounts/login/$'</span>, views.index),</span><br><span class="line">url(<span class="string">r'^search_name/$'</span>, views.search_name),</span><br><span class="line">url(<span class="string">r'^guest_manage/$'</span>, views.guest_manage),</span><br><span class="line">url(<span class="string">r'^sign_index/(?P&lt;event_id&gt;[0-9]+)/$'</span>, views.sign_index),  <span class="comment"># 配置二级目录，发布会 id，要求必须为数字</span></span><br><span class="line">url(<span class="string">r'^sign_index_action/(?P&lt;event_id&gt;[0-9]+)/$'</span>, views.sign_index_action),</span><br><span class="line">url(<span class="string">r'^logout/$'</span>, views.logout),</span><br><span class="line">url(<span class="string">r'^api/'</span>, include(<span class="string">'sign.urls'</span>, namespace=<span class="string">"sign"</span>)),</span><br><span class="line">]</span><br></pre></td></tr></table></figure></p><p>guest/sign/admin.py<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> sign.models <span class="keyword">import</span> Event,Guest</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EventAdmin</span><span class="params">(admin.ModelAdmin)</span>:</span></span><br><span class="line">list_display = [<span class="string">'id'</span>, <span class="string">'name'</span>, <span class="string">'status'</span>, <span class="string">'address'</span>, <span class="string">'start_time'</span>]  <span class="comment"># 显示字段</span></span><br><span class="line">search_fields = [<span class="string">'name'</span>]  <span class="comment"># 搜索栏</span></span><br><span class="line">list_filter = [<span class="string">'status'</span>]  <span class="comment"># 过滤器</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GuestAdmin</span><span class="params">(admin.ModelAdmin)</span>:</span></span><br><span class="line">list_display = [<span class="string">'realname'</span>, <span class="string">'phone'</span>, <span class="string">'email'</span>, <span class="string">'sign'</span>, <span class="string">'create_time'</span>, <span class="string">'event'</span>]  <span class="comment"># 显示字段</span></span><br><span class="line">search_fields = [<span class="string">'realname'</span>, <span class="string">'phone'</span>]  <span class="comment"># 搜索栏</span></span><br><span class="line">list_filter = [<span class="string">'sign'</span>]  <span class="comment"># 过滤器</span></span><br><span class="line"></span><br><span class="line">admin.site.register(Event, EventAdmin)  <span class="comment"># 用 EventAdmin 选项注册 Event 模块。</span></span><br><span class="line">admin.site.register(Guest, GuestAdmin)<span class="comment"># 用 GuestAdmin 选项注册 Guest 模块。</span></span><br></pre></td></tr></table></figure></p><p>guest/sign/models.py<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="comment"># 发布会表</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Event</span><span class="params">(models.Model)</span>:</span></span><br><span class="line"><span class="string">"""默认都会生成自增id，在创建模型时不需要声明该字段"""</span></span><br><span class="line">name = models.CharField(max_length=<span class="number">100</span>)  <span class="comment"># 发布会标题</span></span><br><span class="line">limit = models.IntegerField()  <span class="comment"># 参加人数</span></span><br><span class="line">status = models.BooleanField()  <span class="comment"># 发布会状态</span></span><br><span class="line">address = models.CharField(max_length=<span class="number">200</span>)  <span class="comment"># 地址</span></span><br><span class="line">start_time = models.DateTimeField(<span class="string">'event time'</span>)  <span class="comment"># 发布会时间</span></span><br><span class="line">create_time = models.DateTimeField(auto_now=<span class="keyword">True</span>) <span class="comment"># 创建时间（自动获取当前时间）</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line"><span class="keyword">return</span> self.name  <span class="comment"># __str__()方法告诉 Python 如何将对象以 str 的方式显示出来。</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 嘉宾表</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Guest</span><span class="params">(models.Model)</span>:</span></span><br><span class="line"><span class="string">"""默认都会生成自增id，在创建模型时不需要声明该字段"""</span></span><br><span class="line">event = models.ForeignKey(Event, on_delete=models.CASCADE)  <span class="comment"># 关联发布会id</span></span><br><span class="line">realname = models.CharField(max_length=<span class="number">64</span>)  <span class="comment"># 姓名</span></span><br><span class="line">phone = models.CharField(max_length=<span class="number">16</span>)  <span class="comment"># 手机号</span></span><br><span class="line">email = models.EmailField()  <span class="comment"># 邮箱</span></span><br><span class="line">sign = models.BooleanField()  <span class="comment"># 签到状态</span></span><br><span class="line">create_time = models.DateTimeField(auto_now=<span class="keyword">True</span>)  <span class="comment"># 创建时间（自动获取当前时间）</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line"><span class="string">"""通过发布会id+手机号来做为联合主键"""</span></span><br><span class="line">unique_together = (<span class="string">"event"</span>, <span class="string">"phone"</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line"><span class="keyword">return</span> self.realname  <span class="comment"># __str__()方法告诉 Python 如何将对象以 str 的方式显示出来。</span></span><br></pre></td></tr></table></figure></p><p>guest/sign/urls.py<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.conf.urls <span class="keyword">import</span> url</span><br><span class="line"><span class="keyword">from</span> sign <span class="keyword">import</span> views_if, views_if_sec</span><br><span class="line"></span><br><span class="line">app_name=<span class="string">'sign'</span>  <span class="comment"># django2.0里必须添加应用名称，和urls路由里对应。或者直接在urls路由里添加路径也可以</span></span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line"><span class="comment"># guest system interface: </span></span><br><span class="line"><span class="comment"># ex : /api/add_event/</span></span><br><span class="line">url(<span class="string">r'^add_event/'</span>, views_if.add_event, name=<span class="string">'add_event'</span>),</span><br><span class="line"><span class="comment"># ex : /api/add_guest/ </span></span><br><span class="line">url(<span class="string">r'^add_guest/'</span>, views_if.add_guest, name=<span class="string">'add_guest'</span>), </span><br><span class="line"><span class="comment"># ex : /api/get_event_list/ </span></span><br><span class="line">url(<span class="string">r'^get_event_list/'</span>, views_if.get_event_list, name=<span class="string">'get_event_list'</span>), </span><br><span class="line"><span class="comment"># ex : /api/get_guest_list/ </span></span><br><span class="line">url(<span class="string">r'^get_guest_list/'</span>, views_if.get_guest_list, name=<span class="string">'get_guest_list'</span>), </span><br><span class="line"><span class="comment"># ex : /api/user_sign/ </span></span><br><span class="line">url(<span class="string">r'^user_sign/'</span>, views_if.user_sign, name=<span class="string">'user_sign'</span>),</span><br><span class="line"><span class="comment"># security interface: </span></span><br><span class="line"><span class="comment"># ex : /api/sec_get_event_list/ </span></span><br><span class="line">url(<span class="string">r'sec_get_event_list/'</span>, views_if_sec.get_event_list, name=<span class="string">'get_event_list'</span>),</span><br><span class="line"><span class="comment"># security interface:</span></span><br><span class="line"><span class="comment"># ex : /api/sec_add_event/</span></span><br><span class="line">url(<span class="string">r'sec_add_event/'</span>, views_if_sec.add_event, name=<span class="string">'add_event'</span>),</span><br><span class="line"><span class="comment"># security interface: </span></span><br><span class="line"><span class="comment"># ex : /aip/sec_add_event/ </span></span><br><span class="line">url(<span class="string">r'^sec_get_guest_list/'</span>, views_if_sec.get_guest_list, name=<span class="string">'get_guest_list'</span>), </span><br><span class="line">]</span><br></pre></td></tr></table></figure></p><p>guest/sign/views.py<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render, get_object_or_404</span><br><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse, HttpResponseRedirect </span><br><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> auth</span><br><span class="line"><span class="keyword">from</span> django.contrib.auth.decorators <span class="keyword">import</span> login_required</span><br><span class="line"><span class="keyword">from</span> sign.models <span class="keyword">import</span> Event,Guest</span><br><span class="line"><span class="keyword">from</span> django.core.paginator <span class="keyword">import</span> Paginator, EmptyPage, PageNotAnInteger</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(request)</span>:</span></span><br><span class="line"><span class="comment"># return HttpResponse('Hello Django')</span></span><br><span class="line"><span class="keyword">return</span> render(request, <span class="string">'index.html'</span>)  <span class="comment"># 这里抛弃 HttpResponse 类，转而使用 Django 的 render 函数</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login_action</span><span class="params">(request)</span>:</span></span><br><span class="line"><span class="keyword">if</span> request.method == <span class="string">'POST'</span>:</span><br><span class="line">username = request.POST.get(<span class="string">'username'</span>, <span class="string">''</span>)</span><br><span class="line">password = request.POST.get(<span class="string">'password'</span>, <span class="string">''</span>)</span><br><span class="line">user = auth.authenticate(username=username, password=password)  <span class="comment"># 认证给出的用户名和密码</span></span><br><span class="line"><span class="keyword">if</span> user <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>: </span><br><span class="line"><span class="comment">#return HttpResponse('login success!') </span></span><br><span class="line"><span class="comment">#response.set_cookie('user', username)  # 添加浏览器cookie</span></span><br><span class="line">auth.login(request, user)  <span class="comment"># 登录</span></span><br><span class="line">request.session[<span class="string">'user'</span>] = username <span class="comment"># 将 session 信息记录到浏览器</span></span><br><span class="line"><span class="keyword">return</span> HttpResponseRedirect(<span class="string">'/event_manage/'</span>)</span><br><span class="line"><span class="keyword">else</span>: </span><br><span class="line"><span class="keyword">return</span> render(request, <span class="string">'index.html'</span>, &#123;<span class="string">'error'</span>: <span class="string">'username or password error!'</span>&#125;)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line"><span class="keyword">return</span> render(request, <span class="string">'index.html'</span>, &#123;<span class="string">'error'</span>: <span class="string">'username or password error!'</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="meta">@login_required</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">event_manage</span><span class="params">(request)</span>:</span></span><br><span class="line">event_list = Event.objects.all()</span><br><span class="line"><span class="comment">#username = request.COOKIES.get('user', '', 3600)  # 读取浏览器cookie</span></span><br><span class="line">username = request.session.get(<span class="string">'user'</span>, <span class="string">''</span>)  <span class="comment"># 读取浏览器 session</span></span><br><span class="line"><span class="keyword">return</span> render(request, <span class="string">'event_manage.html'</span>, &#123;<span class="string">"user"</span>: username, <span class="string">"events"</span>: event_list&#125;)</span><br><span class="line"></span><br><span class="line"><span class="meta">@login_required</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">search_name</span><span class="params">(request)</span>:</span></span><br><span class="line">username = request.session.get(<span class="string">'user'</span>, <span class="string">''</span>)</span><br><span class="line">search_name = request.GET.get(<span class="string">'name'</span>, <span class="string">''</span>)</span><br><span class="line">event_list = Event.objects.filter(name__contains=search_name)</span><br><span class="line"><span class="keyword">return</span> render(request, <span class="string">"event_manage.html"</span>, &#123;<span class="string">"user"</span>: username, <span class="string">"events"</span>: event_list&#125;)</span><br><span class="line"></span><br><span class="line"><span class="meta">@login_required</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">guest_manage</span><span class="params">(request)</span>:</span></span><br><span class="line">username = request.session.get(<span class="string">'user'</span>, <span class="string">''</span>)</span><br><span class="line">guest_list = Guest.objects.all()</span><br><span class="line">paginator = Paginator(guest_list, <span class="number">2</span>)  <span class="comment"># 划分每页显示 2 条数据</span></span><br><span class="line">page = request.GET.get(<span class="string">'page'</span>)  <span class="comment"># 通过 GET 请求得到当前要显示第几页的数</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">contacts = paginator.page(page)  <span class="comment"># 获取第 page 页的数据</span></span><br><span class="line"><span class="keyword">except</span> PageNotAnInteger:  <span class="comment"># 如果当前没有页数，抛 PageNotAnInteger 异常</span></span><br><span class="line">contacts = paginator.page(<span class="number">1</span>)  <span class="comment"># 返回第一页的数据</span></span><br><span class="line"><span class="keyword">except</span> EmptyPage:  <span class="comment"># 如果超出最大页数的范围，抛 EmptyPage 异常</span></span><br><span class="line">contacts = paginator.page(paginator.num_pages)  <span class="comment"># 返回最后一页面的数据</span></span><br><span class="line"><span class="keyword">return</span> render(request, <span class="string">"guest_manage.html"</span>, &#123;<span class="string">"user"</span>: username, <span class="string">"guests"</span>: contacts&#125;)</span><br><span class="line"></span><br><span class="line"><span class="meta">@login_required</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sign_index</span><span class="params">(request, event_id)</span>:</span></span><br><span class="line">event = get_object_or_404(Event, id=event_id)</span><br><span class="line"><span class="keyword">return</span> render(request, <span class="string">'sign_index.html'</span>, &#123;<span class="string">'event'</span>: event&#125;)</span><br><span class="line"></span><br><span class="line"><span class="meta">@login_required</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sign_index_action</span><span class="params">(request, event_id)</span>:</span></span><br><span class="line">event = get_object_or_404(Event, id=event_id) </span><br><span class="line">phone = request.POST.get(<span class="string">'phone'</span>,<span class="string">''</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 首先，查询 Guest 表判断用户输入的手机号是否存在，如果不存在将提示用户“手机号为空或不存在”</span></span><br><span class="line">result = Guest.objects.filter(phone = phone) </span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> result: </span><br><span class="line"><span class="keyword">return</span> render(request, <span class="string">'sign_index.html'</span>, &#123;<span class="string">'event'</span>: event, <span class="string">'hint'</span>: <span class="string">'phone error.'</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 然后，通过手机和发布会 id 两个条件来查询 Guest 表，如果结果为空将提示用户“该用户未参加此次发布会”</span></span><br><span class="line">result = Guest.objects.filter(phone=phone,event_id=event_id) </span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> result:</span><br><span class="line"><span class="keyword">return</span> render(request, <span class="string">'sign_index.html'</span>, &#123;<span class="string">'event'</span>: event, <span class="string">'hint'</span>:<span class="string">'eventidorphoneerror.'</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 最后，再通过手机号查询 Guest 表，判断该手机号的签到状态是否为 1，如果为 1，表示已经签过到了， 返回用户“已签到”，否则，将提示用户“签到成功！”，并返回签到用户的信息。</span></span><br><span class="line">result = Guest.objects.get(phone=phone,event_id=event_id)</span><br><span class="line"><span class="keyword">if</span> result.sign:</span><br><span class="line"><span class="keyword">return</span> render(request, <span class="string">'sign_index.html'</span>, &#123;<span class="string">'event'</span>: event, <span class="string">'hint'</span>: <span class="string">"user has sign in."</span>&#125;) </span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">Guest.objects.filter(phone=phone,event_id=event_id).update(sign = <span class="string">'1'</span>) </span><br><span class="line"><span class="keyword">return</span> render(request, <span class="string">'sign_index.html'</span>, &#123;<span class="string">'event'</span>: event, <span class="string">'hint'</span>:<span class="string">'sign in success!'</span>, <span class="string">'guest'</span>: result&#125;)</span><br><span class="line"></span><br><span class="line"><span class="meta">@login_required</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">logout</span><span class="params">(request)</span>:</span></span><br><span class="line">auth.logout(request)  <span class="comment"># 退出登录 </span></span><br><span class="line">response = HttpResponseRedirect(<span class="string">'/index/'</span>) </span><br><span class="line"><span class="keyword">return</span> response</span><br></pre></td></tr></table></figure></p><p>guest/sign/views_if.py<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> JsonResponse</span><br><span class="line"><span class="keyword">from</span> sign.models <span class="keyword">import</span> Event</span><br><span class="line"><span class="keyword">from</span> django.core.exceptions <span class="keyword">import</span> ValidationError, ObjectDoesNotExist</span><br><span class="line"><span class="keyword">from</span> django.db.utils <span class="keyword">import</span> IntegrityError</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加发布会接口</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_event</span><span class="params">(request)</span>:</span></span><br><span class="line"><span class="comment"># 通过POST请求接收发布会参数</span></span><br><span class="line">eid = request.POST.get(<span class="string">'eid'</span>,<span class="string">''</span>)                 <span class="comment"># 发布会id</span></span><br><span class="line">name = request.POST.get(<span class="string">'name'</span>,<span class="string">''</span>)               <span class="comment"># 发布会标题</span></span><br><span class="line">limit = request.POST.get(<span class="string">'limit'</span>,<span class="string">''</span>)             <span class="comment"># 限制人数</span></span><br><span class="line">status = request.POST.get(<span class="string">'status'</span>,<span class="string">''</span>)           <span class="comment"># 状态</span></span><br><span class="line">address = request.POST.get(<span class="string">'address'</span>,<span class="string">''</span>)         <span class="comment"># 地址</span></span><br><span class="line">start_time = request.POST.get(<span class="string">'start_time'</span>,<span class="string">''</span>)   <span class="comment"># 发布会时间</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 首先，判断 eid、 name、limit、address、start_time 等字段均不能为空</span></span><br><span class="line"><span class="keyword">if</span> eid ==<span class="string">''</span> <span class="keyword">or</span> name == <span class="string">''</span> <span class="keyword">or</span> limit == <span class="string">''</span> <span class="keyword">or</span> address == <span class="string">''</span> <span class="keyword">or</span> start_time == <span class="string">''</span>:</span><br><span class="line"><span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10021</span>,<span class="string">'message'</span>:<span class="string">'parameter error'</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 接下来，判断发布会 id 是否存在</span></span><br><span class="line">result =Event.objects.filter(id=eid)</span><br><span class="line"><span class="keyword">if</span> result:</span><br><span class="line"><span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10022</span>,<span class="string">'message'</span>:<span class="string">'event id already exists'</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 接下来，判断发布会名称 name 是否存在</span></span><br><span class="line">result = Event.objects.filter(name=name)</span><br><span class="line"><span class="keyword">if</span> result:</span><br><span class="line"><span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10023</span>, <span class="string">'message'</span>:<span class="string">'event name already exists'</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 再接下来，判断发布会状态是否为空，如果为空，将状态设置为 1（True）。</span></span><br><span class="line"><span class="keyword">if</span> status == <span class="string">''</span>:</span><br><span class="line">status = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 最后，将数据插入到 Event 表，在插入的过程中如果日期格式错误，将抛出 ValidationError 异常</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">Event.objects.create(id=eid,name=name,limit=limit,address=address,status=int(status),start_time=start_time)</span><br><span class="line"><span class="keyword">except</span> ValidationError:</span><br><span class="line">error = <span class="string">'start_time format error. It must be in YYYY-MM-DD HH:MM:SS format.'</span></span><br><span class="line"><span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10024</span>,<span class="string">'message'</span>:error&#125;)</span><br><span class="line"><span class="comment"># 否则，插入成功，返回状态码 200 和“addeventsuccess”的提示。</span></span><br><span class="line"><span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">200</span>,<span class="string">'message'</span>:<span class="string">'add event success'</span>&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 发布会查询</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_event_list</span><span class="params">(request)</span>:</span></span><br><span class="line"><span class="comment"># 通过GET请求接收发布会id和name参数。两个参数都是可选的</span></span><br><span class="line">eid = request.GET.get(<span class="string">"eid"</span>, <span class="string">""</span>)      <span class="comment"># 发布会id</span></span><br><span class="line">name = request.GET.get(<span class="string">"name"</span>, <span class="string">""</span>)    <span class="comment"># 发布会名称</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 首先，判断当两个参数同时为空，接 口返回状态码 10021，参数错误。</span></span><br><span class="line"><span class="keyword">if</span> eid == <span class="string">''</span> <span class="keyword">and</span> name == <span class="string">''</span>:</span><br><span class="line"><span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10021</span>,<span class="string">'message'</span>:<span class="string">'parameter error'</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果发布会 id 不为空，优先通过 id 查询，因为 id 的唯一性，所以，查询结果只会有一条</span></span><br><span class="line"><span class="keyword">if</span> eid != <span class="string">''</span>:</span><br><span class="line">event = &#123;&#125;</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">result = Event.objects.get(id=eid)</span><br><span class="line"><span class="keyword">except</span> ObjectDoesNotExist:</span><br><span class="line"><span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10022</span>, <span class="string">'message'</span>:<span class="string">'query result is empty'</span>&#125;)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">event[<span class="string">'eid'</span>] = result.id</span><br><span class="line">event[<span class="string">'name'</span>] = result.name</span><br><span class="line">event[<span class="string">'limit'</span>] = result.limit</span><br><span class="line">event[<span class="string">'status'</span>] = result.status</span><br><span class="line">event[<span class="string">'address'</span>] = result.address</span><br><span class="line">event[<span class="string">'start_time'</span>] = result.start_time</span><br><span class="line"><span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">200</span>, <span class="string">'message'</span>:<span class="string">'success'</span>, <span class="string">'data'</span>:event&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># name 查询为模糊查询，查询数据可能会有多条</span></span><br><span class="line"><span class="keyword">if</span> name != <span class="string">''</span>:</span><br><span class="line">datas = []</span><br><span class="line">results = Event.objects.filter(name__contains=name)</span><br><span class="line"><span class="keyword">if</span> results:</span><br><span class="line"><span class="keyword">for</span> r <span class="keyword">in</span> results:</span><br><span class="line">event = &#123;&#125;</span><br><span class="line">event[<span class="string">'eid'</span>] = r.id</span><br><span class="line">event[<span class="string">'name'</span>] = r.name</span><br><span class="line">event[<span class="string">'limit'</span>] = r.limit</span><br><span class="line">event[<span class="string">'status'</span>] = r.status</span><br><span class="line">event[<span class="string">'address'</span>] = r.address</span><br><span class="line">event[<span class="string">'start_time'</span>] = r.start_time</span><br><span class="line">datas.append(event)</span><br><span class="line"><span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">200</span>, <span class="string">'message'</span>:<span class="string">'success'</span>, <span class="string">'data'</span>:datas&#125;)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line"><span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10022</span>, <span class="string">'message'</span>:<span class="string">'query result is empty'</span>&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加嘉宾接口</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_guest</span><span class="params">(request)</span>:</span></span><br><span class="line"><span class="comment"># 通过POST请求接收嘉宾参数</span></span><br><span class="line">eid =  request.POST.get(<span class="string">'eid'</span>,<span class="string">''</span>)                <span class="comment"># 关联发布会id</span></span><br><span class="line">realname = request.POST.get(<span class="string">'realname'</span>,<span class="string">''</span>)       <span class="comment"># 姓名</span></span><br><span class="line">phone = request.POST.get(<span class="string">'phone'</span>,<span class="string">''</span>)             <span class="comment"># 手机号</span></span><br><span class="line">email = request.POST.get(<span class="string">'email'</span>,<span class="string">''</span>)             <span class="comment"># 邮箱</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 首先，判断 eid、realname、phone 等参数均不能为空</span></span><br><span class="line"><span class="keyword">if</span> eid ==<span class="string">''</span> <span class="keyword">or</span> realname == <span class="string">''</span> <span class="keyword">or</span> phone == <span class="string">''</span>:</span><br><span class="line"><span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10021</span>,<span class="string">'message'</span>:<span class="string">'parameter error'</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 接下来，判断嘉宾关联的发布会 id 是否存在</span></span><br><span class="line">result = Event.objects.filter(id=eid)</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> result:</span><br><span class="line"><span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10022</span>,<span class="string">'message'</span>:<span class="string">'event id null'</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 接下来，判断及关联的发布会状态是否为 True（即 1）</span></span><br><span class="line">result = Event.objects.get(id=eid).status</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> result:</span><br><span class="line"><span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10023</span>,<span class="string">'message'</span>:<span class="string">'event status is not available'</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 接下来，判断发布会人数限制</span></span><br><span class="line">event_limit = Event.objects.get(id=eid).limit        <span class="comment"># 发布会限制人数</span></span><br><span class="line">guest_limit = Guest.objects.filter(event_id=eid)     <span class="comment"># 发布会已添加的嘉宾数</span></span><br><span class="line"><span class="keyword">if</span> len(guest_limit) &gt;= event_limit:</span><br><span class="line"><span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10024</span>,<span class="string">'message'</span>:<span class="string">'event number is full'</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 再接下来的步骤是判断当前时间是否大于发布会时间，如果大于则说明发布已开始，或者早已经结束。</span></span><br><span class="line">event_time = Event.objects.get(id=eid).start_time     <span class="comment"># 发布会时间</span></span><br><span class="line">timeArray = time.strptime(str(event_time), <span class="string">"%Y-%m-%d %H:%M:%S"</span>)</span><br><span class="line">e_time = int(time.mktime(timeArray))</span><br><span class="line">now_time = str(time.time())          <span class="comment"># 当前时间</span></span><br><span class="line">ntime = now_time.split(<span class="string">"."</span>)[<span class="number">0</span>]</span><br><span class="line">n_time = int(ntime)</span><br><span class="line"><span class="keyword">if</span> n_time &gt;= e_time:</span><br><span class="line"><span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10025</span>,<span class="string">'message'</span>:<span class="string">'event has started'</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 最后，插入嘉宾数据，如果发布会的手机号重复则抛 IntegrityError 异常，接收该异常并返回相应的状态 码和提示信息</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">Guest.objects.create(realname=realname,phone=int(phone),email=email,sign=<span class="number">0</span>,event_id=int(eid))</span><br><span class="line"><span class="keyword">except</span> IntegrityError:</span><br><span class="line"><span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10026</span>,<span class="string">'message'</span>:<span class="string">'the event guest phone number repeat'</span>&#125;)</span><br><span class="line"><span class="comment"># 如果添加成功，则返回状态码 200 和“addguestsuccess”的提示</span></span><br><span class="line"><span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">200</span>,<span class="string">'message'</span>:<span class="string">'add guest success'</span>&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 嘉宾查询接口</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_guest_list</span><span class="params">(request)</span>:</span></span><br><span class="line">eid = request.GET.get(<span class="string">"eid"</span>, <span class="string">""</span>)       <span class="comment"># 关联发布会id</span></span><br><span class="line">phone = request.GET.get(<span class="string">"phone"</span>, <span class="string">""</span>)   <span class="comment"># 嘉宾手机号</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> eid == <span class="string">''</span>:</span><br><span class="line"><span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10021</span>,<span class="string">'message'</span>:<span class="string">'eid cannot be empty'</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> eid != <span class="string">''</span> <span class="keyword">and</span> phone == <span class="string">''</span>:</span><br><span class="line">datas = []</span><br><span class="line">results = Guest.objects.filter(event_id=eid)</span><br><span class="line"><span class="keyword">if</span> results:</span><br><span class="line"><span class="keyword">for</span> r <span class="keyword">in</span> results:</span><br><span class="line">guest = &#123;&#125;</span><br><span class="line">guest[<span class="string">'realname'</span>] = r.realname</span><br><span class="line">guest[<span class="string">'phone'</span>] = r.phone</span><br><span class="line">guest[<span class="string">'email'</span>] = r.email</span><br><span class="line">guest[<span class="string">'sign'</span>] = r.sign</span><br><span class="line">datas.append(guest)</span><br><span class="line"><span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">200</span>, <span class="string">'message'</span>:<span class="string">'success'</span>, <span class="string">'data'</span>:datas&#125;)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line"><span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10022</span>, <span class="string">'message'</span>:<span class="string">'query result is empty'</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> eid != <span class="string">''</span> <span class="keyword">and</span> phone != <span class="string">''</span>:</span><br><span class="line">guest = &#123;&#125;</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">result = Guest.objects.get(phone=phone,event_id=eid)</span><br><span class="line"><span class="keyword">except</span> ObjectDoesNotExist:</span><br><span class="line"><span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10022</span>, <span class="string">'message'</span>:<span class="string">'query result is empty'</span>&#125;)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">guest[<span class="string">'realname'</span>] = result.realname</span><br><span class="line">guest[<span class="string">'phone'</span>] = result.phone</span><br><span class="line">guest[<span class="string">'email'</span>] = result.email</span><br><span class="line">guest[<span class="string">'sign'</span>] = result.sign</span><br><span class="line"><span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">200</span>, <span class="string">'message'</span>:<span class="string">'success'</span>, <span class="string">'data'</span>:guest&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 用户签到接口</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">user_sign</span><span class="params">(request)</span>:</span></span><br><span class="line"><span class="comment"># 签到接口通过POST请求接收发布会id和嘉宾手机号</span></span><br><span class="line">eid =  request.POST.get(<span class="string">'eid'</span>,<span class="string">''</span>)       <span class="comment"># 发布会id</span></span><br><span class="line">phone =  request.POST.get(<span class="string">'phone'</span>,<span class="string">''</span>)   <span class="comment"># 嘉宾手机号</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 首先，判断两个参数均不能为空</span></span><br><span class="line"><span class="keyword">if</span> eid ==<span class="string">''</span> <span class="keyword">or</span> phone == <span class="string">''</span>:</span><br><span class="line"><span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10021</span>,<span class="string">'message'</span>:<span class="string">'parameter error'</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 接着，判断发布会 id 是否存在</span></span><br><span class="line">result = Event.objects.filter(id=eid)</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> result:</span><br><span class="line"><span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10022</span>,<span class="string">'message'</span>:<span class="string">'event id null'</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 接着，判断发布会状态是否为 True</span></span><br><span class="line">result = Event.objects.get(id=eid).status</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> result:</span><br><span class="line"><span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10023</span>,<span class="string">'message'</span>:<span class="string">'event status is not available'</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 再接着，判断当前时间是否大于发布会时间，如果大于发布会时间说明发布会已开始，不允许签到</span></span><br><span class="line">event_time = Event.objects.get(id=eid).start_time  <span class="comment"># 发布会时间</span></span><br><span class="line">timeArray = time.strptime(str(event_time), <span class="string">"%Y-%m-%d %H:%M:%S"</span>)</span><br><span class="line">e_time = int(time.mktime(timeArray))</span><br><span class="line">now_time = str(time.time())  <span class="comment"># 当前时间</span></span><br><span class="line">ntime = now_time.split(<span class="string">"."</span>)[<span class="number">0</span>]</span><br><span class="line">n_time = int(ntime)</span><br><span class="line"><span class="keyword">if</span> n_time &gt;= e_time:</span><br><span class="line"><span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10024</span>,<span class="string">'message'</span>:<span class="string">'event has started'</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 然后，再判断嘉宾的手机号是否存在</span></span><br><span class="line">result = Guest.objects.filter(phone=phone)</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> result:</span><br><span class="line"><span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10025</span>,<span class="string">'message'</span>:<span class="string">'user phone null'</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 然后，再判断嘉宾的手机号与发布会 id 是否为对应关系</span></span><br><span class="line">result = Guest.objects.filter(phone=phone,event_id=eid)</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> result:</span><br><span class="line"><span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10026</span>,<span class="string">'message'</span>:<span class="string">'user did not participate in the conference'</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 最后，判断该嘉宾的状态是否为已签到，如果已签到，返回相应的状态码和提示</span></span><br><span class="line">result = Guest.objects.get(event_id=eid,phone=phone).sign</span><br><span class="line"><span class="keyword">if</span> result:</span><br><span class="line"><span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10027</span>,<span class="string">'message'</span>:<span class="string">'user has sign in'</span>&#125;)</span><br><span class="line"><span class="comment"># 如果未签到修改状态 为已签到，并返回状态码 200 和“signsuccess”的提示。</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">Guest.objects.filter(phone=phone).update(sign=<span class="string">'1'</span>)</span><br><span class="line"><span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">200</span>,<span class="string">'message'</span>:<span class="string">'sign success'</span>&#125;)</span><br></pre></td></tr></table></figure></p><p>guest/sign/views_if_sec.py<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> JsonResponse</span><br><span class="line"><span class="keyword">from</span> sign.models <span class="keyword">import</span> Event, Guest</span><br><span class="line"><span class="keyword">from</span> django.core.exceptions <span class="keyword">import</span> ObjectDoesNotExist, ValidationError</span><br><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> auth <span class="keyword">as</span> django_auth</span><br><span class="line"><span class="keyword">import</span> base64, time</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</span><br><span class="line"><span class="comment">#from Crypto.Cipher import AES    # 请安装 Crypto</span></span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 用户认证</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">user_auth</span><span class="params">(request)</span>:</span></span><br><span class="line"><span class="comment"># request.META 包含了所有本次 HTTP 请求的 Header 信息;HTTP_AUTHORIZATION 用于获取 HTTPauthorization;</span></span><br><span class="line"><span class="comment"># 得到的数据是这样的：Basic YWRtaW46YWRtaW4xMjM0NTY=</span></span><br><span class="line">get_http_auth = request.META.get(<span class="string">'HTTP_AUTHORIZATION'</span>,<span class="string">'b'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># split()方法拆分成 list,拆分后的数据是这样的：['Basic','YWRtaW46YWRtaW4xMjM0NTY=']</span></span><br><span class="line">auth = get_http_auth.split()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 取出 list 中的加密串，通过 base64 对加密串进行解码。得到的数据是：('admin',':','admin123456')</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">auth_parts = base64.b64decode(auth[<span class="number">1</span>]).decode(<span class="string">'utf-8'</span>).partition(<span class="string">':'</span>)</span><br><span class="line"><span class="comment"># 如果获取不到 Auth 信息，将会抛 IndexError 异常</span></span><br><span class="line"><span class="keyword">except</span> IndexError:</span><br><span class="line"><span class="keyword">return</span> <span class="string">"null"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 取出元组中对应的用户 id 和密码。最终于数据： admin admin123456</span></span><br><span class="line">userid, password = auth_parts[<span class="number">0</span>], auth_parts[<span class="number">2</span>]</span><br><span class="line"><span class="comment"># 调用 Django 的认证模块，对得到 Auth 信息进行认证。成功将返回 “success”，失败则返回“fail”</span></span><br><span class="line">user = django_auth.authenticate(username=userid, password=password)</span><br><span class="line"><span class="keyword">if</span> user <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span> <span class="keyword">and</span> user.is_active:</span><br><span class="line">django_auth.login(request, user)</span><br><span class="line"><span class="keyword">return</span> <span class="string">"success"</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line"><span class="keyword">return</span> <span class="string">"fail"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 发布会查询接口---增加用户认证</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_event_list</span><span class="params">(request)</span>:</span></span><br><span class="line">auth_result = user_auth(request)  <span class="comment"># 调用认证函数</span></span><br><span class="line"><span class="keyword">if</span> auth_result == <span class="string">"null"</span>:</span><br><span class="line"><span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10011</span>,<span class="string">'message'</span>:<span class="string">'user auth null'</span>&#125;)</span><br><span class="line"><span class="keyword">if</span> auth_result == <span class="string">'fail'</span>:</span><br><span class="line"><span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10012</span>,<span class="string">'message'</span>:<span class="string">'user auth fail'</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过GET请求接收发布会id和name参数。两个参数都是可选的</span></span><br><span class="line">eid = request.GET.get(<span class="string">"eid"</span>, <span class="string">""</span>)  <span class="comment"># 发布会id</span></span><br><span class="line">name = request.GET.get(<span class="string">"name"</span>, <span class="string">""</span>)  <span class="comment"># 发布会名称</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 首先，判断当两个参数同时为空，接 口返回状态码 10021，参数错误。</span></span><br><span class="line"><span class="keyword">if</span> eid == <span class="string">''</span> <span class="keyword">and</span> name == <span class="string">''</span>:</span><br><span class="line"><span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10021</span>,<span class="string">'message'</span>:<span class="string">'parameter error'</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 如果发布会 id 不为空，优先通过 id 查询，因为 id 的唯一性，所以，查询结果只会有一条</span></span><br><span class="line"><span class="keyword">if</span> eid != <span class="string">''</span>:</span><br><span class="line">event = &#123;&#125;</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">result = Event.objects.get(id=eid)</span><br><span class="line"><span class="keyword">except</span> ObjectDoesNotExist:</span><br><span class="line"><span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10022</span>, <span class="string">'message'</span>:<span class="string">'query result is empty'</span>&#125;)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">event[<span class="string">'eid'</span>] = result.id</span><br><span class="line">event[<span class="string">'name'</span>] = result.name</span><br><span class="line">event[<span class="string">'limit'</span>] = result.limit</span><br><span class="line">event[<span class="string">'status'</span>] = result.status</span><br><span class="line">event[<span class="string">'address'</span>] = result.address</span><br><span class="line">event[<span class="string">'start_time'</span>] = result.start_time</span><br><span class="line"><span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">200</span>, <span class="string">'message'</span>:<span class="string">'success'</span>, <span class="string">'data'</span>:event&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># name 查询为模糊查询，查询数据可能会有多条</span></span><br><span class="line"><span class="keyword">if</span> name != <span class="string">''</span>:</span><br><span class="line">datas = []</span><br><span class="line">results = Event.objects.filter(name__contains=name)</span><br><span class="line"><span class="keyword">if</span> results:</span><br><span class="line"><span class="keyword">for</span> r <span class="keyword">in</span> results:</span><br><span class="line">event = &#123;&#125;</span><br><span class="line">event[<span class="string">'eid'</span>] = r.id</span><br><span class="line">event[<span class="string">'name'</span>] = r.name</span><br><span class="line">event[<span class="string">'limit'</span>] = r.limit</span><br><span class="line">event[<span class="string">'status'</span>] = r.status</span><br><span class="line">event[<span class="string">'address'</span>] = r.address</span><br><span class="line">event[<span class="string">'start_time'</span>] = r.start_time</span><br><span class="line">datas.append(event)</span><br><span class="line"><span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">200</span>, <span class="string">'message'</span>:<span class="string">'success'</span>, <span class="string">'data'</span>:datas&#125;)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line"><span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10022</span>, <span class="string">'message'</span>:<span class="string">'query result is empty'</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 用户签名+时间戳</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">user_sign</span><span class="params">(request)</span>:</span></span><br><span class="line"><span class="comment"># 通过 POST 方法获取两个参数 time 和 sign 两个参数</span></span><br><span class="line"><span class="keyword">if</span> request.method == <span class="string">"post"</span>:</span><br><span class="line">client_time = request.POST.get(<span class="string">'time'</span>, <span class="string">''</span>)  <span class="comment"># 客户端时间戳</span></span><br><span class="line">client_sign= request.POST.get(<span class="string">'sign'</span>, <span class="string">''</span>)  <span class="comment"># 客户端签名</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line"><span class="keyword">return</span> <span class="string">"error"</span></span><br><span class="line"><span class="keyword">if</span> client_time == <span class="string">''</span> <span class="keyword">or</span> client_sign == <span class="string">''</span>:</span><br><span class="line"><span class="keyword">return</span> <span class="string">"sign null"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 服务器时间</span></span><br><span class="line">now_time = time.time()  <span class="comment"># 例：1466426831.9126902</span></span><br><span class="line"><span class="comment"># Python3 生成的的时间戳精度太高，我们只需要小数点前面的 10 位即可</span></span><br><span class="line">server_time = str(now_time).split(<span class="string">'.'</span>)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取时间差</span></span><br><span class="line">time_difference = int(server_time) - int(client_time)</span><br><span class="line"><span class="comment"># 接口的请求时间是离现在超过 60 秒,返回请求超时</span></span><br><span class="line"><span class="keyword">if</span> time_difference &gt;= <span class="number">60</span>:</span><br><span class="line"><span class="keyword">return</span> <span class="string">"timeout"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 签名检查</span></span><br><span class="line">md5 = hashlib.md5()</span><br><span class="line"><span class="comment"># 签名参数的生成：密钥字符串(“&amp;Guest-Bugmaster”)和客户端发来的时间戳， 两者拼接成一个新的字符串</span></span><br><span class="line">sign_str = client_time + <span class="string">"&amp;Guest-Bugmaster"</span></span><br><span class="line">sing_bytes_utf8 = sign_str.encode(encoding=<span class="string">"utf-8"</span>)</span><br><span class="line"><span class="comment"># 通过 MD5 对其进行加密。从而将加密后的字符串作为 sign 的字段的参数</span></span><br><span class="line">md5.update(sing_bytes_utf8)</span><br><span class="line">server_sign = md5.hexdigest</span><br><span class="line"><span class="comment"># 两端使用相同的规则生成的加密后的字符串，进行比较</span></span><br><span class="line"><span class="keyword">if</span> server_sign != client_sign:</span><br><span class="line"><span class="keyword">return</span> <span class="string">"sign fail"</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line"><span class="keyword">return</span> <span class="string">"sign right"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加发布会接口---增加签名+时间戳</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_event</span><span class="params">(request)</span>:</span></span><br><span class="line">sign_result = user_sign(request)  <span class="comment"># 调用签名函数</span></span><br><span class="line"><span class="keyword">if</span> sign_result == <span class="string">"error"</span>:</span><br><span class="line"><span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10011</span>,<span class="string">'message'</span>:<span class="string">'request error'</span>&#125;)</span><br><span class="line"><span class="keyword">elif</span> sign_result == <span class="string">"sign null"</span>:</span><br><span class="line"><span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10012</span>,<span class="string">'message'</span>:<span class="string">'user sign null'</span>&#125;)</span><br><span class="line"><span class="keyword">elif</span> sign_result == <span class="string">"timeout"</span>:</span><br><span class="line"><span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10013</span>,<span class="string">'message'</span>:<span class="string">'user sign timeout'</span>&#125;)</span><br><span class="line"><span class="keyword">elif</span> sign_result == <span class="string">"sign fail"</span>:</span><br><span class="line"><span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10014</span>,<span class="string">'message'</span>:<span class="string">'user sign error'</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过POST请求接收发布会参数</span></span><br><span class="line">eid = request.POST.get(<span class="string">'eid'</span>,<span class="string">''</span>)                 <span class="comment"># 发布会id</span></span><br><span class="line">name = request.POST.get(<span class="string">'name'</span>,<span class="string">''</span>)               <span class="comment"># 发布会标题</span></span><br><span class="line">limit = request.POST.get(<span class="string">'limit'</span>,<span class="string">''</span>)             <span class="comment"># 限制人数</span></span><br><span class="line">status = request.POST.get(<span class="string">'status'</span>,<span class="string">''</span>)           <span class="comment"># 状态</span></span><br><span class="line">address = request.POST.get(<span class="string">'address'</span>,<span class="string">''</span>)         <span class="comment"># 地址</span></span><br><span class="line">start_time = request.POST.get(<span class="string">'start_time'</span>,<span class="string">''</span>)   <span class="comment"># 发布会时间</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 首先，判断 eid、 name、limit、address、start_time 等字段均不能为空</span></span><br><span class="line"><span class="keyword">if</span> eid ==<span class="string">''</span> <span class="keyword">or</span> name == <span class="string">''</span> <span class="keyword">or</span> limit == <span class="string">''</span> <span class="keyword">or</span> address == <span class="string">''</span> <span class="keyword">or</span> start_time == <span class="string">''</span>:</span><br><span class="line"><span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10021</span>,<span class="string">'message'</span>:<span class="string">'parameter error'</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 接下来，判断发布会 id 是否存在</span></span><br><span class="line">result =Event.objects.filter(id=eid)</span><br><span class="line"><span class="keyword">if</span> result:</span><br><span class="line"><span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10022</span>,<span class="string">'message'</span>:<span class="string">'event id already exists'</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 接下来，判断发布会名称 name 是否存在</span></span><br><span class="line">result = Event.objects.filter(name=name)</span><br><span class="line"><span class="keyword">if</span> result:</span><br><span class="line"><span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10023</span>, <span class="string">'message'</span>:<span class="string">'event name already exists'</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 再接下来，判断发布会状态是否为空，如果为空，将状态设置为 1（True）。</span></span><br><span class="line"><span class="keyword">if</span> status == <span class="string">''</span>:</span><br><span class="line">status = <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 最后，将数据插入到 Event 表，在插入的过程中如果日期格式错误，将抛出 ValidationError 异常</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">Event.objects.create(id=eid,name=name,limit=limit,address=address,status=int(status),start_time=start_time)</span><br><span class="line"><span class="keyword">except</span> ValidationError:</span><br><span class="line">error = <span class="string">'start_time format error. It must be in YYYY-MM-DD HH:MM:SS format.'</span></span><br><span class="line"><span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10024</span>,<span class="string">'message'</span>:error&#125;)</span><br><span class="line"><span class="comment"># 否则，插入成功，返回状态码 200 和“addeventsuccess”的提示。</span></span><br><span class="line"><span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">200</span>,<span class="string">'message'</span>:<span class="string">'add event success'</span>&#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># AES加密算法</span></span><br><span class="line">BS = <span class="number">16</span></span><br><span class="line"><span class="comment"># 通过 upad 匿名函数对字符串的长度还原</span></span><br><span class="line">unpad = <span class="keyword">lambda</span> s : s[<span class="number">0</span>: - ord(s[<span class="number">-1</span>])]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decryptBase64</span><span class="params">(src)</span>:</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">对 Base64 字符串解密</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="keyword">return</span> base64.urlsafe_b64decode(src)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decryptAES</span><span class="params">(src, key)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    解析AES密文</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line"><span class="comment"># 调用 decryptBase64()方法，将 Base64 加密字符串解密为 AES 加密字符串。</span></span><br><span class="line">    src = decryptBase64(src)</span><br><span class="line">    iv = <span class="string">b"1172311105789011"</span></span><br><span class="line"><span class="comment"># 通过 decrypt() 对 AES 加密串进行解密。</span></span><br><span class="line">    cryptor = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line">    text = cryptor.decrypt(src).decode()</span><br><span class="line">    <span class="keyword">return</span> unpad(text)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">aes_encryption</span><span class="params">(request)</span>:</span></span><br><span class="line"><span class="comment"># 服务器端与合法客户端约定的密钥 app_key。</span></span><br><span class="line">    app_key = <span class="string">'W7v4D60fds2Cmk2U'</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 判断客户端请求是否为 POST，通过 POST.get()方法接收 data 参数</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'POST'</span>:</span><br><span class="line">        data = request.POST.get(<span class="string">"data"</span>, <span class="string">""</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"error"</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 解密，调用解密函数 decryptAES() ，传参加密字符串和 app_key</span></span><br><span class="line">    decode = decryptAES(data, app_key)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 转化为字典，将解密后字符串通过 json.loads()方法转化成字典，并将该字典做为 aes_encryption()函数的返回值</span></span><br><span class="line">    dict_data = json.loads(decode)</span><br><span class="line">    <span class="keyword">return</span> dict_data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 嘉宾查询接口----AES算法</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_guest_list</span><span class="params">(request)</span>:</span></span><br><span class="line">    dict_data = aes_encryption(request)  <span class="comment"># 调用加密字符串解密函数</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> dict_data == <span class="string">"error"</span>:</span><br><span class="line">        <span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10011</span>,<span class="string">'message'</span>:<span class="string">'request error'</span>&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 取出对应的发布会id和嘉宾手机号</span></span><br><span class="line">    eid = dict_data[<span class="string">'eid'</span>]</span><br><span class="line">    phone = dict_data[<span class="string">'phone'</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> eid == <span class="string">''</span>:</span><br><span class="line">        <span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10021</span>,<span class="string">'message'</span>:<span class="string">'eid cannot be empty'</span>&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> eid != <span class="string">''</span> <span class="keyword">and</span> phone == <span class="string">''</span>:</span><br><span class="line">        datas = []</span><br><span class="line">        results = Guest.objects.filter(event_id=eid)</span><br><span class="line">        <span class="keyword">if</span> results:</span><br><span class="line">            <span class="keyword">for</span> r <span class="keyword">in</span> results:</span><br><span class="line">                guest = &#123;&#125;</span><br><span class="line">                guest[<span class="string">'realname'</span>] = r.realname</span><br><span class="line">                guest[<span class="string">'phone'</span>] = r.phone</span><br><span class="line">                guest[<span class="string">'email'</span>] = r.email</span><br><span class="line">                guest[<span class="string">'sign'</span>] = r.sign</span><br><span class="line">                datas.append(guest)</span><br><span class="line">            <span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">200</span>, <span class="string">'message'</span>:<span class="string">'success'</span>, <span class="string">'data'</span>:datas&#125;)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10022</span>, <span class="string">'message'</span>:<span class="string">'query result is empty'</span>&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> eid != <span class="string">''</span> <span class="keyword">and</span> phone != <span class="string">''</span>:</span><br><span class="line">        guest = &#123;&#125;</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            result = Guest.objects.get(phone=phone,event_id=eid)</span><br><span class="line">        <span class="keyword">except</span> ObjectDoesNotExist:</span><br><span class="line">            <span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10022</span>, <span class="string">'message'</span>:<span class="string">'query result is empty'</span>&#125;)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            guest[<span class="string">'realname'</span>] = result.realname</span><br><span class="line">            guest[<span class="string">'phone'</span>] = result.phone</span><br><span class="line">            guest[<span class="string">'email'</span>] = result.email</span><br><span class="line">            guest[<span class="string">'sign'</span>] = result.sign</span><br><span class="line">            <span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">200</span>, <span class="string">'message'</span>:<span class="string">'success'</span>, <span class="string">'data'</span>:guest&#125;)</span><br></pre></td></tr></table></figure></p><p>guest/sign/templates/index.html<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Django Page<span class="tag">&lt;/<span class="name">title</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>发布会管理<span class="tag">&lt;/<span class="name">h1</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">action</span>=<span class="string">"/login_action/"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">placeholder</span>=<span class="string">"username"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">placeholder</span>=<span class="string">"password"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">&#123;&#123; error &#125;&#125;<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"btn"</span> <span class="attr">type</span>=<span class="string">"submit"</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">&#123;% csrf_token %&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>guest/sign/templates/event_manage.html<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"zh-CN"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span> </span><br><span class="line">&#123;% load bootstrap3 %&#125;</span><br><span class="line">&#123;% bootstrap_css %&#125;</span><br><span class="line">&#123;% bootstrap_javascript %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Guest Manage<span class="tag">&lt;/<span class="name">title</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span> </span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">role</span>=<span class="string">"document"</span>&gt;</span> </span><br><span class="line"><span class="comment">&lt;!-- 导航栏 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">nav</span> <span class="attr">class</span>=<span class="string">"navbar navbar-inverse navbar-fixed-top"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"navbar-header"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"navbar-brand"</span> <span class="attr">href</span>=<span class="string">"/event_manage/"</span>&gt;</span>Guest Manage System<span class="tag">&lt;/<span class="name">a</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"navbar"</span> <span class="attr">class</span>=<span class="string">"collapse navbar-collapse"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"nav navbar-nav"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"active"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>发布会<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/guest_manage/"</span>&gt;</span>嘉宾<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"nav navbar-nav navbar-right"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>&#123;&#123;user&#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/logout/"</span>&gt;</span>退出<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--发布会搜索表单--&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"page-header"</span> <span class="attr">style</span>=<span class="string">"padding-top: 60px;"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"navbar"</span> <span class="attr">class</span>=<span class="string">"navbar-collapse collapse"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">class</span>=<span class="string">"navbar-form"</span> <span class="attr">method</span>=<span class="string">"get"</span> <span class="attr">action</span>=<span class="string">"/search_name/"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">placeholder</span>=<span class="string">"名称"</span> <span class="attr">class</span>=<span class="string">"form-control"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">class</span>=<span class="string">"btn btn-success"</span>&gt;</span>搜索<span class="tag">&lt;/<span class="name">button</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 发布会列表 --&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row"</span> <span class="attr">style</span>=<span class="string">"padding-top: 80px;"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-md-6"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">"table table-striped"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">thead</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">th</span>&gt;</span>id<span class="tag">&lt;/<span class="name">th</span>&gt;</span><span class="tag">&lt;<span class="name">th</span>&gt;</span>名称<span class="tag">&lt;/<span class="name">th</span>&gt;</span><span class="tag">&lt;<span class="name">th</span>&gt;</span>状态<span class="tag">&lt;/<span class="name">th</span>&gt;</span><span class="tag">&lt;<span class="name">th</span>&gt;</span>地址<span class="tag">&lt;/<span class="name">th</span>&gt;</span><span class="tag">&lt;<span class="name">th</span>&gt;</span>时间<span class="tag">&lt;/<span class="name">th</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">th</span>&gt;</span>签到<span class="tag">&lt;/<span class="name">th</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tbody</span>&gt;</span> </span><br><span class="line">&#123;% for event in events %&#125; </span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; event.id &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; event.name &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; event.status &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; event.address &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; event.start_time &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">td</span>&gt;</span> <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/sign_index/&#123;&#123; event.id &#125;&#125;/"</span> <span class="attr">target</span>=<span class="string">"&#123;&#123; event.id &#125;&#125;_blank"</span>&gt;</span> sign<span class="tag">&lt;/<span class="name">a</span>&gt;</span> <span class="tag">&lt;/<span class="name">td</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span> </span><br><span class="line">&#123;% endfor %&#125; </span><br><span class="line"><span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>guest/sign/templates/guest_manage.html<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"zh-CN"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span> </span><br><span class="line">&#123;% load bootstrap3 %&#125;</span><br><span class="line">&#123;% bootstrap_css %&#125;</span><br><span class="line">&#123;% bootstrap_javascript %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Guest Manage<span class="tag">&lt;/<span class="name">title</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span> </span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">role</span>=<span class="string">"document"</span>&gt;</span> </span><br><span class="line"><span class="comment">&lt;!-- 导航栏 --&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">nav</span> <span class="attr">class</span>=<span class="string">"navbar navbar-inverse navbar-fixed-top"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"navbar-header"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"navbar-brand"</span> <span class="attr">href</span>=<span class="string">"/event_manage/"</span>&gt;</span>Guest Manage System<span class="tag">&lt;/<span class="name">a</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"navbar"</span> <span class="attr">class</span>=<span class="string">"collapse navbar-collapse"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"nav navbar-nav"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/event_manage/"</span>&gt;</span>发布会<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"active"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>嘉宾<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"nav navbar-nav navbar-right"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>&#123;&#123;user&#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/logout/"</span>&gt;</span>退出<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 嘉宾列表 --&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row"</span> <span class="attr">style</span>=<span class="string">"padding-top: 80px;"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-md-6"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">"table table-striped"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">thead</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">th</span>&gt;</span>id<span class="tag">&lt;/<span class="name">th</span>&gt;</span><span class="tag">&lt;<span class="name">th</span>&gt;</span>名称<span class="tag">&lt;/<span class="name">th</span>&gt;</span><span class="tag">&lt;<span class="name">th</span>&gt;</span>手机<span class="tag">&lt;/<span class="name">th</span>&gt;</span><span class="tag">&lt;<span class="name">th</span>&gt;</span>Email<span class="tag">&lt;/<span class="name">th</span>&gt;</span><span class="tag">&lt;<span class="name">th</span>&gt;</span>签到<span class="tag">&lt;/<span class="name">th</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">th</span>&gt;</span>发布会<span class="tag">&lt;/<span class="name">th</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">thead</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">tbody</span>&gt;</span> </span><br><span class="line">&#123;% for guest in guests %&#125; </span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; guest.id &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; guest.realname &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; guest.phone &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; guest.email &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; guest.sign &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; guest.event &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span> </span><br><span class="line">&#123;% endfor %&#125; </span><br><span class="line"><span class="tag">&lt;/<span class="name">tbody</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">table</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 列表分页器 --&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"pagination"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"step-links"</span>&gt;</span></span><br><span class="line">&#123;% if guests.has_previous %&#125; </span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"?page=&#123;&#123; guests.previous_page_number &#125;&#125;"</span>&gt;</span>previous<span class="tag">&lt;/<span class="name">a</span>&gt;</span> </span><br><span class="line">&#123;% endif %&#125; </span><br><span class="line"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"current"</span>&gt;</span> </span><br><span class="line">Page &#123;&#123; guests.number &#125;&#125; of &#123;&#123; guests.paginator.num_pages &#125;&#125;. </span><br><span class="line"><span class="tag">&lt;/<span class="name">span</span>&gt;</span> </span><br><span class="line">&#123;% if guests.has_next %&#125; </span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"?page=&#123;&#123; guests.next_page_number &#125;&#125;"</span>&gt;</span>next<span class="tag">&lt;/<span class="name">a</span>&gt;</span> </span><br><span class="line">&#123;% endif %&#125; </span><br><span class="line"><span class="tag">&lt;/<span class="name">span</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>guest/sign/templates/sign_index.html<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"zh-CN"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span> </span><br><span class="line">&#123;% load bootstrap3 %&#125;</span><br><span class="line">&#123;% bootstrap_css %&#125;</span><br><span class="line">&#123;% bootstrap_javascript %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>Guest Manage<span class="tag">&lt;/<span class="name">title</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">role</span>=<span class="string">"document"</span>&gt;</span> </span><br><span class="line"><span class="comment">&lt;!-- 导航栏 --&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">nav</span> <span class="attr">class</span>=<span class="string">"navbar navbar-inverse navbar-fixed-top"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"navbar-header"</span>&gt;</span> </span><br><span class="line"><span class="comment">&lt;!--将页面标题设置为发布会名称--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"navbar-brand"</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>&#123;&#123; event.name &#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"navbar"</span> <span class="attr">class</span>=<span class="string">"collapse navbar-collapse"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"nav navbar-nav"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/event_manage/"</span>&gt;</span>发布会<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/guest_manage/"</span>&gt;</span>嘉宾<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">ul</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 签到功能 --&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"page-header"</span> <span class="attr">style</span>=<span class="string">"padding-top: 80px;"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"navbar"</span> <span class="attr">class</span>=<span class="string">"navbar-collapse collapse"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">class</span>=<span class="string">"navbar-form"</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">action</span>=<span class="string">"/sign_index_action/&#123;&#123; event.id &#125;&#125;/"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"phone"</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">placeholder</span>=<span class="string">"输入手机号"</span> <span class="attr">class</span>=<span class="string">"form-control"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">class</span>=<span class="string">"btn btn-success"</span>&gt;</span>签到<span class="tag">&lt;/<span class="name">button</span>&gt;</span> </span><br><span class="line">&#123;% csrf_token %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">font</span> <span class="attr">color</span>=<span class="string">"red"</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>&gt;</span>&#123;&#123; hint &#125;&#125; </span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>&gt;</span>&#123;&#123; guest.realname &#125;&#125; </span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>&gt;</span>&#123;&#123; guest.phone &#125;&#125; </span><br><span class="line"><span class="tag">&lt;/<span class="name">font</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p><h3 id="2、django-rest项目"><a href="#2、django-rest项目" class="headerlink" title="2、django_rest项目"></a>2、django_rest项目</h3><blockquote><ul><li>django_rest/<ul><li>django_rest/<ul><li>__init__.py</li><li>settings.py</li><li>urls.py</li><li>wsgi.py</li></ul></li><li>api/<ul><li>migrations/<ul><li>__init__.py</li><li>0001_initial.py</li></ul></li><li>__init__.py</li><li>admin.py</li><li>apps.py</li><li>models.py</li><li>serializers.py</li><li>tests.py</li><li>views.py</li></ul></li><li>db.sqlite3</li><li>manage.py</li></ul></li></ul></blockquote><p>guest/django_rest/settings.py<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在文件末尾添加 </span></span><br><span class="line">REST_FRAMEWORK = &#123; </span><br><span class="line"><span class="string">'DEFAULT_PERMISSION_CLASSES'</span>: (<span class="string">'rest_framework.permissions.IsAdminUser'</span>,), </span><br><span class="line"><span class="string">'PAGE_SIZE'</span>: <span class="number">10</span> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>guest/django_rest/urls.py<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"><span class="keyword">from</span> django.conf.urls <span class="keyword">import</span> url, include</span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> routers</span><br><span class="line"><span class="keyword">from</span> api <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">因为我们使用的是 viewset，所以我们可以使用 routers 类自动生成 URLconf</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="comment">#Routers provide an easy way of automatically determining the URL conf. </span></span><br><span class="line">router = routers.DefaultRouter()</span><br><span class="line">router.register(<span class="string">r'users'</span>,views.UserViewSet)</span><br><span class="line">router.register(<span class="string">r'groups'</span>,views.GroupViewSet)</span><br><span class="line">router.register(<span class="string">r'event'</span>, views.EventViewSet) </span><br><span class="line">router.register(<span class="string">r'guest'</span>, views.GuestViewSet)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Wire up our API using automatic URL routing. </span></span><br><span class="line"><span class="comment"># Additionally, we include login URLs for the browsable API. </span></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">'admin/'</span>, admin.site.urls),</span><br><span class="line">url(<span class="string">r'^'</span>, include(router.urls)),</span><br><span class="line">url(<span class="string">r'api-auth/'</span>, include(<span class="string">'rest_framework.urls'</span>,namespace=<span class="string">'rest_framework'</span>))</span><br><span class="line">]</span><br></pre></td></tr></table></figure></p><p>guest/api/models.py<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create your models here.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 发布会</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Event</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">name = models.CharField(max_length=<span class="number">100</span>)</span><br><span class="line">limit = models.IntegerField()</span><br><span class="line">status = models.BooleanField()</span><br><span class="line">address = models.CharField(max_length=<span class="number">200</span>)</span><br><span class="line">start_time = models.DateTimeField(<span class="string">'events time'</span>)</span><br><span class="line">create_time = models.DateTimeField(auto_now=<span class="keyword">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line"><span class="keyword">return</span> self.name</span><br><span class="line"></span><br><span class="line"><span class="comment"># 嘉宾</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Guest</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">event = models.ForeignKey(Event, on_delete=models.CASCADE)</span><br><span class="line">realname = models.CharField(max_length=<span class="number">64</span>)</span><br><span class="line">phone = models.CharField(max_length=<span class="number">16</span>)</span><br><span class="line">email = models.EmailField() </span><br><span class="line">sign = models.BooleanField() </span><br><span class="line">create_time = models.DateTimeField(auto_now=<span class="keyword">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">unique_together = (<span class="string">'phone'</span>, <span class="string">'event'</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line"><span class="keyword">return</span> self.realname</span><br></pre></td></tr></table></figure></p><p>guest/api/serializers.py<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib.auth.models <span class="keyword">import</span> User, Group</span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> serializers</span><br><span class="line"><span class="keyword">from</span> api.models <span class="keyword">import</span> Event, Guest</span><br><span class="line"></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">使用的是 HyperlinkedModelSerializer，也可以使用主键或者其他关系。</span></span><br><span class="line"><span class="string">但使用 HyperlinkedModelSerializer 是一个好的 RESTful 设计</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserSerializer</span><span class="params">(serializers.HyperlinkedModelSerializer)</span>:</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">model = User</span><br><span class="line">fields = (<span class="string">'url'</span>, <span class="string">'username'</span>, <span class="string">'email'</span>, <span class="string">'groups'</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GroupSerializer</span><span class="params">(serializers.HyperlinkedModelSerializer)</span>:</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">model = Group</span><br><span class="line">fields = (<span class="string">'url'</span>, <span class="string">'name'</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EventSerializer</span><span class="params">(serializers.HyperlinkedModelSerializer)</span>:</span> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span> </span><br><span class="line">model = Event </span><br><span class="line">fields = (<span class="string">'url'</span>,<span class="string">'name'</span>,<span class="string">'address'</span>,<span class="string">'start_time'</span>,<span class="string">'limit'</span>,<span class="string">'status'</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GuestSerializer</span><span class="params">(serializers.HyperlinkedModelSerializer)</span>:</span> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span> </span><br><span class="line">model = Guest </span><br><span class="line">fields = (<span class="string">'url'</span>,<span class="string">'realname'</span>,<span class="string">'phone'</span>,<span class="string">'email'</span>,<span class="string">'sign'</span>,<span class="string">'event'</span>)</span><br></pre></td></tr></table></figure></p><p>guest/api/views.py<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"><span class="keyword">from</span> django.contrib.auth.models <span class="keyword">import</span> User, Group</span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> viewsets</span><br><span class="line"><span class="keyword">from</span> api.serializers <span class="keyword">import</span> UserSerializer, GroupSerializer</span><br><span class="line"><span class="keyword">from</span> api.serializers <span class="keyword">import</span> EventSerializer, GuestSerializer </span><br><span class="line"><span class="keyword">from</span> api.models <span class="keyword">import</span> Event, Guest</span><br><span class="line"></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">在 django RESTframework 中，所有常见的行为都被归到 ViewSets 中。</span></span><br><span class="line"><span class="string">当然我们可以将这些行为分拆出 来，但使用 ViewSets，使 view 的逻辑更为清楚。</span></span><br><span class="line"><span class="string">使用 queryset 和 serializer_class 使我们能更好的控制 API 行为，这也是我们推荐的使用方式。</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Create your views here.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ViewSets define the view behavior.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserViewSet</span><span class="params">(viewsets.ModelViewSet)</span>:</span></span><br><span class="line"><span class="string">""" </span></span><br><span class="line"><span class="string">API endpoint that allows users to be viewed or edited. </span></span><br><span class="line"><span class="string">"""</span> </span><br><span class="line">queryset = User.objects.all().order_by(<span class="string">'-date_joined'</span>)</span><br><span class="line">serializer_class = UserSerializer</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GroupViewSet</span><span class="params">(viewsets.ModelViewSet)</span>:</span> </span><br><span class="line"><span class="string">""" </span></span><br><span class="line"><span class="string">API endpoint that allows groups to be viewed or edited. </span></span><br><span class="line"><span class="string">"""</span> </span><br><span class="line">queryset = Group.objects.all()</span><br><span class="line">serializer_class = GroupSerializer</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EventViewSet</span><span class="params">(viewsets.ModelViewSet)</span>:</span> </span><br><span class="line"><span class="string">""" </span></span><br><span class="line"><span class="string">API endpoint that allows events to be viewed or edited. </span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line">queryset = Event.objects.all()</span><br><span class="line">serializer_class = EventSerializer</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GuestViewSet</span><span class="params">(viewsets.ModelViewSet)</span>:</span></span><br><span class="line"><span class="string">""" </span></span><br><span class="line"><span class="string">API endpoint that allows guests to be viewed or edited. </span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line">queryset = Guest.objects.all()</span><br><span class="line">serializer_class = GuestSerializer</span><br></pre></td></tr></table></figure></p><h1 id="持续更新…—"><a href="#持续更新…—" class="headerlink" title="持续更新…—"></a><em>持续更新…</em>—</h1><p>title: django-签到系统<br>date: 2018-08-14 15:36:35</p><h2 id="tags"><a href="#tags" class="headerlink" title="tags:"></a>tags:</h2>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;虫师所写django签到系统的学习笔记。&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="django" scheme="http://pythonfood.github.io/categories/django/"/>
    
    
      <category term="django" scheme="http://pythonfood.github.io/tags/django/"/>
    
  </entry>
  
  <entry>
    <title>持续集成-jenkins</title>
    <link href="http://pythonfood.github.io/2018/05/01/%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90-jenkins/"/>
    <id>http://pythonfood.github.io/2018/05/01/持续集成-jenkins/</id>
    <published>2018-05-01T04:00:00.000Z</published>
    <updated>2018-05-11T06:59:51.195Z</updated>
    
    <content type="html"><![CDATA[<p>持续集成jenkins使用笔记。<br><a id="more"></a></p><h2 id="一、持续集成流程"><a href="#一、持续集成流程" class="headerlink" title="一、持续集成流程"></a>一、持续集成流程</h2><p>(1)提交代码<br>(2)拉取代码<br>(3)编译<br>(4)打包<br>(5)配置<br>(6)测试<br>(7)反馈问题<br>(8)开发处理<br>(9)回到(1)</p><h2 id="二、持续集成工具"><a href="#二、持续集成工具" class="headerlink" title="二、持续集成工具"></a>二、持续集成工具</h2><p>(1)代码管理工具：</p><blockquote><p>Git：官网下载安装<a href="https://git-scm.com/downloads" target="_blank" rel="noopener">https://git-scm.com/downloads</a><br>GitHub：官网地址<a href="https://github.com/" target="_blank" rel="noopener">https://github.com/</a></p></blockquote><p>(2)集成工具：</p><blockquote><p>Jenkins：官网下载安装<a href="https://jenkins.io/download/" target="_blank" rel="noopener">https://jenkins.io/download/</a><br>1)安装后会自动启动浏览器，输入<a href="http://localhost:8080" target="_blank" rel="noopener">http://localhost:8080</a><br>2)根据页面中标红路径找到管理员密码吗<br>3)输入管理员密码，点击【Continue】<br>4)安装插件，默认选项即可<br>5)安装完需要创建用户，此处点击【Continue as admin】使用默认账户即可<br>6)点击【Start using Jekins】启动<br>7)修改密码，进入【admin-设置】，向上拉找到密码处即可修改</p></blockquote><h2 id="三、Jenkins系统配置"><a href="#三、Jenkins系统配置" class="headerlink" title="三、Jenkins系统配置"></a>三、Jenkins系统配置</h2><p>(1)插件管理：</p><blockquote><p>1)进入【系统管理-管理插件-已安装】查看下面插件：</p><blockquote><ul><li>Git Plugin</li><li>GitHub Plugin</li><li>Gradle Plugin</li><li>Android Emulator Plugin</li></ul></blockquote><p>2)未安装的进入【可选插件】里安装即可</p></blockquote><p>(2)Gradle配置：</p><blockquote><p>1)进入【系统管理-全局工具配置】找到【Gradle安装】<br>2)点击【新增Gradle】<br>3)选择自动安装，名称输入和版本一致即可<br>4)再点击【Apply】-【Save】</p></blockquote><p>(3)GitHub配置：</p><blockquote><p>1)进入【系统管理-系统设置】找到【GitHub】<br>2)点击【Add GitHub Server】<br>3)在【GitHub Server】的【API URL】输入(<a href="https://api.github.com" target="_blank" rel="noopener">https://api.github.com</a>)<br>4)再点击【Credentials】右侧的问号设置权限，展开的内容里右键点击【personal access token】新窗口打开github<br>5)在github页面【Token description】输入自定义名称,勾选【repo】,点击【Generate token】<br>6)在github页面生成Personal access tokens后复制<br>7)回到jenkins页面点击【add】-【jenkins】<br>8)在弹出窗口里【Kind】类别选择【Secret text】,将刚才复制的token粘贴到【Secret】，再点击【add】就创建了身份信息<br>9)可以点击【Test connection】验证一下，验证通过后点击【保存】</p></blockquote><h2 id="四、Jenkins-JOB配置"><a href="#四、Jenkins-JOB配置" class="headerlink" title="四、Jenkins JOB配置"></a>四、Jenkins JOB配置</h2><p>创建任务：</p><blockquote><p>1)点击页面中【创建一个新任务】<br>2)输入任务名称，选择【构建一个自由风格的软件项目】，点击【确定】进入设置界面<br>3)进行自定义配置后点击【保存】</p></blockquote><h2 id="五、JOB配置小示例"><a href="#五、JOB配置小示例" class="headerlink" title="五、JOB配置小示例"></a>五、JOB配置小示例</h2><p>进入创建的任务详情界面，点击【配置】进行job配置<br>(1)拉取代码：</p><blockquote><p>1)【源码管理】选择【Git】，输入代码库的URL地址<br>2)点击【Add】-【jenkins】配置github权限<br>3)弹出界面输入github的帐户名和密码，点击【Add】添加<br>4)【Credentials】选择刚添加的github账户</p></blockquote><p>(2)编译、打包：</p><blockquote><p>1)【构建】点击【增加构建步骤】<br>2)选择【Invoke Gradle script】<br>3)【Gradle Version】选择对应版本<br>4)【Tasks】填写“build”等信息</p></blockquote><p>(3)配置：</p><blockquote><p>1)【构建】点击【增加构建步骤】<br>2)选择【Install Android package】<br>3)【APK file】填写生成的apk路径（此处可以先生构建一次4)查看路径，再复制到这里）<br>5)勾选【Uninstall existing APK first】</p></blockquote><p>(4)测试：</p><blockquote><p>1)【构建】点击【增加构建步骤】<br>2)选择【Run Android monkey tester】<br>3)【Package IDs】输入包名<br>4)【Event count】输入执行次数<br>5)【Delay between events】输入间隔时间ms<br>6)点击【Apply】,点击【保存】</p></blockquote><p>(5)立即构建：</p><blockquote><p>1)进入创建的任务详情界面<br>2)点击【立即构建】进行构建<br>3)点击构建的任务可以查看详情<br>4)【Console Output】可以查看日志信息</p></blockquote><p>(6)定时构建：</p><blockquote><p>1)进入创建的任务详情界面<br>2)点击【配置】进行job配置<br>3)【构建触发器】下选择【Build periodically】<br>4)【日程表】里输入规则，例如“H/15 <em> </em> <em> </em>”(每15分钟构建一次)<br>5)点击【日程表】右侧问号，可以查看规则描述<br>6)点击【Apply】,点击【保存】</p></blockquote><h1 id="持续更新…"><a href="#持续更新…" class="headerlink" title="持续更新…"></a><em>持续更新…</em></h1>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;持续集成jenkins使用笔记。&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="持续集成" scheme="http://pythonfood.github.io/categories/%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90/"/>
    
    
      <category term="jenkins" scheme="http://pythonfood.github.io/tags/jenkins/"/>
    
  </entry>
  
  <entry>
    <title>unittest测试框架</title>
    <link href="http://pythonfood.github.io/2018/05/01/unittest%E6%B5%8B%E8%AF%95%E6%A1%86%E6%9E%B6/"/>
    <id>http://pythonfood.github.io/2018/05/01/unittest测试框架/</id>
    <published>2018-05-01T01:00:00.000Z</published>
    <updated>2018-05-11T06:59:06.744Z</updated>
    
    <content type="html"><![CDATA[<p>unittest中最核心的四个概念是：test fixture, test case, test suite, test runner。<br><a id="more"></a></p><h2 id="一、unittest框架"><a href="#一、unittest框架" class="headerlink" title="一、unittest框架"></a>一、unittest框架</h2><p>(1)Test Fixture</p><ul><li>setup()</li><li>testcase()</li><li>teardown()</li></ul><p>(2)Test Case<br>(3)Test Suite<br>(4)Test Runner</p><h2 id="二、unittest小示例"><a href="#二、unittest小示例" class="headerlink" title="二、unittest小示例"></a>二、unittest小示例</h2><blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">import unittestdemo1</span><br><span class="line">import unittestdemo2</span><br><span class="line">import unittest</span><br><span class="line">from appium import webdriver</span><br><span class="line"></span><br><span class="line">class MyTestCase(unittest.TestCase):</span><br><span class="line">#初始化setup</span><br><span class="line">def setUp(self):</span><br><span class="line">desired_caps=&#123;&#125;</span><br><span class="line">        desired_caps[&apos;platformName&apos;]=&apos;Android&apos;</span><br><span class="line">        desired_caps[&apos;platformVersion&apos;]=&apos;5.1.1&apos;</span><br><span class="line">        desired_caps[&apos;deviceName&apos;]=&apos;61f9c06a&apos;</span><br><span class="line">        desired_caps[&apos;appPackage&apos;]=&apos;com.android.contacts&apos;</span><br><span class="line">        desired_caps[&apos;appActivity&apos;]=&apos;com.android.contacts.DialtactsContactsEntryActivity&apos;</span><br><span class="line">        desired_caps[&apos;unicodeKeyboard&apos;]=&apos;true&apos;</span><br><span class="line">        desired_caps[&apos;resetKeyboard&apos;]=&apos;true&apos;</span><br><span class="line">        self.driver = webdriver.Remote(&apos;http://127.0.0.1:4723/wd/hub&apos;, desired_caps)</span><br><span class="line"></span><br><span class="line">#测试用例1</span><br><span class="line">def test_something(self):</span><br><span class="line">self.assertEqual(False, True)</span><br><span class="line">print(&apos;test_something&apos;)</span><br><span class="line">#测试用例2</span><br><span class="line">def test_anything(self):</span><br><span class="line">self.assertEqual(True, True)</span><br><span class="line">print(&apos;test_anything&apos;)</span><br><span class="line"></span><br><span class="line">#释放资源teardown</span><br><span class="line">def tearDown(self):</span><br><span class="line">self.driver.quit()</span><br><span class="line"></span><br><span class="line">if __name__ ==&quot;__main__&quot;:</span><br><span class="line">#以类的形式添加测试用例</span><br><span class="line">cases1 = unittest.TestLoader().loadTestsFromTestCase(unittestdemo1.MyTestCase)</span><br><span class="line">cases2 = unittest.TestLoader().loadTestsFromTestCase(unittestdemo2.MyTestCase)</span><br><span class="line">#定义suite</span><br><span class="line">suite = unittest.TestSuite([cases1, cases2])</span><br><span class="line">#以单条测试用例形式装载</span><br><span class="line">    suite.addTest(MyTestCase(&apos;test_something&apos;))</span><br><span class="line">suite.addTest(MyTestCase(&apos;test_anything&apos;))</span><br><span class="line">    </span><br><span class="line">#定义runner</span><br><span class="line">    runner = unittest.TextTestRunner(verbosity=2)</span><br><span class="line">#用runner执行suite</span><br><span class="line">    runner.run(suite)</span><br></pre></td></tr></table></figure></blockquote><h2 id="三、DDT数据驱动模式"><a href="#三、DDT数据驱动模式" class="headerlink" title="三、DDT数据驱动模式"></a>三、DDT数据驱动模式</h2><p>(1)官网下载安装：<a href="https://pypi.python.org/pypi/ddt" target="_blank" rel="noopener">https://pypi.python.org/pypi/ddt</a><br>(2)使用前导入模块<code>from ddt import ddt,data,unpack</code><br>(3)首先说明测试类使用的是ddt测试框架：</p><blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@ddt</span><br><span class="line">class MyTestCase(unittest.TestCase)</span><br></pre></td></tr></table></figure></blockquote><p>(4)数据驱动主要是解决带参数的测试用例：<br>1）使用元组存放测试的数据，一个参数的情况：</p><blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@data(1,-3,2,0)</span><br><span class="line">def testcase(self, value):</span><br></pre></td></tr></table></figure></blockquote><p>2）使用元组存放测试的数据，多个参数的情况：</p><blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@data((3,2),(4,3),(5,3))</span><br><span class="line">@unpack</span><br><span class="line">def testcase(self, value1, value2):</span><br></pre></td></tr></table></figure></blockquote><h2 id="四、DDT小示例"><a href="#四、DDT小示例" class="headerlink" title="四、DDT小示例"></a>四、DDT小示例</h2><blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">from ddt import ddt,data,unpack</span><br><span class="line"></span><br><span class="line">@ddt</span><br><span class="line">class MyTestCase(unittest.TestCase):</span><br><span class="line"></span><br><span class="line">@data(1,2,3)</span><br><span class="line">def test_something(self, value):</span><br><span class="line">print(value)</span><br><span class="line">self.assertEqual(value, 2)</span><br><span class="line"></span><br><span class="line">@data((1,2),(2,3))</span><br><span class="line">@unpack</span><br><span class="line">def test_anything(self, value1, value2):</span><br><span class="line">print(value1,value2)</span><br><span class="line">self.assertEqual(value2, value1+1)</span><br><span class="line"></span><br><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line">unittest.main()</span><br></pre></td></tr></table></figure></blockquote><p>ps:使用ddt框架后，测试用例的名称会改变，所以装载Test Suite时不能使用单条测试用例装载了，尽量使用类的形式装载Test Suite。</p><h1 id="持续更新…"><a href="#持续更新…" class="headerlink" title="持续更新…"></a><em>持续更新…</em></h1>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;unittest中最核心的四个概念是：test fixture, test case, test suite, test runner。&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="测试框架" scheme="http://pythonfood.github.io/categories/%E6%B5%8B%E8%AF%95%E6%A1%86%E6%9E%B6/"/>
    
    
      <category term="unittest" scheme="http://pythonfood.github.io/tags/unittest/"/>
    
  </entry>
  
  <entry>
    <title>接口测试-python</title>
    <link href="http://pythonfood.github.io/2018/04/01/%E6%8E%A5%E5%8F%A3%E6%B5%8B%E8%AF%95-python/"/>
    <id>http://pythonfood.github.io/2018/04/01/接口测试-python/</id>
    <published>2018-04-01T04:00:00.000Z</published>
    <updated>2018-05-11T07:10:53.301Z</updated>
    
    <content type="html"><![CDATA[<p>接口测试python实现脚本测试笔记。<br><a id="more"></a></p><h2 id="一、requests模块"><a href="#一、requests模块" class="headerlink" title="一、requests模块"></a>一、requests模块</h2><p>(1)安装<code>pip install requests</code><br>(2)使用前导入<code>import requests</code></p><h2 id="二、GET请求ddt自动化"><a href="#二、GET请求ddt自动化" class="headerlink" title="二、GET请求ddt自动化"></a>二、GET请求ddt自动化</h2><p>(1)代码结构：</p><blockquote><p>1)构造Header<br>2)构造cookies<br>3)发送Get请求<br>4)获取返回值<br>5)对结果进行校验</p></blockquote><p>(2)代码示例：</p><blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python3</span><br><span class="line">#coding=utf-8</span><br><span class="line"></span><br><span class="line">import requests</span><br><span class="line">import unittest</span><br><span class="line">import ddt</span><br><span class="line"></span><br><span class="line">@ddt.ddt</span><br><span class="line">class ApiTestClass(unittest.TestCase):</span><br><span class="line">    </span><br><span class="line">    @ddt.data(&apos;android&apos;,&apos;&apos;,&apos;ios&apos;)</span><br><span class="line">    def test_Get(self,os_phone):</span><br><span class="line">        #header部分配置</span><br><span class="line">        headers = &#123;&apos;User-Agent&apos;:&apos;Dalvik/1.6.0 (Linux; U; Android 4.3; Coolpad 8720L Build/JSS15Q)&apos;,</span><br><span class="line">                   &apos;Host&apos;:&apos;bdsp.x.jd.com&apos;,</span><br><span class="line">                   &apos;Connection&apos;:&apos;Keep-Alive&apos;,</span><br><span class="line">                   &apos;Accept-Encoding&apos;:&apos;gzip&apos;</span><br><span class="line">                   &#125;</span><br><span class="line">        </span><br><span class="line">        #cookies部分配置</span><br><span class="line">        cookies = dict(search_test = &apos;1&apos;)</span><br><span class="line">        </span><br><span class="line">        #get请求获得返回数据</span><br><span class="line">        res = requests.get(&apos;http://bdsp.x.jd.com/app/config?os=&apos;+os_phone+&apos;&amp;key=wx3ebc9e606b4f9242&amp;sdkv=5&apos;, </span><br><span class="line">                           headers = headers,</span><br><span class="line">                           cookies = cookies)</span><br><span class="line">        </span><br><span class="line">        print(res.text)</span><br><span class="line">        print(res.status_code)</span><br><span class="line">        </span><br><span class="line">        #测试点校验</span><br><span class="line">        self.assertTrue(&apos;15*1000&apos; in res.text)</span><br><span class="line">                      </span><br><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line">    cases = unittest.TestLoader().loadTestsFromTestCase(ApiTestClass)</span><br><span class="line">    suite = unittest.TestSuite([cases])</span><br><span class="line">    #suite.addTest(ApiTestClass(&apos;test_Get&apos;))</span><br><span class="line">    </span><br><span class="line">    runner = unittest.TextTestRunner()</span><br><span class="line">    runner.run(suite)</span><br></pre></td></tr></table></figure></blockquote><h2 id="三、POST请求ddt自动化"><a href="#三、POST请求ddt自动化" class="headerlink" title="三、POST请求ddt自动化"></a>三、POST请求ddt自动化</h2><p>(1)代码结构：</p><blockquote><p>1)构造Keyword(即request body)<br>2)构造Header<br>3)构造cookies<br>4)发送Get请求<br>5)获取返回值<br>6)对结果进行校验</p></blockquote><p>(2)代码示例：</p><blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import unittest</span><br><span class="line">import ddt</span><br><span class="line"></span><br><span class="line">@ddt.ddt</span><br><span class="line">class ApiTestClass(unittest.TestCase):</span><br><span class="line">    </span><br><span class="line">    @ddt.data((&apos;60.206.137.140&apos;,&apos;hjfwp9VflXZU3FsuM3cu6PBV&apos;),</span><br><span class="line">              (&apos;&apos;,&apos;&apos;)</span><br><span class="line">              )</span><br><span class="line">    @ddt.unpack</span><br><span class="line">    def test_Post(self,m_host,m_accessToken):</span><br><span class="line">        #header部分配置</span><br><span class="line">        headers = &#123;&apos;Content-Type&apos;:&apos;application/x-www-form-urlencoded&apos;,</span><br><span class="line">                   &apos;Content-Length&apos;:&apos;36&apos;,</span><br><span class="line">                   &apos;Host&apos;:m_host,</span><br><span class="line">                   &apos;Connection&apos;:&apos;Keep-Alive&apos;,</span><br><span class="line">                   &apos;Accept-Encoding&apos;:&apos;gzip&apos;,</span><br><span class="line">                   &apos;User-Agent&apos;:&apos;okhttp/3.8.1&apos;</span><br><span class="line">                   &#125;</span><br><span class="line">        </span><br><span class="line">        #cookies部分配置</span><br><span class="line">        cookies = dict(search_test = &apos;1&apos;)</span><br><span class="line">        </span><br><span class="line">        #data部分配置</span><br><span class="line">        keyword = &#123;&apos;accessToken&apos;:m_accessToken&#125;</span><br><span class="line">        </span><br><span class="line">        #post请求获得返回数据</span><br><span class="line">        res = requests.post(&apos;http://60.206.137.140/iot_api/family/queryFamilyList.json&apos;, </span><br><span class="line">                           headers = headers,</span><br><span class="line">                           cookies = cookies,</span><br><span class="line">                           data = keyword</span><br><span class="line">                           )</span><br><span class="line">        </span><br><span class="line">        print(res.text)</span><br><span class="line">        print(res.status_code)</span><br><span class="line">        </span><br><span class="line">        #测试点校验</span><br><span class="line">        self.assertTrue(&apos;北京市北京市&apos; in res.text)</span><br><span class="line">                      </span><br><span class="line">if __name__ == &apos;__main__&apos;:</span><br><span class="line">    cases = unittest.TestLoader().loadTestsFromTestCase(ApiTestClass)</span><br><span class="line">    suite = unittest.TestSuite([cases])</span><br><span class="line">    #suite.addTest(ApiTestClass(&apos;test_Post&apos;))</span><br><span class="line">    </span><br><span class="line">    runner = unittest.TextTestRunner()</span><br><span class="line">    runner.run(suite)</span><br></pre></td></tr></table></figure></blockquote><h1 id="持续更新…"><a href="#持续更新…" class="headerlink" title="持续更新…"></a><em>持续更新…</em></h1>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;接口测试python实现脚本测试笔记。&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="接口测试" scheme="http://pythonfood.github.io/categories/%E6%8E%A5%E5%8F%A3%E6%B5%8B%E8%AF%95/"/>
    
    
      <category term="接口脚本" scheme="http://pythonfood.github.io/tags/%E6%8E%A5%E5%8F%A3%E8%84%9A%E6%9C%AC/"/>
    
  </entry>
  
  <entry>
    <title>接口测试-jmeter</title>
    <link href="http://pythonfood.github.io/2018/04/01/%E6%8E%A5%E5%8F%A3%E6%B5%8B%E8%AF%95-jmeter/"/>
    <id>http://pythonfood.github.io/2018/04/01/接口测试-jmeter/</id>
    <published>2018-04-01T03:00:00.000Z</published>
    <updated>2018-05-11T06:58:28.803Z</updated>
    
    <content type="html"><![CDATA[<p>接口测试jmeter工具使用笔记。<br><a id="more"></a></p><h2 id="一、jmeter安装"><a href="#一、jmeter安装" class="headerlink" title="一、jmeter安装"></a>一、jmeter安装</h2><p>1、<a href="https://pythonfood.github.io/2018/02/01/appium安装-windows/#1-安装jdk">安装java</a></p><p>2、安装jmeter</p><blockquote><p>(1)官网下载最新版zip包：<a href="http://jmeter.apache.org/download_jmeter.cgi" target="_blank" rel="noopener">http://jmeter.apache.org/download_jmeter.cgi</a><br>(2)解压下载的zip包到自定义路径即可，例如：<code>D:\Program Files\jmeter</code></p></blockquote><p>3、运行jmeter</p><blockquote><p>(1)进入jmeter解压路径的\bin路径下，例如：<code>D:\Program Files\jmeter\apache-jmeter-4.0\bin</code><br>(2)双击<code>jmeter.bat</code>即可运行jmeter。</p></blockquote><p>4、安装插件</p><blockquote><p>(1)下载 <code>plugins-manager.jar</code>：<a href="http://www.jmeter-plugins.org/get/" target="_blank" rel="noopener">http://www.jmeter-plugins.org/get/</a><br>(2)将下载的jar包放到jmeter路径的\lib\ext路径下，例如：<code>D:\Program Files\jmeter\apache-jmeter-4.0\lib\ext</code><br>(3)启动jmeter，菜单栏【选项】会多出一个【Plugins Manager】的选项。<br>(4)点击 【Plugins Manager】选项打开jmeter插件管理。</p><blockquote><ul><li>Installed Plugins：显示已安装的插件。</li><li>Available Plugins：显示可安装的插件。</li><li>Upgrades：显示可以升级的插件。</li></ul></blockquote><p>(5)通过”勾选/取消勾选”插件，并点击右下角【Apply Changes and Restart JMeter】按钮来卸载、安装、升级插件。</p></blockquote><h2 id="二、jmeter基础原件"><a href="#二、jmeter基础原件" class="headerlink" title="二、jmeter基础原件"></a>二、jmeter基础原件</h2><p><a href="http://jmeter.apache.org/usermanual/component_reference.html#introduction" target="_blank" rel="noopener">官方文档介绍</a></p><h3 id="1、测试计划"><a href="#1、测试计划" class="headerlink" title="1、测试计划"></a>1、测试计划</h3><p>Test Plan 是其它JMeter测试元件的容器，jmeter创建测试的所有内容是于基于一个计划的。<br><img src="/2018/04/01/接口测试-jmeter/测试计划.png" alt="测试计划"></p><p>除了测试计划下的元件还有两种控制器。<br><img src="/2018/04/01/接口测试-jmeter/控制器.png" alt="控制器"></p><h3 id="2、线程用户"><a href="#2、线程用户" class="headerlink" title="2、线程用户"></a>2、线程用户</h3><p>Threads （Users）是一个虚拟用户组，线程组内线程数量在运行过程中不会发生改变。<br><img src="/2018/04/01/接口测试-jmeter/线程用户.png" alt="线程用户"></p><p>(1)thread group(线程组)</p><blockquote><p>1) 名称：可以给线程组设置一个命名。<br>2) 注释：可以对线程组添加备注以标记。<br>3) 在取样器错误后要执行的动作：</p><blockquote><ul><li>继续执行后续的。</li><li>启动下一线程组循环。</li><li>停止线程。</li><li>停止测试。</li><li>立刻停止测试。</li></ul></blockquote><p>4) 线程数：即用户数，一个虚拟用户占用一个进程或线程，需要多少用户并发，设置多少虚拟用户数在这里也就是设置多少个线程数。<br>5) Ramp-Up Period(in seconds)准备时长：设置的虚拟用户数需要多长时间全部启动。如果线程数为100，准备时长为10，那么需要10秒钟启动100个线程，也就是每秒钟启动10个线程。<br>6) 循环次数：每个线程发送请求的次数。</p><blockquote><ul><li>如果线程数为20，循环次数为100，那么每个线程发送100次请求。总请求数为20*100=2000 。</li><li>如果勾选了“永远”，那么所有线程会一直发送请求，一到选择停止运行脚本。</li></ul></blockquote><p>7) Delay Thread creation until needed：直到需要时延迟线程的创建。<br>8) 调度器：可以设置线程组启动的开始时间和结束时间。实践结论是配置调度器时，需要设置循环次数为永远，防止因循环次数不够而终止压测。             </p><blockquote><ul><li>启动时间:测试计划什么时候启动，启动延迟会覆盖它。当启动时间已过，手动运行脚本时也当前时间也会覆盖它(但启动时间页面显示不会变)。</li><li>结束时间：测试计划什么时候结束，持续时间会覆盖它。</li><li>持续时间（秒）：测试计划持续多长时间，会覆盖结束时间。</li><li>启动延迟（秒）：测试计划延迟多长时间启动，会覆盖启动时间。</li></ul></blockquote></blockquote><h3 id="3、配置元件"><a href="#3、配置元件" class="headerlink" title="3、配置元件"></a>3、配置元件</h3><p>Config Element 用于提供对静态数据配置的支持。<br><img src="/2018/04/01/接口测试-jmeter/配置元件.png" alt="配置元件"></p><p>(1)CSV Data Set Config(csv数据文件设置)</p><blockquote><p>1) 名称：可以给元件一个命名。<br>2) 注释：可以对元件添加备注以标记。<br>3) Filename：所需数据文件的路径。如和脚本同一路径，可直接填写文件名<br>4) File encoding：编码和文件保持一致即可，默认为ANSI。如有中文，建议为UTF-8<br>5) Variable Names：引用变量时的变量名，对应数据文件中的每一列，以逗号分隔。如不填写，文件的第一行数据将被读取为变量名<br>6) Delimiter：在.txt、.dat文件中，可以用逗号（,）或者Tab键（\t）来区分列与列<br>7) Allow quoted data：True时，可以使用双引号来识别逗号或双引号（如数据文件中为 1,2,”3,”4”,5” ，则识别出的为A_1=1，B_1=2，C_1=3,”4”,5）<br>8) Recycle on EOF：到数据文件结尾时是否循环读取。设置为True时，线程数过多，数据文件读取到最后一行时，会再次从第一行开始读取。设置为False，到达文件结尾时如继续读取，则值会默认为<eof>，可通过设置jmeter属性csvdataset.eofstring来改变该值。<br>9) Stop thread on EOF：Recycle on EOF设置为False，Stop thread on EOF设置为True，则读取数据文件最后一行后，停止测试，不管还有多少线程组未执行。<br>10) Sharing mode：共享模式。默认在所有线程组中使用，可选择每个线程组单独打开</eof></p><blockquote><ul><li>All threads:文件在所有线程间共享</li><li>Current thread group: 每个文件会针对每个线程组打开一次</li><li>Current thread: 每个文件会针对每个线程单独打开</li><li>Identifier:所有线程共享相同的标识，共享相同的文件。如有４个线程组，测试人员可以使用一个通用ＩＤ，以便在两个或多个线程组之间共享文件。</li></ul></blockquote></blockquote><h3 id="4、监听器"><a href="#4、监听器" class="headerlink" title="4、监听器"></a>4、监听器</h3><p>Listener 是用来对测试结果数据进行处理和可视化展示的一系列元件。<br><img src="/2018/04/01/接口测试-jmeter/监听器.png" alt="监听器"></p><p>(1)View Results in Table(察看结果树)</p><blockquote><p>1) 名称：可以给元件一个命名。<br>2) 注释：可以对元件添加备注以标记。<br>3) 所有数据写入一个文件：提供结果保存功能。保存信息可勾选配置。<br>4) Text下拉列表：用来显示不同的取样器请求，默认Text方式显示。<br>5) 取样器结果：显示取样器运行结果。<br>6) 请求：显示请求表单内容，不同取样器会有不同显示格式。<br>7) 响应数据：显示服务器响应数据，同时还提供查询功能。</p></blockquote><p>(2)Aggregate Report(聚合报告)</p><blockquote><p>1) 名称：可以给元件一个命名。<br>2) 注释：可以对元件添加备注以标记。<br>3) 所有数据写入一个文件：提供结果保存功能。保存信息可勾选配置。<br>4) Label： 请求的名称，就是我们在进行测试的httprequest sampler的名称<br>5) Samples： 总共发给服务器的请求数量<br>6) Average： 单个请求的平均响应时间，单位是毫秒<br>7) Median： 50%的请求的响应时间<br>8) 90%Line： 90%的请求的响应时间<br>9) 95%Line： 95%的请求的响应时间<br>10) 99%Line： 99%的请求的响应时间<br>11) Min： 最小的响应时间<br>12) Max： 最大的响应时间<br>13) Error%： 错误率=错误的请求的数量/请求的总数<br>14) Throughput： 吞吐量即表示每秒完成的请求数<br>15) Received KB/sec： 每秒从服务器端接收到的数据量<br>16) Sent KB/Sec： 每秒从发送到服务器端的数据量</p></blockquote><h3 id="5、定时器"><a href="#5、定时器" class="headerlink" title="5、定时器"></a>5、定时器</h3><p>Timer 用于操作之间设置等待时间，等待时间是性能测试中常用的控制客户端QPS的手段。<br><img src="/2018/04/01/接口测试-jmeter/定时器.png" alt="定时器"></p><p>(1)Constant Timer(固定定时器)</p><blockquote><p>1) 名称：可以给元件一个命名。<br>2) 注释：可以对元件添加备注以标记。<br>3) 线程延迟（毫秒）：让每个线程在请求之前按相同的指定时间停顿。需要注意的是，固定定时器的延时不会计入单个sampler的响应时间，但会计入事务控制器的时间。</p></blockquote><h3 id="6、前置处理器"><a href="#6、前置处理器" class="headerlink" title="6、前置处理器"></a>6、前置处理器</h3><p>Pre Processors 用于在实际的请求发出之前对即将发出的请求进行特殊处理。<br><img src="/2018/04/01/接口测试-jmeter/前置处理器.png" alt="前置处理器"></p><p>(1)User Parameters(用户参数)</p><blockquote><p>1) 名称：可以给元件一个命名。<br>2) 注释：可以对元件添加备注以标记。<br>3) 每次迭代更新一次：如果选中该选项，则参数的值在每个迭代中保持不变，在新的迭代开始时取下一个值。如果取消该选项，则参数值在每个在其作用域内的sampler发出请求时取下一个可用值。<br>4) 添加变量<br>5) 添加用户<br>6) 删除变量<br>7) 删除用户<br>8) UP：向上移动<br>9) down: 向下移动</p></blockquote><h3 id="7、后置处理器"><a href="#7、后置处理器" class="headerlink" title="7、后置处理器"></a>7、后置处理器</h3><p>Post Processors 用于对Sampler发出请求后得到的服务器响应进行处理。一般用来提取响应中的特定数据。<br><img src="/2018/04/01/接口测试-jmeter/后置处理器.png" alt="后置处理器"></p><p>(1)JSON Extractor(json提取器)</p><blockquote><p>1) 名称：可以给元件一个命名。<br>2) 注释：可以对元件添加备注以标记。<br>3) Apply to：Sampler可能会产生子Sampler，这里需要选择从哪个Sampler中进行提取。</p><blockquote><ul><li>Main sample and sub-samples:作用于父节点的取样器及对应子节点的取样器</li><li>Main sample only：仅作用于父节点的取样器</li><li>Sub-samples only:仅作用于子节点的取样器</li><li>JMeter Variable:作用于jmeter变量(输入框内可输入jmeter的变量名称)</li></ul></blockquote><p>4) Variable Names：变量名。例如:status<br>5) JSON Path Expressions： Json提取表达式。例如:$.status<br>6) Match No. (0 for Random)：当提取有多个结果值时，选择需要的值保存到变量中，默认值为0</p><blockquote><ul><li>0：随机一个</li><li>-1：全部值，使用_N 方式保存（N从1开始），比如status_1,status_2…</li><li>X: 自然数，比如1，返回第X个值（如果X大于返回值的数量，结果会不能获取，最终返回设置的默认值）</li></ul></blockquote><p>7) Compute concatenation var：如果有匹配到多个值，选择此项，会将全部值保存到_ALL，并使用逗号分割每个值。Match No. (0 for Random)需要为-1才有效，不然只能匹配到一个值了。<br>8) Default Value： 缺省值</p></blockquote><h3 id="8、断言"><a href="#8、断言" class="headerlink" title="8、断言"></a>8、断言</h3><p>Assertions 断言用于检查测试中得到的相应数据等是否符合预期，断言一般用来设置检查点。<br><img src="/2018/04/01/接口测试-jmeter/断言.png" alt="断言"></p><p>(1)Response Assertion(响应断言)</p><blockquote><p>1) 名称：可以给元件一个命名。<br>2) 注释：可以对元件添加备注以标记。<br>3) Apply to：Sampler可能会产生子Sampler，这里需要选择从哪个Sampler中进行提取。</p><blockquote><ul><li>Main sample and sub-samples:作用于父节点的取样器及对应子节点的取样器</li><li>Main sample only：仅作用于父节点的取样器</li><li>Sub-samples only:仅作用于子节点的取样器</li><li>JMeter Variable:作用于jmeter变量(输入框内可输入jmeter的变量名称)</li></ul></blockquote><p>4)要测试的响应字段：要检查的项。</p><blockquote><ul><li>响应报文</li><li>Documeng(text)：测试文件</li><li>URL样本</li><li>响应代码</li><li>响应信息</li><li>Response Headers:响应头部</li><li>Ignore status：忽略返回的响应报文状态码</li></ul></blockquote><p>5) 模式匹配规则：</p><blockquote><ul><li>包括：返回结果包括你指定的内容</li><li>匹配：（好像跟Equals查不多，弄不明白有什么区别）   </li><li>Equals：返回结果与你指定结果一致</li><li>Substring：返回结果是指定结果的字串</li><li>否：不进行匹配</li></ul></blockquote><p>6) 要测试的模式:即填写你指定的结果（可填写多个）,按钮【添加】、【删除】是进行指定内容的管理</p></blockquote><h3 id="9、测试片段"><a href="#9、测试片段" class="headerlink" title="9、测试片段"></a>9、测试片段</h3><p>Test Fragment 是控制器上的一个种特殊的线程组，它在测试树上与线程组处于一个层级。它与线程组有所不同，因为它不被执行，除非它是一个模块控制器或者是被控制器所引用时才会被执行。<br><img src="/2018/04/01/接口测试-jmeter/测试片段.png" alt="测试片段"></p><p>(1)Test Fragment(测试片段)</p><blockquote><p>1) 名称：可以给元件一个命名。<br>2) 注释：可以对元件添加备注以标记。</p></blockquote><h3 id="10、非测试元件"><a href="#10、非测试元件" class="headerlink" title="10、非测试元件"></a>10、非测试元件</h3><p>Non-Test Elements 提供http镜像服务、http代理服务、属性显示等功能。<br><img src="/2018/04/01/接口测试-jmeter/非测试元件.png" alt="非测试元件"></p><p>1)Property Display(属性显示)</p><blockquote><p>1) 名称：可以给元件一个命名。<br>2) 注释：可以对元件添加备注以标记。<br>3) System：系统变量。<br>4) Jmeter Properties：jmeter变量。</p></blockquote><h3 id="11、取样器"><a href="#11、取样器" class="headerlink" title="11、取样器"></a>11、取样器</h3><p>Sampler 是测试中向服务器发送请求，记录响应信息，记录响应时间的最小单元。<br><img src="/2018/04/01/接口测试-jmeter/取样器.png" alt="取样器"></p><p>(1)HTTP Sampler(HTTP取样器)</p><blockquote><p>1) 名称：可以给元件一个命名。<br>2) 注释：可以对元件添加备注以标记。<br>3) 协议：向目标服务器发送http请求时的协议，http/https，大小写不敏感，默认http.<br>4) 服务器名称或IP：http请求发送的目标服务器名称或者IP地址。<br>5) 端口号：目标服务器的端口号，默认值为80，可不填<br>6) 方法：发送http请求的方法</p><blockquote><ul><li>GET：向特定的资源发出请求。</li><li>POST：向指定资源提交数据进行处理请求。</li><li>HEAD：获得报文首部</li><li>PUT：向指定资源位置上传其最新内容。</li><li>OPTIONS：返回服务器针对特定资源所支持的HTTP请求方法。</li><li>TRACE：追踪路径，回显服务器收到的请求，主要用于测试或诊断。</li><li>DELETE：请求服务器删除Request-URI所标识的资源。</li><li>PATCH：实体中包含一个表，表中说明与该URI所表示的原内容的区别。 </li></ul></blockquote><p>7) 路径：目标的URL路径（不包括服务器地址和端口）<br>8) Content encoding：内容的编码方式（Content-Type=application/json;charset=utf-8）<br>9) 自动重定向：发出的http请求得到响应是301/302，jmeter会重定向到新的界面<br>10) 跟随重定向：响应Code是3XX时，自动跳转至目标地址。JMeter会记录重定向过程中的所有请求响应。<br>11) Use keep Alive：jmeter 和目标服务器之间使用 Keep-Alive方式进行HTTP通信（默认选中）。<br>12) Use multipart/from-data for HTTP POST ：当发送HTTP POST 请求时使用。<br>13) browser-compatible headers：浏览器兼容请求头。<br>14) Parameters：xx=xx&amp;xxx=xx格式的参数为GET或者POST请求中，url中带的参数值。</p><blockquote><ul><li>Encode?：参数有“=”、“&amp;”、“？”等特殊符号时选择。</li><li>Include Equals：自动添加参数名和值之间的等号。</li></ul></blockquote><p>15) Body Data：json格式的是POST请求中的参数<br>16) Files Upload：发出HTTP请求并获得响应的HTML文件内容后还对该HTML进行Parse，并获取HTML中包含的所有资源（图片、flash等）：（默认不选中）<br>17) Implementation:执行</p><blockquote><ul><li>Java：使用的http是使用的JAVA JVM提供的方法，有相关的限制。</li><li>HttpClient4：使用Apache HttpClient 4.1部件</li><li>空白：使用HTTP默认请求中的配置或jmeter.properties中jmeter.httpsample中的配置</li></ul></blockquote><p>18) Timeouts：超时</p><blockquote><ul><li>Connect：连接</li><li>Response：响应</li></ul></blockquote><p>19) Embedded Resources from HTML Files：解析HTML文件并发送所有资源请求(包括图片，java小程序，JS，CSS等)</p><blockquote><ul><li>从HTML文件获取所有内含的资源</li><li>Parallel downloads.Number：并行下载.数量</li><li>URLs must match：URL需匹配</li></ul></blockquote><p>20) Source address：IP欺骗，指定请求要用到的本地地址（参数化）。<br>21) Proxy Server：代理相关设置</p><blockquote><ul><li>服务器名称或IP</li><li>端口号</li><li>用户名</li><li>密码</li></ul></blockquote><p>22)Save response as MD5 hash?：在执行时仅记录服务端响应数据的MD5值，而不记录完整的响应数据。在需要进行数据量非常大的测试时，建议选中该项以减少取样器记录响应数据的开销。</p></blockquote><h3 id="12、逻辑控制器"><a href="#12、逻辑控制器" class="headerlink" title="12、逻辑控制器"></a>12、逻辑控制器</h3><p>Logic Controller 用来控制采样器的执行顺序。分为两类：一种是控制采样器的逻辑执行顺序，如Loop Controller、If Controller等；一种是对采样器进行分组，方便控制的，如Throughput Controller、Transaction Controller等。<br><img src="/2018/04/01/接口测试-jmeter/逻辑控制器.png" alt="逻辑控制器"></p><p>(1)Loop Controller(循环控制器)</p><blockquote><p>1) 名称：可以给元件一个命名。<br>2) 注释：可以对元件添加备注以标记。<br>3) Loop Count：循环次数<br>4) Forever：永远循环</p></blockquote><p>(2)ForEach Controller(遍历循环控制器)</p><blockquote><p>1) 名称：可以给元件一个命名。<br>2) 注释：可以对元件添加备注以标记。<br>3) 输入变量前缀：在其中输入需要遍历的用户参数（User Parameter）<br>4) Start index for loop(exclusive）：循环指数开始（唯一）→ 遍历查询的变量范围，开始的值（这里如果不填写，默认从1开始，如果没有1开始的变量，执行时会报错）<br>5) End index for loop(inclusive）：循环指数结束（包含）→ 遍历查询的变量范围，结束的值<br>6) 输出变量名称：将遍历查询到的符合条件的用户参数赋值给输入变量（Vname），然后就可以在控制器下的取样器使用，格式为${输出变量名}<br>7) Add”<em>”before number：输入变量名称中是否使用“</em>”进行间隔</p></blockquote><p>(3)Switch Controller(转换控制器)</p><blockquote><p>1) 名称：可以给元件一个命名。<br>2) 注释：可以对元件添加备注以标记。<br>3) Switch value：控制器具体赋值的value值字段。当Value为空时，默认执行第1个子节点元素。</p><blockquote><ul><li>第一种：是数值，Switch控制器下的子节点从0开始计数，通过指定子节点所在的数值来确定执行哪个元素。</li><li>第二种：是直接指定子元素的名称，比如采样器的Name来进行匹配。当指定的名称不存在时，不执行任何元素。</li></ul></blockquote></blockquote><p>(4)While Controller(while条件控制器)</p><blockquote><p>1) 名称：可以给元件一个命名。<br>2) 注释：可以对元件添加备注以标记。<br>3) Condition(function or variable):条件（函数或变量）。需要注意的是：条件是评估两次,一次取样前,一次随机取样。里面可填入判断依据的条件，可能的条件值有：</p><blockquote><ul><li>空白：最后一个示例循环失败时退出循环。</li><li>最后一个值：最后一个示例循环失败时退出循环。 如果之前的最后一个示例只是循环失败,不进入循环。</li><li>否则：退出时(或不输入)循环条件等于字符串“ 假 ”</li></ul></blockquote></blockquote><p>(5)If Controller(IF控制器)</p><blockquote><p>1) 名称：可以给元件一个命名。<br>2) 注释：可以对元件添加备注以标记。<br>3) Condition(default javascript)（条件（默认JavaScript））:使用JavaScript的函数或变量进行评估判断条件为真或假<br>4) interpret condition as variable expression（条件解释为变量表达式）:如果勾选该项，那么变量表达式会进行求值，并与“ture”或“false”进行比较，而无需使用JavaScript<br>5) evaluate for all children（对所有子条件执行）:如果勾选该项，则该controller在没一个子节点执行时执行一次；</p></blockquote><p>(6)Module Controller(模块控制器)</p><blockquote><p>1) 名称：可以给元件一个命名。<br>2) 注释：可以对元件添加备注以标记。<br>3) Find target element(寻找目标元素)：寻找测试计划中需要特定测试的元素，模块；也可理解为该控制器可以控制已经封装好的模块元素。</p></blockquote><p>(7)Simple Controller(简单控制器)</p><blockquote><p>1) 名称：可以给元件一个命名。<br>2) 注释：可以对元件添加备注以标记。</p></blockquote><h2 id="三、原件作用域和顺序"><a href="#三、原件作用域和顺序" class="headerlink" title="三、原件作用域和顺序"></a>三、原件作用域和顺序</h2><h3 id="1、元件的作用域"><a href="#1、元件的作用域" class="headerlink" title="1、元件的作用域"></a>1、元件的作用域</h3><p>jmeter中共有8类可被执行的元件（test plan和thread group不属于元件）。<br>其中：sampler（取样器）是不与其他元件发生交互的作用的元件，Logic Controller（逻辑控制器）只对其子节点的sampler有效，而其他元件需要与sampler等元件交互。</p><blockquote><p>1）Config Elements（配置元件）：影响其范围内的所有元件<br>2）Pre-porcessors（前置处理器）：在其作用范围内的每一个sampler元件之前执行<br>3）Timer（定时器）：对其作用范围内的每一个sampler有效<br>4）Post-porcessors（后置处理器）：在其作用范围内的每一个sampler元件之后执行<br>5）Assirtions（断言）：对其作用范围内的每一个sampler元件执行后的结果执行校验<br>6）Listener（监听器）：收集其作用范围内的每一个sampler元件的信息并且呈现出来</p></blockquote><p>在jmeter中，元件的作用域是靠test plan的树形结构中元件的父子关系来确定的，其原则如下：</p><blockquote><p>1） sampler（取样器）不与其他元件相互作用，因此不存在作用域问题<br>2） Logic Controller（逻辑控制器）只对其子节点中的sampler和Logic Controller作用<br>3） 除sampler和Logic Controller外的其他元件，如果是某个sampler的子节点，则该元件仅对其父节点作用<br>4） 除sampler和Logic Controller外的其他元件，如果其父节点不是sampler，则其作用域是该元件父节点下的其他所有后带节点（包括子节点，子节点的子节点等）</p></blockquote><h3 id="2、元件的执行顺序"><a href="#2、元件的执行顺序" class="headerlink" title="2、元件的执行顺序"></a>2、元件的执行顺序</h3><p>在同一作用域范围内，test plan中的元件按照以下顺序执行：</p><blockquote><p>1） Config Elements（配置元件）<br>2） Pre-porcessors（前置处理器）<br>3） Timer（定时器）<br>4） Sampler（取样器）<br>5） Post-porcessors（后置处理器）（除非Sampler得到的返回结果为空）<br>6） Assirtions（断言）（除非Sampler得到的返回结果为空）<br>7） Listener（监听器）（除非Sampler得到的返回结果为空）</p></blockquote><p>PS:Pre-porcessors、Post-porcessors和Assirtions等元件仅对Sampler作用，如在它们作用域内没有任何Sampler，则不会被执行；如果在同一作用域范围内有多个同一类型的元件，则这些元件按照它们在test plan中的上下顺序依次执行。</p><h2 id="四、jmeter运行模式"><a href="#四、jmeter运行模式" class="headerlink" title="四、jmeter运行模式"></a>四、jmeter运行模式</h2><p>1、GUI模式<br>GUI打开已有的jmx文件，点击启动按钮运行 。</p><p>2、命令行模式<br>(1)依赖：<br>配置jmeter环境变量（windows下为将${jmeterhome}/bin加入Path变量）。<br>如果未加入环境变量，在执行的时候可以直接给出全路径或在${jmeterhome}/bin下执行。</p><p>(2)命令：<br><code>jmeter -n -t &lt;testplan filename&gt; -l &lt;listener filename&gt;</code></p><ul><li>-h 帮助 -&gt; 打印出有用的信息并退出 </li><li>-n 非 GUI 模式 -&gt; 在非 GUI 模式下运行 JMeter </li><li>-t 测试文件 -&gt; 要运行的 JMeter 测试脚本文件 </li><li>-l jtl文件 -&gt; 记录结果的文件 </li><li>-r 远程执行 -&gt; 启动远程服务 </li><li>-H 代理主机 -&gt; 设置 JMeter 使用的代理主机 </li><li>-P 代理端口 -&gt; 设置 JMeter 使用的代理主机的端口号 </li><li>-j 日志文件-&gt;设置JMeter日志文件的名称 </li></ul><p>(3)实例：</p><blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">JMeter -n -t my_test.jmx -l log.jtl -H my.proxy.server -P 8000</span><br></pre></td></tr></table></figure></blockquote><p>(4)执行步骤：<br>jmeter默认去当前目录寻找脚本文件，并把日志记录在当前目录。比如你在 C:\tools\apache-jmeter-4.0\bin 目录下执行以上命令，jmeter会去该目录下寻找test.jmx脚本并把执行结果放在该目录。<br>如果你的脚本在其他目录，而且想要把执行结果放在另外文件夹，可以使用绝对路径告诉jmeter。</p><h1 id="持续更新…"><a href="#持续更新…" class="headerlink" title="持续更新…"></a><em>持续更新…</em></h1>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;接口测试jmeter工具使用笔记。&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="接口测试" scheme="http://pythonfood.github.io/categories/%E6%8E%A5%E5%8F%A3%E6%B5%8B%E8%AF%95/"/>
    
    
      <category term="jmeter" scheme="http://pythonfood.github.io/tags/jmeter/"/>
    
  </entry>
  
  <entry>
    <title>接口测试-postman</title>
    <link href="http://pythonfood.github.io/2018/04/01/%E6%8E%A5%E5%8F%A3%E6%B5%8B%E8%AF%95-postman/"/>
    <id>http://pythonfood.github.io/2018/04/01/接口测试-postman/</id>
    <published>2018-04-01T02:00:00.000Z</published>
    <updated>2018-05-11T06:58:28.803Z</updated>
    
    <content type="html"><![CDATA[<p>接口测试postman工具使用笔记。<br><a id="more"></a></p><h2 id="一、适用范围"><a href="#一、适用范围" class="headerlink" title="一、适用范围"></a>一、适用范围</h2><ul><li>PC</li><li>WAP</li><li>APP</li></ul><h2 id="二、环境准备"><a href="#二、环境准备" class="headerlink" title="二、环境准备"></a>二、环境准备</h2><p>(1)下载安装:<a href="https://www.getpostman.com/apps" target="_blank" rel="noopener">https://www.getpostman.com/apps</a><br>(2)注册账户</p><h2 id="三、发送一条http-Get请求"><a href="#三、发送一条http-Get请求" class="headerlink" title="三、发送一条http Get请求"></a>三、发送一条http Get请求</h2><p>(1)GET请求输入URL(可以从fiddler复制)<br>(2)GET请求输入Headers(可以从fiddler复制)<br>(3)点击【Send】可以查看返回信息<br>(4)可以对返回值内容增加校验，GET请求的Tests里设置校验方法和校验字段<br>(5)点击【Send】可以查看返回信息和测试结果<br>(6)可以将以上测试步骤，点击【Save】保存到一个集合<br>(7)可以修改请求的测试参数，点击【Save as】保存到同一个集合<br>(8)以此类推形成一个自动化测试的集合<br>(9)点击该集合的【Run】弹出集合运行界面<br>(10)可以修改循环次数【iterations】、延迟【Delay】等参数<br>(11)点击【Run …】运行脚本，查看测试结果</p><h2 id="四、发送一条http-Post请求"><a href="#四、发送一条http-Post请求" class="headerlink" title="四、发送一条http Post请求"></a>四、发送一条http Post请求</h2><p>(1)POST请求输入URL(可以从fiddler复制)<br>(2)POST请求输入Headers(可以从fiddler复制)<br>(3)POST请求输入Body(可以从fiddler的WebForms里一项一项复制)<br>(4)点击【Send】可以查看返回信息<br>(5)可以对返回值内容增加校验，POST请求的Tests里设置校验方法和校验字段<br>(6)点击【Send】可以查看返回信息和测试结果<br>(7)可以将以上测试步骤，点击【Save】保存到一个集合<br>(8)可以修改请求的测试参数，点击【Save as】保存到同一个集合<br>(9)以此类推形成一个自动化测试的集合<br>(10)点击该集合的【Run】弹出集合运行界面<br>(11)可以修改循环次数【iterations】、延迟【Delay】等参数<br>(12)点击【Run …】运行脚本，查看测试结果</p><h1 id="持续更新…"><a href="#持续更新…" class="headerlink" title="持续更新…"></a><em>持续更新…</em></h1>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;接口测试postman工具使用笔记。&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="接口测试" scheme="http://pythonfood.github.io/categories/%E6%8E%A5%E5%8F%A3%E6%B5%8B%E8%AF%95/"/>
    
    
      <category term="postman" scheme="http://pythonfood.github.io/tags/postman/"/>
    
  </entry>
  
  <entry>
    <title>接口测试-fiddler</title>
    <link href="http://pythonfood.github.io/2018/04/01/%E6%8E%A5%E5%8F%A3%E6%B5%8B%E8%AF%95-fiddler/"/>
    <id>http://pythonfood.github.io/2018/04/01/接口测试-fiddler/</id>
    <published>2018-04-01T01:00:00.000Z</published>
    <updated>2018-05-11T06:58:28.803Z</updated>
    
    <content type="html"><![CDATA[<p>接口测试fiddler工具使用笔记。<br><a id="more"></a></p><h2 id="一、Fiddler-环境准备"><a href="#一、Fiddler-环境准备" class="headerlink" title="一、Fiddler 环境准备"></a>一、Fiddler 环境准备</h2><p>(1)官网下载安装:<a href="https://www.telerik.com/download/fiddler" target="_blank" rel="noopener">https://www.telerik.com/download/fiddler</a><br>(2)相关设置:【Tools-options-HTTPS-Connections】,设置好之后退出再启动一次。</p><p><img src="/2018/04/01/接口测试-fiddler/HTTPS设置.png" alt="HTTPS设置"><br><img src="/2018/04/01/接口测试-fiddler/Connections设置.png" alt="Connections设置"></p><h2 id="二、Fiddler-工作原理"><a href="#二、Fiddler-工作原理" class="headerlink" title="二、Fiddler 工作原理"></a>二、Fiddler 工作原理</h2><p><img src="/2018/04/01/接口测试-fiddler/fiddler工作原理.png" alt="fiddler工作原理"></p><h2 id="三、Fiddler-基本界面"><a href="#三、Fiddler-基本界面" class="headerlink" title="三、Fiddler 基本界面"></a>三、Fiddler 基本界面</h2><p>(1)Session部分:</p><blockquote><ul><li>#:id</li><li>Result:服务器返回的状态码</li><li>Protocol:协议</li><li>Host:发送给服务器的host值</li><li>URL:</li></ul></blockquote><p>(2)Inspectors:<br>1)Request部分:</p><blockquote><ul><li>Headers:头部信息<blockquote><ul><li>User-Agent:用户的身份</li><li>Referer:请求的上一个请求来源</li><li>Host:当前的host</li></ul></blockquote></li><li>TextView:</li><li>WebForms:请求的参数值</li><li>HexView:16进制的view</li><li>Cookies:</li><li>Raw:最原始的所有的数据</li><li>JSON:json形式的请求</li><li>XML:xml形式的请求</li></ul></blockquote><p>2)Response部分:</p><blockquote><ul><li>TextView:可以看到整个返回的内容</li><li>Raw:返回所有的相关的内容</li><li>JSON:返回json形式的数据</li><li>XML:返回xml形式的数据</li><li>WebView:返回的html页面</li><li>ImageView:返回的图片内容</li></ul></blockquote><p>(3)Statistics:静态统计</p><p>(4)Composer:构造各种各样的请求发送给服务器</p><p>(5)AutoResponder:配置假数据模拟后端服务器返回的数据</p><h2 id="四、Fiddler-设置断点修改Request"><a href="#四、Fiddler-设置断点修改Request" class="headerlink" title="四、Fiddler 设置断点修改Request"></a>四、Fiddler 设置断点修改Request</h2><p>(1)通过工具栏设置断点(缺点是会拦截所有的请求)</p><blockquote><p>1)设置断点【Rules-Automatic Breakpoints-Before Request F11】<br>2)清除请求区域<br>3)浏览器进行百度搜索“fiddler”<br>4)fiddler对应的请求，点击【Response部分-Run to Completion】<br>5)fiddler新弹出的请求应该就是需要改参数的请求<br>6)fiddler需要修改参数的请求，点击【Request部分-WebForms】<br>7)修改对应的参数<br>8)点击【Repose部分-Run to Completion】<br>9)回到浏览器查看请求是否修改成功</p></blockquote><p>(2)通过命令设置断点(可以拦截指定站点)</p><blockquote><p>1)session部分底部输入命令<code>bpu www.baidu.com</code>，其他操作同上。<br>2)清除拦截，输入命令<code>bpu</code></p></blockquote><h2 id="五、Fiddler-设置断点修改Response"><a href="#五、Fiddler-设置断点修改Response" class="headerlink" title="五、Fiddler 设置断点修改Response"></a>五、Fiddler 设置断点修改Response</h2><p>(1)通过工具栏设置断点(缺点是会拦截所有的请求)</p><blockquote><p>1)点击设置【Rules-Automatic Breakpoints-After Response Alt+F11】<br>2)清除请求区域<br>3)浏览器进行百度搜索“哈哈”<br>4)fiddler修改Response部分的参数<br>5)点击【Response部分-Run to Completion】<br>6)回到浏览器查看请求是否修改成功</p></blockquote><p>(2)通过命令设置断点(可以拦截指定站点)</p><blockquote><p>1)session部分底部输入命令<code>bpafter www.baidu.com</code>，其他操作同上。<br>2)清除拦截，输入命令<code>bpafter</code></p></blockquote><p>(3)AutoResponder设置</p><blockquote><p>1)浏览器进行百度搜索“哈哈”<br>2)fiddler对应的请求,点击【AutoResponder-Add Rule】<br>3)勾选【Enable reles】【Unmatched requests passthrough】【Enable Latency】<br>4)下边规则改为模糊匹配，例如改为：<code>regex:(?inx)^https://www.baidu.com/s?.+</code><br>5)下边下拉框返回状态码任意可选，例如选择:404_Plain.dat<br>6)点击【Save】按钮<br>7)回到浏览器重新百度搜索任意字符，看是否返回404<br>ps:可以通过下拉列表的“find a file”自定义规则，文件内容自定义。</p></blockquote><h2 id="六、Fiddler-小工具"><a href="#六、Fiddler-小工具" class="headerlink" title="六、Fiddler 小工具"></a>六、Fiddler 小工具</h2><p>(1)会话的过滤</p><blockquote><p>1)点击【Filters-Use Filters】<br>2)【No Host Filter】下拉框选择【Show only the following Hosts】<br>3)输入要过滤的站点，例如:www.baidu.com<br>4)点击【Actions-Run Filterset now】<br>5)此时session对话框只显示过滤站点请求</p></blockquote><p>(2)会话的比较<br>下载windiff:<a href="https://www.grigsoft.com/download-windiff.htm" target="_blank" rel="noopener">https://www.grigsoft.com/download-windiff.htm</a><br>解压后复制到fiddler安装路径即可</p><blockquote><p>1)选中两个要对比的请求<br>2)右键点击【Compare】<br>3)调起windiff工具进行对比</p></blockquote><p>(3)编码小工具</p><blockquote><p>1)点击【Tools-TextWizard】<br>2)上部分输入原始内容，下部分显示编解码内容<br>3)例如：上面输入(<a href="https://www.grigsoft.com/download-windiff.htm" target="_blank" rel="noopener">https://www.grigsoft.com/download-windiff.htm</a>) ，下面选择URLEecode,即可看到结果。</p></blockquote><h2 id="七、Fiddler-Host设置"><a href="#七、Fiddler-Host设置" class="headerlink" title="七、Fiddler Host设置"></a>七、Fiddler Host设置</h2><blockquote><p>1)点击【Tools-HOSTS…】<br>2)勾选对话框顶部【Enable Remapping of requests for one host to a differenthost or IP,overing DNS】<br>3)点击会话框底部【Import Windows Hosts File】，导入系统host<br>4)任意修改host,点击【Save】host即生效<br>5)不使用修改的host,只需要取消勾选对话框顶部【Enable Remapping of requests for one host to a differenthost or IP,overing DNS】</p></blockquote><h2 id="八、Fiddler-构造HTTP请求"><a href="#八、Fiddler-构造HTTP请求" class="headerlink" title="八、Fiddler 构造HTTP请求"></a>八、Fiddler 构造HTTP请求</h2><p>(1)构造Get请求</p><blockquote><p>1)选择一条Get请求，点击【Inspectors-Headers】<br>2)复制Headers的头部信息，粘贴到【Composer-Parsed】的对话框<br>3)首先删除掉复制信息的“Get”类型<br>4)再剪切复制信息的URL，粘贴到上方的输入框，去掉URL尾部的“HTTP/1.1”协议<br>5)点击【Execute】发送请求<br>6)查看session界面请求是否发送<br>ps:可以任意修改URL进行接口测试</p></blockquote><p>(2)构造Post请求</p><blockquote><p>1)选择一条Post请求，点击【Inspectors-Raw】<br>2)复制所有信息，粘贴到【Composer-Parsed】的对话框，请求方式选择【POST】<br>3)首先删除掉复制信息的“Post”类型<br>4)再剪切复制信息的URL，粘贴到上方的输入框，去掉URL尾部的“HTTP/1.1”协议<br>5)剪切空行以下的request body信息，粘贴到下面的输入框<br>6)点击【Execute】发送请求<br>7)查看session界面请求是否发送<br>ps:可以任意修改URL和request body信息进行接口测试</p></blockquote><h2 id="九、Fiddler-抓取手机包"><a href="#九、Fiddler-抓取手机包" class="headerlink" title="九、Fiddler 抓取手机包"></a>九、Fiddler 抓取手机包</h2><p>(1)配置Fiddler允许监听https<br>(2)配置Fiddler允许远程连接<br>(3)手机端设置代理服务</p><blockquote><p>1)设置【Tools-Options-HTTPS】<br>2)设置【Tools-Options-Connections】<br>3)手机当前连接wifi里设置代理:主机名填写电脑的ip地址，端口填写8888<br>4)手机操作应用，请求就会发送到fiddler,其他操作同PC端操作</p></blockquote><h1 id="持续更新…"><a href="#持续更新…" class="headerlink" title="持续更新…"></a><em>持续更新…</em></h1>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;接口测试fiddler工具使用笔记。&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="接口测试" scheme="http://pythonfood.github.io/categories/%E6%8E%A5%E5%8F%A3%E6%B5%8B%E8%AF%95/"/>
    
    
      <category term="fiddler" scheme="http://pythonfood.github.io/tags/fiddler/"/>
    
  </entry>
  
  <entry>
    <title>selenium常用API</title>
    <link href="http://pythonfood.github.io/2018/03/01/selenium%E5%B8%B8%E7%94%A8API/"/>
    <id>http://pythonfood.github.io/2018/03/01/selenium常用API/</id>
    <published>2018-03-01T02:00:00.000Z</published>
    <updated>2018-05-11T06:55:16.658Z</updated>
    
    <content type="html"><![CDATA[<p>selenium常用API笔记。<br><a id="more"></a></p><h2 id="一、浏览器操作"><a href="#一、浏览器操作" class="headerlink" title="一、浏览器操作"></a>一、浏览器操作</h2><p>(1)浏览器最大化</p><blockquote><p><code>driver.maximize_window()</code> #浏览器最大化</p></blockquote><p>(2)设置浏览器宽、高</p><blockquote><p><code>driver.set_window_size(480, 800)</code> #设置浏览器宽、高</p></blockquote><p>(3)浏览器后退</p><blockquote><p><code>driver.back()</code> #浏览器后退</p></blockquote><p>(4)浏览器前进</p><blockquote><p><code>driver.forward()</code> #浏览器前进</p></blockquote><p>(5)刷新当前页面</p><blockquote><p><code>driver.refresh()</code> #刷新当前页面</p></blockquote><p>(6)退出浏览器</p><blockquote><p><code>driver.quit()</code> #退出浏览器</p></blockquote><p>(7)关闭单个窗口</p><blockquote><p><code>driver.close()</code> #关闭单个窗口</p></blockquote><h2 id="二、元素定位"><a href="#二、元素定位" class="headerlink" title="二、元素定位"></a>二、元素定位</h2><p>(1)id定位 </p><blockquote><p><code>find_element_by_id(&quot;kw&quot;)</code> #一般唯一</p></blockquote><p>(2)name定位 </p><blockquote><p><code>find_element_by_name(&quot;wd&quot;)</code> #一般唯一</p></blockquote><p>(3)class_name定位 </p><blockquote><p><code>find_element_by_class_name(&quot;bg s_btn&quot;)</code> #不唯一</p></blockquote><p>(4)tag_name定位</p><blockquote><p><code>find_element_by_tag_name(&quot;input&quot;)</code> #不唯一</p></blockquote><p>(5)link_text定位</p><blockquote><p><code>find_element_by_link_text(u&quot;这是一条新闻&quot;)</code> #定位文本链接</p></blockquote><p>(6)partial_link_text定位</p><blockquote><p><code>find_element_by_partial_link_text(&quot;这是一条新&quot;)</code> #定位可以唯一标识这个文本链接的一部分</p></blockquote><p>(7)xpath定位</p><blockquote><p>1)绝对路径定位</p><blockquote><p><code>find_element_by_xpath(&quot;/html/body/div[2]/form/span/input&quot;)</code> #从根节点开始绝对路径</p></blockquote><p>2)相对路径定位</p><blockquote><p><code>find_element_by_xpath(&quot;//input[@id=’input’]&quot;)</code> #通过自身的id 属性定位<br><code>find_element_by_xpath(&quot;//span[@id=’input-container’]/input&quot;)</code> #通过上一级目录的id 属性定位<br><code>find_element_by_xpath(&quot;//div[@name=’q’]/form/span[2]/input&quot;)</code> #通过上三级目录的name 属性定位<br><code>find_element_by_xpath(&quot;//div[@id=’hd’ or @name=’q’]/form/span/input&quot;)</code> #通过布尔逻辑运算 属性定位</p></blockquote></blockquote><p>(8)css_selector定位</p><blockquote><p><code>find_element_by_css_selector(&quot;#su&quot;)</code> #通过id属性定位<br><code>find_element_by_css_selector(&quot;.s_ipt&quot;)</code> #通过class属性定位<br><code>find_element_by_css_selector(&quot;input&quot;)</code> #通过标签名定位<br><code>find_element_by_css_selector(&quot;span&gt;input&quot;)</code> #通过父子关系定位<br><code>find_element_by_css_selector(&quot;input[maxlength=&#39;100&#39;]&quot;)</code> #通过属性定位<br><code>find_element_by_css_selector(&quot;span.bgs_ipt_wr&gt;input.s_ipt&quot;)</code> #组合定位</p><blockquote><p><img src="/2018/03/01/selenium常用API/css_selector定位.png" alt="css_selector定位"></p></blockquote></blockquote><p>(9)用By定位<br>需要使用定位方法时，By可以设置定位策略。使用前导入By模块<code>from selenium.webdriver.common.by import By</code>。</p><blockquote><p><code>find_element(By.ID,&quot;kw&quot;)</code><br><code>find_element(By.NAME,&quot;wd&quot;)</code><br><code>find_element(By.CLASS_NAME,&quot;s_ipt&quot;)</code><br><code>find_element(By.TAG_NAME,&quot;input&quot;)</code><br><code>find_element(By.LINK_TEXT,u&quot;新闻&quot;)</code><br><code>find_element(By.PARTIAL_LINK_TEXT,u&quot;新&quot;)</code><br><code>find_element(By.XPATH,&quot;//*[@class=&#39;bgs_btn&#39;]&quot;)</code><br><code>find_element(By.CSS_SELECTOR,&quot;span.bgs_btn_wr&gt;input#su&quot;)</code></p></blockquote><h2 id="三、元素操作"><a href="#三、元素操作" class="headerlink" title="三、元素操作"></a>三、元素操作</h2><p>(1)clear()  #清除输入框内容</p><blockquote><p><code>driver.find_element_by_id(&quot;user_name&quot;).clear()</code></p></blockquote><p>(2)send_keys(“xx”) #输入框里输入xx内容</p><blockquote><p><code>driver.find_element_by_id(&quot;user_name&quot;).send_keys(&quot;username&quot;)</code></p></blockquote><p>(3)click() #单击一个按钮、连接等</p><blockquote><p><code>driver.find_element_by_id(&quot;dl_an_submit&quot;).click()</code></p></blockquote><p>(4)submit() #提交表单</p><blockquote><p><code>driver.find_element_by_id(&quot;dl_an_submit&quot;).submit()</code></p></blockquote><p>(5)size #返回元素的尺寸</p><blockquote><p><code>size=driver.find_element_by_id(&quot;kw&quot;).size</code> #返回百度输入框的宽高</p></blockquote><p>(6)text #获取元素的文本</p><blockquote><p><code>text=driver.find_element_by_id(&quot;cp&quot;).text</code> #返回百度页面底部备案信息</p></blockquote><p>(7)get_attribute(name) #获得属性值</p><blockquote><p><code>attribute=driver.find_element_by_id(&quot;kw&quot;).get_attribute(&#39;type&#39;)</code> #返回元素的属性值，可以是id、name、type 或元素拥有的其它任意属性</p></blockquote><p>(8)is_displayed() #检查该元素是否用户可见    </p><blockquote><p><code>result=driver.find_element_by_id(&quot;kw&quot;).is_displayed()</code> #返回元素的结果是否可见，返回结果为True 或False</p></blockquote><h2 id="四、鼠标事件"><a href="#四、鼠标事件" class="headerlink" title="四、鼠标事件"></a>四、鼠标事件</h2><p>ActionChains用于生成用户的行为，所有的行为都存储在actionchains对象中。通过perform()执行存储的行为。<br>使用前导入ActionChains模块<code>from selenium.webdriver.common.action_chains import ActionChains</code>。</p><p>(1)perform() #顺序执行所有ActionChains中存储的行为</p><blockquote><p><code>ActionChains(driver).context_click(操作对象).perform()</code> #ActionChains方法的书写格式</p></blockquote><p>(2)context_click() #右击 </p><blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">right =driver.find_element_by_xpath(&quot;xx&quot;) #定位到要右击的元素</span><br><span class="line">ActionChains(driver).context_click(right).perform() #对定位到的元素执行鼠标右键操作</span><br></pre></td></tr></table></figure></blockquote><p>(3)double_click() #双击</p><blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">double =driver.find_element_by_xpath(&quot;xxx&quot;) #定位到要双击的元素</span><br><span class="line">ActionChains(driver).double_click(double).perform() #对定位到的元素执行鼠标双击操作</span><br></pre></td></tr></table></figure></blockquote><p>(4)drag_and_drop() #鼠标拖放</p><blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">element = driver.find_element_by_name(&quot;xxx&quot;) #定位元素的原位置</span><br><span class="line">target = driver.find_element_by_name(&quot;xxx&quot;) #定位元素要移动到的目标位置</span><br><span class="line">ActionChains(driver).drag_and_drop(element, target).perform() #执行元素的移动操作</span><br></pre></td></tr></table></figure></blockquote><p>(5)move_to_element() #鼠标悬停</p><blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">above = driver.find_element_by_xpath(&quot;xxx&quot;) #定位到鼠标移动到上面的元素</span><br><span class="line">ActionChains(driver).move_to_element(above).perform() #对定位到的元素执行鼠标移动到上面的操作</span><br></pre></td></tr></table></figure></blockquote><p>(6)click_and_hold() #按下鼠标左键    </p><blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">left=driver.find_element_by_xpath(&quot;xxx&quot;) #定位到鼠标按下左键的元素</span><br><span class="line">ActionChains(driver).click_and_hold(left).perform() #对定位到的元素执行鼠标左键按下的操作</span><br></pre></td></tr></table></figure></blockquote><h2 id="五、键盘事件"><a href="#五、键盘事件" class="headerlink" title="五、键盘事件"></a>五、键盘事件</h2><p>使用前导入keys模块<code>from selenium.webdriver.common.keys import Keys</code>。</p><p>(1)send_keys(Keys.BACK_SPACE) #删除键（BackSpace）</p><p>(2)send_keys(Keys.SPACE) #空格键(Space)</p><p>(3)send_keys(Keys.TAB) #制表键(Tab)</p><p>(4)send_keys(Keys.ESCAPE) #回退键（Esc）</p><p>(5)send_keys(Keys.ENTER) #回车键（Enter）</p><p>(6)send_keys(Keys.F5) #刷新建（F5）</p><p>(7)send_keys(Keys.CONTROL,’a’) #全选（Ctrl+A）</p><p>(8)send_keys(Keys.CONTROL,’c’) #复制（Ctrl+C）</p><p>(9)send_keys(Keys.CONTROL,’x’) #剪切（Ctrl+X）</p><p>(10)send_keys(Keys.CONTROL,’v’) #粘贴（Ctrl+V）</p><h2 id="六、获取验证信息"><a href="#六、获取验证信息" class="headerlink" title="六、获取验证信息"></a>六、获取验证信息</h2><p>(1)获得当前页面title，判断页面跳转是否符合预期</p><blockquote><p><code>title = driver.title</code></p></blockquote><p>(2)获得当前URL，一般用来测试重定向</p><blockquote><p><code>url = driver.current_url</code></p></blockquote><h2 id="七、设置等待时间"><a href="#七、设置等待时间" class="headerlink" title="七、设置等待时间"></a>七、设置等待时间</h2><p>(1)sleep() #休眠等待<br>sleep()方法以秒为单位，假如休眠时间小于 1 秒，可以用小数表示。<br>使用前导入sleep模块<code>from time import sleep</code>。</p><blockquote><p><code>sleep(0.5)</code></p></blockquote><p>(2)implicitly_wait() #隐式等待<br>隐式等待是通过一定的时长等待页面所元素加载完成。<br>如果超出了设置的时长元素还没有被加载测抛NoSuchElementException异常。<br>implicitly_wait()默认参数的单位为秒。</p><blockquote><p><code>driver.implicitly_wait(10)</code> #设置智能等待10秒</p></blockquote><p>(3)WebDriverWait() #显式等待<br>显式等待是等待某个条件成立时继续执行，否则在达到最大时长则抛TimeoutException异常。</p><p>WebDriverWait(driver, timeout, poll_frequency=0.5, ignored_exceptions=None)，参数解释如下：</p><ul><li>driver - WebDriver 的驱动程序(Ie, Firefox, Chrome 或远程)</li><li>timeout - 最长超时时间，默认以秒为单位</li><li>poll_frequency - 休眠时间的间隔（步长）时间，默认为 0.5 秒</li><li>ignored_exceptions - 超时后的异常信息，默认情况下抛 NoSuchElementException 异常。</li></ul><p>使用前导入WebDriverWait模块<code>from selenium.webdriver.support.ui import WebDriverWait</code>。</p><p>WebDriverWai()一般由 unit()或 until_not()方法配合使用，下面是 unit()和 until_not()方法的说明：<br>1)until(method, message=’’)调用该方法提供的驱动程序作为一个参数，直到返回值不为False。</p><blockquote><p><code>element = WebDriverWait(driver, 10).until(lambda x: x.find_element_by_id(“someId”))</code></p></blockquote><p>2)until_not(method, message=’’)调用该方法提供的驱动程序作为一个参数，直到返回值为 False。</p><blockquote><p><code>is_disappeared = WebDriverWait(driver, 30, 1, (ElementNotVisibleException)).until_not(lambda x: x.find_element_by_id(“someId”).is_displayed())</code>    </p></blockquote><h2 id="八、定位一组对象"><a href="#八、定位一组对象" class="headerlink" title="八、定位一组对象"></a>八、定位一组对象</h2><p>(1)find_elements 用于获取一组元素:</p><blockquote><p><code>find_elements_by_id(‘xx’)</code><br><code>find_elements_by_name(‘xx’)</code><br><code>find_elements_by_class_name(‘xx’)</code><br><code>find_elements_by_tag_name(‘xx’)</code><br><code>find_elements_by_link_text(‘xx’)</code><br><code>find_elements_by_partial_link_text(‘xx’)</code><br><code>find_elements_by_xpath(‘xx’)</code><br><code>find_elements_by_css_selector(‘xx’)</code></p></blockquote><p>(2)可以使用for… in …对这一组元素进行遍历:</p><blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">for checkbox in checkboxes:</span><br><span class="line">checkbox.click()</span><br></pre></td></tr></table></figure></blockquote><p>(3)也可以使用pop（）方法获得这一组元素中的第几个，然后再对该元素进行操作：</p><blockquote><p><code>find_elements_by_id(‘xx’).pop().click()</code></p><blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pop（）或pop（-1）#默认获取一组元素中的最后一个</span><br><span class="line">pop(0)   #默认获取一组元素的第一个元素</span><br><span class="line">pop(1)   #默认获取一组元素的第二个元素</span><br><span class="line">...... #以此类推</span><br></pre></td></tr></table></figure></blockquote></blockquote><h2 id="九、层级定位"><a href="#九、层级定位" class="headerlink" title="九、层级定位"></a>九、层级定位</h2><p>经常会有这样的需求：页面上有很多个属性基本相同的元素 ，现在需要具体定位到其中的一个。由于属性基本相当，所以在定位的时候会有些麻烦，这时候就需要用到层级定位。先定位父元素，然后再通过父元素定位子孙元素：</p><blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#点击 Link1 链接（弹出下拉列表）</span><br><span class="line">driver.find_element_by_link_text(&apos;Link1&apos;).click() </span><br><span class="line">#在父亲元件下找到 link 为 Action 的子元素</span><br><span class="line">menu=driver.find_element_by_id(&apos;dropdown1&apos;).find_element_by_link_text(&apos;Another action&apos;)</span><br></pre></td></tr></table></figure></blockquote><h2 id="十、表单切换"><a href="#十、表单切换" class="headerlink" title="十、表单切换"></a>十、表单切换</h2><p>在web应用中经常会出现frame/iframe 表单内嵌套的应用，WebDriver只能在一个页面上进行元素识别定位，对于frame/iframe表单内嵌页面上的元素无法直接定位。这时需要通过switch_to.frame()方法将当前定位的主体切换为frame/iframe表单的内嵌页面中。</p><p>(1)switch_to_frame()默认可以直接取表单的id或name属性进行切换：</p><blockquote><p><code>driver.switch_to_frame(&quot;if&quot;)</code> #id = “if”<br><code>driver.switch_to_frame(&quot;nf&quot;)</code> #name = “nf” </p></blockquote><p>(2)如果 iframe 没有可用的 id 和 name 可以通过下面的方式进行定位：</p><blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#先通过xpth定位到iframe </span><br><span class="line">xf = driver.find_element_by_xpath(&apos;//*[@class=&quot;if&quot;]&apos;)</span><br><span class="line">#再将定位对象传给switch_to_frame()方法 </span><br><span class="line">driver.switch_to_frame(xf)</span><br></pre></td></tr></table></figure></blockquote><p>(3)如果完成了在当前表单上的操作，跳出当前表单：</p><blockquote><p><code>driver.switch_to.parent_content()</code> #返回到父级表单<br><code>driver.switch_to.default_conent()</code> #返回到主文档页面</p></blockquote><h2 id="十一、多窗口切换"><a href="#十一、多窗口切换" class="headerlink" title="十一、多窗口切换"></a>十一、多窗口切换</h2><ul><li><code>current_window_handle</code> #获得当前窗口句柄。</li><li><code>window_handles</code> #返回所有窗口的句柄到当前对话。</li><li><code>switch_to.window</code>(窗口句柄) #切换到对应的窗口。</li></ul><blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">nowhandle=driver.current_window_handle #获得当前窗口句柄。</span><br><span class="line">driver.find_element_by_link_text(u&quot;发表话题&quot;).click()</span><br><span class="line">time.sleep(3)</span><br><span class="line">allhandles=driver.window_handles #返回所有窗口的句柄到当前对话。</span><br><span class="line">for handle in allhandles:</span><br><span class="line">if(handle!=nowhandle):</span><br><span class="line">driver.switch_to.window(handle) #切换到对应的窗口。</span><br></pre></td></tr></table></figure></blockquote><h2 id="十二、警告框处理"><a href="#十二、警告框处理" class="headerlink" title="十二、警告框处理"></a>十二、警告框处理</h2><p>处理javascript所生成的alert、confirm、prompt，可以使用switch_to_alert()方法定位到alert/confirm/prompt，然后使用text/accept/dismiss/send_keys等方法进行操作：</p><ul><li><code>text</code> #返回 alert/confirm/prompt 中的文字信息。</li><li><code>accept</code> #点击确认按钮。</li><li><code>dismiss</code> #点击取消按钮，如果有的话。</li><li><code>send_keys</code> #输入值，这个 alert\confirm 没有对话框就不能用了，不然会报错。</li></ul><blockquote><p><code>driver.switch_to_alert().accept()</code></p></blockquote><h2 id="十三、上传文件"><a href="#十三、上传文件" class="headerlink" title="十三、上传文件"></a>十三、上传文件</h2><p>(1)查找到input标签，通过send_keys)传入本地文件路径从而模拟上传功能:</p><blockquote><p><code>driver.find_element_by_name(&quot;file&quot;).send_keys(&#39;D:\\upload_file.txt&#39;)</code> #查找到input标签，然后send进去</p></blockquote><p>(2)使用AutoIt识别flash控件和windows控件实现自动上传文件</p><blockquote><p>1)下载安装，官方网站：<a href="https://www.autoitscript.com/site/" target="_blank" rel="noopener">https://www.autoitscript.com/site/</a><br>2)配置编辑AutoIt。<br>3)<code>os.system(&quot;D:\\upfile.exe&quot;)</code> #通过系统调用upfile.exe上传程序 </p></blockquote><h2 id="十四、下载文件"><a href="#十四、下载文件" class="headerlink" title="十四、下载文件"></a>十四、下载文件</h2><p>(1)以FireFox为例，为了让FireFox浏览器能实现文件的载，我们需要通过FirefoxProfile()对其参数做一个设置:</p><ul><li><code>browser.download.folderList</code> #设置成0代表下载到浏览器默认下载路径；设置成2则可以保存到指定目录。</li><li><code>browser.download.manager.showWhenStarting</code> #是否显示开始，Ture为显示，Flase为不显示。</li><li><code>browser.download.dir</code> #用于指定你所下载文件的目录。os.getcwd()该函数不需要传递参数，用于返回当前的目录。</li><li><code>browser.helperApps.neverAsk.saveToDisk</code> #指定要下载页面的Content-type值，“application/octet-stream”为文件的类型。HTTP Content-type常用对照表：<a href="http://tool.oschina.net/commons" target="_blank" rel="noopener">http://tool.oschina.net/commons</a></li></ul><p>(2)这些参数的设置可以通过在Firefox浏览器地址栏输入：about:config 进行设置，如图： </p><p><img src="/2018/03/01/selenium常用API/firefox参数设置.png" alt="firefox参数设置"></p><p>(3)浏览器设置代码示例：</p><blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#coding=utf-8 </span><br><span class="line">from selenium import webdriver </span><br><span class="line">import os</span><br><span class="line"></span><br><span class="line">fp = webdriver.FirefoxProfile()</span><br><span class="line">fp.set_preference(&quot;browser.download.folderList&quot;,2) </span><br><span class="line">fp.set_preference(&quot;browser.download.manager.showWhenStarting&quot;,False) </span><br><span class="line">fp.set_preference(&quot;browser.download.dir&quot;, os.getcwd()) </span><br><span class="line">fp.set_preference(&quot;browser.helperApps.neverAsk.saveToDisk&quot;, &quot;application/octet-stream&quot;)</span><br><span class="line"></span><br><span class="line">driver = webdriver.Firefox(firefox_profile=fp) </span><br><span class="line">driver.get(&quot;http://pypi.Python.org/pypi/selenium&quot;) </span><br><span class="line">driver.find_element_by_partial_link_text(&quot;selenium-2&quot;).click()</span><br></pre></td></tr></table></figure></blockquote><h2 id="十五、操作Cookie"><a href="#十五、操作Cookie" class="headerlink" title="十五、操作Cookie"></a>十五、操作Cookie</h2><p>webdriver操作cookie的方法有：</p><ul><li><code>get_cookies()</code> #获得所有cookie信息  </li><li><code>get_cookie(name)</code> #返回有特定name值有cookie信息  </li><li><code>add_cookie(cookie_dict)</code> #添加cookie，必须有name和value值  </li><li><code>delete_cookie(name)</code> #删除特定(部分)的cookie信息  </li><li><code>delete_all_cookies()</code> #删除所有cookie信息</li></ul><p>(1)先通过get_cookies()来获取当前浏览器的cookie信息。<br>通过打印结果可以看出，cookie 是以字典的形式进行存放的，知道了cookie的存放形式，那么我们就可以按照这种形式向浏览器中写入cookie信息。</p><blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">driver.get(&quot;http://www.youdao.com&quot;)</span><br><span class="line">cookie= driver.get_cookies() # 获得cookie信息 </span><br><span class="line">print cookie #将获得cookie的信息打印</span><br></pre></td></tr></table></figure><blockquote><p><img src="/2018/03/01/selenium常用API/cookie打印信息.png" alt="cookie打印信息"></p></blockquote></blockquote><p>(2)再进行cookie的添加、删除等操作。</p><blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">driver.get(&quot;http://www.youdao.com&quot;)</span><br><span class="line">driver.add_cookie(&#123;&apos;name&apos;:&apos;key-aaaaaaa&apos;, &apos;value&apos;:&apos;value-bbbbbb&apos;&#125;) #向cookie的name 和value添加会话信息。</span><br></pre></td></tr></table></figure></blockquote><h2 id="十六、调用javascript"><a href="#十六、调用javascript" class="headerlink" title="十六、调用javascript"></a>十六、调用javascript</h2><p>当webdriver遇到没法完成的操作时，可以考虑调用JavaScript来完成。<br>webdriver提供<code>execute_script()</code>方法用来调用js代码：</p><blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#修改元素的属性</span><br><span class="line">js = &apos;document.querySelectorAll(&quot;select&quot;)[0].style.display=&quot;block&quot;;&apos;</span><br><span class="line">driver.execute_script(js)</span><br></pre></td></tr></table></figure></blockquote><h2 id="十七、控制浏览器滚动条"><a href="#十七、控制浏览器滚动条" class="headerlink" title="十七、控制浏览器滚动条"></a>十七、控制浏览器滚动条</h2><p>(1)上下滚动：<br><code>document.body.scrollTop</code> #网页被卷去的高。置顶设置：scrollTop为0；置底设置：scrollTop大于窗口的高度像素。</p><blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#将页面滚动条拖到底部</span><br><span class="line">js=&quot;var q=document.documentElement.scrollTop=10000&quot;</span><br><span class="line">driver.execute_script(js)</span><br><span class="line">time.sleep(3)</span><br><span class="line">#将滚动条移动到页面的顶部</span><br><span class="line">js1=&quot;var q=document.documentElement.scrollTop=0&quot;</span><br><span class="line">driver.execute_script(js1)</span><br><span class="line">time.sleep(3)</span><br></pre></td></tr></table></figure></blockquote><p>(2)左右滚动：<br><code>window.scrollTo(左边距,上边距)</code> #指定左右滚动的坐标即可</p><blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">js=&quot; window.scrollTo(200,1000);&quot; </span><br><span class="line">driver.execute_script(js)</span><br></pre></td></tr></table></figure></blockquote><h2 id="十八、窗口截图"><a href="#十八、窗口截图" class="headerlink" title="十八、窗口截图"></a>十八、窗口截图</h2><p>Webdriver提供了截图函数<code>get_screenshot_as_file()</code>来截取当前窗口:</p><blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">try:</span><br><span class="line">driver.find_element_by_id(&apos;kw_error&apos;).send_key(&apos;selenium&apos;) </span><br><span class="line">driver.find_element_by_id(&apos;su&apos;).click() </span><br><span class="line">except: </span><br><span class="line">driver.get_screenshot_as_file(&quot;D:\\baidu_error.jpg&quot;) #截图，保存到指定路径</span><br><span class="line">driver.quit()</span><br></pre></td></tr></table></figure></blockquote><h2 id="十九、获取对象的属性值"><a href="#十九、获取对象的属性值" class="headerlink" title="十九、获取对象的属性值"></a>十九、获取对象的属性值</h2><p>有时候我们定位页面上的元素发现常用的id、name等属性是相同的。这个时候我们只能通过常规的定位方法定位出一组元素，然后观察通过元素的属性可以定位出单个元素。<br>可使用.get_attribute()方法:</p><blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 选择页面上所有的tag name为input的元素</span><br><span class="line">inputs = driver.find_elements_by_tag_name(&apos;input&apos;)</span><br><span class="line">#然后循环遍历出属性data-node值为594434493的元素，单击勾选</span><br><span class="line">for input in inputs:</span><br><span class="line">if input.get_attribute(&apos;data-node&apos;) == &apos;594434493&apos;:</span><br><span class="line">input.click()</span><br></pre></td></tr></table></figure></blockquote><h2 id="二十、验证码处理"><a href="#二十、验证码处理" class="headerlink" title="二十、验证码处理"></a>二十、验证码处理</h2><p>(1)去掉验证码。<br>(2)设置万能码。<br>(3)验证码识别技术<br>例如可以通过Python-tesseract来识别图片验证码,能够读取任何常规的图片文件(JPG,GIF,PNG,TIFF 等)。不过，目前市面上的验证码识别技术识别率都不是100% 。<br>(4)记录cookie<br>通过向浏览器中添加cookie可以绕过登录的验证码,这种方式最大的问题是如何从浏览器的Cookie中找到用户名和密码对应的key值，并传传输入对应的登录信息。如果网站登录时根本不将用户名和密码写Cookie，这会存在一定的安全风险。那么这种方式就不起作用了。</p><blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#访问xx网站 </span><br><span class="line">driver.get(&quot;http://www.xx.cn&quot;)</span><br><span class="line">#将用户名密码写入浏览器cookie </span><br><span class="line">driver.add_cookie(&#123;&apos;name&apos;:&apos;Login_UserNumber&apos;, &apos;value&apos;:&apos;username&apos;&#125;) </span><br><span class="line">driver.add_cookie(&#123;&apos;name&apos;:&apos;Login_Passwd&apos;, &apos;value&apos;:&apos;password&apos;&#125;)</span><br><span class="line">#再次访问xx网站，将会自动登录 </span><br><span class="line">driver.get(&quot;http://www.xx.cn/&quot;) </span><br><span class="line">time.sleep(3)</span><br></pre></td></tr></table></figure></blockquote><p>(5)内部提供一个接口获得验证码，然后通过js代码把获取的验证码填写进去：</p><blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#自动获取验证码并填写</span><br><span class="line">js=&quot;$.getJSON(&apos;http://xxx.xxx.com/util/getCode.jsonp?callback=?&apos;,function(data)&#123;$(&apos;.imgcode&apos;).val(data.code);&#125;)&quot;</span><br><span class="line">driver.execute_script(js)</span><br></pre></td></tr></table></figure></blockquote><h1 id="持续更新…"><a href="#持续更新…" class="headerlink" title="持续更新…"></a><em>持续更新…</em></h1>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;selenium常用API笔记。&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="web测试" scheme="http://pythonfood.github.io/categories/web%E6%B5%8B%E8%AF%95/"/>
    
    
      <category term="selenium" scheme="http://pythonfood.github.io/tags/selenium/"/>
    
  </entry>
  
  <entry>
    <title>selenium安装-windows</title>
    <link href="http://pythonfood.github.io/2018/03/01/selenium%E5%AE%89%E8%A3%85-windows/"/>
    <id>http://pythonfood.github.io/2018/03/01/selenium安装-windows/</id>
    <published>2018-03-01T01:00:00.000Z</published>
    <updated>2018-05-11T06:55:16.648Z</updated>
    
    <content type="html"><![CDATA[<p>selenium环境搭建的简单步骤：安装Python——安装pip——安装selenium——安装浏览器驱动。<br><a id="more"></a></p><h2 id="一、安装Python"><a href="#一、安装Python" class="headerlink" title="一、安装Python"></a>一、<a href="https://pythonfood.github.io/2017/12/28/python安装-windows/#more">安装Python</a></h2><h2 id="二、安装pip"><a href="#二、安装pip" class="headerlink" title="二、安装pip"></a>二、安装pip</h2><blockquote><p>方法1：自动安装</p><blockquote><p>在第1步安装python时，已经安装了pip。</p></blockquote><p>方法2：手动安装</p><blockquote><p>(1)下载pip压缩包：<a href="https://pypi.python.org/pypi/pip#downloads" target="_blank" rel="noopener">https://pypi.python.org/pypi/pip#downloads</a><br>(2)解压后cmd进入解压目录，执行<code>python setup.py install</code>进行安装。</p></blockquote></blockquote><h2 id="三、安装selenium"><a href="#三、安装selenium" class="headerlink" title="三、安装selenium"></a>三、安装selenium</h2><blockquote><p>方法1：命令行安装</p><blockquote><p>进入cmd输入命令’pip install selenium’。</p></blockquote><p>方法2：下载whl包安装</p><blockquote><p>(1)下载selenium安装包：<a href="https://pypi.python.org/pypi/selenium" target="_blank" rel="noopener">https://pypi.python.org/pypi/selenium</a> 或 <a href="https://www.seleniumhq.org/download/" target="_blank" rel="noopener">https://www.seleniumhq.org/download/</a><br>(2)下载完成后，进入cmd输入命令<code>pip install</code>，再直接将文件拖入cmd窗口，回车即可安装。</p></blockquote></blockquote><h2 id="四、安装浏览器驱动"><a href="#四、安装浏览器驱动" class="headerlink" title="四、安装浏览器驱动"></a>四、安装浏览器驱动</h2><blockquote><p>(1)下载浏览器驱动</p><blockquote><p>不同浏览器需下载不同驱动，不同版本浏览器对应不同版本驱动。这里只给出chrome和firefox的驱动下载地址：<br>1)chrome：<a href="http://npm.taobao.org/mirrors/chromedriver" target="_blank" rel="noopener">http://npm.taobao.org/mirrors/chromedriver</a> 或 <a href="http://chromedriver.storage.googleapis.com/index.html" target="_blank" rel="noopener">http://chromedriver.storage.googleapis.com/index.html</a><br>2)firefox：<a href="https://github.com/mozilla/geckodriver/releases" target="_blank" rel="noopener">https://github.com/mozilla/geckodriver/releases</a></p></blockquote><p>(2)安装浏览器驱动</p><blockquote><p>下载完驱动后解压，将驱动放置在可执行路径下。这里给出三种路径：<br>1)将浏览器驱动放到python的Path路径下。<br>2)将浏览器驱动放到浏览器的Path路径下。<br>3)自定义路径，新建driver文件夹，将驱动放在driver文件下，最后将该路径添加到环境变量中。</p></blockquote></blockquote><h2 id="五、验证环境（小示例）"><a href="#五、验证环境（小示例）" class="headerlink" title="五、验证环境（小示例）"></a>五、验证环境（小示例）</h2><blockquote><p>(1)创建python文件selenium_python.py，内容如下：</p><blockquote><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">from selenium import webdriver</span><br><span class="line">driver = webdriver.Chrome()</span><br><span class="line">driver.get(&apos;http://www.baidu.com/&apos;)</span><br></pre></td></tr></table></figure></blockquote><p>(2)cmd执行命令<code>python selenium_python.py</code>。<br>(3)脚本自动执行，结果如下：</p><blockquote><p><img src="/2018/03/01/selenium安装-windows/脚本执行结果.png" alt="脚本执行结果"></p></blockquote></blockquote><h1 id="持续更新…"><a href="#持续更新…" class="headerlink" title="持续更新…"></a><em>持续更新…</em></h1>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;selenium环境搭建的简单步骤：安装Python——安装pip——安装selenium——安装浏览器驱动。&lt;br&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="web测试" scheme="http://pythonfood.github.io/categories/web%E6%B5%8B%E8%AF%95/"/>
    
    
      <category term="selenium" scheme="http://pythonfood.github.io/tags/selenium/"/>
    
  </entry>
  
</feed>
