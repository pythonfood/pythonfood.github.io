<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>django-虫师-笔记 | PythonFood</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
    <meta name="keywords" content="python food,Python Food," />
  
  <meta name="description" content="虫师所写django签到系统的学习笔记。">
<meta name="keywords" content="django">
<meta property="og:type" content="article">
<meta property="og:title" content="django-虫师-笔记">
<meta property="og:url" content="http://pythonfood.github.io/2018/06/01/django-虫师-笔记/index.html">
<meta property="og:site_name" content="PythonFood">
<meta property="og:description" content="虫师所写django签到系统的学习笔记。">
<meta property="og:updated_time" content="2018-08-11T07:57:20.461Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="django-虫师-笔记">
<meta name="twitter:description" content="虫师所写django签到系统的学习笔记。">
  
  
    <link rel="icon" href="/favicon.ico">
  
  <link href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css">
  <script src="/js/pace.min.js"></script>
  

  
  

</head>

<body>
  <div id="container">
      <header id="header">
    <div id="banner"></div>
    <div id="header-outer">
        <div id="header-menu" class="header-menu-pos animated">
            <div class="header-menu-container">
                <a href="/" class="left">
                    <span class="site-title">Python Food</span>
                </a>
                <nav id="header-menu-nav" class="right">
                    
                    <a  href="/">
                        <i class="fa fa-home"></i>
                        <span>Home</span>
                    </a>
                    
                    <a  href="/archives">
                        <i class="fa fa-archive"></i>
                        <span>Archives</span>
                    </a>
                    
                    <a  href="/about">
                        <i class="fa fa-user"></i>
                        <span>About</span>
                    </a>
                    
                </nav>
                <a class="mobile-header-menu-button">
                    <i class="fa fa-bars"></i>
                </a>
            </div>
        </div>
        <div id="header-row">
            <div id="logo">
                <a href="/">
                    <img src="/images/logo.png" alt="logo">
                </a>
            </div>
            <div class="header-info">
                <div id="header-title">
                    
                    <h2>
                        Python Food
                    </h2>
                    
                </div>
                <div id="header-description">
                    
                    <h3>
                        A snake that grows up slowly
                    </h3>
                    
                </div>
            </div>
            <nav class="header-nav">
                <div class="social">
                    
                        <a title="Home" target="_blank" href="//pythonfood.github.io">
                            <i class="fa fa-home fa-2x"></i></a>
                    
                        <a title="Github" target="_blank" href="//github.com/pythonfood">
                            <i class="fa fa-github fa-2x"></i></a>
                    
                </div>
            </nav>
        </div>
    </div>
</header>
      <div class="outer">
        <section id="main" class="body-wrap"><article id="post-django-虫师-笔记" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 class="post-title" itemprop="name">
      django-虫师-笔记
    </h1>
    <div class="post-title-bar">
      <ul>
          
              <li>
                  <i class="fa fa-book"></i>
                  
                      <a href="/categories/django/">django</a>
                  
              </li>
          
        <li>
          <i class="fa fa-calendar"></i>  2018-06-01
        </li>
        <li>
          <i class="fa fa-eye"></i>
          <span id="busuanzi_value_page_pv"></span>
        </li>
      </ul>
    </div>
  

          
      </header>
    
    <div class="article-entry post-content" itemprop="articleBody">
      
            
            <p>虫师所写django签到系统的学习笔记。<br><a id="more"></a></p>
<h2 id="一、Hello-Django"><a href="#一、Hello-Django" class="headerlink" title="一、Hello Django"></a>一、Hello Django</h2><p><strong>1、查看django命令</strong></p>
<p>D:> <code>django-admin</code></p>
<p><strong>2、创建项目</strong></p>
<p>D:> <code>django-admin startproject guest</code></p>
<blockquote>
<ul>
<li>guest/<ul>
<li>guest/<ul>
<li>__init__.py：一个空的文件，用它标识一个目录为 Python 的标准包。</li>
<li>settings.py：Django 项目的配置文件，包括 Django 模块应用配置，数据库配置，模板配置等。</li>
<li>urls.py：Django 项目的 URL 声明。</li>
<li>wsgi.py：为 WSGI 兼容的 Web 服务器服务项目的切入点。</li>
</ul>
</li>
<li>manage.py：一个命令行工具，可以让你在使用 Django 项目时以不同的方式进行交互。</li>
</ul>
</li>
</ul>
</blockquote>
<p><strong>3、查看 manage 所提供的命令</strong></p>
<p>D:\guest&gt; <code>python manage.py</code></p>
<p><strong>4、创建应用</strong></p>
<p>D:\guest&gt; <code>python manage.py startapp sign</code></p>
<blockquote>
<ul>
<li>guest/<ul>
<li>sign/<ul>
<li>migrations/：用于记录 models 中数据的变更。</li>
<li>admin.py：映射 models 中的数据到 Django 自带的 admin 后台。</li>
<li>apps.py：在新的 Django 版本中新增，用于应用程序的配置。</li>
<li>models.py：创建应用程序数据表模型（对应数据库的相关操作）。</li>
<li>tests.py：创建 Django 测试。</li>
<li>views.py：控制向前端显示哪些数据。</li>
</ul>
</li>
</ul>
</li>
</ul>
</blockquote>
<p><strong>5、运行项目</strong></p>
<blockquote>
<p>D:\guest&gt; <code>python manage.py runserver</code></p>
<p>默认8000端口启动项目，也可以指定IP和端口：D:\guest&gt; <code>python manage.py runserver 127.0.0.1:8001</code></p>
</blockquote>
<p><strong>6、使用视图显示 Hello Django</strong></p>
<blockquote>
<p>(1)首先配置 guest/guest/settings.py ，将 sign 应用添加到项目中。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">INSTALLED_APPS = [</span><br><span class="line">	...</span><br><span class="line">	<span class="string">'sign'</span>,  <span class="comment"># 添加sign应用</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure></p>
<p>(2)再配置 guest/guest/urls.py ，添加 index/ 目录。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.conf.urls <span class="keyword">import</span> url, include  <span class="comment"># url控制需要导入</span></span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">	path(<span class="string">'admin/'</span>, admin.site.urls),</span><br><span class="line">	url(<span class="string">r'^index/$'</span>, views.index),   <span class="comment"># 添加 index/ 路径配置</span></span><br><span class="line">]</span><br></pre></td></tr></table></figure></p>
<p>(3)接着编辑 guest/sign/views.py ，创建 index() 视图函数。<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(request)</span>:</span></span><br><span class="line">	<span class="keyword">return</span> HttpResponse(<span class="string">'Hello Django'</span>)</span><br></pre></td></tr></table></figure></p>
<p>(4)运行项目，访问127.0.0.1:8000，即可显示’Hello Django’。</p>
</blockquote>
<p><strong>7、使用模板显示 Hello Django</strong></p>
<blockquote>
<p>(1)在应用 guest/sign/ 目录下，创建 templates/index.html 。（注意需要创建templates目录）<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span> </span><br><span class="line">		<span class="tag">&lt;<span class="name">title</span>&gt;</span>Django Page<span class="tag">&lt;/<span class="name">title</span>&gt;</span> </span><br><span class="line">	<span class="tag">&lt;/<span class="name">head</span>&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">body</span>&gt;</span> </span><br><span class="line">		<span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello Django<span class="tag">&lt;/<span class="name">h1</span>&gt;</span> </span><br><span class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>(2)编辑 guest/sign/views.py，用 index() 视图函数返回 index.html。（注意html文件路径不需要写templates）<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(request)</span>:</span></span><br><span class="line">	<span class="keyword">return</span> render(request, <span class="string">'index.html'</span>)  <span class="comment"># 这里抛弃 HttpResponse 类，转而使用 Django 的 render 函数</span></span><br></pre></td></tr></table></figure></p>
<p>(3)运行项目，访问127.0.0.1:8000，即可显示’Hello Django’。</p>
</blockquote>
<p><strong>8、MTV模式</strong></p>
<blockquote>
<p>(1)首先理解 Model-View-Controller（MVC）模式：数据存取逻辑、表现逻辑、业务逻辑。</p>
<p>(2)由于 Controller 由框架自行处理，而 Django 里更关注的是模型（Model）、模板(Template)和视图（Views）， Django 也被称为 MTV 框架 ：</p>
<ul>
<li>M（Model），即数据存取层。该层处理与数据相关的所有事务： 如何存取、如何验证有效。</li>
<li>T（Template），即表现层。该层处理与表现相关的决定： 如何在页面或其他类型文档中进行显示。</li>
<li>V（View），即业务逻辑层。该层包含存取模型及调取恰当模板的相关逻辑。 你可以把它看作模型与模板之间的桥梁。</li>
</ul>
</blockquote>
<h2 id="二、Views-视图"><a href="#二、Views-视图" class="headerlink" title="二、Views 视图"></a>二、Views 视图</h2><p><strong>1、写个简单的登录</strong></p>
<blockquote>
<p>(1)…/templates/index.html编写登录表单代码代码。表单方法使用 method=”post”，提交路径为  action=”/login_action/“。<br>(2)注意页面需要添加跨站请求伪造（ CSRF）令牌，在Html表单中使用Django模板标签：<code>{</code>% csrf_token %<code>}</code><br>(3)打开 …/guest/urls.py 文件添加 login_action/的路由。<br>(4)打开 …/sign/views.py 文件，创建 login_action 视图函数。<br>(5)在 …/templates/index.html 页面中添加 Django 模板：。<br>(6)刷新网页，填入账号密码，验证效果。</p>
</blockquote>
<p><strong>2、添加登录成功页</strong></p>
<blockquote>
<p>(1)首先创建 …/templates/event_manage.html 页面，编写html代码。<br>(2)修改 …/sign/views.py 中的 login_action 函数，登录成功后重定向到 /event_manage/ 路径。<br>(3)在 …/guest/urls.py 文件中添加路径 event_manage/的路由：views.event_manage。<br>(4)在 …/sign/views.py 中添加event_manage视图函数，返回event_manage.html。</p>
</blockquote>
<p><strong>3、Cookie 的使用</strong></p>
<blockquote>
<p>(1)修改…/sign/views.py 文件login_action函数设置cookie：<code>response.set_cookie(&#39;user&#39;, username)</code><br>(2)修改…/sign/views.py 文件 event_manage函数获取cookie： <code>request.COOKIES.get(&#39;user&#39;, &#39;&#39;, 3600)</code><br>(3)修改…/templates/event_manage.html 页面，添加<div>标签来显示用户登录的用户名。</div></p>
</blockquote>
<p><strong>4、Session 的使用</strong></p>
<blockquote>
<p>(1)修改…/sign/views.py文件，在 login_action 函数中将 session 信息记录到浏览器：<code>request.session[&#39;user&#39;]=username</code> 。<br>(2)修改…/sign/views.py文件，在 event_manage 函数中读取浏览器 session：<code>username=request.session.get(&#39;user&#39;,&#39;&#39;)</code> 。<br>(3)既然要服务器端记录用户的数据，需要创建 django_session 表，不过Django已经准备好了，我们需要生成他们，进行数据迁移：D:\guest&gt; <code>python3 manage.py migrate</code> </p>
</blockquote>
<p><strong>5、登录 Admin 后台</strong></p>
<blockquote>
<p>执行 manage.py 的“migrate”命令时，Django 同时也帮我们生成了 auth_user 表。同时，我们可以通过 URL 地址：<a href="http://127.0.0.1:8000/admin/" target="_blank" rel="noopener">http://127.0.0.1:8000/admin/</a> 来访问 Django 自带的 Admin 管理后台。在此之前,先来创建登录 Admin 后台的管理员账号：</p>
<ul>
<li>D:\guest&gt; <code>python3 manage.py createsuperuser</code></li>
<li>Username (leave blank to use ‘fnngj’): <code>admin</code> #输入用户名 </li>
<li>Email address: <code>admin@mail.com</code> #输入邮箱 </li>
<li>Password: <code>admin123456</code> #输入密码 </li>
<li>Password (again): <code>admin123456</code> #重复输入密码 </li>
</ul>
</blockquote>
<p><strong>6、引用 Django 认证登录</strong></p>
<blockquote>
<p>(1)打开…/sign/views.py 文件修改 login_action 函数，认证给出的用户名和密码：<code>user = auth.authenticate(username=username, password=password)</code><br>(2)通过 if 语句判断 authenticate()返回（即user）如果不为 None，说明用户认证通过。<br>(3)来调用 login()函数进行 登录：<code>auth.login(request, user)</code> </p>
</blockquote>
<p><strong>7、关上窗户</strong></p>
<blockquote>
<p>(1)直接访问：<a href="http://127.0.0.1:8000/event_manage/，" target="_blank" rel="noopener">http://127.0.0.1:8000/event_manage/，</a> 我们不需要通过登录也可以直接访问到登录成功的页面。我们要把这些“窗户”都关上，使用户只能通过登录来访问系统：</p>
<ul>
<li>如果想限制某个视图函数必须登录才能访问，只需要在这个函数的前面加上： <code>@login_required</code> 。</li>
</ul>
<p>(2)仔细看，会发布在访问被@login_required 装饰的视图时，默认会跳转的 URL 中会包含 “/accounts/login/”，为什么不让它直接跳转到登录页面呢？不但要告诉你窗户是关着的，还要帮你指引到门的位置：</p>
<ul>
<li>修改…/urls.py 文件，添加以下路径：url(r’^accounts/login/$’, views.index)。</li>
<li>当用户访问：<a href="http://127.0.0.1:8000/" target="_blank" rel="noopener">http://127.0.0.1:8000/</a> 、 <a href="http://127.0.0.1:8000/index/" target="_blank" rel="noopener">http://127.0.0.1:8000/index/</a> 、 <a href="http://127.0.0.1:8000/event_manage/" target="_blank" rel="noopener">http://127.0.0.1:8000/event_manage/</a> ，都会跳转到登录页面。</li>
</ul>
</blockquote>
<h2 id="三、Model-模型"><a href="#三、Model-模型" class="headerlink" title="三、Model 模型"></a>三、Model 模型</h2><p><strong>1、设计系统表</strong></p>
<blockquote>
<p>Django 提供完善的模型（model）层主要用来创建和存取数据，不需要我们直接对数据库操作。每个模型是一个 Python 类，继承 django.db.models.model 类。该模型的每个属性表示一个数据库表字段。</p>
<p>(1)打开…/sign/models.py 文件，完成表的创建。<br>(2)进行数据库迁移：</p>
<ul>
<li>D:\guest&gt; <code>python3 manage.py makemigrations sign</code> </li>
<li>D:\guest&gt; <code>python3 manage.py migrate</code></li>
</ul>
</blockquote>
<p><strong>2、admin 后台管理</strong></p>
<blockquote>
<p>创建的发布会和嘉宾表 同样可以通过 Admin 后台去管理：</p>
<ul>
<li>打开…/sign/admin.py 文件，通知 admin 管理工具为这些模块逐一提供界面：<code>admin.site.register()</code>。</li>
<li>打开…/sign/admin.py 文件，定义 list_display 要在列表中显示哪些字段，当然，这些字段名称必须是模型中的数据表类中定义的。</li>
<li>打开…/sign/admin.py 文件，search_fields 创建表字段的搜索器，设置搜索关键字匹配多个表字段。 list_filter 用于创建字段过滤器。</li>
</ul>
</blockquote>
<p><strong>3、基本数据访问</strong></p>
<ul>
<li><code>python manage.py shell</code>  # dos下进入django的shell模式</li>
<li><code>from sign.models import Event,Guest</code>  </li>
<li><code>table.objects.all()</code>  # 获得 table（Event、Gues 表）中的所有对象</li>
<li><code>quit()</code>  # 退出shell</li>
</ul>
<blockquote>
<p>(1)插入数据<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> datetime <span class="keyword">import</span> datetime  </span><br><span class="line">e1 = Event(id=<span class="number">2</span>,name=<span class="string">'红米 Pro 发布会'</span>,limit=<span class="number">2000</span>,status=<span class="keyword">True</span>,address=<span class="string">'北京水立方'</span>,start_time=datetime(<span class="number">2016</span>,<span class="number">8</span>,<span class="number">10</span>,<span class="number">14</span>,<span class="number">0</span>,<span class="number">0</span>))   </span><br><span class="line">e1.save()</span><br></pre></td></tr></table></figure></p>
<p>ps：修改 settings.py 文件保存后，需要执行 quit() 命令退出 shell 模式，并重新执行 Python3 manage.py shell 进入，刚才的设置才会生效。<br>也可以通过 table.objects.create()方法将两步合为一步：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Event.objects.create(id=<span class="number">3</span>,name=<span class="string">'红米 MAX发布会'</span>,limit=<span class="number">2000</span>,status=<span class="keyword">True</span>, address=<span class="string">'北京会展中心'</span>,start_time=datetime(<span class="number">2016</span>,<span class="number">9</span>,<span class="number">22</span>,<span class="number">14</span>,<span class="number">0</span>,<span class="number">0</span>)) &lt;Event: 红米MAX发布会&gt; </span><br><span class="line">Guest.objects.create(realname=<span class="string">'andy'</span>,phone=<span class="number">13611001101</span>,email= <span class="string">'andy@mail.com'</span>,sign=<span class="keyword">False</span>,event_id=<span class="number">3</span>)</span><br></pre></td></tr></table></figure></p>
<p>(2)查询数据<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">table.objects.get()  <span class="comment"># 从数据库表中取得一条匹配的结果，返回一个对象，如果记录不存在的话，那么它会报DoesNotExist类型错误：</span></span><br><span class="line">e1 = Event.objects.get(name=<span class="string">'红米MAX发布会'</span>) </span><br><span class="line">e1</span><br><span class="line">e1.address</span><br><span class="line"></span><br><span class="line">table.objects.filter()  <span class="comment"># 方法是从数据库的取得匹配的结果，返回一个对象列表，如果记录不存在的话，它会返回[]：</span></span><br><span class="line">e2 = Event.objects.filter(name__contains=<span class="string">'发布会'</span>) </span><br><span class="line">e2</span><br></pre></td></tr></table></figure></p>
<p>(3)删除数据<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#通过 delete()方法删除：</span></span><br><span class="line">g2 = Guest.objects.get(phone=<span class="string">'13611001101'</span>) </span><br><span class="line">g2.delete()</span><br></pre></td></tr></table></figure></p>
<p>(4)更新数据<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">g3=Guest.objects.get(phone=<span class="string">'13611001101'</span>) </span><br><span class="line">g3.realname=<span class="string">'andy2'</span> </span><br><span class="line">g3.save()</span><br></pre></td></tr></table></figure></p>
</blockquote>
<p><strong>4、配置 MySQL</strong></p>
<blockquote>
<p>(1)要在…/guest/settings.py 文件中修改数据库相关配置。<br>(2)安装pymysql库。<br>(3)创建数据库。<br>(4)切换了数据库后，之前 Sqlite3 数据库里的数据并不能复制到 MySQL 中，所以需要重新进行数据库同步，使数据模型重新在 MySQL 数据库中生成表：D:\guest&gt; <code>python manage.py migrate</code><br>(5)直接进行数据迁移会报错！这是因为Django 在连接 MySQL 数据库时默认使用的是 MySQLdb 驱动，然而我们没有安装该驱动，因为它并不支持 Python3，我们现在安装的是 PyMySQL 驱动，如何让当前的 Django 通过 PyMySQL 来连接 MySQL 数据库呢？方法很简单，在…/guest/__init__.py 目录下添加：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line">pymysql.install_as_MySQLdb()</span><br><span class="line"><span class="comment">#添加完后，再执行数据迁移命令。</span></span><br></pre></td></tr></table></figure></p>
<p>(6) 因为更换了数据库，所以，Admin 后台超级管理员账号（admin/admin123456）也需要重新创建：  </p>
<ul>
<li>D:\guest&gt; <code>python3 manage.py createsuperuser</code></li>
<li>Username (leave blank to use ‘fnngj’): <code>admin</code> #输入用户名 </li>
<li>Email address: <code>admin@mail.com</code> #输入邮箱 </li>
<li>Password: <code>admin123456</code> #输入密码 </li>
<li>Password (again): <code>admin123456</code> #重复输入密码 </li>
</ul>
</blockquote>
<h2 id="四、Template-模板"><a href="#四、Template-模板" class="headerlink" title="四、Template 模板"></a>四、Template 模板</h2><p><strong>1、Django-bootstrap3</strong></p>
<blockquote>
<p>(1)安装 <code>pip install django-bootstrap3</code><br>(2)在…/guest/settings.py 文件中添加 bootstrap3 应用。</p>
</blockquote>
<p><strong>2、发布会管理</strong></p>
<blockquote>
<p>(1)打开…/sign/views.py 文件，修改 event_manage()视图函数：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">event_list = Event.objects.all()  <span class="comment"># 从数据库查询所有发布会</span></span><br><span class="line"><span class="keyword">return</span> render(request,<span class="string">"event_manage.html"</span>,&#123;<span class="string">"user"</span>: username, <span class="string">"events"</span>:event_list&#125;)  <span class="comment"># 将发布会列表返回给前端</span></span><br></pre></td></tr></table></figure></p>
<p>(2)打开并编写…/templates/event_manage.html 页面：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- &lt;head&gt;中引入bootstrap：--&gt;</span></span><br><span class="line">&#123;% load bootstrap3 %&#125; </span><br><span class="line">&#123;% bootstrap_css %&#125;</span><br><span class="line">&#123;% bootstrap_javascript %&#125; </span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- &lt;body&gt;中遍历显示出所有发布会列表：--&gt;</span></span><br><span class="line">&#123;% for event in events %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; event.id &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; event.name &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; event.status &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; event.address &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; event.start_time &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span> </span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure></p>
<p>(3)在…/templates/event_manage.html 页面上创建搜索表单。<br>(4)在…/guest/urls.py 文件中添加搜索路径的路由：<code>url(r&#39;^search_name/$&#39;, views.search_name)</code><br>(5)打开…/sign/views.py 文件，创建 search_name()视图函数。</p>
</blockquote>
<p><strong>3、嘉宾管理</strong></p>
<blockquote>
<p>(1)创建…/templates/guest_manage.html 页面：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;% for guest in guests %&#125;</span><br><span class="line"><span class="tag">&lt;<span class="name">tr</span>&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; guest.id &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; guest.realname &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; guest.phone &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; guest.email &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; guest.sign &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; guest.event &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">tr</span>&gt;</span> </span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure></p>
<p>(2)在…/guest/urls.py 文件中添加嘉宾路径的路由。<br>(3)打开…/sign/views.py 文件，创建 guest_manage()视图函数。</p>
</blockquote>
<p><strong>4、分页器 Paginator</strong></p>
<p>Django 已经为我们准备好了 Paginator 分页类。所以，只需要调用它即可完成列表的分页功能，进入 Django 的 shell 模式，练习 Paginator 类的基本使用:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">D:\guest&gt; python3 manage.py shell</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> django.core.paginator <span class="keyword">import</span> Paginator</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">from</span> sign.models <span class="keyword">import</span> Guest</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>guest_list = Guest.objects.all()  <span class="comment"># 查询 uest 表的所有数据</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p = Paginator(guest_list, <span class="number">2</span>)  <span class="comment"># 创建每页 2 条数据的分页器 </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p.count  <span class="comment"># 查看共多少条数据</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>p.page_range  <span class="comment"># 查看共分多少页 </span></span><br><span class="line"></span><br><span class="line"><span class="comment">##########第一页#############</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>page1 = p.page(<span class="number">1</span>)  <span class="comment"># 获取第 1 页的数据</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>page1  <span class="comment"># 当前第几页  </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>page1.object_list  <span class="comment"># 当前页的对象 </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">for</span> p <span class="keyword">in</span> page1:  <span class="comment"># 循环打印第 1 页嘉宾的 realname </span></span><br><span class="line"><span class="meta">... </span>	p.realname</span><br><span class="line"></span><br><span class="line"><span class="comment">##########第二页#############</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>page2 = p.page(<span class="number">2</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>page2.start_index()  <span class="comment"># 本页的第一条数据 </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>page2.end_index()  <span class="comment"># 本页的最后一条数据 </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>page2.has_previous()  <span class="comment"># 是否有上一页 </span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>page2.has_next()  <span class="comment"># 是否有下一页</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>page2.previous_page_number()  <span class="comment"># 上一页是第几页</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>page2.next_page_number()  <span class="comment"># 下一页是第几页  </span></span><br><span class="line"></span><br><span class="line"><span class="comment">##########第三页#############</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>page3 = p.page(<span class="number">3</span>) </span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>page3.has_other_pages()  <span class="comment"># 是否有其他页</span></span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>(1)打开…/sign/views.py 文件，修改 guest_manage()视图函数。<br>(2)在…/templates/guest_manage.html 页面也需要添加分页器的代码。</p>
</blockquote>
<p><strong>5、签到功能</strong></p>
<blockquote>
<p>(1)在…/templates/event_manage.html 页面，增加签到列链接。<br>(2)在…/guest/urls.py 文件中添加路径路由。<br>(3)打开…/sign/views.py 文件，创建 sign_index()视图函数。<br>(4)创建…/templates/sign_index.html 签到页面。<br>(5)打开…/guest/urls.py 文件，添加签到路径的路由。<br>(6)打开…/sign/views.py 文件，创建 sign_index_action()视图函数。<br>(7)修改…/templates/sign_index.html 页面，增加 sign_index_action()视图函数返回的提示信息的位置：<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">font</span> <span class="attr">color</span>=<span class="string">"red"</span>&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">br</span>&gt;</span>&#123;&#123; hint &#125;&#125; </span><br><span class="line">	<span class="tag">&lt;<span class="name">br</span>&gt;</span>&#123;&#123; guest.realname &#125;&#125; </span><br><span class="line">	<span class="tag">&lt;<span class="name">br</span>&gt;</span>&#123;&#123; guest.phone &#125;&#125; </span><br><span class="line"><span class="tag">&lt;/<span class="name">font</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
</blockquote>
<p><strong>6、退出系统</strong></p>
<blockquote>
<p>(1)打开…/urls.py 文件，添加退出目录的路由。<br>(2)打开…/sign/views.py 文件，创建 logout()视图函数：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">auth.logout(request) <span class="comment">#退出登录 </span></span><br><span class="line">response = HttpResponseRedirect(<span class="string">'/index/'</span>) </span><br><span class="line"><span class="keyword">return</span> response</span><br></pre></td></tr></table></figure></p>
</blockquote>
<h2 id="五、开发-Web-接口"><a href="#五、开发-Web-接口" class="headerlink" title="五、开发 Web 接口"></a>五、开发 Web 接口</h2><p>首先，单独创建…/sign/views_if.py文件，该项目的接口方法都在这里。</p>
<p><strong>1、发布会添加接口</strong></p>
<blockquote>
<p>(1)首先，判断 eid、 name、limit、address、start_time 等字段均不能为空，否则 JsonResponse()返回相应的 状态码和提示。<br>(2)接下来，判断发布会 id 是否存在，以及发布会名称（name）是否存在；如果存在将返回相应的状态码和 提示信息。<br>(3)再接下来，判断发布会状态是否为空，如果为空，将状态设置为 1（True）。<br>(4)最后，将数据插入到 Event 表，在插入的过程中如果日期格式错误，将抛出 ValidationError 异常，接收 该异常并返回相应的状态和提示，否则，插入成功，返回状态码 200 和“addeventsuccess”的提示。</p>
</blockquote>
<p><strong>2、发布会查询接口</strong></p>
<blockquote>
<p>(1)通过GET请求接收发布会id和name参数。两个参数都是可选的。首先，判断当两个参数同时为空，接 口返回状态码 10021，参数错误。<br>(2)如果发布会 id 不为空，优先通过 id 查询，因为 id 的唯一性，所以，查询结果只会有一条，将查询结果 以 key:value 对的方式存放到定义的 event 字典中，并将数据字典作为整个返回字典中 data 对应的值返回。<br>(3)name 查询为模糊查询，查询数据可能会有多条，返回的数据稍显复杂；首先将查询的每一条数据放到一 个字典 event 中，再把每一个字典再放到数组 datas 中，最后再将整个数组做为返回字典中 data 对应的值返回。</p>
</blockquote>
<p><strong>3、嘉宾添加接口</strong></p>
<blockquote>
<p>(1)通过POST请求接收嘉宾参数：关联的发布会id、姓名、手机号和邮箱等参数。<br>(2)首先，判断 eid、realname、phone 等参数均不能为空。<br>(3)接下来，判断嘉宾关联的发布会 id 是否存在，以及关联的发布会状态是否为 True（即 1），如果不存在 或不为 True，将返回相应的状态码和提示信息。<br>(4)接下来判断发布会人数限制。<br>(5)再接下来的步骤是判断当前时间是否大于发布会时间，如果大于则说明发布已开始，或者早已经结束。那么该发布会就应该不能允许再添加嘉宾。<br>(6)最后，插入嘉宾数据，如果发布会的手机号重复则抛 IntegrityError 异常，接收该异常并返回相应的状态 码和提示信息。如果添加成功，则返回状态码 200 和“addguestsuccess”的提示。</p>
</blockquote>
<p><strong>4、嘉宾查询接口</strong></p>
<p>嘉宾查询接口与发布会查询接口相似，只是参数与查询条件判断有所不同，这里就不再一一说明。</p>
<p><strong>5、嘉宾签到接口</strong></p>
<blockquote>
<p>(1)签到接口通过POST请求接收发布会id和嘉宾手机号。签到接口的判断条件比较多。<br>(2)首先，判断两个参数均不能为空。<br>(3)接着，判断发布会 id 是否存在，以及发布会状态是否为 True，如果不存在或不为 True，将返回相应的状 态码和提示信息。<br>(4)再接着，判断当前时间是否大于发布会时间，如果大于发布会时间说明发布会已开始，不允许签到。<br>(5)然后，再判断嘉宾的手机号是否存在，以及嘉宾的手机号与发布会 id 是否为对应关系。否则返回相应的 错误码和提示信息。<br>(6)最后，判断该嘉宾的状态是否为已签到，如果已签到，返回相应的状态码和提示；如果未签到修改状态 为已签到，并返回状态码 200 和“signsuccess”的提示。</p>
</blockquote>
<p><strong>6、配置接口路径</strong></p>
<blockquote>
<p>(1)打开…/guest/urls.py文件，添加接口基本路径“/api/”：<code>url(r&#39;^api/&#39;, include(&#39;sign.urls&#39;, namespace=&quot;sign&quot;))</code><br>(2)创建…/sign/urls.py文件，配置具体接口的二级路径：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">app_name=<span class="string">'sign'</span>  <span class="comment"># django2.0里必须添加应用名称</span></span><br><span class="line">urlpatterns = [</span><br><span class="line">	<span class="comment"># guest system interface: </span></span><br><span class="line">	<span class="comment"># ex : /api/add_event/</span></span><br><span class="line">	url(<span class="string">r'^add_event/'</span>, views_if.add_event, name=<span class="string">'add_event'</span>),</span><br><span class="line">	<span class="comment"># ex : /api/add_guest/ </span></span><br><span class="line">	url(<span class="string">r'^add_guest/'</span>, views_if.add_guest, name=<span class="string">'add_guest'</span>), </span><br><span class="line">	<span class="comment"># ex : /api/get_event_list/ </span></span><br><span class="line">	url(<span class="string">r'^get_event_list/'</span>, views_if.get_event_list, name=<span class="string">'get_event_list'</span>), </span><br><span class="line">	<span class="comment"># ex : /api/get_guest_list/ </span></span><br><span class="line">	url(<span class="string">r'^get_guest_list/'</span>, views_if.get_guest_list, name=<span class="string">'get_guest_list'</span>), </span><br><span class="line">	<span class="comment"># ex : /api/user_sign/ </span></span><br><span class="line">	url(<span class="string">r'^user_sign/'</span>, views_if.user_sign, name=<span class="string">'user_sign'</span>),</span><br><span class="line">]</span><br></pre></td></tr></table></figure></p>
</blockquote>
<p><strong>7、编写 Web 接口文档</strong></p>
<h2 id="六、接口的安全机制"><a href="#六、接口的安全机制" class="headerlink" title="六、接口的安全机制"></a>六、接口的安全机制</h2><p><strong>1、用户认证</strong></p>
<blockquote>
<p>(1)重新创建…/sign/views_if_sec.py 视图文件，添加用户认证函数。<br>(2)增加发布会查询接口函数，函数首先调用用户认证函数，进行用户认证。<br>(3)在…/sign/urls.py 文件中添加新的安全接口指向：<code>url(r&#39;^sec_get_event_list/&#39;, views_if_sec.get_event_list, name=&#39;get_event_list&#39;)</code></p>
</blockquote>
<p><strong>2、数字签名</strong></p>
<p>在使用 HTTP/SOAP 协议传输数据的时候，签名作为其中一个参数，可以起到关键作用：</p>
<p>1)鉴权：通过客户的密钥，服务端的密钥匹配：</p>
<ul>
<li>例如一个接口传参为：<a href="http://127.0.0.1:8000/api/?a=1&amp;b=2" target="_blank" rel="noopener">http://127.0.0.1:8000/api/?a=1&amp;b=2</a></li>
<li>假设签名的密钥为：@admin123</li>
<li>加上签名之后的接口参数为：<a href="http://127.0.0.1:8000/sign/?a=1&amp;b=2&amp;sign=@admin123" target="_blank" rel="noopener">http://127.0.0.1:8000/sign/?a=1&amp;b=2&amp;sign=@admin123</a></li>
<li>sign 参数明文传输是不安全的，一般会通过加密算法进行加密, “@admin123” 经过 MD5 加密得到：4b9db269c5f978e1264480b0a7619eea</li>
<li>单做为鉴权，带签名的接口为：<a href="http://127.0.0.1:8000/sign/?a=1&amp;b=2&amp;sign=4b9db269c5f978e1264480b0a7619eea" target="_blank" rel="noopener">http://127.0.0.1:8000/sign/?a=1&amp;b=2&amp;sign=4b9db269c5f978e1264480b0a7619eea</a></li>
<li>服务器接收到请求后，同样需要对“@admin123”进行 MD5 加密，比对与传来的 sign 加密串是否一致，从而来鉴别调用者是否有权限方位该接口。</li>
</ul>
<p>2)数据防篡改：参数是明文传输，将参数及密钥加密作为签名与服务器匹配：</p>
<ul>
<li>同样是这样一个带参数的接口：<a href="http://127.0.0.1:8000/api/?a=1&amp;b=2" target="_blank" rel="noopener">http://127.0.0.1:8000/api/?a=1&amp;b=2</a></li>
<li>假设签名的密钥为：@admin123</li>
<li>签名的明文为：a=1&amp;b=2&amp;api_key=@admin123</li>
<li>将签名的明文生成 MD5 加密串：786bfe32ae1d3764f208e03ca0bfaf13</li>
<li>带参数的接口串为：<a href="http://127.0.0.1:8000/sign/?a=1&amp;b=2&amp;sign=786bfe32ae1d3764f208e03ca0bfaf13" target="_blank" rel="noopener">http://127.0.0.1:8000/sign/?a=1&amp;b=2&amp;sign=786bfe32ae1d3764f208e03ca0bfaf13</a></li>
<li>因为整个接口的参数做了加密，所以，只要任意一个参数发改变，那签名的验证就会失败。从而起到了鉴权及数据完整性的保护。</li>
</ul>
<blockquote>
<p>(1)打开…/sign/views_if_sec.py 视图文件，添加用户签名函数。<br>(2)增加添加发布会接口函数，函数首先调用用户签名函数，进行签名验证。<br>(3)在…/sign/urls.py 文件中添加新的安全接口路由：<code>url(r&#39;sec_add_event/&#39;, views_if_sec.add_event, name=&#39;add_event&#39;)</code></p>
</blockquote>
<p><strong>3、接口加密</strong></p>
<p>PyCrypto 是一个免费的加密算法库，支持常见的 DES、AES 加密以及 MD5、SHA 各种 HASH 运算。<br>安装PyCryoto库： <code>pip install Crypto</code></p>
<blockquote>
<p>(1)客户端请求接口时，进行了AES加密，在服务端需要进行解密验证。代码详见虫师原文地址。<br>(2)打开…/sign/views_if_sec.py 视图文件，编写解密函数。<br>(3)在获取嘉宾例表的接口中调用 aes_encryption()函数进行 AES 加密字符串解密。<br>(4)在…/sign/urls.py 文件中添加新的安全接口指向：<code>url(r&#39;^sec_get_guest_list/&#39;, views_if_sec.get_guest_list, name=&#39;get_guest_list&#39;)</code></p>
</blockquote>
<h2 id="七、REST-API"><a href="#七、REST-API" class="headerlink" title="七、REST API"></a>七、REST API</h2><p>REST（即 RepresentationalStateTransfer 的缩写）中文翻译为“表现层状态转化”：</p>
<ul>
<li><p>资源（Resources），所谓”资源”，就是网络上的一个实体，或者说是网络上的一个具体信息。你可以用一个 URI（统一资源定位符）指向它，每种资源对应一个特定的 URI。要获取这个资源，访问它的 URI 就可以。</p>
</li>
<li><p>表现层（Representation），把”资源”具体呈现出来的形式。URI 只代表资源的实体，不代表它的形式。严格地说，有些网址最后的“.html”后缀名是不必要的，因为这个后缀名表示格式，属于“表现层”范畴，而 URI 应该只代表“资源”的位置。它的具体表现形式，应该在 HTTP 请求的头信息中用 Accept 和 Content-Type 字段指定，这两个字段才是对”表现层”的描述。</p>
</li>
<li><p>状态转化（StateTransfer），互联网通信协议 HTTP 协议，是一个无状态协议。这意味着，所有的状态都保存在服务器端。因此，如果客户端想要操作服务器，必须通过某种手段，让服务器端发生“状态转化”（StateTransfer）。而这种转化是建立在表现层之上的，所以就是”表现层状态转化”。客户端用到的手段，只能是 HTTP 协议。具体来说，就是 HTTP 协议里面，四个表示操作方式的动词： GET、POST、PUT、DELETE。它们分别对应四种基本操作：GET 用来获取资源，POST 用来新建资源（也可 以用于更新资源），PUT 用来更新资源，DELETE 用来删除资源。</p>
</li>
</ul>
<p>Django-REST-Framework是一个强大而灵活的工具用于构建 WebAPIs。通过该框架可以创建 REST 风格的 WebSeriver 应用。安装：<code>pip install djangorestframework</code></p>
<p><strong>1、创建简单的 API</strong></p>
<blockquote>
<p>(1)&gt; <code>django-admin startproject django_rest</code><br>(2)&gt; <code>cd django_rest</code><br>(3)\django_rest&gt; <code>python3 manage.py startapp api</code><br>(4)打开 settings.py 文件添加应用：’rest_framework’和’api’<br>(5)在 settings.py 文件末尾添加:<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">REST_FRAMEWORK = &#123; </span><br><span class="line">	<span class="string">'DEFAULT_PERMISSION_CLASSES'</span>: (<span class="string">'rest_framework.permissions.IsAdminUser'</span>,), </span><br><span class="line">	<span class="string">'PAGE_SIZE'</span>: <span class="number">10</span> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>(6)执行数据库迁移 \django_rest&gt; <code>python3 manage.py migrate</code><br>(7)创建超级管理员账户\django_rest&gt; <code>python3 manage.py createsuperuser</code><br>(8)创建数据序列化，创建…/api/serializers.py 文件,代码见文件。<br>(9)创建视图，打开…/api/views.py 视图文件，代码见文件。<br>(10)打开…/django_rest/urls.py 文件，添加路径的路由，代码见文件。<br>(11)启动服务 …\django_rest&gt; <code>python3 manage.py runserver</code></p>
</blockquote>
<p><strong>2、 集成发布会系统 API</strong></p>
<blockquote>
<p>(1)接下来在 django_rest 项目的基础上增加发布会和嘉宾管理的接口。<br>(2)打开…/api/models.py 文件，创建模型。<br>(3)进行数据库迁移：<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">\django_rest&gt; python3 manage.py makemigrations api</span><br><span class="line">\django_rest&gt; python3 manage.py migrate</span><br></pre></td></tr></table></figure></p>
<p>(4)打开…/api/serializers.py 文件，添加发布会数据序列化。<br>(5)打开…/api/views.py 视图文件，定义发布会视图类。<br>(6)打开…/django_rest/urls.py 文件，添加 URL 配置。<br>(7)启动项目，使用浏览器打开：<a href="http://127.0.0.1:8000/" target="_blank" rel="noopener">http://127.0.0.1:8000/</a></p>
</blockquote>
<h2 id="八、项目代码"><a href="#八、项目代码" class="headerlink" title="八、项目代码"></a>八、项目代码</h2><h3 id="1、guest项目"><a href="#1、guest项目" class="headerlink" title="1、guest项目"></a>1、guest项目</h3><blockquote>
<ul>
<li>guest/<ul>
<li>guest/<ul>
<li>__init__.py</li>
<li>settings.py</li>
<li>urls.py</li>
<li>wsgi.py</li>
</ul>
</li>
<li>sign/<ul>
<li>migrations/<ul>
<li>__init__.py</li>
<li>0001_initial.py</li>
</ul>
</li>
<li>templates/<ul>
<li>event_manage.html</li>
<li>guest_manage.html</li>
<li>index.html</li>
<li>sign_index.html</li>
</ul>
</li>
<li>__init__.py</li>
<li>admin.py</li>
<li>apps.py</li>
<li>models.py</li>
<li>tests.py</li>
<li>urls.py</li>
<li>views.py</li>
<li>views_if.py</li>
<li>views_if_sec.py</li>
</ul>
</li>
<li>db.sqlite3</li>
<li>manage.py</li>
</ul>
</li>
</ul>
</blockquote>
<p>guest/guest/__init__.py<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line"></span><br><span class="line">pymysql.install_as_MySQLdb()  <span class="comment"># 让当前的 Django 通过 PyMySQL 来连接 MySQL 数据库</span></span><br></pre></td></tr></table></figure></p>
<p>guest/guest/settings.py<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">INSTALLED_APPS = [</span><br><span class="line">    <span class="string">'django.contrib.admin'</span>,</span><br><span class="line">    <span class="string">'django.contrib.auth'</span>,</span><br><span class="line">    <span class="string">'django.contrib.contenttypes'</span>,</span><br><span class="line">    <span class="string">'django.contrib.sessions'</span>,</span><br><span class="line">    <span class="string">'django.contrib.messages'</span>,</span><br><span class="line">    <span class="string">'django.contrib.staticfiles'</span>,</span><br><span class="line">	<span class="string">'sign'</span>,  <span class="comment"># 添加sign应用</span></span><br><span class="line">	<span class="string">'bootstrap3'</span>,  <span class="comment"># 添加</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="meta">... </span></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置mysql数据库</span></span><br><span class="line">DATABASES = &#123;</span><br><span class="line">    <span class="string">'default'</span>: &#123;</span><br><span class="line">        <span class="string">'ENGINE'</span>: <span class="string">'django.db.backends.mysql'</span>, </span><br><span class="line">		<span class="string">'HOST'</span>: <span class="string">'127.0.0.1'</span>, </span><br><span class="line">		<span class="string">'PORT'</span>: <span class="string">'3306'</span>, </span><br><span class="line">		<span class="string">'NAME'</span>: <span class="string">'guest'</span>, </span><br><span class="line">		<span class="string">'USER'</span>: <span class="string">'root'</span>, </span><br><span class="line">		<span class="string">'PASSWORD'</span>: <span class="string">'123456'</span>,</span><br><span class="line">		<span class="string">'OPTIONS'</span>: &#123; </span><br><span class="line">			<span class="string">'init_command'</span>: <span class="string">"SET sql_mode='STRICT_TRANS_TABLES'"</span>, </span><br><span class="line">		&#125;,</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">... </span></span><br><span class="line">...</span><br></pre></td></tr></table></figure></p>
<p>guest/guest/urls.py<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"><span class="keyword">from</span> django.conf.urls <span class="keyword">import</span> url, include  <span class="comment"># url控制需要导入</span></span><br><span class="line"><span class="keyword">from</span> sign <span class="keyword">import</span> views  <span class="comment"># 导入 sign 应用 views 文件</span></span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">'admin/'</span>, admin.site.urls),</span><br><span class="line">	url(<span class="string">r'^index/$'</span>, views.index),   <span class="comment"># 添加 index/路径配置</span></span><br><span class="line">	url(<span class="string">r'^login_action/$'</span>, views.login_action),</span><br><span class="line">	url(<span class="string">r'^event_manage/$'</span>, views.event_manage),</span><br><span class="line">	url(<span class="string">r'^accounts/login/$'</span>, views.index),</span><br><span class="line">	url(<span class="string">r'^search_name/$'</span>, views.search_name),</span><br><span class="line">	url(<span class="string">r'^guest_manage/$'</span>, views.guest_manage),</span><br><span class="line">	url(<span class="string">r'^sign_index/(?P&lt;event_id&gt;[0-9]+)/$'</span>, views.sign_index),  <span class="comment"># 配置二级目录，发布会 id，要求必须为数字</span></span><br><span class="line">	url(<span class="string">r'^sign_index_action/(?P&lt;event_id&gt;[0-9]+)/$'</span>, views.sign_index_action),</span><br><span class="line">	url(<span class="string">r'^logout/$'</span>, views.logout),</span><br><span class="line">	url(<span class="string">r'^api/'</span>, include(<span class="string">'sign.urls'</span>, namespace=<span class="string">"sign"</span>)),</span><br><span class="line">]</span><br></pre></td></tr></table></figure></p>
<p>guest/sign/admin.py<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> sign.models <span class="keyword">import</span> Event,Guest</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EventAdmin</span><span class="params">(admin.ModelAdmin)</span>:</span></span><br><span class="line">	list_display = [<span class="string">'id'</span>, <span class="string">'name'</span>, <span class="string">'status'</span>, <span class="string">'address'</span>, <span class="string">'start_time'</span>]  <span class="comment"># 显示字段</span></span><br><span class="line">	search_fields = [<span class="string">'name'</span>]  <span class="comment"># 搜索栏</span></span><br><span class="line">	list_filter = [<span class="string">'status'</span>]  <span class="comment"># 过滤器</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GuestAdmin</span><span class="params">(admin.ModelAdmin)</span>:</span></span><br><span class="line">	list_display = [<span class="string">'realname'</span>, <span class="string">'phone'</span>, <span class="string">'email'</span>, <span class="string">'sign'</span>, <span class="string">'create_time'</span>, <span class="string">'event'</span>]  <span class="comment"># 显示字段</span></span><br><span class="line">	search_fields = [<span class="string">'realname'</span>, <span class="string">'phone'</span>]  <span class="comment"># 搜索栏</span></span><br><span class="line">	list_filter = [<span class="string">'sign'</span>]  <span class="comment"># 过滤器</span></span><br><span class="line"></span><br><span class="line">admin.site.register(Event, EventAdmin)  <span class="comment"># 用 EventAdmin 选项注册 Event 模块。</span></span><br><span class="line">admin.site.register(Guest, GuestAdmin)	<span class="comment"># 用 GuestAdmin 选项注册 Guest 模块。</span></span><br></pre></td></tr></table></figure></p>
<p>guest/sign/models.py<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="comment"># 发布会表</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Event</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">	<span class="string">"""默认都会生成自增id，在创建模型时不需要声明该字段"""</span></span><br><span class="line">	name = models.CharField(max_length=<span class="number">100</span>)  <span class="comment"># 发布会标题</span></span><br><span class="line">	limit = models.IntegerField()  <span class="comment"># 参加人数</span></span><br><span class="line">	status = models.BooleanField()  <span class="comment"># 发布会状态</span></span><br><span class="line">	address = models.CharField(max_length=<span class="number">200</span>)  <span class="comment"># 地址</span></span><br><span class="line">	start_time = models.DateTimeField(<span class="string">'event time'</span>)  <span class="comment"># 发布会时间</span></span><br><span class="line">	create_time = models.DateTimeField(auto_now=<span class="keyword">True</span>) <span class="comment"># 创建时间（自动获取当前时间）</span></span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">		<span class="keyword">return</span> self.name  <span class="comment"># __str__()方法告诉 Python 如何将对象以 str 的方式显示出来。</span></span><br><span class="line">	</span><br><span class="line"><span class="comment"># 嘉宾表</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Guest</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">	<span class="string">"""默认都会生成自增id，在创建模型时不需要声明该字段"""</span></span><br><span class="line">	event = models.ForeignKey(Event, on_delete=models.CASCADE)  <span class="comment"># 关联发布会id</span></span><br><span class="line">	realname = models.CharField(max_length=<span class="number">64</span>)  <span class="comment"># 姓名</span></span><br><span class="line">	phone = models.CharField(max_length=<span class="number">16</span>)  <span class="comment"># 手机号</span></span><br><span class="line">	email = models.EmailField()  <span class="comment"># 邮箱</span></span><br><span class="line">	sign = models.BooleanField()  <span class="comment"># 签到状态</span></span><br><span class="line">	create_time = models.DateTimeField(auto_now=<span class="keyword">True</span>)  <span class="comment"># 创建时间（自动获取当前时间）</span></span><br><span class="line"></span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">		<span class="string">"""通过发布会id+手机号来做为联合主键"""</span></span><br><span class="line">		unique_together = (<span class="string">"event"</span>, <span class="string">"phone"</span>)</span><br><span class="line">		</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">		<span class="keyword">return</span> self.realname  <span class="comment"># __str__()方法告诉 Python 如何将对象以 str 的方式显示出来。</span></span><br></pre></td></tr></table></figure></p>
<p>guest/sign/urls.py<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.conf.urls <span class="keyword">import</span> url</span><br><span class="line"><span class="keyword">from</span> sign <span class="keyword">import</span> views_if, views_if_sec</span><br><span class="line"></span><br><span class="line">app_name=<span class="string">'sign'</span>  <span class="comment"># django2.0里必须添加应用名称，和urls路由里对应。或者直接在urls路由里添加路径也可以</span></span><br><span class="line"></span><br><span class="line">urlpatterns = [</span><br><span class="line">	<span class="comment"># guest system interface: </span></span><br><span class="line">	<span class="comment"># ex : /api/add_event/</span></span><br><span class="line">	url(<span class="string">r'^add_event/'</span>, views_if.add_event, name=<span class="string">'add_event'</span>),</span><br><span class="line">	<span class="comment"># ex : /api/add_guest/ </span></span><br><span class="line">	url(<span class="string">r'^add_guest/'</span>, views_if.add_guest, name=<span class="string">'add_guest'</span>), </span><br><span class="line">	<span class="comment"># ex : /api/get_event_list/ </span></span><br><span class="line">	url(<span class="string">r'^get_event_list/'</span>, views_if.get_event_list, name=<span class="string">'get_event_list'</span>), </span><br><span class="line">	<span class="comment"># ex : /api/get_guest_list/ </span></span><br><span class="line">	url(<span class="string">r'^get_guest_list/'</span>, views_if.get_guest_list, name=<span class="string">'get_guest_list'</span>), </span><br><span class="line">	<span class="comment"># ex : /api/user_sign/ </span></span><br><span class="line">	url(<span class="string">r'^user_sign/'</span>, views_if.user_sign, name=<span class="string">'user_sign'</span>),</span><br><span class="line">	<span class="comment"># security interface: </span></span><br><span class="line">	<span class="comment"># ex : /api/sec_get_event_list/ </span></span><br><span class="line">	url(<span class="string">r'sec_get_event_list/'</span>, views_if_sec.get_event_list, name=<span class="string">'get_event_list'</span>),</span><br><span class="line">	<span class="comment"># security interface:</span></span><br><span class="line">	<span class="comment"># ex : /api/sec_add_event/</span></span><br><span class="line">	url(<span class="string">r'sec_add_event/'</span>, views_if_sec.add_event, name=<span class="string">'add_event'</span>),</span><br><span class="line">	<span class="comment"># security interface: </span></span><br><span class="line">	<span class="comment"># ex : /aip/sec_add_event/ </span></span><br><span class="line">	url(<span class="string">r'^sec_get_guest_list/'</span>, views_if_sec.get_guest_list, name=<span class="string">'get_guest_list'</span>), </span><br><span class="line">]</span><br></pre></td></tr></table></figure></p>
<p>guest/sign/views.py<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render, get_object_or_404</span><br><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse, HttpResponseRedirect </span><br><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> auth</span><br><span class="line"><span class="keyword">from</span> django.contrib.auth.decorators <span class="keyword">import</span> login_required</span><br><span class="line"><span class="keyword">from</span> sign.models <span class="keyword">import</span> Event,Guest</span><br><span class="line"><span class="keyword">from</span> django.core.paginator <span class="keyword">import</span> Paginator, EmptyPage, PageNotAnInteger</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">(request)</span>:</span></span><br><span class="line">	<span class="comment"># return HttpResponse('Hello Django')</span></span><br><span class="line">	<span class="keyword">return</span> render(request, <span class="string">'index.html'</span>)  <span class="comment"># 这里抛弃 HttpResponse 类，转而使用 Django 的 render 函数</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">login_action</span><span class="params">(request)</span>:</span></span><br><span class="line">	<span class="keyword">if</span> request.method == <span class="string">'POST'</span>:</span><br><span class="line">		username = request.POST.get(<span class="string">'username'</span>, <span class="string">''</span>)</span><br><span class="line">		password = request.POST.get(<span class="string">'password'</span>, <span class="string">''</span>)</span><br><span class="line">		user = auth.authenticate(username=username, password=password)  <span class="comment"># 认证给出的用户名和密码</span></span><br><span class="line">		<span class="keyword">if</span> user <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span>: </span><br><span class="line">			<span class="comment">#return HttpResponse('login success!') </span></span><br><span class="line">			<span class="comment">#response.set_cookie('user', username)  # 添加浏览器cookie</span></span><br><span class="line">			auth.login(request, user)  <span class="comment"># 登录</span></span><br><span class="line">			request.session[<span class="string">'user'</span>] = username <span class="comment"># 将 session 信息记录到浏览器</span></span><br><span class="line">			<span class="keyword">return</span> HttpResponseRedirect(<span class="string">'/event_manage/'</span>)</span><br><span class="line">		<span class="keyword">else</span>: </span><br><span class="line">			<span class="keyword">return</span> render(request, <span class="string">'index.html'</span>, &#123;<span class="string">'error'</span>: <span class="string">'username or password error!'</span>&#125;)</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		<span class="keyword">return</span> render(request, <span class="string">'index.html'</span>, &#123;<span class="string">'error'</span>: <span class="string">'username or password error!'</span>&#125;)</span><br><span class="line"></span><br><span class="line"><span class="meta">@login_required		</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">event_manage</span><span class="params">(request)</span>:</span></span><br><span class="line">	event_list = Event.objects.all()</span><br><span class="line">	<span class="comment">#username = request.COOKIES.get('user', '', 3600)  # 读取浏览器cookie</span></span><br><span class="line">	username = request.session.get(<span class="string">'user'</span>, <span class="string">''</span>)  <span class="comment"># 读取浏览器 session</span></span><br><span class="line">	<span class="keyword">return</span> render(request, <span class="string">'event_manage.html'</span>, &#123;<span class="string">"user"</span>: username, <span class="string">"events"</span>: event_list&#125;)</span><br><span class="line"></span><br><span class="line"><span class="meta">@login_required</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">search_name</span><span class="params">(request)</span>:</span></span><br><span class="line">	username = request.session.get(<span class="string">'user'</span>, <span class="string">''</span>)</span><br><span class="line">	search_name = request.GET.get(<span class="string">'name'</span>, <span class="string">''</span>)</span><br><span class="line">	event_list = Event.objects.filter(name__contains=search_name)</span><br><span class="line">	<span class="keyword">return</span> render(request, <span class="string">"event_manage.html"</span>, &#123;<span class="string">"user"</span>: username, <span class="string">"events"</span>: event_list&#125;)</span><br><span class="line"></span><br><span class="line"><span class="meta">@login_required	</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">guest_manage</span><span class="params">(request)</span>:</span></span><br><span class="line">	username = request.session.get(<span class="string">'user'</span>, <span class="string">''</span>)</span><br><span class="line">	guest_list = Guest.objects.all()</span><br><span class="line">	paginator = Paginator(guest_list, <span class="number">2</span>)  <span class="comment"># 划分每页显示 2 条数据</span></span><br><span class="line">	page = request.GET.get(<span class="string">'page'</span>)  <span class="comment"># 通过 GET 请求得到当前要显示第几页的数</span></span><br><span class="line">	<span class="keyword">try</span>:</span><br><span class="line">		contacts = paginator.page(page)  <span class="comment"># 获取第 page 页的数据</span></span><br><span class="line">	<span class="keyword">except</span> PageNotAnInteger:  <span class="comment"># 如果当前没有页数，抛 PageNotAnInteger 异常</span></span><br><span class="line">		contacts = paginator.page(<span class="number">1</span>)  <span class="comment"># 返回第一页的数据</span></span><br><span class="line">	<span class="keyword">except</span> EmptyPage:  <span class="comment"># 如果超出最大页数的范围，抛 EmptyPage 异常</span></span><br><span class="line">		contacts = paginator.page(paginator.num_pages)  <span class="comment"># 返回最后一页面的数据</span></span><br><span class="line">	<span class="keyword">return</span> render(request, <span class="string">"guest_manage.html"</span>, &#123;<span class="string">"user"</span>: username, <span class="string">"guests"</span>: contacts&#125;)</span><br><span class="line"></span><br><span class="line"><span class="meta">@login_required</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sign_index</span><span class="params">(request, event_id)</span>:</span></span><br><span class="line">	event = get_object_or_404(Event, id=event_id)</span><br><span class="line">	<span class="keyword">return</span> render(request, <span class="string">'sign_index.html'</span>, &#123;<span class="string">'event'</span>: event&#125;)</span><br><span class="line"></span><br><span class="line"><span class="meta">@login_required</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sign_index_action</span><span class="params">(request, event_id)</span>:</span></span><br><span class="line">	event = get_object_or_404(Event, id=event_id) </span><br><span class="line">	phone = request.POST.get(<span class="string">'phone'</span>,<span class="string">''</span>)</span><br><span class="line">	</span><br><span class="line">	<span class="comment"># 首先，查询 Guest 表判断用户输入的手机号是否存在，如果不存在将提示用户“手机号为空或不存在”</span></span><br><span class="line">	result = Guest.objects.filter(phone = phone) </span><br><span class="line">	<span class="keyword">if</span> <span class="keyword">not</span> result: </span><br><span class="line">		<span class="keyword">return</span> render(request, <span class="string">'sign_index.html'</span>, &#123;<span class="string">'event'</span>: event, <span class="string">'hint'</span>: <span class="string">'phone error.'</span>&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="comment"># 然后，通过手机和发布会 id 两个条件来查询 Guest 表，如果结果为空将提示用户“该用户未参加此次发布会”</span></span><br><span class="line">	result = Guest.objects.filter(phone=phone,event_id=event_id) </span><br><span class="line">	<span class="keyword">if</span> <span class="keyword">not</span> result:</span><br><span class="line">		<span class="keyword">return</span> render(request, <span class="string">'sign_index.html'</span>, &#123;<span class="string">'event'</span>: event, <span class="string">'hint'</span>:<span class="string">'eventidorphoneerror.'</span>&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="comment"># 最后，再通过手机号查询 Guest 表，判断该手机号的签到状态是否为 1，如果为 1，表示已经签过到了， 返回用户“已签到”，否则，将提示用户“签到成功！”，并返回签到用户的信息。</span></span><br><span class="line">	result = Guest.objects.get(phone=phone,event_id=event_id)</span><br><span class="line">	<span class="keyword">if</span> result.sign:</span><br><span class="line">		<span class="keyword">return</span> render(request, <span class="string">'sign_index.html'</span>, &#123;<span class="string">'event'</span>: event, <span class="string">'hint'</span>: <span class="string">"user has sign in."</span>&#125;) </span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		Guest.objects.filter(phone=phone,event_id=event_id).update(sign = <span class="string">'1'</span>) </span><br><span class="line">		<span class="keyword">return</span> render(request, <span class="string">'sign_index.html'</span>, &#123;<span class="string">'event'</span>: event, <span class="string">'hint'</span>:<span class="string">'sign in success!'</span>, <span class="string">'guest'</span>: result&#125;)</span><br><span class="line"></span><br><span class="line"><span class="meta">@login_required</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">logout</span><span class="params">(request)</span>:</span></span><br><span class="line">	auth.logout(request)  <span class="comment"># 退出登录 </span></span><br><span class="line">	response = HttpResponseRedirect(<span class="string">'/index/'</span>) </span><br><span class="line">	<span class="keyword">return</span> response</span><br></pre></td></tr></table></figure></p>
<p>guest/sign/views_if.py<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> JsonResponse</span><br><span class="line"><span class="keyword">from</span> sign.models <span class="keyword">import</span> Event</span><br><span class="line"><span class="keyword">from</span> django.core.exceptions <span class="keyword">import</span> ValidationError, ObjectDoesNotExist</span><br><span class="line"><span class="keyword">from</span> django.db.utils <span class="keyword">import</span> IntegrityError</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加发布会接口</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_event</span><span class="params">(request)</span>:</span></span><br><span class="line">	<span class="comment"># 通过POST请求接收发布会参数</span></span><br><span class="line">	eid = request.POST.get(<span class="string">'eid'</span>,<span class="string">''</span>)                 <span class="comment"># 发布会id</span></span><br><span class="line">	name = request.POST.get(<span class="string">'name'</span>,<span class="string">''</span>)               <span class="comment"># 发布会标题</span></span><br><span class="line">	limit = request.POST.get(<span class="string">'limit'</span>,<span class="string">''</span>)             <span class="comment"># 限制人数</span></span><br><span class="line">	status = request.POST.get(<span class="string">'status'</span>,<span class="string">''</span>)           <span class="comment"># 状态</span></span><br><span class="line">	address = request.POST.get(<span class="string">'address'</span>,<span class="string">''</span>)         <span class="comment"># 地址</span></span><br><span class="line">	start_time = request.POST.get(<span class="string">'start_time'</span>,<span class="string">''</span>)   <span class="comment"># 发布会时间</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment"># 首先，判断 eid、 name、limit、address、start_time 等字段均不能为空</span></span><br><span class="line">	<span class="keyword">if</span> eid ==<span class="string">''</span> <span class="keyword">or</span> name == <span class="string">''</span> <span class="keyword">or</span> limit == <span class="string">''</span> <span class="keyword">or</span> address == <span class="string">''</span> <span class="keyword">or</span> start_time == <span class="string">''</span>:</span><br><span class="line">		<span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10021</span>,<span class="string">'message'</span>:<span class="string">'parameter error'</span>&#125;)</span><br><span class="line">	</span><br><span class="line">	<span class="comment"># 接下来，判断发布会 id 是否存在</span></span><br><span class="line">	result =Event.objects.filter(id=eid)</span><br><span class="line">	<span class="keyword">if</span> result:</span><br><span class="line">		<span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10022</span>,<span class="string">'message'</span>:<span class="string">'event id already exists'</span>&#125;)</span><br><span class="line">	</span><br><span class="line">	<span class="comment"># 接下来，判断发布会名称 name 是否存在</span></span><br><span class="line">	result = Event.objects.filter(name=name)</span><br><span class="line">	<span class="keyword">if</span> result:</span><br><span class="line">		<span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10023</span>, <span class="string">'message'</span>:<span class="string">'event name already exists'</span>&#125;)</span><br><span class="line">	</span><br><span class="line">	<span class="comment"># 再接下来，判断发布会状态是否为空，如果为空，将状态设置为 1（True）。</span></span><br><span class="line">	<span class="keyword">if</span> status == <span class="string">''</span>:</span><br><span class="line">		status = <span class="number">1</span></span><br><span class="line">		</span><br><span class="line">	<span class="comment"># 最后，将数据插入到 Event 表，在插入的过程中如果日期格式错误，将抛出 ValidationError 异常</span></span><br><span class="line">	<span class="keyword">try</span>:</span><br><span class="line">		Event.objects.create(id=eid,name=name,limit=limit,address=address,status=int(status),start_time=start_time)</span><br><span class="line">	<span class="keyword">except</span> ValidationError:</span><br><span class="line">		error = <span class="string">'start_time format error. It must be in YYYY-MM-DD HH:MM:SS format.'</span></span><br><span class="line">		<span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10024</span>,<span class="string">'message'</span>:error&#125;)</span><br><span class="line">	<span class="comment"># 否则，插入成功，返回状态码 200 和“addeventsuccess”的提示。</span></span><br><span class="line">	<span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">200</span>,<span class="string">'message'</span>:<span class="string">'add event success'</span>&#125;)</span><br><span class="line">		</span><br><span class="line">		</span><br><span class="line"><span class="comment"># 发布会查询</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_event_list</span><span class="params">(request)</span>:</span></span><br><span class="line">	<span class="comment"># 通过GET请求接收发布会id和name参数。两个参数都是可选的</span></span><br><span class="line">	eid = request.GET.get(<span class="string">"eid"</span>, <span class="string">""</span>)      <span class="comment"># 发布会id</span></span><br><span class="line">	name = request.GET.get(<span class="string">"name"</span>, <span class="string">""</span>)    <span class="comment"># 发布会名称</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment"># 首先，判断当两个参数同时为空，接 口返回状态码 10021，参数错误。</span></span><br><span class="line">	<span class="keyword">if</span> eid == <span class="string">''</span> <span class="keyword">and</span> name == <span class="string">''</span>:</span><br><span class="line">		<span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10021</span>,<span class="string">'message'</span>:<span class="string">'parameter error'</span>&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="comment"># 如果发布会 id 不为空，优先通过 id 查询，因为 id 的唯一性，所以，查询结果只会有一条</span></span><br><span class="line">	<span class="keyword">if</span> eid != <span class="string">''</span>:</span><br><span class="line">		event = &#123;&#125;</span><br><span class="line">		<span class="keyword">try</span>:</span><br><span class="line">			result = Event.objects.get(id=eid)</span><br><span class="line">		<span class="keyword">except</span> ObjectDoesNotExist:</span><br><span class="line">			<span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10022</span>, <span class="string">'message'</span>:<span class="string">'query result is empty'</span>&#125;)</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			event[<span class="string">'eid'</span>] = result.id</span><br><span class="line">			event[<span class="string">'name'</span>] = result.name</span><br><span class="line">			event[<span class="string">'limit'</span>] = result.limit</span><br><span class="line">			event[<span class="string">'status'</span>] = result.status</span><br><span class="line">			event[<span class="string">'address'</span>] = result.address</span><br><span class="line">			event[<span class="string">'start_time'</span>] = result.start_time</span><br><span class="line">			<span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">200</span>, <span class="string">'message'</span>:<span class="string">'success'</span>, <span class="string">'data'</span>:event&#125;)</span><br><span class="line">	</span><br><span class="line">	<span class="comment"># name 查询为模糊查询，查询数据可能会有多条</span></span><br><span class="line">	<span class="keyword">if</span> name != <span class="string">''</span>:</span><br><span class="line">		datas = []</span><br><span class="line">		results = Event.objects.filter(name__contains=name)</span><br><span class="line">		<span class="keyword">if</span> results:</span><br><span class="line">			<span class="keyword">for</span> r <span class="keyword">in</span> results:</span><br><span class="line">				event = &#123;&#125;</span><br><span class="line">				event[<span class="string">'eid'</span>] = r.id</span><br><span class="line">				event[<span class="string">'name'</span>] = r.name</span><br><span class="line">				event[<span class="string">'limit'</span>] = r.limit</span><br><span class="line">				event[<span class="string">'status'</span>] = r.status</span><br><span class="line">				event[<span class="string">'address'</span>] = r.address</span><br><span class="line">				event[<span class="string">'start_time'</span>] = r.start_time</span><br><span class="line">				datas.append(event)</span><br><span class="line">			<span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">200</span>, <span class="string">'message'</span>:<span class="string">'success'</span>, <span class="string">'data'</span>:datas&#125;)</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			<span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10022</span>, <span class="string">'message'</span>:<span class="string">'query result is empty'</span>&#125;)		</span><br><span class="line"></span><br><span class="line">			</span><br><span class="line"><span class="comment"># 添加嘉宾接口</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_guest</span><span class="params">(request)</span>:</span></span><br><span class="line">	<span class="comment"># 通过POST请求接收嘉宾参数</span></span><br><span class="line">	eid =  request.POST.get(<span class="string">'eid'</span>,<span class="string">''</span>)                <span class="comment"># 关联发布会id</span></span><br><span class="line">	realname = request.POST.get(<span class="string">'realname'</span>,<span class="string">''</span>)       <span class="comment"># 姓名</span></span><br><span class="line">	phone = request.POST.get(<span class="string">'phone'</span>,<span class="string">''</span>)             <span class="comment"># 手机号</span></span><br><span class="line">	email = request.POST.get(<span class="string">'email'</span>,<span class="string">''</span>)             <span class="comment"># 邮箱</span></span><br><span class="line"></span><br><span class="line">	<span class="comment"># 首先，判断 eid、realname、phone 等参数均不能为空</span></span><br><span class="line">	<span class="keyword">if</span> eid ==<span class="string">''</span> <span class="keyword">or</span> realname == <span class="string">''</span> <span class="keyword">or</span> phone == <span class="string">''</span>:</span><br><span class="line">		<span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10021</span>,<span class="string">'message'</span>:<span class="string">'parameter error'</span>&#125;)</span><br><span class="line">	</span><br><span class="line">	<span class="comment"># 接下来，判断嘉宾关联的发布会 id 是否存在</span></span><br><span class="line">	result = Event.objects.filter(id=eid)</span><br><span class="line">	<span class="keyword">if</span> <span class="keyword">not</span> result:</span><br><span class="line">		<span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10022</span>,<span class="string">'message'</span>:<span class="string">'event id null'</span>&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="comment"># 接下来，判断及关联的发布会状态是否为 True（即 1）</span></span><br><span class="line">	result = Event.objects.get(id=eid).status</span><br><span class="line">	<span class="keyword">if</span> <span class="keyword">not</span> result:</span><br><span class="line">		<span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10023</span>,<span class="string">'message'</span>:<span class="string">'event status is not available'</span>&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="comment"># 接下来，判断发布会人数限制</span></span><br><span class="line">	event_limit = Event.objects.get(id=eid).limit        <span class="comment"># 发布会限制人数</span></span><br><span class="line">	guest_limit = Guest.objects.filter(event_id=eid)     <span class="comment"># 发布会已添加的嘉宾数</span></span><br><span class="line">	<span class="keyword">if</span> len(guest_limit) &gt;= event_limit:</span><br><span class="line">		<span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10024</span>,<span class="string">'message'</span>:<span class="string">'event number is full'</span>&#125;)</span><br><span class="line">	</span><br><span class="line">	<span class="comment"># 再接下来的步骤是判断当前时间是否大于发布会时间，如果大于则说明发布已开始，或者早已经结束。</span></span><br><span class="line">	event_time = Event.objects.get(id=eid).start_time     <span class="comment"># 发布会时间</span></span><br><span class="line">	timeArray = time.strptime(str(event_time), <span class="string">"%Y-%m-%d %H:%M:%S"</span>)</span><br><span class="line">	e_time = int(time.mktime(timeArray))</span><br><span class="line">	now_time = str(time.time())          <span class="comment"># 当前时间</span></span><br><span class="line">	ntime = now_time.split(<span class="string">"."</span>)[<span class="number">0</span>]</span><br><span class="line">	n_time = int(ntime)</span><br><span class="line">	<span class="keyword">if</span> n_time &gt;= e_time:</span><br><span class="line">		<span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10025</span>,<span class="string">'message'</span>:<span class="string">'event has started'</span>&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="comment"># 最后，插入嘉宾数据，如果发布会的手机号重复则抛 IntegrityError 异常，接收该异常并返回相应的状态 码和提示信息</span></span><br><span class="line">	<span class="keyword">try</span>:</span><br><span class="line">		Guest.objects.create(realname=realname,phone=int(phone),email=email,sign=<span class="number">0</span>,event_id=int(eid))</span><br><span class="line">	<span class="keyword">except</span> IntegrityError:</span><br><span class="line">		<span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10026</span>,<span class="string">'message'</span>:<span class="string">'the event guest phone number repeat'</span>&#125;)</span><br><span class="line">	<span class="comment"># 如果添加成功，则返回状态码 200 和“addguestsuccess”的提示</span></span><br><span class="line">	<span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">200</span>,<span class="string">'message'</span>:<span class="string">'add guest success'</span>&#125;)</span><br><span class="line">		</span><br><span class="line"></span><br><span class="line"><span class="comment"># 嘉宾查询接口</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_guest_list</span><span class="params">(request)</span>:</span></span><br><span class="line">	eid = request.GET.get(<span class="string">"eid"</span>, <span class="string">""</span>)       <span class="comment"># 关联发布会id</span></span><br><span class="line">	phone = request.GET.get(<span class="string">"phone"</span>, <span class="string">""</span>)   <span class="comment"># 嘉宾手机号</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> eid == <span class="string">''</span>:</span><br><span class="line">		<span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10021</span>,<span class="string">'message'</span>:<span class="string">'eid cannot be empty'</span>&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> eid != <span class="string">''</span> <span class="keyword">and</span> phone == <span class="string">''</span>:</span><br><span class="line">		datas = []</span><br><span class="line">		results = Guest.objects.filter(event_id=eid)</span><br><span class="line">		<span class="keyword">if</span> results:</span><br><span class="line">			<span class="keyword">for</span> r <span class="keyword">in</span> results:</span><br><span class="line">				guest = &#123;&#125;</span><br><span class="line">				guest[<span class="string">'realname'</span>] = r.realname</span><br><span class="line">				guest[<span class="string">'phone'</span>] = r.phone</span><br><span class="line">				guest[<span class="string">'email'</span>] = r.email</span><br><span class="line">				guest[<span class="string">'sign'</span>] = r.sign</span><br><span class="line">				datas.append(guest)</span><br><span class="line">			<span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">200</span>, <span class="string">'message'</span>:<span class="string">'success'</span>, <span class="string">'data'</span>:datas&#125;)</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			<span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10022</span>, <span class="string">'message'</span>:<span class="string">'query result is empty'</span>&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> eid != <span class="string">''</span> <span class="keyword">and</span> phone != <span class="string">''</span>:</span><br><span class="line">		guest = &#123;&#125;</span><br><span class="line">		<span class="keyword">try</span>:</span><br><span class="line">			result = Guest.objects.get(phone=phone,event_id=eid)</span><br><span class="line">		<span class="keyword">except</span> ObjectDoesNotExist:</span><br><span class="line">			<span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10022</span>, <span class="string">'message'</span>:<span class="string">'query result is empty'</span>&#125;)</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			guest[<span class="string">'realname'</span>] = result.realname</span><br><span class="line">			guest[<span class="string">'phone'</span>] = result.phone</span><br><span class="line">			guest[<span class="string">'email'</span>] = result.email</span><br><span class="line">			guest[<span class="string">'sign'</span>] = result.sign</span><br><span class="line">			<span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">200</span>, <span class="string">'message'</span>:<span class="string">'success'</span>, <span class="string">'data'</span>:guest&#125;)		</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 用户签到接口</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">user_sign</span><span class="params">(request)</span>:</span></span><br><span class="line">	<span class="comment"># 签到接口通过POST请求接收发布会id和嘉宾手机号</span></span><br><span class="line">	eid =  request.POST.get(<span class="string">'eid'</span>,<span class="string">''</span>)       <span class="comment"># 发布会id</span></span><br><span class="line">	phone =  request.POST.get(<span class="string">'phone'</span>,<span class="string">''</span>)   <span class="comment"># 嘉宾手机号</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment"># 首先，判断两个参数均不能为空</span></span><br><span class="line">	<span class="keyword">if</span> eid ==<span class="string">''</span> <span class="keyword">or</span> phone == <span class="string">''</span>:</span><br><span class="line">		<span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10021</span>,<span class="string">'message'</span>:<span class="string">'parameter error'</span>&#125;)</span><br><span class="line">		</span><br><span class="line">	<span class="comment"># 接着，判断发布会 id 是否存在</span></span><br><span class="line">	result = Event.objects.filter(id=eid)</span><br><span class="line">	<span class="keyword">if</span> <span class="keyword">not</span> result:</span><br><span class="line">		<span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10022</span>,<span class="string">'message'</span>:<span class="string">'event id null'</span>&#125;)</span><br><span class="line">	</span><br><span class="line">	<span class="comment"># 接着，判断发布会状态是否为 True</span></span><br><span class="line">	result = Event.objects.get(id=eid).status</span><br><span class="line">	<span class="keyword">if</span> <span class="keyword">not</span> result:</span><br><span class="line">		<span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10023</span>,<span class="string">'message'</span>:<span class="string">'event status is not available'</span>&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="comment"># 再接着，判断当前时间是否大于发布会时间，如果大于发布会时间说明发布会已开始，不允许签到</span></span><br><span class="line">	event_time = Event.objects.get(id=eid).start_time  <span class="comment"># 发布会时间</span></span><br><span class="line">	timeArray = time.strptime(str(event_time), <span class="string">"%Y-%m-%d %H:%M:%S"</span>)</span><br><span class="line">	e_time = int(time.mktime(timeArray))</span><br><span class="line">	now_time = str(time.time())  <span class="comment"># 当前时间</span></span><br><span class="line">	ntime = now_time.split(<span class="string">"."</span>)[<span class="number">0</span>]</span><br><span class="line">	n_time = int(ntime)</span><br><span class="line">	<span class="keyword">if</span> n_time &gt;= e_time:</span><br><span class="line">		<span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10024</span>,<span class="string">'message'</span>:<span class="string">'event has started'</span>&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="comment"># 然后，再判断嘉宾的手机号是否存在</span></span><br><span class="line">	result = Guest.objects.filter(phone=phone)</span><br><span class="line">	<span class="keyword">if</span> <span class="keyword">not</span> result:</span><br><span class="line">		<span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10025</span>,<span class="string">'message'</span>:<span class="string">'user phone null'</span>&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="comment"># 然后，再判断嘉宾的手机号与发布会 id 是否为对应关系</span></span><br><span class="line">	result = Guest.objects.filter(phone=phone,event_id=eid)</span><br><span class="line">	<span class="keyword">if</span> <span class="keyword">not</span> result:</span><br><span class="line">		<span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10026</span>,<span class="string">'message'</span>:<span class="string">'user did not participate in the conference'</span>&#125;)</span><br><span class="line">	</span><br><span class="line">	<span class="comment"># 最后，判断该嘉宾的状态是否为已签到，如果已签到，返回相应的状态码和提示</span></span><br><span class="line">	result = Guest.objects.get(event_id=eid,phone=phone).sign</span><br><span class="line">	<span class="keyword">if</span> result:</span><br><span class="line">		<span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10027</span>,<span class="string">'message'</span>:<span class="string">'user has sign in'</span>&#125;)</span><br><span class="line">	<span class="comment"># 如果未签到修改状态 为已签到，并返回状态码 200 和“signsuccess”的提示。</span></span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		Guest.objects.filter(phone=phone).update(sign=<span class="string">'1'</span>)</span><br><span class="line">		<span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">200</span>,<span class="string">'message'</span>:<span class="string">'sign success'</span>&#125;)</span><br></pre></td></tr></table></figure></p>
<p>guest/sign/views_if_sec.py<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> JsonResponse</span><br><span class="line"><span class="keyword">from</span> sign.models <span class="keyword">import</span> Event, Guest</span><br><span class="line"><span class="keyword">from</span> django.core.exceptions <span class="keyword">import</span> ObjectDoesNotExist, ValidationError</span><br><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> auth <span class="keyword">as</span> django_auth</span><br><span class="line"><span class="keyword">import</span> base64, time</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> django.http <span class="keyword">import</span> HttpResponse</span><br><span class="line"><span class="comment">#from Crypto.Cipher import AES    # 请安装 Crypto</span></span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 用户认证</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">user_auth</span><span class="params">(request)</span>:</span></span><br><span class="line">	<span class="comment"># request.META 包含了所有本次 HTTP 请求的 Header 信息;HTTP_AUTHORIZATION 用于获取 HTTPauthorization;</span></span><br><span class="line">	<span class="comment"># 得到的数据是这样的：Basic YWRtaW46YWRtaW4xMjM0NTY=</span></span><br><span class="line">	get_http_auth = request.META.get(<span class="string">'HTTP_AUTHORIZATION'</span>,<span class="string">'b'</span>)</span><br><span class="line">	</span><br><span class="line">	<span class="comment"># split()方法拆分成 list,拆分后的数据是这样的：['Basic','YWRtaW46YWRtaW4xMjM0NTY=']</span></span><br><span class="line">	auth = get_http_auth.split()</span><br><span class="line">	</span><br><span class="line">	<span class="comment"># 取出 list 中的加密串，通过 base64 对加密串进行解码。得到的数据是：('admin',':','admin123456')</span></span><br><span class="line">	<span class="keyword">try</span>:</span><br><span class="line">		auth_parts = base64.b64decode(auth[<span class="number">1</span>]).decode(<span class="string">'utf-8'</span>).partition(<span class="string">':'</span>)</span><br><span class="line">	<span class="comment"># 如果获取不到 Auth 信息，将会抛 IndexError 异常</span></span><br><span class="line">	<span class="keyword">except</span> IndexError:</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"null"</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment"># 取出元组中对应的用户 id 和密码。最终于数据： admin admin123456	</span></span><br><span class="line">	userid, password = auth_parts[<span class="number">0</span>], auth_parts[<span class="number">2</span>]</span><br><span class="line">	<span class="comment"># 调用 Django 的认证模块，对得到 Auth 信息进行认证。成功将返回 “success”，失败则返回“fail”</span></span><br><span class="line">	user = django_auth.authenticate(username=userid, password=password)</span><br><span class="line">	<span class="keyword">if</span> user <span class="keyword">is</span> <span class="keyword">not</span> <span class="keyword">None</span> <span class="keyword">and</span> user.is_active:</span><br><span class="line">		django_auth.login(request, user)</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"success"</span></span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"fail"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 发布会查询接口---增加用户认证</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_event_list</span><span class="params">(request)</span>:</span></span><br><span class="line">	auth_result = user_auth(request)  <span class="comment"># 调用认证函数</span></span><br><span class="line">	<span class="keyword">if</span> auth_result == <span class="string">"null"</span>:</span><br><span class="line">		<span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10011</span>,<span class="string">'message'</span>:<span class="string">'user auth null'</span>&#125;)</span><br><span class="line">	<span class="keyword">if</span> auth_result == <span class="string">'fail'</span>:</span><br><span class="line">		<span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10012</span>,<span class="string">'message'</span>:<span class="string">'user auth fail'</span>&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="comment"># 通过GET请求接收发布会id和name参数。两个参数都是可选的</span></span><br><span class="line">	eid = request.GET.get(<span class="string">"eid"</span>, <span class="string">""</span>)  <span class="comment"># 发布会id</span></span><br><span class="line">	name = request.GET.get(<span class="string">"name"</span>, <span class="string">""</span>)  <span class="comment"># 发布会名称</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment"># 首先，判断当两个参数同时为空，接 口返回状态码 10021，参数错误。</span></span><br><span class="line">	<span class="keyword">if</span> eid == <span class="string">''</span> <span class="keyword">and</span> name == <span class="string">''</span>:</span><br><span class="line">		<span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10021</span>,<span class="string">'message'</span>:<span class="string">'parameter error'</span>&#125;)</span><br><span class="line"></span><br><span class="line">	<span class="comment"># 如果发布会 id 不为空，优先通过 id 查询，因为 id 的唯一性，所以，查询结果只会有一条</span></span><br><span class="line">	<span class="keyword">if</span> eid != <span class="string">''</span>:</span><br><span class="line">		event = &#123;&#125;</span><br><span class="line">		<span class="keyword">try</span>:</span><br><span class="line">			result = Event.objects.get(id=eid)</span><br><span class="line">		<span class="keyword">except</span> ObjectDoesNotExist:</span><br><span class="line">			<span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10022</span>, <span class="string">'message'</span>:<span class="string">'query result is empty'</span>&#125;)</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			event[<span class="string">'eid'</span>] = result.id</span><br><span class="line">			event[<span class="string">'name'</span>] = result.name</span><br><span class="line">			event[<span class="string">'limit'</span>] = result.limit</span><br><span class="line">			event[<span class="string">'status'</span>] = result.status</span><br><span class="line">			event[<span class="string">'address'</span>] = result.address</span><br><span class="line">			event[<span class="string">'start_time'</span>] = result.start_time</span><br><span class="line">			<span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">200</span>, <span class="string">'message'</span>:<span class="string">'success'</span>, <span class="string">'data'</span>:event&#125;)</span><br><span class="line">	</span><br><span class="line">	<span class="comment"># name 查询为模糊查询，查询数据可能会有多条</span></span><br><span class="line">	<span class="keyword">if</span> name != <span class="string">''</span>:</span><br><span class="line">		datas = []</span><br><span class="line">		results = Event.objects.filter(name__contains=name)</span><br><span class="line">		<span class="keyword">if</span> results:</span><br><span class="line">			<span class="keyword">for</span> r <span class="keyword">in</span> results:</span><br><span class="line">				event = &#123;&#125;</span><br><span class="line">				event[<span class="string">'eid'</span>] = r.id</span><br><span class="line">				event[<span class="string">'name'</span>] = r.name</span><br><span class="line">				event[<span class="string">'limit'</span>] = r.limit</span><br><span class="line">				event[<span class="string">'status'</span>] = r.status</span><br><span class="line">				event[<span class="string">'address'</span>] = r.address</span><br><span class="line">				event[<span class="string">'start_time'</span>] = r.start_time</span><br><span class="line">				datas.append(event)</span><br><span class="line">			<span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">200</span>, <span class="string">'message'</span>:<span class="string">'success'</span>, <span class="string">'data'</span>:datas&#125;)</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			<span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10022</span>, <span class="string">'message'</span>:<span class="string">'query result is empty'</span>&#125;)		</span><br><span class="line"></span><br><span class="line"><span class="comment"># 用户签名+时间戳</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">user_sign</span><span class="params">(request)</span>:</span></span><br><span class="line">	<span class="comment"># 通过 POST 方法获取两个参数 time 和 sign 两个参数</span></span><br><span class="line">	<span class="keyword">if</span> request.method == <span class="string">"post"</span>:</span><br><span class="line">		client_time = request.POST.get(<span class="string">'time'</span>, <span class="string">''</span>)  <span class="comment"># 客户端时间戳</span></span><br><span class="line">		client_sign= request.POST.get(<span class="string">'sign'</span>, <span class="string">''</span>)  <span class="comment"># 客户端签名</span></span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"error"</span>	</span><br><span class="line">	<span class="keyword">if</span> client_time == <span class="string">''</span> <span class="keyword">or</span> client_sign == <span class="string">''</span>:</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"sign null"</span></span><br><span class="line">		</span><br><span class="line">	<span class="comment"># 服务器时间</span></span><br><span class="line">	now_time = time.time()  <span class="comment"># 例：1466426831.9126902</span></span><br><span class="line">	<span class="comment"># Python3 生成的的时间戳精度太高，我们只需要小数点前面的 10 位即可</span></span><br><span class="line">	server_time = str(now_time).split(<span class="string">'.'</span>)[<span class="number">0</span>]</span><br><span class="line">	</span><br><span class="line">	<span class="comment"># 获取时间差</span></span><br><span class="line">	time_difference = int(server_time) - int(client_time)</span><br><span class="line">	<span class="comment"># 接口的请求时间是离现在超过 60 秒,返回请求超时</span></span><br><span class="line">	<span class="keyword">if</span> time_difference &gt;= <span class="number">60</span>:</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"timeout"</span></span><br><span class="line">		</span><br><span class="line">	<span class="comment"># 签名检查</span></span><br><span class="line">	md5 = hashlib.md5()</span><br><span class="line">	<span class="comment"># 签名参数的生成：密钥字符串(“&amp;Guest-Bugmaster”)和客户端发来的时间戳， 两者拼接成一个新的字符串</span></span><br><span class="line">	sign_str = client_time + <span class="string">"&amp;Guest-Bugmaster"</span></span><br><span class="line">	sing_bytes_utf8 = sign_str.encode(encoding=<span class="string">"utf-8"</span>)</span><br><span class="line">	<span class="comment"># 通过 MD5 对其进行加密。从而将加密后的字符串作为 sign 的字段的参数</span></span><br><span class="line">	md5.update(sing_bytes_utf8)</span><br><span class="line">	server_sign = md5.hexdigest</span><br><span class="line">	<span class="comment"># 两端使用相同的规则生成的加密后的字符串，进行比较</span></span><br><span class="line">	<span class="keyword">if</span> server_sign != client_sign:</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"sign fail"</span></span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		<span class="keyword">return</span> <span class="string">"sign right"</span></span><br><span class="line">			</span><br><span class="line"></span><br><span class="line"><span class="comment"># 添加发布会接口---增加签名+时间戳</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_event</span><span class="params">(request)</span>:</span></span><br><span class="line">	sign_result = user_sign(request)  <span class="comment"># 调用签名函数</span></span><br><span class="line">	<span class="keyword">if</span> sign_result == <span class="string">"error"</span>:</span><br><span class="line">		<span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10011</span>,<span class="string">'message'</span>:<span class="string">'request error'</span>&#125;)</span><br><span class="line">	<span class="keyword">elif</span> sign_result == <span class="string">"sign null"</span>:</span><br><span class="line">		<span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10012</span>,<span class="string">'message'</span>:<span class="string">'user sign null'</span>&#125;)</span><br><span class="line">	<span class="keyword">elif</span> sign_result == <span class="string">"timeout"</span>:</span><br><span class="line">		<span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10013</span>,<span class="string">'message'</span>:<span class="string">'user sign timeout'</span>&#125;)</span><br><span class="line">	<span class="keyword">elif</span> sign_result == <span class="string">"sign fail"</span>:</span><br><span class="line">		<span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10014</span>,<span class="string">'message'</span>:<span class="string">'user sign error'</span>&#125;)	</span><br><span class="line">			</span><br><span class="line">	<span class="comment"># 通过POST请求接收发布会参数</span></span><br><span class="line">	eid = request.POST.get(<span class="string">'eid'</span>,<span class="string">''</span>)                 <span class="comment"># 发布会id</span></span><br><span class="line">	name = request.POST.get(<span class="string">'name'</span>,<span class="string">''</span>)               <span class="comment"># 发布会标题</span></span><br><span class="line">	limit = request.POST.get(<span class="string">'limit'</span>,<span class="string">''</span>)             <span class="comment"># 限制人数</span></span><br><span class="line">	status = request.POST.get(<span class="string">'status'</span>,<span class="string">''</span>)           <span class="comment"># 状态</span></span><br><span class="line">	address = request.POST.get(<span class="string">'address'</span>,<span class="string">''</span>)         <span class="comment"># 地址</span></span><br><span class="line">	start_time = request.POST.get(<span class="string">'start_time'</span>,<span class="string">''</span>)   <span class="comment"># 发布会时间</span></span><br><span class="line">	</span><br><span class="line">	<span class="comment"># 首先，判断 eid、 name、limit、address、start_time 等字段均不能为空</span></span><br><span class="line">	<span class="keyword">if</span> eid ==<span class="string">''</span> <span class="keyword">or</span> name == <span class="string">''</span> <span class="keyword">or</span> limit == <span class="string">''</span> <span class="keyword">or</span> address == <span class="string">''</span> <span class="keyword">or</span> start_time == <span class="string">''</span>:</span><br><span class="line">		<span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10021</span>,<span class="string">'message'</span>:<span class="string">'parameter error'</span>&#125;)</span><br><span class="line">	</span><br><span class="line">	<span class="comment"># 接下来，判断发布会 id 是否存在</span></span><br><span class="line">	result =Event.objects.filter(id=eid)</span><br><span class="line">	<span class="keyword">if</span> result:</span><br><span class="line">		<span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10022</span>,<span class="string">'message'</span>:<span class="string">'event id already exists'</span>&#125;)</span><br><span class="line">	</span><br><span class="line">	<span class="comment"># 接下来，判断发布会名称 name 是否存在</span></span><br><span class="line">	result = Event.objects.filter(name=name)</span><br><span class="line">	<span class="keyword">if</span> result:</span><br><span class="line">		<span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10023</span>, <span class="string">'message'</span>:<span class="string">'event name already exists'</span>&#125;)</span><br><span class="line">	</span><br><span class="line">	<span class="comment"># 再接下来，判断发布会状态是否为空，如果为空，将状态设置为 1（True）。</span></span><br><span class="line">	<span class="keyword">if</span> status == <span class="string">''</span>:</span><br><span class="line">		status = <span class="number">1</span></span><br><span class="line">		</span><br><span class="line">	<span class="comment"># 最后，将数据插入到 Event 表，在插入的过程中如果日期格式错误，将抛出 ValidationError 异常</span></span><br><span class="line">	<span class="keyword">try</span>:</span><br><span class="line">		Event.objects.create(id=eid,name=name,limit=limit,address=address,status=int(status),start_time=start_time)</span><br><span class="line">	<span class="keyword">except</span> ValidationError:</span><br><span class="line">		error = <span class="string">'start_time format error. It must be in YYYY-MM-DD HH:MM:SS format.'</span></span><br><span class="line">		<span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10024</span>,<span class="string">'message'</span>:error&#125;)</span><br><span class="line">	<span class="comment"># 否则，插入成功，返回状态码 200 和“addeventsuccess”的提示。</span></span><br><span class="line">	<span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">200</span>,<span class="string">'message'</span>:<span class="string">'add event success'</span>&#125;)</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line"><span class="comment"># AES加密算法			</span></span><br><span class="line">BS = <span class="number">16</span></span><br><span class="line"><span class="comment"># 通过 upad 匿名函数对字符串的长度还原</span></span><br><span class="line">unpad = <span class="keyword">lambda</span> s : s[<span class="number">0</span>: - ord(s[<span class="number">-1</span>])]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decryptBase64</span><span class="params">(src)</span>:</span></span><br><span class="line">	<span class="string">"""</span></span><br><span class="line"><span class="string">	对 Base64 字符串解密</span></span><br><span class="line"><span class="string">	"""</span></span><br><span class="line">	<span class="keyword">return</span> base64.urlsafe_b64decode(src)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decryptAES</span><span class="params">(src, key)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    解析AES密文</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">	<span class="comment"># 调用 decryptBase64()方法，将 Base64 加密字符串解密为 AES 加密字符串。</span></span><br><span class="line">    src = decryptBase64(src)</span><br><span class="line">    iv = <span class="string">b"1172311105789011"</span></span><br><span class="line">	<span class="comment"># 通过 decrypt() 对 AES 加密串进行解密。</span></span><br><span class="line">    cryptor = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line">    text = cryptor.decrypt(src).decode()</span><br><span class="line">    <span class="keyword">return</span> unpad(text)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">aes_encryption</span><span class="params">(request)</span>:</span></span><br><span class="line">	<span class="comment"># 服务器端与合法客户端约定的密钥 app_key。</span></span><br><span class="line">    app_key = <span class="string">'W7v4D60fds2Cmk2U'</span></span><br><span class="line"></span><br><span class="line">	<span class="comment"># 判断客户端请求是否为 POST，通过 POST.get()方法接收 data 参数</span></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'POST'</span>:</span><br><span class="line">        data = request.POST.get(<span class="string">"data"</span>, <span class="string">""</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"error"</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 解密，调用解密函数 decryptAES() ，传参加密字符串和 app_key</span></span><br><span class="line">    decode = decryptAES(data, app_key)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 转化为字典，将解密后字符串通过 json.loads()方法转化成字典，并将该字典做为 aes_encryption()函数的返回值</span></span><br><span class="line">    dict_data = json.loads(decode)</span><br><span class="line">    <span class="keyword">return</span> dict_data</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 嘉宾查询接口----AES算法</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_guest_list</span><span class="params">(request)</span>:</span></span><br><span class="line">    dict_data = aes_encryption(request)  <span class="comment"># 调用加密字符串解密函数</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> dict_data == <span class="string">"error"</span>:</span><br><span class="line">        <span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10011</span>,<span class="string">'message'</span>:<span class="string">'request error'</span>&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 取出对应的发布会id和嘉宾手机号</span></span><br><span class="line">    eid = dict_data[<span class="string">'eid'</span>]</span><br><span class="line">    phone = dict_data[<span class="string">'phone'</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> eid == <span class="string">''</span>:</span><br><span class="line">        <span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10021</span>,<span class="string">'message'</span>:<span class="string">'eid cannot be empty'</span>&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> eid != <span class="string">''</span> <span class="keyword">and</span> phone == <span class="string">''</span>:</span><br><span class="line">        datas = []</span><br><span class="line">        results = Guest.objects.filter(event_id=eid)</span><br><span class="line">        <span class="keyword">if</span> results:</span><br><span class="line">            <span class="keyword">for</span> r <span class="keyword">in</span> results:</span><br><span class="line">                guest = &#123;&#125;</span><br><span class="line">                guest[<span class="string">'realname'</span>] = r.realname</span><br><span class="line">                guest[<span class="string">'phone'</span>] = r.phone</span><br><span class="line">                guest[<span class="string">'email'</span>] = r.email</span><br><span class="line">                guest[<span class="string">'sign'</span>] = r.sign</span><br><span class="line">                datas.append(guest)</span><br><span class="line">            <span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">200</span>, <span class="string">'message'</span>:<span class="string">'success'</span>, <span class="string">'data'</span>:datas&#125;)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10022</span>, <span class="string">'message'</span>:<span class="string">'query result is empty'</span>&#125;)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> eid != <span class="string">''</span> <span class="keyword">and</span> phone != <span class="string">''</span>:</span><br><span class="line">        guest = &#123;&#125;</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            result = Guest.objects.get(phone=phone,event_id=eid)</span><br><span class="line">        <span class="keyword">except</span> ObjectDoesNotExist:</span><br><span class="line">            <span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">10022</span>, <span class="string">'message'</span>:<span class="string">'query result is empty'</span>&#125;)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            guest[<span class="string">'realname'</span>] = result.realname</span><br><span class="line">            guest[<span class="string">'phone'</span>] = result.phone</span><br><span class="line">            guest[<span class="string">'email'</span>] = result.email</span><br><span class="line">            guest[<span class="string">'sign'</span>] = result.sign</span><br><span class="line">            <span class="keyword">return</span> JsonResponse(&#123;<span class="string">'status'</span>:<span class="number">200</span>, <span class="string">'message'</span>:<span class="string">'success'</span>, <span class="string">'data'</span>:guest&#125;)</span><br></pre></td></tr></table></figure></p>
<p>guest/sign/templates/index.html<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span> </span><br><span class="line">		<span class="tag">&lt;<span class="name">title</span>&gt;</span>Django Page<span class="tag">&lt;/<span class="name">title</span>&gt;</span> </span><br><span class="line">	<span class="tag">&lt;/<span class="name">head</span>&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">body</span>&gt;</span> </span><br><span class="line">		<span class="tag">&lt;<span class="name">h1</span>&gt;</span>发布会管理<span class="tag">&lt;/<span class="name">h1</span>&gt;</span> </span><br><span class="line">		<span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">action</span>=<span class="string">"/login_action/"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">placeholder</span>=<span class="string">"username"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">type</span>=<span class="string">"password"</span> <span class="attr">placeholder</span>=<span class="string">"password"</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">		&#123;&#123; error &#125;&#125;<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">"btn"</span> <span class="attr">type</span>=<span class="string">"submit"</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">		&#123;% csrf_token %&#125;</span><br><span class="line">		<span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span> </span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>guest/sign/templates/event_manage.html<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"zh-CN"</span>&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span> </span><br><span class="line">		&#123;% load bootstrap3 %&#125;</span><br><span class="line">		&#123;% bootstrap_css %&#125;</span><br><span class="line">		&#123;% bootstrap_javascript %&#125;</span><br><span class="line">		<span class="tag">&lt;<span class="name">title</span>&gt;</span>Guest Manage<span class="tag">&lt;/<span class="name">title</span>&gt;</span> </span><br><span class="line">	<span class="tag">&lt;/<span class="name">head</span>&gt;</span> </span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">body</span> <span class="attr">role</span>=<span class="string">"document"</span>&gt;</span> </span><br><span class="line">		<span class="comment">&lt;!-- 导航栏 --&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">nav</span> <span class="attr">class</span>=<span class="string">"navbar navbar-inverse navbar-fixed-top"</span>&gt;</span> </span><br><span class="line">			<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span> </span><br><span class="line">				<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"navbar-header"</span>&gt;</span> </span><br><span class="line">					<span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"navbar-brand"</span> <span class="attr">href</span>=<span class="string">"/event_manage/"</span>&gt;</span>Guest Manage System<span class="tag">&lt;/<span class="name">a</span>&gt;</span> </span><br><span class="line">				<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"navbar"</span> <span class="attr">class</span>=<span class="string">"collapse navbar-collapse"</span>&gt;</span> </span><br><span class="line">					<span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"nav navbar-nav"</span>&gt;</span> </span><br><span class="line">						<span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"active"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>发布会<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span> </span><br><span class="line">						<span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/guest_manage/"</span>&gt;</span>嘉宾<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span> </span><br><span class="line">					<span class="tag">&lt;/<span class="name">ul</span>&gt;</span> </span><br><span class="line">					<span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"nav navbar-nav navbar-right"</span>&gt;</span> </span><br><span class="line">						<span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>&#123;&#123;user&#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span> </span><br><span class="line">						<span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/logout/"</span>&gt;</span>退出<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span> </span><br><span class="line">					<span class="tag">&lt;/<span class="name">ul</span>&gt;</span> </span><br><span class="line">				<span class="tag">&lt;/<span class="name">div</span>&gt;</span> </span><br><span class="line">			<span class="tag">&lt;/<span class="name">div</span>&gt;</span> </span><br><span class="line">		<span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span><br><span class="line">		</span><br><span class="line">		<span class="comment">&lt;!--发布会搜索表单--&gt;</span> </span><br><span class="line">			<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"page-header"</span> <span class="attr">style</span>=<span class="string">"padding-top: 60px;"</span>&gt;</span> </span><br><span class="line">				<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"navbar"</span> <span class="attr">class</span>=<span class="string">"navbar-collapse collapse"</span>&gt;</span> </span><br><span class="line">					<span class="tag">&lt;<span class="name">form</span> <span class="attr">class</span>=<span class="string">"navbar-form"</span> <span class="attr">method</span>=<span class="string">"get"</span> <span class="attr">action</span>=<span class="string">"/search_name/"</span>&gt;</span> </span><br><span class="line">						<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span> </span><br><span class="line">							<span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"name"</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">placeholder</span>=<span class="string">"名称"</span> <span class="attr">class</span>=<span class="string">"form-control"</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;/<span class="name">div</span>&gt;</span> </span><br><span class="line">						<span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">class</span>=<span class="string">"btn btn-success"</span>&gt;</span>搜索<span class="tag">&lt;/<span class="name">button</span>&gt;</span> </span><br><span class="line">					<span class="tag">&lt;/<span class="name">form</span>&gt;</span> </span><br><span class="line">				<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">		</span><br><span class="line">		<span class="comment">&lt;!-- 发布会列表 --&gt;</span> </span><br><span class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row"</span> <span class="attr">style</span>=<span class="string">"padding-top: 80px;"</span>&gt;</span> </span><br><span class="line">			<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-md-6"</span>&gt;</span> </span><br><span class="line">				<span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">"table table-striped"</span>&gt;</span> </span><br><span class="line">					<span class="tag">&lt;<span class="name">thead</span>&gt;</span> </span><br><span class="line">						<span class="tag">&lt;<span class="name">tr</span>&gt;</span> </span><br><span class="line">							<span class="tag">&lt;<span class="name">th</span>&gt;</span>id<span class="tag">&lt;/<span class="name">th</span>&gt;</span><span class="tag">&lt;<span class="name">th</span>&gt;</span>名称<span class="tag">&lt;/<span class="name">th</span>&gt;</span><span class="tag">&lt;<span class="name">th</span>&gt;</span>状态<span class="tag">&lt;/<span class="name">th</span>&gt;</span><span class="tag">&lt;<span class="name">th</span>&gt;</span>地址<span class="tag">&lt;/<span class="name">th</span>&gt;</span><span class="tag">&lt;<span class="name">th</span>&gt;</span>时间<span class="tag">&lt;/<span class="name">th</span>&gt;</span> </span><br><span class="line">							<span class="tag">&lt;<span class="name">th</span>&gt;</span>签到<span class="tag">&lt;/<span class="name">th</span>&gt;</span> </span><br><span class="line">						<span class="tag">&lt;/<span class="name">tr</span>&gt;</span> </span><br><span class="line">					<span class="tag">&lt;/<span class="name">thead</span>&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">tbody</span>&gt;</span> </span><br><span class="line">						&#123;% for event in events %&#125; </span><br><span class="line">							<span class="tag">&lt;<span class="name">tr</span>&gt;</span> </span><br><span class="line">								<span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; event.id &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span> </span><br><span class="line">								<span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; event.name &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span> </span><br><span class="line">								<span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; event.status &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span> </span><br><span class="line">								<span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; event.address &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span> </span><br><span class="line">								<span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; event.start_time &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span> </span><br><span class="line">								<span class="tag">&lt;<span class="name">td</span>&gt;</span> <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/sign_index/&#123;&#123; event.id &#125;&#125;/"</span> <span class="attr">target</span>=<span class="string">"&#123;&#123; event.id &#125;&#125;_blank"</span>&gt;</span> sign<span class="tag">&lt;/<span class="name">a</span>&gt;</span> <span class="tag">&lt;/<span class="name">td</span>&gt;</span> </span><br><span class="line">							<span class="tag">&lt;/<span class="name">tr</span>&gt;</span> </span><br><span class="line">						&#123;% endfor %&#125; </span><br><span class="line">					<span class="tag">&lt;/<span class="name">tbody</span>&gt;</span></span><br><span class="line">				<span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">div</span>&gt;</span> </span><br><span class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>guest/sign/templates/guest_manage.html<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"zh-CN"</span>&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span> </span><br><span class="line">		&#123;% load bootstrap3 %&#125;</span><br><span class="line">		&#123;% bootstrap_css %&#125;</span><br><span class="line">		&#123;% bootstrap_javascript %&#125;</span><br><span class="line">		<span class="tag">&lt;<span class="name">title</span>&gt;</span>Guest Manage<span class="tag">&lt;/<span class="name">title</span>&gt;</span> </span><br><span class="line">	<span class="tag">&lt;/<span class="name">head</span>&gt;</span> </span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">body</span> <span class="attr">role</span>=<span class="string">"document"</span>&gt;</span> </span><br><span class="line">		<span class="comment">&lt;!-- 导航栏 --&gt;</span> </span><br><span class="line">		<span class="tag">&lt;<span class="name">nav</span> <span class="attr">class</span>=<span class="string">"navbar navbar-inverse navbar-fixed-top"</span>&gt;</span> </span><br><span class="line">			<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span> </span><br><span class="line">				<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"navbar-header"</span>&gt;</span> </span><br><span class="line">					<span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"navbar-brand"</span> <span class="attr">href</span>=<span class="string">"/event_manage/"</span>&gt;</span>Guest Manage System<span class="tag">&lt;/<span class="name">a</span>&gt;</span> </span><br><span class="line">				<span class="tag">&lt;/<span class="name">div</span>&gt;</span> </span><br><span class="line">				<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"navbar"</span> <span class="attr">class</span>=<span class="string">"collapse navbar-collapse"</span>&gt;</span> </span><br><span class="line">					<span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"nav navbar-nav"</span>&gt;</span></span><br><span class="line">						<span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/event_manage/"</span>&gt;</span>发布会<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span> </span><br><span class="line">						<span class="tag">&lt;<span class="name">li</span> <span class="attr">class</span>=<span class="string">"active"</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>嘉宾<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span> </span><br><span class="line">					<span class="tag">&lt;/<span class="name">ul</span>&gt;</span> </span><br><span class="line">					<span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"nav navbar-nav navbar-right"</span>&gt;</span> </span><br><span class="line">						<span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>&#123;&#123;user&#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span> </span><br><span class="line">						<span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/logout/"</span>&gt;</span>退出<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span> </span><br><span class="line">					<span class="tag">&lt;/<span class="name">ul</span>&gt;</span> </span><br><span class="line">				<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">			<span class="tag">&lt;/<span class="name">div</span>&gt;</span> </span><br><span class="line">		<span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span><br><span class="line">		</span><br><span class="line">		<span class="comment">&lt;!-- 嘉宾列表 --&gt;</span> </span><br><span class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"row"</span> <span class="attr">style</span>=<span class="string">"padding-top: 80px;"</span>&gt;</span> </span><br><span class="line">			<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"col-md-6"</span>&gt;</span> </span><br><span class="line">				<span class="tag">&lt;<span class="name">table</span> <span class="attr">class</span>=<span class="string">"table table-striped"</span>&gt;</span> </span><br><span class="line">					<span class="tag">&lt;<span class="name">thead</span>&gt;</span> </span><br><span class="line">						<span class="tag">&lt;<span class="name">tr</span>&gt;</span> </span><br><span class="line">							<span class="tag">&lt;<span class="name">th</span>&gt;</span>id<span class="tag">&lt;/<span class="name">th</span>&gt;</span><span class="tag">&lt;<span class="name">th</span>&gt;</span>名称<span class="tag">&lt;/<span class="name">th</span>&gt;</span><span class="tag">&lt;<span class="name">th</span>&gt;</span>手机<span class="tag">&lt;/<span class="name">th</span>&gt;</span><span class="tag">&lt;<span class="name">th</span>&gt;</span>Email<span class="tag">&lt;/<span class="name">th</span>&gt;</span><span class="tag">&lt;<span class="name">th</span>&gt;</span>签到<span class="tag">&lt;/<span class="name">th</span>&gt;</span> </span><br><span class="line">							<span class="tag">&lt;<span class="name">th</span>&gt;</span>发布会<span class="tag">&lt;/<span class="name">th</span>&gt;</span> </span><br><span class="line">						<span class="tag">&lt;/<span class="name">tr</span>&gt;</span> </span><br><span class="line">					<span class="tag">&lt;/<span class="name">thead</span>&gt;</span> </span><br><span class="line">					<span class="tag">&lt;<span class="name">tbody</span>&gt;</span> </span><br><span class="line">						&#123;% for guest in guests %&#125; </span><br><span class="line">							<span class="tag">&lt;<span class="name">tr</span>&gt;</span> </span><br><span class="line">								<span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; guest.id &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span> </span><br><span class="line">								<span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; guest.realname &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span> </span><br><span class="line">								<span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; guest.phone &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span> </span><br><span class="line">								<span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; guest.email &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span> </span><br><span class="line">								<span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; guest.sign &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span> </span><br><span class="line">								<span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123; guest.event &#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span> </span><br><span class="line">							<span class="tag">&lt;/<span class="name">tr</span>&gt;</span> </span><br><span class="line">						&#123;% endfor %&#125; </span><br><span class="line">					<span class="tag">&lt;/<span class="name">tbody</span>&gt;</span> </span><br><span class="line">				<span class="tag">&lt;/<span class="name">table</span>&gt;</span> </span><br><span class="line">			<span class="tag">&lt;/<span class="name">div</span>&gt;</span> </span><br><span class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">		</span><br><span class="line">		<span class="comment">&lt;!-- 列表分页器 --&gt;</span> </span><br><span class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"pagination"</span>&gt;</span> </span><br><span class="line">			<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"step-links"</span>&gt;</span></span><br><span class="line">				&#123;% if guests.has_previous %&#125; </span><br><span class="line">					<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"?page=&#123;&#123; guests.previous_page_number &#125;&#125;"</span>&gt;</span>previous<span class="tag">&lt;/<span class="name">a</span>&gt;</span> </span><br><span class="line">				&#123;% endif %&#125; </span><br><span class="line">					<span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">"current"</span>&gt;</span> </span><br><span class="line">						Page &#123;&#123; guests.number &#125;&#125; of &#123;&#123; guests.paginator.num_pages &#125;&#125;. </span><br><span class="line">					<span class="tag">&lt;/<span class="name">span</span>&gt;</span> </span><br><span class="line">				&#123;% if guests.has_next %&#125; </span><br><span class="line">					<span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"?page=&#123;&#123; guests.next_page_number &#125;&#125;"</span>&gt;</span>next<span class="tag">&lt;/<span class="name">a</span>&gt;</span> </span><br><span class="line">				&#123;% endif %&#125; </span><br><span class="line">			<span class="tag">&lt;/<span class="name">span</span>&gt;</span> </span><br><span class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>guest/sign/templates/sign_index.html<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"zh-CN"</span>&gt;</span> </span><br><span class="line">	<span class="tag">&lt;<span class="name">head</span>&gt;</span> </span><br><span class="line">		&#123;% load bootstrap3 %&#125;</span><br><span class="line">		&#123;% bootstrap_css %&#125;</span><br><span class="line">		&#123;% bootstrap_javascript %&#125;</span><br><span class="line">		<span class="tag">&lt;<span class="name">title</span>&gt;</span>Guest Manage<span class="tag">&lt;/<span class="name">title</span>&gt;</span> </span><br><span class="line">	<span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">body</span> <span class="attr">role</span>=<span class="string">"document"</span>&gt;</span> </span><br><span class="line">		<span class="comment">&lt;!-- 导航栏 --&gt;</span> </span><br><span class="line">		<span class="tag">&lt;<span class="name">nav</span> <span class="attr">class</span>=<span class="string">"navbar navbar-inverse navbar-fixed-top"</span>&gt;</span> </span><br><span class="line">			<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"container"</span>&gt;</span> </span><br><span class="line">				<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"navbar-header"</span>&gt;</span> </span><br><span class="line">					<span class="comment">&lt;!--将页面标题设置为发布会名称--&gt;</span></span><br><span class="line">					<span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">"navbar-brand"</span> <span class="attr">href</span>=<span class="string">"#"</span>&gt;</span>&#123;&#123; event.name &#125;&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span> </span><br><span class="line">				<span class="tag">&lt;/<span class="name">div</span>&gt;</span> </span><br><span class="line">				<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"navbar"</span> <span class="attr">class</span>=<span class="string">"collapse navbar-collapse"</span>&gt;</span> </span><br><span class="line">					<span class="tag">&lt;<span class="name">ul</span> <span class="attr">class</span>=<span class="string">"nav navbar-nav"</span>&gt;</span> </span><br><span class="line">						<span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/event_manage/"</span>&gt;</span>发布会<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span> </span><br><span class="line">						<span class="tag">&lt;<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">"/guest_manage/"</span>&gt;</span>嘉宾<span class="tag">&lt;/<span class="name">a</span>&gt;</span><span class="tag">&lt;/<span class="name">li</span>&gt;</span> </span><br><span class="line">					<span class="tag">&lt;/<span class="name">ul</span>&gt;</span> </span><br><span class="line">				<span class="tag">&lt;/<span class="name">div</span>&gt;</span> </span><br><span class="line">			<span class="tag">&lt;/<span class="name">div</span>&gt;</span> </span><br><span class="line">		<span class="tag">&lt;/<span class="name">nav</span>&gt;</span></span><br><span class="line">		</span><br><span class="line">		<span class="comment">&lt;!-- 签到功能 --&gt;</span> </span><br><span class="line">		<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"page-header"</span> <span class="attr">style</span>=<span class="string">"padding-top: 80px;"</span>&gt;</span> </span><br><span class="line">			<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">"navbar"</span> <span class="attr">class</span>=<span class="string">"navbar-collapse collapse"</span>&gt;</span> </span><br><span class="line">				<span class="tag">&lt;<span class="name">form</span> <span class="attr">class</span>=<span class="string">"navbar-form"</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">action</span>=<span class="string">"/sign_index_action/&#123;&#123; event.id &#125;&#125;/"</span>&gt;</span> </span><br><span class="line">					<span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">"form-group"</span>&gt;</span> </span><br><span class="line">						<span class="tag">&lt;<span class="name">input</span> <span class="attr">name</span>=<span class="string">"phone"</span> <span class="attr">type</span>=<span class="string">"text"</span> <span class="attr">placeholder</span>=<span class="string">"输入手机号"</span> <span class="attr">class</span>=<span class="string">"form-control"</span>&gt;</span> </span><br><span class="line">					<span class="tag">&lt;/<span class="name">div</span>&gt;</span> </span><br><span class="line">					<span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">class</span>=<span class="string">"btn btn-success"</span>&gt;</span>签到<span class="tag">&lt;/<span class="name">button</span>&gt;</span> </span><br><span class="line">					&#123;% csrf_token %&#125;</span><br><span class="line">					<span class="tag">&lt;<span class="name">font</span> <span class="attr">color</span>=<span class="string">"red"</span>&gt;</span> </span><br><span class="line">						<span class="tag">&lt;<span class="name">br</span>&gt;</span>&#123;&#123; hint &#125;&#125; </span><br><span class="line">						<span class="tag">&lt;<span class="name">br</span>&gt;</span>&#123;&#123; guest.realname &#125;&#125; </span><br><span class="line">						<span class="tag">&lt;<span class="name">br</span>&gt;</span>&#123;&#123; guest.phone &#125;&#125; </span><br><span class="line">					<span class="tag">&lt;/<span class="name">font</span>&gt;</span> </span><br><span class="line">				<span class="tag">&lt;/<span class="name">form</span>&gt;</span> </span><br><span class="line">			<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<h3 id="2、django-rest项目"><a href="#2、django-rest项目" class="headerlink" title="2、django_rest项目"></a>2、django_rest项目</h3><blockquote>
<ul>
<li>django_rest/<ul>
<li>django_rest/<ul>
<li>__init__.py</li>
<li>settings.py</li>
<li>urls.py</li>
<li>wsgi.py</li>
</ul>
</li>
<li>api/<ul>
<li>migrations/<ul>
<li>__init__.py</li>
<li>0001_initial.py</li>
</ul>
</li>
<li>__init__.py</li>
<li>admin.py</li>
<li>apps.py</li>
<li>models.py</li>
<li>serializers.py</li>
<li>tests.py</li>
<li>views.py</li>
</ul>
</li>
<li>db.sqlite3</li>
<li>manage.py</li>
</ul>
</li>
</ul>
</blockquote>
<p>guest/django_rest/settings.py<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="comment"># 在文件末尾添加 </span></span><br><span class="line">REST_FRAMEWORK = &#123; </span><br><span class="line">	<span class="string">'DEFAULT_PERMISSION_CLASSES'</span>: (<span class="string">'rest_framework.permissions.IsAdminUser'</span>,), </span><br><span class="line">	<span class="string">'PAGE_SIZE'</span>: <span class="number">10</span> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>guest/django_rest/urls.py<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib <span class="keyword">import</span> admin</span><br><span class="line"><span class="keyword">from</span> django.urls <span class="keyword">import</span> path</span><br><span class="line"><span class="keyword">from</span> django.conf.urls <span class="keyword">import</span> url, include</span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> routers</span><br><span class="line"><span class="keyword">from</span> api <span class="keyword">import</span> views</span><br><span class="line"></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">因为我们使用的是 viewset，所以我们可以使用 routers 类自动生成 URLconf</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="comment">#Routers provide an easy way of automatically determining the URL conf. </span></span><br><span class="line">router = routers.DefaultRouter()</span><br><span class="line">router.register(<span class="string">r'users'</span>,views.UserViewSet)</span><br><span class="line">router.register(<span class="string">r'groups'</span>,views.GroupViewSet)</span><br><span class="line">router.register(<span class="string">r'event'</span>, views.EventViewSet) </span><br><span class="line">router.register(<span class="string">r'guest'</span>, views.GuestViewSet)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Wire up our API using automatic URL routing. </span></span><br><span class="line"><span class="comment"># Additionally, we include login URLs for the browsable API. </span></span><br><span class="line">urlpatterns = [</span><br><span class="line">    path(<span class="string">'admin/'</span>, admin.site.urls),</span><br><span class="line">	url(<span class="string">r'^'</span>, include(router.urls)),</span><br><span class="line">	url(<span class="string">r'api-auth/'</span>, include(<span class="string">'rest_framework.urls'</span>,namespace=<span class="string">'rest_framework'</span>))</span><br><span class="line">]</span><br></pre></td></tr></table></figure></p>
<p>guest/api/models.py<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.db <span class="keyword">import</span> models</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create your models here.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 发布会</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Event</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">	name = models.CharField(max_length=<span class="number">100</span>)</span><br><span class="line">	limit = models.IntegerField()</span><br><span class="line">	status = models.BooleanField()</span><br><span class="line">	address = models.CharField(max_length=<span class="number">200</span>)</span><br><span class="line">	start_time = models.DateTimeField(<span class="string">'events time'</span>)</span><br><span class="line">	create_time = models.DateTimeField(auto_now=<span class="keyword">True</span>)</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">		<span class="keyword">return</span> self.name</span><br><span class="line"></span><br><span class="line"><span class="comment"># 嘉宾</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Guest</span><span class="params">(models.Model)</span>:</span></span><br><span class="line">	event = models.ForeignKey(Event, on_delete=models.CASCADE)</span><br><span class="line">	realname = models.CharField(max_length=<span class="number">64</span>)</span><br><span class="line">	phone = models.CharField(max_length=<span class="number">16</span>)</span><br><span class="line">	email = models.EmailField() </span><br><span class="line">	sign = models.BooleanField() </span><br><span class="line">	create_time = models.DateTimeField(auto_now=<span class="keyword">True</span>)</span><br><span class="line"></span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">		unique_together = (<span class="string">'phone'</span>, <span class="string">'event'</span>)</span><br><span class="line">		</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">		<span class="keyword">return</span> self.realname</span><br></pre></td></tr></table></figure></p>
<p>guest/api/serializers.py<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.contrib.auth.models <span class="keyword">import</span> User, Group</span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> serializers</span><br><span class="line"><span class="keyword">from</span> api.models <span class="keyword">import</span> Event, Guest</span><br><span class="line"></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">使用的是 HyperlinkedModelSerializer，也可以使用主键或者其他关系。</span></span><br><span class="line"><span class="string">但使用 HyperlinkedModelSerializer 是一个好的 RESTful 设计</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserSerializer</span><span class="params">(serializers.HyperlinkedModelSerializer)</span>:</span></span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">		model = User</span><br><span class="line">		fields = (<span class="string">'url'</span>, <span class="string">'username'</span>, <span class="string">'email'</span>, <span class="string">'groups'</span>)</span><br><span class="line">		</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GroupSerializer</span><span class="params">(serializers.HyperlinkedModelSerializer)</span>:</span></span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span></span><br><span class="line">		model = Group</span><br><span class="line">		fields = (<span class="string">'url'</span>, <span class="string">'name'</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EventSerializer</span><span class="params">(serializers.HyperlinkedModelSerializer)</span>:</span> </span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span> </span><br><span class="line">		model = Event </span><br><span class="line">		fields = (<span class="string">'url'</span>,<span class="string">'name'</span>,<span class="string">'address'</span>,<span class="string">'start_time'</span>,<span class="string">'limit'</span>,<span class="string">'status'</span>)</span><br><span class="line">		</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GuestSerializer</span><span class="params">(serializers.HyperlinkedModelSerializer)</span>:</span> </span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">Meta</span>:</span> </span><br><span class="line">		model = Guest </span><br><span class="line">		fields = (<span class="string">'url'</span>,<span class="string">'realname'</span>,<span class="string">'phone'</span>,<span class="string">'email'</span>,<span class="string">'sign'</span>,<span class="string">'event'</span>)</span><br></pre></td></tr></table></figure></p>
<p>guest/api/views.py<br><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> django.shortcuts <span class="keyword">import</span> render</span><br><span class="line"><span class="keyword">from</span> django.contrib.auth.models <span class="keyword">import</span> User, Group</span><br><span class="line"><span class="keyword">from</span> rest_framework <span class="keyword">import</span> viewsets</span><br><span class="line"><span class="keyword">from</span> api.serializers <span class="keyword">import</span> UserSerializer, GroupSerializer</span><br><span class="line"><span class="keyword">from</span> api.serializers <span class="keyword">import</span> EventSerializer, GuestSerializer </span><br><span class="line"><span class="keyword">from</span> api.models <span class="keyword">import</span> Event, Guest</span><br><span class="line"></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">在 django RESTframework 中，所有常见的行为都被归到 ViewSets 中。</span></span><br><span class="line"><span class="string">当然我们可以将这些行为分拆出 来，但使用 ViewSets，使 view 的逻辑更为清楚。</span></span><br><span class="line"><span class="string">使用 queryset 和 serializer_class 使我们能更好的控制 API 行为，这也是我们推荐的使用方式。</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Create your views here.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ViewSets define the view behavior.</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">UserViewSet</span><span class="params">(viewsets.ModelViewSet)</span>:</span></span><br><span class="line">	<span class="string">""" </span></span><br><span class="line"><span class="string">	API endpoint that allows users to be viewed or edited. </span></span><br><span class="line"><span class="string">	"""</span> </span><br><span class="line">	queryset = User.objects.all().order_by(<span class="string">'-date_joined'</span>)</span><br><span class="line">	serializer_class = UserSerializer</span><br><span class="line">	</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GroupViewSet</span><span class="params">(viewsets.ModelViewSet)</span>:</span> </span><br><span class="line">	<span class="string">""" </span></span><br><span class="line"><span class="string">	API endpoint that allows groups to be viewed or edited. </span></span><br><span class="line"><span class="string">	"""</span> </span><br><span class="line">	queryset = Group.objects.all()</span><br><span class="line">	serializer_class = GroupSerializer</span><br><span class="line">	</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">EventViewSet</span><span class="params">(viewsets.ModelViewSet)</span>:</span> </span><br><span class="line">	<span class="string">""" </span></span><br><span class="line"><span class="string">	API endpoint that allows events to be viewed or edited. </span></span><br><span class="line"><span class="string">	"""</span></span><br><span class="line">	queryset = Event.objects.all()</span><br><span class="line">	serializer_class = EventSerializer</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">GuestViewSet</span><span class="params">(viewsets.ModelViewSet)</span>:</span></span><br><span class="line">	<span class="string">""" </span></span><br><span class="line"><span class="string">	API endpoint that allows guests to be viewed or edited. </span></span><br><span class="line"><span class="string">	"""</span></span><br><span class="line">	queryset = Guest.objects.all()</span><br><span class="line">	serializer_class = GuestSerializer</span><br></pre></td></tr></table></figure></p>
<h1 id="持续更新…"><a href="#持续更新…" class="headerlink" title="持续更新…"></a><em>持续更新…</em></h1>
            <div class="post-copyright">
    <div class="content">
        <p>最后更新： 2018年08月11日 15:57</p>
        <p>原始链接： <a class="post-url" href="/2018/06/01/django-虫师-笔记/" title="django-虫师-笔记">http://pythonfood.github.io/2018/06/01/django-虫师-笔记/</a></p>
        <footer>
            <a href="http://pythonfood.github.io">
                <img src="/images/logo.png" alt="Python Food">
                Python Food
            </a>
        </footer>
    </div>
</div>

      
        
            
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;">赏</a>
</div>

<div id="reward" class="post-modal reward-lay">
    <a class="close" href="javascript:;" id="reward-close">×</a>
    <span class="reward-title">
        <i class="icon icon-quote-left"></i>
        多少都行~
        <i class="icon icon-quote-right"></i>
    </span>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/images/wechat_code.jpg" alt="打赏二维码">
        </div>
        <div class="reward-select">
            
            <label class="reward-select-item checked" data-id="wechat" data-wechat="/images/wechat_code.jpg">
                <img class="reward-select-item-wechat" src="/images/wechat.png" alt="微信">
            </label>
            
            
            <label class="reward-select-item" data-id="alipay" data-alipay="/images/alipay_code.jpg">
                <img class="reward-select-item-alipay" src="/images/alipay.png" alt="支付宝">
            </label>
            
        </div>
    </div>
</div>


        
    </div>
    <footer class="article-footer">
        
        
<div class="post-share">
    <a href="javascript:;" id="share-sub" class="post-share-fab">
        <i class="fa fa-share-alt"></i>
    </a>
    <div class="post-share-list" id="share-list">
        <ul class="share-icons">
          <li>
            <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://pythonfood.github.io/2018/06/01/django-虫师-笔记/&title=《django-虫师-笔记》 — PythonFood&pic=/images/banner.jpg" data-title="微博">
              <i class="fa fa-weibo"></i>
            </a>
          </li>
          <li>
            <a class="weixin share-sns" id="wxFab" href="javascript:;" data-title="微信">
              <i class="fa fa-weixin"></i>
            </a>
          </li>
          <li>
            <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://pythonfood.github.io/2018/06/01/django-虫师-笔记/&title=《django-虫师-笔记》 — PythonFood&source=虫师所写django签到系统的学习笔记。" data-title="QQ">
              <i class="fa fa-qq"></i>
            </a>
          </li>
          <li>
            <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://pythonfood.github.io/2018/06/01/django-虫师-笔记/" data-title="Facebook">
              <i class="fa fa-facebook"></i>
            </a>
          </li>
          <li>
            <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《django-虫师-笔记》 — PythonFood&url=http://pythonfood.github.io/2018/06/01/django-虫师-笔记/&via=http://pythonfood.github.io" data-title="Twitter">
              <i class="fa fa-twitter"></i>
            </a>
          </li>
          <li>
            <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://pythonfood.github.io/2018/06/01/django-虫师-笔记/" data-title="Google+">
              <i class="fa fa-google-plus"></i>
            </a>
          </li>
        </ul>
     </div>
</div>
<div class="post-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;" id="wxShare-close">×</a>
    <p>扫一扫，分享到微信</p>
    <img src="//api.qrserver.com/v1/create-qr-code/?data=http://pythonfood.github.io/2018/06/01/django-虫师-笔记/" alt="微信分享二维码">
</div>

<div class="mask"></div>

        
        <ul class="article-footer-menu">
            
            
  <li class="article-footer-tags">
    <i class="fa fa-tags"></i>
      
    <a href="/tags/django/" class="color2">django</a>
      
  </li>

        </ul>
        
    </footer>
  </div>
</article>


    <aside class="post-toc-pos post-toc-top" id="post-toc">
        <nav class="post-toc-wrap">
            <ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#一、Hello-Django"><span class="post-toc-text">一、Hello Django</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#二、Views-视图"><span class="post-toc-text">二、Views 视图</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#三、Model-模型"><span class="post-toc-text">三、Model 模型</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#四、Template-模板"><span class="post-toc-text">四、Template 模板</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#五、开发-Web-接口"><span class="post-toc-text">五、开发 Web 接口</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#六、接口的安全机制"><span class="post-toc-text">六、接口的安全机制</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#七、REST-API"><span class="post-toc-text">七、REST API</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#八、项目代码"><span class="post-toc-text">八、项目代码</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#1、guest项目"><span class="post-toc-text">1、guest项目</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#2、django-rest项目"><span class="post-toc-text">2、django_rest项目</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#持续更新…"><span class="post-toc-text">持续更新…</span></a>
        </nav>
    </aside>
    

<nav id="article-nav">
  
  
    <a href="/2018/05/01/持续集成-jenkins/" id="article-nav-older" class="article-nav-link-wrap">
      <span class="article-nav-title">持续集成-jenkins</span>
      <i class="fa fa-hand-o-right" aria-hidden="true"></i>
    </a>
  
</nav>



    
        <div id="SOHUCS" sid="django-虫师-笔记" ></div>
<script type="text/javascript">
    (function(){
        var appid = 'cytnRgqDg';
        var conf = '61714297a608dcad6779ec4ea0059b2a';
        var width = window.innerWidth || document.documentElement.clientWidth;
        if (width < 960) {
            window.document.write('<script id="changyan_mobile_js" charset="utf-8" type="text/javascript" src="https://changyan.sohu.com/upload/mobile/wap-js/changyan_mobile.js?client_id=' + appid + '&conf=' + conf + '"><\/script>'); } else { var loadJs=function(d,a){var c=document.getElementsByTagName("head")[0]||document.head||document.documentElement;var b=document.createElement("script");b.setAttribute("type","text/javascript");b.setAttribute("charset","UTF-8");b.setAttribute("src",d);if(typeof a==="function"){if(window.attachEvent){b.onreadystatechange=function(){var e=b.readyState;if(e==="loaded"||e==="complete"){b.onreadystatechange=null;a()}}}else{b.onload=a}}c.appendChild(b)};loadJs("https://changyan.sohu.com/upload/changyan.js",function(){window.changyan.api.config({appid:appid,conf:conf})}); } })(); </script>
    
</section>
        
      </div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info" class="inner">
      
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


      <p>
        Powered by  <a href="http://hexo.io/" target="_blank">Hexo</a>
        Theme <a href="//github.com/wongminho/hexo-theme-miho" target="_blank">MiHo</a>
      &copy; 2018 Python Food<br>
      </p>
    </div>
  </div>
</footer>
    <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<script src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script>
<script>
  var mihoConfig = {
      root: "http://pythonfood.github.io",
      animate: true,
      isHome: false,
      share: true,
      reward: 1
  }
</script>
<div class="sidebar">
    <div id="sidebar-search" title="Search">
        <i class="fa fa-search"></i>
    </div>
    <div id="sidebar-category" title="Categories">
        <i class="fa fa-book"></i>
    </div>
    <div id="sidebar-tag" title="Tags">
        <i class="fa fa-tags"></i>
    </div>
    <div id="sidebar-top">
        <span class="sidebar-top-icon"><i class="fa fa-angle-up"></i></span>
    </div>
</div>
<div class="sidebar-menu-box" id="sidebar-menu-box">
    <div class="sidebar-menu-box-container">
        <div id="sidebar-menu-box-categories">
            <a class="category-link" href="/categories/app测试/">app测试</a><a class="category-link" href="/categories/django/">django</a><a class="category-link" href="/categories/github/">github</a><a class="category-link" href="/categories/hexo/">hexo</a><a class="category-link" href="/categories/linux/">linux</a><a class="category-link" href="/categories/markdown/">markdown</a><a class="category-link" href="/categories/mysql/">mysql</a><a class="category-link" href="/categories/python/">python</a><a class="category-link" href="/categories/web测试/">web测试</a><a class="category-link" href="/categories/持续集成/">持续集成</a><a class="category-link" href="/categories/接口测试/">接口测试</a><a class="category-link" href="/categories/测试框架/">测试框架</a><a class="category-link" href="/categories/测试用例/">测试用例</a>
        </div>
        <div id="sidebar-menu-box-tags">
            <a href="/tags/adb/" style="font-size: 10px;">adb</a> <a href="/tags/appium/" style="font-size: 14px;">appium</a> <a href="/tags/app测试/" style="font-size: 10px;">app测试</a> <a href="/tags/django/" style="font-size: 10px;">django</a> <a href="/tags/fiddler/" style="font-size: 10px;">fiddler</a> <a href="/tags/github/" style="font-size: 10px;">github</a> <a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/jenkins/" style="font-size: 10px;">jenkins</a> <a href="/tags/jmeter/" style="font-size: 10px;">jmeter</a> <a href="/tags/linux/" style="font-size: 10px;">linux</a> <a href="/tags/markdown/" style="font-size: 10px;">markdown</a> <a href="/tags/monkey/" style="font-size: 10px;">monkey</a> <a href="/tags/mysql/" style="font-size: 10px;">mysql</a> <a href="/tags/postman/" style="font-size: 10px;">postman</a> <a href="/tags/python/" style="font-size: 20px;">python</a> <a href="/tags/selenium/" style="font-size: 12px;">selenium</a> <a href="/tags/unittest/" style="font-size: 10px;">unittest</a> <a href="/tags/web测试/" style="font-size: 10px;">web测试</a> <a href="/tags/安卓性能/" style="font-size: 16px;">安卓性能</a> <a href="/tags/接口测试/" style="font-size: 10px;">接口测试</a> <a href="/tags/接口脚本/" style="font-size: 10px;">接口脚本</a> <a href="/tags/测试用例/" style="font-size: 18px;">测试用例</a>
        </div>
    </div>
    <a href="javascript:;" class="sidebar-menu-box-close">&times;</a>
</div>
<div class="mobile-header-menu-nav" id="mobile-header-menu-nav">
    <div class="mobile-header-menu-container">
        <span class="title">Menus</span>
        <ul class="mobile-header-menu-navbar">
            
            <li>
                <a  href="/">
                    <i class="fa fa-home"></i><span>Home</span>
                </a>
            </li>
            
            <li>
                <a  href="/archives">
                    <i class="fa fa-archive"></i><span>Archives</span>
                </a>
            </li>
            
            <li>
                <a  href="/about">
                    <i class="fa fa-user"></i><span>About</span>
                </a>
            </li>
            
        </ul>
    </div>
    <div class="mobile-header-tag-container">
        <span class="title">Tags</span>
        <div id="mobile-header-container-tags">
            <a href="/tags/adb/" style="font-size: 10px;">adb</a> <a href="/tags/appium/" style="font-size: 14px;">appium</a> <a href="/tags/app测试/" style="font-size: 10px;">app测试</a> <a href="/tags/django/" style="font-size: 10px;">django</a> <a href="/tags/fiddler/" style="font-size: 10px;">fiddler</a> <a href="/tags/github/" style="font-size: 10px;">github</a> <a href="/tags/hexo/" style="font-size: 10px;">hexo</a> <a href="/tags/jenkins/" style="font-size: 10px;">jenkins</a> <a href="/tags/jmeter/" style="font-size: 10px;">jmeter</a> <a href="/tags/linux/" style="font-size: 10px;">linux</a> <a href="/tags/markdown/" style="font-size: 10px;">markdown</a> <a href="/tags/monkey/" style="font-size: 10px;">monkey</a> <a href="/tags/mysql/" style="font-size: 10px;">mysql</a> <a href="/tags/postman/" style="font-size: 10px;">postman</a> <a href="/tags/python/" style="font-size: 20px;">python</a> <a href="/tags/selenium/" style="font-size: 12px;">selenium</a> <a href="/tags/unittest/" style="font-size: 10px;">unittest</a> <a href="/tags/web测试/" style="font-size: 10px;">web测试</a> <a href="/tags/安卓性能/" style="font-size: 16px;">安卓性能</a> <a href="/tags/接口测试/" style="font-size: 10px;">接口测试</a> <a href="/tags/接口脚本/" style="font-size: 10px;">接口脚本</a> <a href="/tags/测试用例/" style="font-size: 18px;">测试用例</a>
        </div>
    </div>
</div>
<div class="search-wrap">
    <span class="search-close">&times;</span>
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
            <i class="icon icon-lg icon-chevron-left"></i>
        </a>
        <input class="search-field" placeholder="Search..." id="keywords">
        <a id="search-submit" href="javascript:;">
            <i class="fa fa-search"></i>
        </a>
    <div class="search-container" id="search-container">
        <ul class="search-result" id="search-result">
        </ul>
    </div>
</div>

<div id="search-tpl">
    <li class="search-result-item">
        <a href="{url}" class="search-item-li">
            <span class="search-item-li-title" title="{title}">{title}</span>
        </a>
    </li>
</div>
<script src="/js/search.js"></script>
<script src="/js/main.js"></script>


  <script src="//cdn.bootcss.com/particles.js/2.0.0/particles.min.js"></script>
  <div id="particles"></div>
  <script src="/js/particles.js"></script>







  <link rel="stylesheet" href="//cdn.bootcss.com/animate.css/3.5.0/animate.min.css">
  <script src="//cdn.bootcss.com/scrollReveal.js/3.0.5/scrollreveal.js"></script>
  <script src="/js/animate.js"></script>

  </div>
</body>
</html>